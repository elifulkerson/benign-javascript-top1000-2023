WH.News=new function(){const e=this;const t=WH.DOM;const n=WH.LocalStorage;const s=WH.Responsive;const a=WH.Tooltip;const i=["19"];this.addFeatureBoxTracking=function(){if(!WH.WAS){return}var e=WH.WAS.getChannelName();$(".row-features .feature-block a").each((function(){WH.Track.setLinkClickEvent(this,e,"News: Feature Image")}))};this.addNewsPostTracking=function(e){if(!e||!WH.WAS){return}var t=WH.WAS.getChannelName();$("a",e).each((function(){WH.Track.setLinkClickEvent(this,t,WH.News.determineNewsPostLinkArea)}))};this.addNotificationsWidget=function(e){let t=[{name:"discord",text:WH.TERMS.getDiscordNotifications_tip,link:"/webhook"},{name:"site",text:WH.TERMS.wowheadNewsNotifications_tip,link:"/notifications/settings"}];let n=Math.floor(Math.random()*t.length);e.dataset.notificationType=t[n].name;WH.ae(e,WH.ce("a",{classList:"news-post-footer-section-logo",href:t[n].link}));let s=t[n].text.split(/\%\d\$s/);let a=WH.ce("div",{classList:"news-post-footer-section-text"});if(s[0]){WH.ae(a,WH.ct(s[0]))}WH.ae(a,WH.ce("a",{href:t[n].link},WH.ct(s[1])));if(s[2]){WH.ae(a,WH.ct(s[2]))}WH.ae(e,a)};this.addPaginationButtonTooltip=function(e){WH.Tooltip.simple(e,e.ariaLabel,"q2")};this.addRecentNewsContentTracking=function(){if(!WH.WAS){return}let e=WH.WAS.getChannelName();WH.Track.setLinkClickEvent(WH.qs('.news-recent-posts[data-type="blue"] .imitation-heading a'),e,"News: Blue Tracker: Heading");WH.Track.setLinkClickEvent(WH.qs('.news-recent-posts[data-type="blue"] .news-recent-posts-view-all'),e,"News: Blue Tracker: View All");WH.qsa('.news-recent-posts[data-type="blue"] .news-recent-posts-rows-row a').forEach((function(t){WH.Track.setLinkClickEvent(t,e,"News: Blue Tracker: Post")}));WH.qsa('.news-recent-posts[data-type="news"] .news-recent-posts-rows-row a').forEach((function(t){WH.Track.setLinkClickEvent(t,e,"News: Recent News: Post")}))};this.deleteEntityCommentHandler=function(e,t){if(!confirm(WH.TERMS.deletecomment_tip)){return}WH.fetch(WH.Url.generatePath("/comment=delete"),{form:{id:e.id},success:()=>{t.deleteRows([e])},error:()=>{alert(WH.TERMS.internalerror_tip)}})};this.determineNewsPostLinkArea=function(e){if(e.parentNode&&e.parentNode.className){if(e.parentNode.className.indexOf("heading-size-")>-1&&e.parentNode.parentNode&&e.parentNode.parentNode.className&&e.parentNode.parentNode.className.indexOf("news-post-header-title-group")>-1){return"News - View Article (Heading)"}else if(e.parentNode.className.indexOf("tags")>-1){return"News - Tag"}else if(e.parentNode.className.indexOf("share-links")>-1){return"News - Share"}else if(e.parentNode.className.indexOf("news-post-footer-links")>-1){if(e.className){if(e.className.indexOf("fa-link")>-1){return"News - View Article (Permalink)"}else if(e.className.indexOf("fa-pencil")>-1){return"News - Edit (Text)"}}}}if(e.className){var t={"comments-numsm":"News - Comments (Text Count)","comments-btn":"News - Post a Comment","news-post-header-edit":"News - Edit (Heading)"};for(var n in t){if(e.className.indexOf(n)>-1&&t.hasOwnProperty(n)){return t[n]}}}if(e.getAttribute("rel")=="author"){return"News - Author"}return"News - Link in the body"};this.filterNewsLists=function(){if(!l()){return}let e=f();WH.qsa(".news-recent-posts-rows-row[data-type], .news-list-card").forEach((function(t){if(i.includes(t.dataset.type)||!e.includes(t.dataset.type)){t.dataset.visible="true"}else{t.dataset.visible="false"}}))};this.focusPostACommentForm=function(e,t){var n=document.forms["addcomment"];if(n){var s=WH.gE(n,"textarea")[0];if(t&&t.user&&t.body){s.value+="[quote="+t.user+"]"+t.body+"[/quote]\n\n";WH.setCaretPosition(s,s.value.length)}setTimeout(function(){WH.safeFocus(this)}.bind(s),25)}};this.getSubjectFromChild=function(e){var t=$(e).closest(".news-post");if(!t.length)return"Unknown";var n=$(".news-post-header-title-group .heading-size-1",t);if(!n.length)return"Unknown";var s=$("a",n);if(s.length){return s.html()}return n.html()};this.initContentSpotlight=function(){let e=false;let t=false;let n=WH.qs(".news-content-spotlight");let s=n.dataset.spotlight;if(s){n.dataset.hasText=JSON.stringify(e=o(s));n.dataset.hasIcons=JSON.stringify(t=r(s))}else{WH.error("Could not get spotlight name from .news-content-spotlight")}if(!e&&!t){WH.displayNone(".news-content-spotlight");return}$(".news-content-spotlight a").each((function(){this.rel="np";var e=this.dataset["class"];var t=WH.Wow.PlayerClass.getName(e);var n=WH.Wow.PlayerClass.Specialization.getName(this.dataset.spec);if(t&&n){WH.Tooltip.simpleNonTouch(this,WH.Strings.sprintf(WH.TERMS.specclass_format,n,t),"c"+e,{noWrap:true})}else{var s=WH.qs("img",this);if(s&&s.alt){WH.Tooltip.simpleNonTouch(this,s.alt,e?"c"+e:undefined)}}}))};this.initPinnedNewsScroller=()=>{const e=3;let t=WH.qs('.news-list[data-pinned="true"]');if((t&&parseInt(t.dataset.count)||0)<2){return}let n=false;let a=false;let i;let r=false;let o;let l=()=>{WH.aE(t,"mousedown",(e=>{if(!n){return}r=true;i=e.pageX-t.offsetLeft;o=t.scrollLeft}));WH.aE(t,"mouseup",(()=>{if(!n){return}r=false}));WH.aE(t,"mouseleave",(()=>{if(!n){return}r=false}));WH.aE(t,"mousemove",(s=>{if(!n||!r){return}s.preventDefault();let a=s.pageX-t.offsetLeft;let l=(a-i)*e;t.scrollLeft=o-l}));WH.aE(t,"scroll",(()=>{if(!n||!r){return}if(t.scrollLeft<=0){t.dataset.rightIndicator="true";t.dataset.leftIndicator="false"}else if(t.scrollLeft+t.clientWidth>=t.scrollWidth){t.dataset.rightIndicator="false";t.dataset.leftIndicator="true"}else{t.dataset.rightIndicator="true";t.dataset.leftIndicator="true"}}));a=true};let c=()=>{n=window.innerWidth<=s.BREAKPOINTS.MOBILE_MODE;t.dataset.scroller=JSON.stringify(n);if(n&&t.scrollWidth>t.clientWidth&&!a){l()}};c();WH.aE(window,"resize",c)};this.initRecentPosts=function(){let t=WH.getPageData("WH.News.recentPosts");let n=WH.qs(".news-recent");if(t.blueTracker&&t.blueTracker.length>0){c(n,"blue",WH.TERMS.bluetracker,WH.Url.generatePath("/blue-tracker"),t.blueTracker)}if(t.news&&t.news.length>0){c(n,"news",WH.TERMS.recentnews,WH.Url.generatePath("/news"),t.news)}e.addRecentNewsContentTracking();e.filterNewsLists()};this.setupListOptions=function(e,t){if(!l()){return}var n=$(e);if(!n.length){return}var s=[];for(var a in t){if(!t.hasOwnProperty(a)){continue}s.push([a,t[a],u.bind(null,a),null,{className:"news-type-color-"+a,checkedFunc:d.bind(null,a)}])}s.sort((function(e,t){return e[Menu.ITEM_LABEL].localeCompare(t[Menu.ITEM_LABEL])}));var i=WH.ce("span",{className:"news-list-type-options",onmousedown:WH.rf});WH.st(i,WH.TERMS.types+" ");WH.ae(i,WH.ce("span",{className:"fa fa-chevron-down"}));Menu.add(i,s);n.append(i)};this.undeleteEntityCommentHandler=function(e,t,n){if(!confirm(WH.TERMS.votetoundelete_tip)){return}WH.fetch(WH.Url.generatePath("/comment=undelete"),{form:{id:e.id},success:()=>{delete n.dataset.deleted;let e=WH.qs(".comment-lastedit-deleted",n);if(e){e.parentNode.removeChild(e)}let t=WH.qs(".comment-dateline span > a.undelete",n);if(t){t.parentNode.parentNode.removeChild(t.parentNode)}},error:()=>{alert(WH.TERMS.internalerror_tip)}})};function r(e){let t=WH.qs(".news-content-spotlight-class-guides");if(!t){WH.error("Could not find .news-content-spotlight-class-guides");return false}let n=Menu.getMenu("contentSpotlight_"+e+"_icons");if(!n){WH.log("No content spotlight icons menu with the name "+e);WH.displayNone(t);return false}let s=0;let a;for(let e,d=0;e=n[d];d++){if(!a||Menu.isHeading(e)&&a.hasChildNodes()){a=WH.ce("div",{className:"news-content-spotlight-class-guides-icons"});WH.ae(t,a)}if(Menu.isHeading(e)){var i=WH.ct(Menu.getLabel(e));var r=Menu.getItemUrl(e);if(r){i=WH.ce("a",{href:r},i)}a.parentNode.insertBefore(WH.getMajorHeading(i,2,4),a)}else{var o=WH.ce("a",{href:Menu.getItemUrl(e)});var l=Menu.getItemOptions(e);var c;if(l.className&&(c=/\bc(\d+)\b/.exec(l.className))){o.dataset["class"]=c[1]}var f=l.tinyIcon||WH.Icon.UNKNOWN;WH.ae(o,WH.ce("img",{src:WH.staticUrl+"/images/wow/icons/medium/"+f.toLowerCase()+".jpg",alt:Menu.getLabel(e)}));WH.ae(a,o)}s++}if(!s){WH.displayNone(t)}return s>0}function o(e){let t=WH.qs(".news-content-spotlight-main");if(!t){WH.error("Could not find .news-content-spotlight-main");return false}let n=Menu.getMenu("contentSpotlight_"+e+"_text");if(!n){WH.log("No content spotlight text menu with the name "+e);WH.displayNone(t);return false}let s=0;let a;let i;for(let e,c=0;e=n[c];c++){if(!a||Menu.isHeading(e)&&a.hasChildNodes()){a=WH.ce("div",{className:"news-content-spotlight-main-guides"});WH.ae(t,a);i=0}if(Menu.isHeading(e)){var r=Menu.getLabel(e);var o=Menu.getItemUrl(e);if(o){r=WH.ce("a",{href:o},WH.ct(r))}var l=n[c+1];if(l&&Menu.isHeading(l)){a.parentNode.insertBefore(WH.getMajorHeading(r,2),a)}else{WH.ae(a,WH.getMajorHeading(r,2,3))}}else{if(i++>0){WH.ae(a,WH.ct(" | "))}WH.ae(a,WH.ce("a",{href:Menu.getItemUrl(e)},WH.ct(Menu.getLabel(e))))}s++}if(!s){WH.displayNone(t)}return s>0}function l(){return WH.getDataEnv()===WH.dataEnv.MAIN&&n.isSupported()}function c(e,t,n,s,i){let r=WH.ce("div",{className:"news-recent-posts",dataset:{type:t}});WH.ae(e,r);let o=WH.ce("a",{href:s},WH.ct(n));WH.ae(r,WH.getImitationHeading(o,3));let l=WH.ce("a",{className:"news-recent-posts-view-all",href:s},WH.ct(WH.TERMS.viewall));WH.ae(r,l);let c=WH.ce("div",{className:"news-recent-posts-rows"});WH.ae(r,c);let f=[];i.forEach((function(e){let t=WH.ce("div",{className:"news-recent-posts-rows-row"});WH.ae(c,t);let n=WH.ce("var");if(e.pinned){n.classList.add("fa");n.classList.add("fa-thumb-tack");a.simple(n,WH.TERMS.stickyNews_tip,"q")}else{WH.st(n,e.time)}WH.ae(t,n);f.push(n);if(e.newsType){t.dataset.type=""+e.newsType;let n=WH.ce("span",{className:"news-type-color-"+e.newsType});a.simple(n,WH.term("news_format",e.newsTypeName),"q",{noWrap:true});WH.ae(t,n)}let s=WH.ce("a",{href:e.url},WH.ct(e.name));if(e.news){s.classList.add("fa","fa-bullhorn","fa-color-light-gray")}if(e.region){WH.ae(t,WH.ce("span",{className:"news-recent-posts-rows-row-region"},WH.ct(e.region)));s.classList.add("icon-"+e.region)}if(e.news||e.blue){s.classList.add("blizzard-blue")}WH.ae(t,s)}));let d=W.bind(undefined,f);WH.aE(window,"resize",d);requestAnimationFrame(d)}function f(){let e=n.get(n.KEY_NEWS_LIST_FILTER);return e&&Array.isArray(e)?e:[]}function d(e){return f().indexOf(e)===-1}function u(e){var t=f();if(t.indexOf(e)===-1){t.push(e);t.sort()}else{t.splice(t.indexOf(e),1)}n.set(n.KEY_NEWS_LIST_FILTER,t);WH.News.filterNewsLists()}function W(e){let n=0;let s=[];e.forEach((function(e){if(!t.isVisible(e)){return}s.push(e);n=Math.max(e.offsetWidth,n)}));s.forEach((function(e){e.style.flexBasis=n+"px"}))}};WH.onLoad((()=>{WH.Tooltips.titlesToTooltips(".date-tip[title]")}));