!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("wafer-caas",[],t):"object"==typeof exports?exports["wafer-caas"]=t():(e.wafer=e.wafer||{},e.wafer.wafers=e.wafer.wafers||{},e.wafer.wafers["wafer-caas"]=t())}("undefined"!=typeof self?self:this,function(){return function(e){function t(r){if(a[r])return a[r].exports;var i=a[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var a={};return t.m=e,t.c=a,t.d=function(e,a,r){t.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="https://s.yimg.com/aaq/wf/",t(t.s="./src/entry.js")}({"./src/base.js":function(e,t,a){"use strict";function r(){return o=a("./src/utils.js")}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o,c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},l=function(){function e(e,t){var a=[],r=!0,i=!1,n=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){i=!0,n=e}finally{try{!r&&o.return&&o.return()}finally{if(i)throw n}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),f=function e(t,a,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,a);if(void 0===i){var n=Object.getPrototypeOf(t);return null===n?void 0:e(n,a,r)}if("value"in i)return i.value;var s=i.get;if(void 0!==s)return s.call(r)},d=window.wafer,h=d.base,v=d.constants,m=d.utils,p=d.WaferBaseClass,w=v.ATTR_PREFIX,g=m.clearAndSetInnerHTML,y=m.clearTimeout,_=m.convertNodeListToArray,b=m.debounce,C=m.fetchWithCache,A=m.findAncestor,E=m.getConfigFromJSONScriptNode,k=m.getUrlParameterValueByName,P=m.getWaferForType,S=m.setTimeout,O=["caas-collapsed","caas-url","caas-uuid"],I={},R={},T=["wafer-jac","wafer-benji","wafer-darla"],N=function(e){function t(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=a.caasConfig,s=a.errorClass,o=a.selector,u=a.successClass;i(this,t);var f=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,{errorClass:s,selector:o,successClass:u},{STATE_ATTRS:O})),d=e.getAttribute(w+"caas-cache"),h=e.getAttribute(w+"caas-collapsed"),v=e.getAttribute(w+"caas-url"),m=e.getAttribute(w+"caas-uuid"),p=e.getAttribute(w+"caas-cache-strategy")||"cacheFirst",g=e.getAttribute(w+"caas-cache-ttl"),y=e.getAttribute("href"),_=e.getAttribute(w+"caas-prefetch"),b=e.getAttribute(w+"caas-prefetch-group"),C=e.getAttribute(w+"caas-timeout"),A=e.getAttribute(w+"caas-type")||"default",k=e.getAttribute(w+"caas-wrapper"),P=e.getAttribute(w+"caas-dependency"),I=e.getAttribute(w+"caas-has-rightrail-ads"),T=P&&document.querySelector(P),N=(e.getAttribute(w+"caas-trigger-offset")||"").split(" "),j=l(N,2),L=j[0],V=j[1],B=e.getAttribute(w+"caas-item-count-balanced"),x=e.getAttribute(w+"caas-target"),W=x&&e.querySelector(x)||e,D=e.getAttribute(w+"caas-trigger")||"viewport";if(f._util=c({},f._util,{"caas-collapsed":null===h||void 0===h?0:Number(h),"caas-url":v,"caas-uuid":m,cache:null===d||void 0===d?1:Number(d),caasConfig:r,cacheStrategy:p,cacheTtl:null===g||void 0===g?300:Number(g),dependencyElem:T,isPrefetch:null===_||void 0===_?0:Number(_),targetElem:W,timeout:null===C||void 0===C?6e3:Number(C),elem:e,errorClass:s,hasRightRailAds:null===I||void 0===I?0:Number(I),href:y,offsetX:Number(V)||0,offsetY:Number(L)||0,prefetchGroup:b,selector:o,successClass:u,trigger:D,type:A,wrapper:k,isItemCountBalanced:null===B||void 0===B?0:Number(B)}),b&&(R[m]=b),f._state={fullInView:!1,halfInView:!1,preInViewTriggered:!1,shouldPrefetchForViewport:"viewportWithPrefetch"===D,status:void 0},f._util.hasRightRailAds&&(f._state.resizeObserver=null),"sidekick"===A){var M=e.getAttribute(w+"caas-second-node"),F=M&&document.getElementById(M);F&&(f._util.secondNode=F)}else"renderedArticle"===A&&S(function(){var t=e.getElementsByClassName("wafer-caas-data")[0],a=t&&E(t);f.handleRenderedArticle(a)},0,f);return f}return s(t,e),u(t,[{key:"fetch",value:function(){var e=this,t=this._util["caas-url"],a=this._util["caas-uuid"];if(!t&&!a)return Promise.reject(new Error("uuid and url is missing"));var i=this._util,n=i.dependencyElem,s=i.successClass;if(n&&!n.classList.contains(s))return Promise.reject(new Error("dependency not yet complete"));var c=this._util.elem;if(c.classList.contains(s))return Promise.resolve(!0);var u=this._util,f=u.caasConfig,d=void 0===f?{}:f,v=u.cacheStrategy,m=u.cacheTtl,p=u.errorClass,w=u.secondNode,y=u.targetElem,b=u.timeout,A=u.type,E=a+":1:"+d.contextParams;if(0!==this._state.status){var P=!1;if(t){var S=-1===t.indexOf("?")?"?":"&";t=t+S+d.contextParams}else t=(d.caasUrl||"https://www.yahoo.com/caas/content/article/")+"?uuid="+a+"&"+d.contextParams;return t=(0,(o||r()).getCaaSUrlToUse)(t),c.classList.add("wafer-caas-trigger-inprogress"),this._state.status=0,new Promise(function(e,r){if("default"===A){var i=window.__waferCaasCollection.get(a);if(i)return P=!0,void e(i)}var n={cache:0,cacheKey:E,cacheStrategy:v,cacheTtl:m,timeout:b},s=!0;if(-1===t.indexOf("s.yimg.com")&&(n.credentials="include"),"sidekick"===A){var o=k("uuid",t);if(o){var c=o.split(",")[0];c&&(s=!1,window.wafer.caas.getData([c]).then(function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=l(a,1),s=i[0],o=s||{},c=o.adMeta,u=o.wikiids,f=c.site_attribute||"";n.body=JSON.stringify({wikis:u,siteAttribute:f}),C(t,n).then(function(t){e(t)}).catch(function(e){r(e)})}))}}s&&C(t,n).then(function(t){e(t)}).catch(function(e){r(e)})}).then(function(e){var t=e.assets;if(!t.length)return e;if("sidekick"!==A&&window.CAAS)return e;var a=e.style,i=I[A];return i?i.then(function(){return e}):(I[A]=(0,(o||r()).loadCaaSAssets)(t,a,A).then(function(){return e}),I[A])}).then(function(r){var i=A.length?A[0].toUpperCase()+A.slice(1):"",n=e["handle"+i],o=r._fetchMeta||{},l=o.duration,u=o.source;h.destroy(c,{destroySelf:!1});var f=void 0;if("default"===A){var d=r||{},v=d.assets,m=d.items,p=void 0===m?[]:m,b={};p.length>1?p.some(function(e){return((e||{}).data||{}).partnerData.uuid===a&&(b=e,!0)}):b=p[0];var C=R[a];C&&(b.data.partnerData.groupName=p[0].data.partnerData.groupName=C),f=(b||{}).markup,g(y,f),f&&!P&&window.__waferCaasCollection.set(a,{assets:v,items:[b]})}else if("sidekick"===A)if(f=r.markup,w){var E=e._util.isItemCountBalanced,k=document.createElement("div"),S=document.createElement("div");k.innerHTML=f,S.innerHTML=f;for(var O=_(k.getElementsByClassName("sidekick-item")),I=O.length,T=Math.round(I/2)+ +!E,N=T;N<I;N++){var j=O[N].parentNode;j.parentNode.removeChild(j)}g(y,k.innerHTML);for(var L=_(S.getElementsByClassName("sidekick-item")),V=0;V<T;V++){var B=L[V].parentNode;B.parentNode.removeChild(B)}y.innerHTML=k.innerHTML,g(w,S.innerHTML)}else g(y,f);if(e._util["caas-collapsed"]){var x=_(y.getElementsByClassName("caas-body-wrapper"))[0];x&&x.classList.add("caas-body-collapsed")}if(n&&n.call(e,c,r),c.classList.remove("wafer-caas-trigger-inprogress"),c.classList.add(s),h.emitLog({name:"WaferCaas",elem:c,meta:{duration:l,source:P?"MEMORY":u,url:t}}),"default"===A){var W=r.items[0].data.partnerData;h.emitWaferEvent("caas:article:fetch",{elem:c,meta:{data:W,url:t}})}return!0}).catch(function(r){return h.emitWaferEvent("caas:"+("default"===A?"article":A)+":error",{elem:c,meta:{url:t,uuid:a},stack:r.stack||r.message}),c.classList.remove("wafer-caas-trigger-inprogress"),c.classList.add(p),c.classList.remove(s),h.destroy(c),e._state.status=2,!1})}return Promise.resolve(!1)}},{key:"handleSidekick",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=this._util,r=a["caas-url"],i=a.elem,n=a.secondNode;if(!t.markup)return void h.emitWaferEvent("caas:sidekick:error",{elem:i,meta:{url:r}});h.emitWaferEvent("caas:sidekick:init",{elem:i,meta:{url:r}}),this._state.status=1,h.sync(e),n&&h.sync(n)}},{key:"handleRenderedArticle",value:function(e){var t=this._util,a=t["caas-uuid"],r=t.elem,i=t.successClass,n=t.targetElem;if(window.__waferCaasCollection.set(a,{items:[{data:{partnerData:c({},e,{uuid:a})}}]}),this.handleDefault(r),this._util["caas-collapsed"]){var s=_(n.getElementsByClassName("caas-body-wrapper"))[0];s&&s.classList.add("caas-body-collapsed")}r.classList.add(i),h.emitLog({name:"WaferCaas",elem:r,meta:{}})}},{key:"handleSpacingAndGetOffsetAboveRightRailAds",value:function(e){var t=this._util.caasBody,a=A(t,"caas"),r=a.getAttribute("data-params");if(r){try{r=JSON.parse(r)}catch(e){return}var i=r.features,n=0,s=t.getElementsByClassName("caas-body")[0];if(i.rrAdsAlignWithCover){var o=s.getElementsByClassName("caas-cover")[0];if(o)n=o.offsetTop||0;else{var c=s.getElementsByTagName("p")[0];n=s.offsetTop+(c?c.offsetTop:0)}}else if(i.rrPosFix){var l=s.getElementsByTagName("p")[0];n=s.offsetTop+(l?l.offsetTop:0)}return n&&e&&(e.style.marginTop=n+"px"),n}}},{key:"handleRightRailAds",value:function(){if(this._util.hasRightRailAds){var e=this._util.targetElem,t=e.getElementsByClassName("caas-slotted-aside")[0];if(t){this._util.caasBody=this._util.caasBody||e.getElementsByClassName("caas-body-content")[0];var a=this._util.caasBody;if(a){var r=_(t.getElementsByClassName("caas-da")),i=r.length;if(i){for(var n=this.handleSpacingAndGetOffsetAboveRightRailAds(t),s=this._util.caasConfig,o=void 0===s?{}:s,c=o.rightRailAdSpacing,l=[],u=c||500,f=a.offsetHeight-n,d=0,v=0,m=0;m<i;m++){var p=r[m],w=window.getComputedStyle(p).marginTop;if(u=w&&parseInt(w.replace("px",""),10)||u,p.getElementsByClassName("wafer-destroyed")[0]){var g=p.offsetHeight;v+=g<10?u+607:g+u}else v+=u+607;if(v>f+u)break;++d}d=d||1;for(var y=0;y<d;y++){(function(e){var t=r[e];if(t.classList.contains("wafer-caas-ad-visited"))return"continue";t.style.display="block",t.classList.add("wafer-caas-ad-visited"),T.some(function(e){var a=e+"-pending",r=t.getElementsByClassName(a)[0];if(r)return r.classList.remove(a),r.classList.add(e),"onCaasArticleLoad"===r.getAttribute("data-wf-trigger")?(h.sync(r.parentNode),l.push(r)):h.sync(t),!0;if("wafer-benji"===e){var i=t.getElementsByClassName("wafer-benji")[0];i&&"onCaasArticleLoad"===i.getAttribute("data-wf-trigger")&&l.push(i)}return!1})})(y)}if(l.length){var b=P("wafer-benji");b&&b.triggerForElements(l)}if(i>d)for(var C=i-1;C>=d;C--){(function(e){var t=r[e];if(t.classList.contains("wafer-caas-ad-visited"))return"continue";T.some(function(e){var a=t.getElementsByClassName(e)[0];return!!a&&(a.classList.remove(e),a.classList.add(e+"-pending"),!0)}),t.style.display="none"})(C)}else this.disconnectResizeObserver()}}}}}},{key:"addResizeObserver",value:function(){var e=this;if(window.ResizeObserver){var t=this._util.targetElem.getElementsByClassName("caas-body-content")[0];t&&(this._state.resizeObserver=new ResizeObserver(b(function(){e.handleRightRailAds()},50)),this._state.resizeObserver.observe(t))}}},{key:"handleDefault",value:function(e){var t=this;if(!this._destroyed){var a=this._util,r=a["caas-uuid"],i=a.elem,n=a.type,s=window.__waferCaasCollection.get(r)||{},o=s.items,c=void 0===o?[]:o,u=l(c,1),f=u[0];f=void 0===f?{}:f;var d=f.data,v=f.markup;if(!("renderedArticle"===n||v&&d))return void h.emitWaferEvent("caas:article:error",{elem:i,meta:{hasData:!!d,hasMarkup:!!v,uuid:r}});var m=d.partnerData;if(window._caasInstance)S(function(){t._destroyed||(t.handleRightRailAds(),window._caasInstance.sync(),h.sync(e))},window.__waferCaasRenderInProgress?300:0,this);else{var p=this._util.wrapper;window.wafer.base.pauseVideo("wafer-caas"),window._caasInstance=new window.CAAS.BASE({container:p}),this.handleColorSchemaChange(),window._caasInstance.on("yvideo:scriptLoadingError",function(e){h.emitError({name:"WaferCaas",elem:null,meta:{message:"Could not load js"},stack:e.stack||e.message})}),window._caasInstance.on("link:clicked",function(e){e.isYahoo&&h.emitWaferEvent("caas:yahooLink:clicked",{elem:i,meta:{data:e,instance:window._caasInstance}}),t._state.resizeObserver||"story-continues"!==e.type||t.handleRightRailAds(),h.emitWaferEvent("caas:link:clicked",{elem:i,meta:{data:e,instance:window._caasInstance}})}),this._state.status=1,h.emitWaferEvent("caas:article:init",{elem:i,meta:{data:m,instance:window._caasInstance}}),this.handleRightRailAds(),h.sync(e)}this._util.hasRightRailAds&&this.addResizeObserver(),window.__waferCaasRenderInProgress=!0,y(window.__waferCaasRenderInProgressTimeout),window.__waferCaasRenderInProgressTimeout=S(function(){window.__waferCaasRenderInProgress=!1},300,this),this._state.status=1}}},{key:"handleArticleViewEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"inview";if("pre:inview"===e){if(this._state.preInViewTriggered)return;this._state.preInViewTriggered=!0}else if("half:inview"===e){if(this._state.halfInView)return;this._state.halfInView=!0}else if("full:inview"===e){if(this._state.fullInView)return;this._state.fullInView=!0}else if("half:not:inview"===e){if(!this._state.halfInView)return;this._state.halfInView=!1,this._state.fullInView=!1}else"inview"===e&&(this._state.halfInView=!1,this._state.fullInView=!1);var t=this._util,a=t.elem,r=t.type,i=t["caas-uuid"],n=window.__waferCaasCollection.get(i)||{},s=n.items,o=void 0===s?[]:s,c=l(o,1),u=c[0];u=void 0===u?{}:u;var f=u.data,d=u.markup;if("renderedArticle"===r||d&&f){var v=f.partnerData;h.emitWaferEvent("caas:article:"+e,{elem:a,meta:{data:v,instance:window._caasInstance}})}}},{key:"handleColorSchemaChange",value:function(){var e=window._caasInstance;if(e){var t=window.wafer.base.colorSchema,a=void 0;a="dark"===t?e.componentShouldSwitchToDarkmode:e.componentShouldSwitchToLightmode,a&&a.call(e)}}},{key:"stateDidUpdate",value:function(){if("caas-collapsed"!==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).stateAttr)"stateChange"===this._util.trigger&&this.fetch().catch(function(){});else{if(!this._util.targetElem)return;if(this._util["caas-collapsed"]=Number(this._util["caas-collapsed"]),this._util["caas-collapsed"]){var e=_(this._util.targetElem.getElementsByClassName("caas-body-wrapper"))[0];e&&e.classList.add("caas-body-collapsed")}}}},{key:"disconnectResizeObserver",value:function(){var e=this._state.resizeObserver;e&&e.disconnect()}},{key:"destroy",value:function(){this.disconnectResizeObserver(),f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"config",get:function(){var e=this._util,t=e["caas-url"],a=e["caas-uuid"],r=e.caasConfig,i=e.elem,n=e.href,s=e.isPrefetch,o=e.offsetX,c=e.offsetY,l=e.prefetchGroup,u=e.selector,f=e.trigger,d=e.type;return{caasConfig:r,elem:i,href:n,isPrefetch:s,offsetX:o,offsetY:c,prefetchGroup:l,selector:u,shouldPrefetchForViewport:this._state.shouldPrefetchForViewport,trigger:f,type:d,url:t,uuid:a}}},{key:"shouldPrefetchForViewport",set:function(e){this._state.shouldPrefetchForViewport=e}}]),t}(p);t.default=N,e.exports=t.default},"./src/controller.js":function(e,t,a){"use strict";function r(){return l=n(a("./src/base.js"))}function i(){return u=a("./src/utils.js")}function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l,u,f=function(){function e(e,t){var a=[],r=!0,i=!1,n=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);r=!0);}catch(e){i=!0,n=e}finally{try{!r&&o.return&&o.return()}finally{if(i)throw n}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),h=window.wafer,v=h.base,m=h.utils,p=m.elementInView,w=m.fetchWithCache,g=m.findAncestor,y=m.getConfigFromJSONScriptNode,_=m.getWaferInstanceForElem,b=m.throttle,C=void 0,A=h.controllers.WaferBaseController;window.__waferCaasCollection=function(){var e=new Map,t={};return{set:function(t,a){e.set(t,a)},get:function(a){return t[a]=!0,e.get(a)},clearVisitedNodes:function(){t={}}}}();var E=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=e.errorClass,i=void 0===a?"wafer-caas-error":a,n=e.root,c=void 0===n?document:n,u=e.selector,f=e.successClass,d=void 0===f?"wafer-caas-complete":f,v=e.validateDelay,m=void 0===v?10:v;s(this,t);var p=y(document.getElementById("wafer-caas-config"));if(p.caasUrl){var w=location,g=w.hostname,_=w.port,C=w.protocol;"localhost"===g||"4443"===_||"https:"!==C||p.mock||(p.caasUrl="/caas/content/article/")}var A=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{root:c,selector:u,props:{caasConfig:p,errorClass:i,selector:u,successClass:d},WaferClass:(l||r()).default}));return A._validateWithThrottle=b(function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];A.validate.apply(A,t)},m,A),A._state=A._state||{},A._state.lastScrollTop=0,A._state.progressLoader=null,A.sync(),h.ready(function(){A.listenToWaferEvents()}),A.addPublicAPIs(p),A}return c(t,e),d(t,[{key:"listenToWaferEvents",value:function(){var e=this;h.on("darla:fetch:success",function(t){var a=t.elem;e._handleRightRailAds(a)}),h.on("jac:success",function(t){var a=t.elem;e._handleRightRailAds(a)}),h.on("benji:success",function(t){var a=t.elem;e._handleRightRailAds(a)})}},{key:"addPublicAPIs",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.contextParams,a=void 0===t?{}:t;window.wafer.caas||(window.wafer.caas={getData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Promise.all(e.map(function(e){return new Promise(function(t){var r=window.__waferCaasCollection.get(e);if(r){var i=f(r.items,1),n=i[0].data;return t((void 0===n?{}:n).partnerData||{})}if(!window.wafer.db)return t({});window.wafer.db.get(e+":1:"+a,"fetch",{timeout:3e3}).then(function(e){try{var a=JSON.parse(e.value),r=a.items,i=f(r,1),n=i[0].data;return t((void 0===n?{}:n).partnerData||{})}catch(e){return t({})}}).catch(function(e){t({})})})}))}})}},{key:"prefetch",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!window.wafer.base.isBot){var t=this._state.elementInstances,a={},r=[],n=[],s={},o=void 0,c=void 0,l=void 0,f=0,d=0,h=!0,m=!1,p=void 0;try{for(var g,y=t.values()[Symbol.iterator]();!(h=(g=y.next()).done);h=!0){var _=g.value;r[f]=r[f]||[];var b=_.instance,A=b.config,E=A.caasConfig,k=void 0===E?{}:E,P=A.elem,S=A.href,O=A.isPrefetch,I=A.prefetchGroup,R=A.shouldPrefetchForViewport,T=A.uuid;if(l=l||k.caasUrl,c=c||k.contextParams||"",I){if(!e){s[I]=!0;continue}if(I!==e)continue;c=k[I+"ContextParams"]||c}if((O||R)&&T){var N=a[T]||!!window.__waferCaasCollection.get(T);!N&&r[f].push({href:S,uuid:T}),a[T]=!0,R?(P.classList.add("did-prefetch"),b.shouldPrefetchForViewport=!1):b.destroy(),!N&&++d>=10&&(d=0,f++)}}}catch(e){m=!0,p=e}finally{try{!h&&y.return&&y.return()}finally{if(m)throw p}}for(var j in s)s.hasOwnProperty(j)&&this.prefetch(j);return Promise.all(r.map(function(t){var a=t.map(function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).uuid});if(a.length)return o=(l||"https://www.yahoo.com/caas/content/article/")+"?uuid="+a.join(",")+"&"+c,o=(0,(u||i()).getCaaSUrlToUse)(o),w(o,{cache:0,timeout:8e3}).then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.assets,a=e.items,r=void 0===a?[]:a,n={items:r,assets:t};return window.CAAS?n:(C=C||(0,(u||i()).loadCaaSAssets)(t,"","default")).then(function(){return n})}).then(function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=a.assets,s=a.items,o=void 0===s?[]:s;return(0,(u||i()).handlePrefetchedData)(o,r,e,function(e){var a=t[e].href;a&&n.push(a)})})})).then(function(){if(n.length)return Promise.all(n.map(function(t){return w((l||"https://www.yahoo.com/caas/content/article/")+"?url="+t+"&"+c,{cache:0}).then(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=t.items,r=void 0===a?[]:a,n=t.assets;return(0,(u||i()).handlePrefetchedData)(r,n,e)})}))}).then(function(){v.emitWaferEvent("caas:prefetch:success",{meta:{url:o}})}).catch(function(){v.emitWaferEvent("caas:prefetch:failed",{meta:{url:o}})})}}},{key:"_handleArticleInView",value:function(e,t){if(this._state.activeElem!==t){var a=this._state.progressLoader;a&&!a.instance._destroyed||(this._state.progressLoader=_(document.getElementsByClassName("wafer-caas-progress-loader")[0],"wafer-progress-loader")),a=this._state.progressLoader,a&&(a.instance.target=t),e.handleArticleViewEvent(),this._state.activeElem=t}}},{key:"_handleRightRailAds",value:function(e){var t=g(e,"wafer-caas")||g(e,"wafer-caas-complete");if(t){var a=this._state.elementInstances,r=a.get(t);if(r){r.instance.handleRightRailAds()}}}},{key:"handleScroll",value:function(){var e=window.pageYOffset||document.documentElement.scrollTop,t=1;t=e>this._state.lastScrollTop?1:0,this._state.lastScrollTop=e<=0?0:e,this._validateWithThrottle({scrollDirection:t})}},{key:"handleResize",value:function(){this._validateWithThrottle()}},{key:"didSync",value:function(){var e=this,t=this._state,a=t.elementInstances,r=t.mounted;0===a.size||r||(this._state.mounted=!0),setTimeout(function(){e.prefetch()},10)}},{key:"trigger",value:function(e){var t=this._state.elementInstances.get(e);if(t){var a=t.instance;if("renderedArticle"===a.config.type)return;a.fetch()}}},{key:"handleColorSchemaChange",value:function(){if(this._state&&this._state.mounted){var e=this._state.elementInstances,t=!0,a=!1,r=void 0;try{for(var i,n=e.values()[Symbol.iterator]();!(t=(i=n.next()).done);t=!0){i.value.instance.handleColorSchemaChange()}}catch(e){a=!0,r=e}finally{try{!t&&n.return&&n.return()}finally{if(a)throw r}}}}},{key:"willValidate",value:function(e){var t=this,a=this._state.elementInstances;e.forEach(function(e){var r=a.get(e),i=r.instance;if(!i.config.isPrefetch){var n=i.config,s=n.offsetX,o=n.offsetY,c=n.selector,l=n.trigger,u=n.type,f=p(e,{offsetX:s,offsetY:o},v.viewport);if("renderedArticle"!==u)switch(l){case"viewport":case"viewportWithPrefetch":1!==i._state.status&&f&&i.fetch().then(function(t){t&&c&&e.classList.remove(c.replace(".",""))}).catch(function(){});break;case"onLoad":i.fetch().then(function(t){t&&c&&e.classList.remove(c.replace(".",""))}).catch(function(){})}var d=!1;if(f){(d=1===i._state.status&&("default"===u||"renderedArticle"===u))&&i.handleArticleViewEvent("pre:inview");var h=t._state.activeElem;if(h===e){if(d){var m=h.getBoundingClientRect(),w=m.bottom,g=m.top,y=h.offsetHeight,_=y/2,b=v.viewport;w+0>=b.top&&g+_<=b.bottom?(i.handleArticleViewEvent("half:inview"),w+0>=b.top&&g+y<=b.bottom&&i.handleArticleViewEvent("full:inview")):i.handleArticleViewEvent("half:not:inview")}return}}t._state.activeElem&&p(t._state.activeElem,{offsetX:s,offsetY:o},v.viewport)||d&&t._handleArticleInView(i,e)}})}},{key:"didDestroy",value:function(){var e=!0,t=this._state.elementInstances,a=!0,r=!1,i=void 0;try{for(var n,s=t.values()[Symbol.iterator]();!(a=(n=s.next()).done);a=!0){var o=n.value,c=o.instance.config,l=c.isPrefetch;if("default"===c.type&&!l){e=!1;break}}}catch(e){r=!0,i=e}finally{try{!a&&s.return&&s.return()}finally{if(r)throw i}}e&&(window._caasInstance&&(window._caasInstance.destructor(),window._caasInstance=null,window.__waferCaasCollection.clearVisitedNodes()),window.wafer.base.resumeVideo("wafer-caas"))}}]),t}(A);t.default=E,e.exports=t.default},"./src/entry.js":function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i;t.default=new((i||function(){return i=r(a("./src/controller.js"))}()).default)({selector:"wafer-caas"}),e.exports=t.default},"./src/utils.js":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=window.wafer,i=r.features,n=r.utils,s=n.getUrlParameterValueByName,o=n.loadCSSSync,c=n.loadScriptAsync,l=/^https:\/\/s.yimg.com\/(os|aaq)\/c/,u=function(e,t,a){var r=new RegExp("([?&])"+t+"=.*?(&|$)","i"),i=-1!==e.indexOf("?")?"&":"?";return e.match(r)?e.replace(r,"$1"+t+"="+a+"$2"):e+i+t+"="+a};t.handlePrefetchedData=function(e,t,a,r){return Promise.all(e.map(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments[1],n=e.data,s=void 0===n?{}:n,o=e.markup,c=s.partnerData;if(!c||!o)return r&&r(i),Promise.resolve();a&&(e.data.partnerData.groupName=a);var l=c.uuid,u={assets:t,items:[e]};return window.__waferCaasCollection.set(l,u),e}))},t.loadCaaSAssets=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments[2];return new Promise(function(r){var i="sidekick"===a?"CAAS_SIDEKICK":"CAAS",n=void 0,s=!0,u=!0;window.__caasModules=window.__caasModules||{},e.forEach(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,a=e.asset;"js"===t&&a.value&&(s=!1),"css"===t&&(u=!1)}),e.forEach(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=e.type,f=e.asset;n=(void 0===f?{}:f).value,l.test(n)&&("js"===a?c({src:n},function(){s=!0,u&&r()},i):"css"===a&&(window.__caasModules[i]?(u=!0,s&&r()):(window.__caasModules[i]=!0,o({src:n,text:t},function(){u=!0,s&&r()}))))})})},t.getCaaSUrlToUse=function(e){var t=[],a=window.wafer.base.colorSchema;i.isPWA&&t.push("pwa"),a&&t.push("darkmode");var r=t.join(",");if(r){var n=s("features",e);e=n?u(e,"features",n+","+r):e+"&features="+r}return e}}})});