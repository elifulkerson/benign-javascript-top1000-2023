function qualitySelectorSB(results){var player=this;var streams={};var max_quality=0;var qualities=[12,4000,1080,720,480,320,240];var available_qualities=[];var quality_menu=$('.video_toolbar .qt .qt_menu');var quality_button=$('.video_toolbar .qt');var shuffle=function(array){if(typeof array==='undefined')return[]
var currentIndex=array.length;var temporaryValue,randomIndex;while(0!==currentIndex){randomIndex=Math.floor(Math.random()*currentIndex);currentIndex-=1;temporaryValue=array[currentIndex];array[currentIndex]=array[randomIndex];array[randomIndex]=temporaryValue;}
return array;};var pick_available_quality=function(quality){var q_length=available_qualities.length;var this_set=[];for(var i=0;i<q_length;i++){if(available_qualities[i]<=quality)this_set.push(available_qualities[i]);}
if(this_set.length==0)return Math.min.apply(null,available_qualities);return Math.max.apply(null,this_set);}
var init_ui=function(){var q_length=qualities.length;streams['hls-auto']=shuffle(results['m3u8']);var menu_item=$('<p>').text('AUTO').data('q','auto').on('click',function(){change_quality($(this).data('q'));});quality_menu.append(menu_item);for(var i=0;i<q_length;i++){var q=qualities[i];var q_ext=q+'p';if(q==4000)var q_ext='4k';if(q_ext in results&&results[q_ext].length){streams['mp4-'+q]=shuffle(results[q_ext]);}
if('m3u8_'+q_ext in results&&results['m3u8_'+q_ext].length){streams['hls-'+q]=shuffle(results['m3u8_'+q_ext]);}
if('hls-'+q in streams||'mp4-'+q in streams){var menu_item=$('<p>').text(q_ext).data('q',q).on('click',function(){change_quality($(this).data('q'));});quality_menu.append(menu_item);available_qualities.push(q);}}
quality_button.on('click',function(){quality_menu.toggleClass('qt_menu_active');})}
var get_quality_cookie=function(){var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1);if(c.indexOf('player_quality=')==0)var value=c.substring('player_quality='.length,c.length);}
if(!isNaN(parseInt(value)))return parseInt(value);return"auto";}
var set_quality_cookie=function(quality){var d=new Date();d.setTime(d.getTime()+(365*24*3600*1000));var expires="expires="+d.toUTCString();document.cookie="player_quality="+quality+"; "+expires+'; path=/';}
var init_quality=function(quality){if(quality=='auto'){quality_button.find('span').text('AUTO');player.src([{src:streams['mp4-'+pick_available_quality(720)][0],type:'video/mp4'},{src:streams['hls-auto'][0],type:'application/x-mpegURL'}])}else{quality=pick_available_quality(quality)
var q_ext=quality+'p';if(quality==4000)var q_ext='4k';quality_button.find('span').text(q_ext);player.src([{src:streams['mp4-'+quality][0],type:'video/mp4'},{src:streams['hls-'+quality][0],type:'application/x-mpegURL'}]);}}
var change_quality=function(quality){setTimeout(function(){quality_menu.removeClass('qt_menu_active');},200);var current_time=player.currentTime();if(quality=='auto'){quality_button.find('span').text('AUTO');player.src([{src:streams['mp4-'+pick_available_quality(720)][0],type:'video/mp4'},{src:streams['hls-auto'][0],type:'application/x-mpegURL'}]);set_quality_cookie('auto');}else{quality=pick_available_quality(quality);var q_ext=quality+'p';if(quality==4000)var q_ext='4k';quality_button.find('span').text(q_ext);player.src([{src:streams['mp4-'+quality][0],type:'video/mp4'},{src:streams['hls-'+quality][0],type:'application/x-mpegURL'}]);set_quality_cookie(quality);}
if(current_time>0){player.play();player.one('playing',function(){player.currentTime(current_time);});}else{load_player();}
analytics_track_event('player','switch_quality',quality,'','dev');}
player.on('error',function(){var cs=player.currentSrc();var cq=get_quality_cookie();if(cs.indexOf('m3u8')!==-1){var index=streams['hls-'+cq].indexOf(cs);if(index>-1){streams['hls-'+cq].splice(index,1);}}else{if(quality=='auto'){cq=pick_available_quality(720);}
var index=streams['mp4-'+cq].indexOf(cs);if(index>-1){streams['mp4-'+cq].splice(index,1);}}
if(player.currentTime()>0){change_quality(get_quality_cookie());}else{init_quality(get_quality_cookie());}});init_ui();init_quality(get_quality_cookie());}
videojs.registerPlugin('qualitySelectorSB',qualitySelectorSB);(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){(function(global){'use strict';var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();var _get=function get(_x,_x2,_x3){var _again=true;_function:while(_again){var object=_x,property=_x2,receiver=_x3;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{_x=parent;_x2=property;_x3=receiver;_again=true;desc=parent=undefined;continue _function;}}else if('value'in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}}};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}
function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var _videoJs=(typeof window!=="undefined"?window['videojs']:typeof global!=="undefined"?global['videojs']:null);var _videoJs2=_interopRequireDefault(_videoJs);var Component=_videoJs2['default'].getComponent('Component');var Button=_videoJs2['default'].getComponent('Button');var registerPlugin=_videoJs2['default'].registerPlugin||_videoJs2['default'].plugin;var AirplayToggle=(function(_Button){_inherits(AirplayToggle,_Button);function AirplayToggle(player,options){_classCallCheck(this,AirplayToggle);_get(Object.getPrototypeOf(AirplayToggle.prototype),'constructor',this).call(this,player,options);}
_createClass(AirplayToggle,[{key:'buildCSSClass',value:function buildCSSClass(){return'vjs-airplay-control '+_get(Object.getPrototypeOf(AirplayToggle.prototype),'buildCSSClass',this).call(this);}},{key:'handleClick',value:function handleClick(){this.player().el().getElementsByTagName('video')[0].webkitShowPlaybackTargetPicker();this.player().trigger('airplayStart');}}]);return AirplayToggle;})(Button);AirplayToggle.prototype.controlText_='Airplay';_videoJs2['default'].registerComponent('AirplayToggle',AirplayToggle);var AirplayButton=function AirplayButton(options){var player=this;if(window.WebKitPlaybackTargetAvailabilityEvent){var videoEl=player.el().getElementsByTagName('video')[0];videoEl.addEventListener('webkitplaybacktargetavailabilitychanged',function(event){switch(event.availability){case"available":player.on('loadeddata',function(){if(!player.controlBar.childNameIndex_.hasOwnProperty('AirplayToggle')){var AirplayToggle=this.controlBar.addChild('AirplayToggle',options);player.controlBar.el().insertBefore(AirplayToggle.el(),player.controlBar.fullscreenToggle.el());}});break;case"not-available":break;}});};};registerPlugin('airplayButton',AirplayButton);}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}]},{},[1]);;(function(root,factory){if(typeof window!=='undefined'&&window.videojs){factory(window.videojs);}else if(typeof define==='function'&&define.amd){define('videojs-hotkeys',['video.js'],function(module){return factory(module.default||module);});}else if(typeof module!=='undefined'&&module.exports){module.exports=factory(require('video.js'));}}(this,function(videojs){"use strict";if(typeof window!=='undefined'){window['videojs_hotkeys']={version:"0.2.25"};}
var hotkeys=function(options){var player=this;var pEl=player.el();var doc=document;var def_options={volumeStep:0.1,seekStep:5,enableMute:true,enableVolumeScroll:true,enableHoverScroll:false,enableFullscreen:true,enableNumbers:true,enableJogStyle:false,alwaysCaptureHotkeys:false,enableModifiersForNumbers:true,enableInactiveFocus:true,skipInitialFocus:false,playPauseKey:playPauseKey,rewindKey:rewindKey,forwardKey:forwardKey,volumeUpKey:volumeUpKey,volumeDownKey:volumeDownKey,muteKey:muteKey,fullscreenKey:fullscreenKey,customKeys:{}};var cPlay=1,cRewind=2,cForward=3,cVolumeUp=4,cVolumeDown=5,cMute=6,cFullscreen=7;var mergeOptions=videojs.mergeOptions||videojs.util.mergeOptions;options=mergeOptions(def_options,options||{});var volumeStep=options.volumeStep,seekStep=options.seekStep,enableMute=options.enableMute,enableVolumeScroll=options.enableVolumeScroll,enableHoverScroll=options.enableHoverScroll,enableFull=options.enableFullscreen,enableNumbers=options.enableNumbers,enableJogStyle=options.enableJogStyle,alwaysCaptureHotkeys=options.alwaysCaptureHotkeys,enableModifiersForNumbers=options.enableModifiersForNumbers,enableInactiveFocus=options.enableInactiveFocus,skipInitialFocus=options.skipInitialFocus;var videojsVer=videojs.VERSION;if(!pEl.hasAttribute('tabIndex')){pEl.setAttribute('tabIndex','-1');}
pEl.style.outline="none";if(alwaysCaptureHotkeys||!player.autoplay()){if(!skipInitialFocus){player.one('play',function(){pEl.focus();});}}
if(enableInactiveFocus){player.on('userinactive',function(){var cancelFocusingPlayer=function(){clearTimeout(focusingPlayerTimeout);};var focusingPlayerTimeout=setTimeout(function(){player.off('useractive',cancelFocusingPlayer);var activeElement=doc.activeElement;var controlBar=pEl.querySelector('.vjs-control-bar');if(activeElement&&activeElement.parentElement==controlBar){pEl.focus();}},10);player.one('useractive',cancelFocusingPlayer);});}
player.on('play',function(){var ifblocker=pEl.querySelector('.iframeblocker');if(ifblocker&&ifblocker.style.display===''){ifblocker.style.display="block";ifblocker.style.bottom="39px";}});var keyDown=function keyDown(event){var ewhich=event.which,wasPlaying,seekTime;var ePreventDefault=event.preventDefault;var duration=player.duration();if(player.controls()){var activeEl=doc.activeElement;if(alwaysCaptureHotkeys||activeEl==pEl||activeEl==pEl.querySelector('.vjs-tech')||activeEl==pEl.querySelector('.vjs-control-bar')||activeEl==pEl.querySelector('.iframeblocker')){switch(checkKeys(event,player)){case cPlay:ePreventDefault();if(alwaysCaptureHotkeys){event.stopPropagation();}
if(player.paused()){silencePromise(player.play());}else{player.pause();}
break;case cRewind:wasPlaying=!player.paused();ePreventDefault();if(wasPlaying){player.pause();}
seekTime=player.currentTime()-seekStepD(event);if(seekTime<=0){seekTime=0;}
player.currentTime(seekTime);if(wasPlaying){silencePromise(player.play());}
break;case cForward:wasPlaying=!player.paused();ePreventDefault();if(wasPlaying){player.pause();}
seekTime=player.currentTime()+seekStepD(event);if(seekTime>=duration){seekTime=wasPlaying?duration-.001:duration;}
player.currentTime(seekTime);if(wasPlaying){silencePromise(player.play());}
break;case cVolumeDown:ePreventDefault();if(!enableJogStyle){player.volume(player.volume()-volumeStep);}else{seekTime=player.currentTime()-1;if(player.currentTime()<=1){seekTime=0;}
player.currentTime(seekTime);}
break;case cVolumeUp:ePreventDefault();if(!enableJogStyle){player.volume(player.volume()+volumeStep);}else{seekTime=player.currentTime()+1;if(seekTime>=duration){seekTime=duration;}
player.currentTime(seekTime);}
break;case cMute:if(enableMute){player.muted(!player.muted());}
break;case cFullscreen:if(enableFull){if(player.isFullscreen()){player.exitFullscreen();}else{player.requestFullscreen();}}
break;default:if((ewhich>47&&ewhich<59)||(ewhich>95&&ewhich<106)){if(enableModifiersForNumbers||!(event.metaKey||event.ctrlKey||event.altKey)){if(enableNumbers){var sub=48;if(ewhich>95){sub=96;}
var number=ewhich-sub;ePreventDefault();player.currentTime(player.duration()*number*0.1);}}}
for(var customKey in options.customKeys){var customHotkey=options.customKeys[customKey];if(customHotkey&&customHotkey.key&&customHotkey.handler){if(customHotkey.key(event)){ePreventDefault();customHotkey.handler(player,options,event);}}}}}}};var doubleClick=function doubleClick(event){if(videojsVer!=null&&videojsVer<="7.1.0"){if(player.controls()){var activeEl=event.relatedTarget||event.toElement||doc.activeElement;if(activeEl==pEl||activeEl==pEl.querySelector('.vjs-tech')||activeEl==pEl.querySelector('.iframeblocker')){if(enableFull){if(player.isFullscreen()){player.exitFullscreen();}else{player.requestFullscreen();}}}}}};var volumeHover=false;var volumeSelector=pEl.querySelector('.vjs-volume-menu-button')||pEl.querySelector('.vjs-volume-panel');if(volumeSelector!=null){volumeSelector.onmouseover=function(){volumeHover=true;};volumeSelector.onmouseout=function(){volumeHover=false;};}
var mouseScroll=function mouseScroll(event){if(enableHoverScroll){var activeEl=0;}else{var activeEl=doc.activeElement;}
if(player.controls()){if(alwaysCaptureHotkeys||activeEl==pEl||activeEl==pEl.querySelector('.vjs-tech')||activeEl==pEl.querySelector('.iframeblocker')||activeEl==pEl.querySelector('.vjs-control-bar')||volumeHover){if(enableVolumeScroll){event=window.event||event;var delta=Math.max(-1,Math.min(1,(event.wheelDelta||-event.detail)));event.preventDefault();if(delta==1){player.volume(player.volume()+volumeStep);}else if(delta==-1){player.volume(player.volume()-volumeStep);}}}}};var checkKeys=function checkKeys(e,player){if(options.playPauseKey(e,player)){return cPlay;}
if(options.rewindKey(e,player)){return cRewind;}
if(options.forwardKey(e,player)){return cForward;}
if(options.volumeUpKey(e,player)){return cVolumeUp;}
if(options.volumeDownKey(e,player)){return cVolumeDown;}
if(options.muteKey(e,player)){return cMute;}
if(options.fullscreenKey(e,player)){return cFullscreen;}};function playPauseKey(e){return(e.which===32||e.which===179);}
function rewindKey(e){return(e.which===37||e.which===177);}
function forwardKey(e){return(e.which===39||e.which===176);}
function volumeUpKey(e){return(e.which===38);}
function volumeDownKey(e){return(e.which===40);}
function muteKey(e){return(e.which===77);}
function fullscreenKey(e){return(e.which===70);}
function seekStepD(e){return(typeof seekStep==="function"?seekStep(e):seekStep);}
function silencePromise(value){if(value!=null&&typeof value.then==='function'){value.then(null,function(e){});}}
player.on('keydown',keyDown);player.on('dblclick',doubleClick);player.on('mousewheel',mouseScroll);player.on("DOMMouseScroll",mouseScroll);return this;};var registerPlugin=videojs.registerPlugin||videojs.plugin;registerPlugin('hotkeys',hotkeys);}));(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){module.exports={"name":"videojs-theater-mode","version":"0.1.0","description":"Adds a class the video.js container that can be used to put your video into \"theater mode\"","main":"dist/videojs-theater-mode.cjs.js","module":"dist/videojs-theater-mode.es.js","generator-videojs-plugin":{"version":"5.0.0"},"scripts":{"build":"npm run clean; npm run sass; npm run build-dist; cp -r fonts dist/","sass":"mkdir -p dist/ && ./node_modules/.bin/node-sass --output-style compact ./src/videojs.theaterMode.scss dist/videojs.theaterMode.css","build-dist":"mkdir -p dist/ && ./node_modules/.bin/browserify ./src/videojs.theaterMode.js -o dist/videojs.theaterMode.js","clean":"rm -rf dist/"},"keywords":["videojs","videojs-plugin","theater mode"],"author":"Jon <jon@jgubman.com>","license":"MIT","repository":{"type":"git","url":"https://github.com/jgubman/videojs-theater-mode"},"vjsstandard":{"ignore":["dist","docs","test/dist","test/karma.conf.js"]},"files":["CONTRIBUTING.md","dist/","docs/","fonts/","index.html","scripts/","src/","test/"],"dependencies":{"global":"^4.3.2","video.js":"^5.2.1"},"devDependencies":{"babelify":"^6.3.0","browserify":"^11.1.0","browserify-shim":"^3.8.10","node-sass":"^3.4.2"},"browserify":{"transform":["babelify","browserify-shim"]},"browserify-shim":{"video.js":"global:videojs"}}},{}],2:[function(require,module,exports){(function(global){'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();var _get=function get(_x,_x2,_x3){var _again=true;_function:while(_again){var object=_x,property=_x2,receiver=_x3;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{_x=parent;_x2=property;_x3=receiver;_again=true;desc=parent=undefined;continue _function;}}else if('value'in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}}};function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{'default':obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}
function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
var _videoJs=(typeof window!=="undefined"?window['videojs']:typeof global!=="undefined"?global['videojs']:null);var _videoJs2=_interopRequireDefault(_videoJs);var _packageJson=require('../package.json');var Button=_videoJs2['default'].getComponent('Button');var defaults={className:'theater-mode'};var registerPlugin=_videoJs2['default'].registerPlugin||_videoJs2['default'].plugin;var TheaterModeToggle=(function(_Button){_inherits(TheaterModeToggle,_Button);function TheaterModeToggle(player,options){_classCallCheck(this,TheaterModeToggle);_get(Object.getPrototypeOf(TheaterModeToggle.prototype),'constructor',this).call(this,player,options);this.controlText('Toggle theater mode');}
_createClass(TheaterModeToggle,[{key:'buildCSSClass',value:function buildCSSClass(){if(document.getElementById(this.options_.elementToToggle).classList.contains(this.options_.className)){return'vjs-theater-mode-control-close '+_get(Object.getPrototypeOf(TheaterModeToggle.prototype),'buildCSSClass',this).call(this);}else{return'vjs-theater-mode-control-open '+_get(Object.getPrototypeOf(TheaterModeToggle.prototype),'buildCSSClass',this).call(this);}}},{key:'handleClick',value:function handleClick(){var theaterModeIsOn=document.getElementById(this.options_.elementToToggle).classList.toggle(this.options_.className);this.player().trigger('theaterMode',{'theaterModeIsOn':theaterModeIsOn});if(theaterModeIsOn){this.el_.classList.remove('vjs-theater-mode-control-open');this.el_.classList.add('vjs-theater-mode-control-close');}else{this.el_.classList.remove('vjs-theater-mode-control-close');this.el_.classList.add('vjs-theater-mode-control-open');}}}]);return TheaterModeToggle;})(Button);_videoJs2['default'].registerComponent('TheaterModeToggle',TheaterModeToggle);var onPlayerReady=function onPlayerReady(player,options){player.addClass('vjs-theater-mode');var toggle=player.controlBar.addChild('theaterModeToggle',options);player.controlBar.el().insertBefore(toggle.el(),player.controlBar.fullscreenToggle.el());};var theaterMode=function theaterMode(options){var _this=this;this.ready(function(){onPlayerReady(_this,_videoJs2['default'].mergeOptions(defaults,options));});};registerPlugin('theaterMode',theaterMode);theaterMode.VERSION=_packageJson.version;exports['default']=theaterMode;module.exports=exports['default'];}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../package.json":1}]},{},[2]);function timelineThumbs(image_url){var player_element=$('#'+this.id_);var seek_bar=player_element.find('.vjs-progress-control');var mouse_display=seek_bar.find('.vjs-mouse-display');var time_stamp=mouse_display.find('.vjs-time-tooltip');var cts;var thumb_num;seek_bar.append('<div class="timeline-thumbs"><span class="thumb"></span></div>');var timeline_thumbs=seek_bar.find('.timeline-thumbs');var thumb_holder=timeline_thumbs.find('.thumb');thumb_holder.css('background-image','url('+image_url+')');seek_bar.on('mousemove touchmove',function(){thumb_holder.css('margin-left',(parseFloat(mouse_display.css('left'))-50)+'px');if(cts==time_stamp.text())return;cts=time_stamp.text();var ct=time_stamp.text().split(':');if(ct.length==2){current_seconds=parseInt(ct[0])*60+parseInt(ct[1]);}else{current_seconds=parseInt(ct[0])*3600+parseInt(ct[1])*60+parseInt(ct[2]);}
if(thumb_num==parseInt(current_seconds/20))return;thumb_num=parseInt(current_seconds/20);thumb_holder.css('background-position',(-1*thumb_num*120)+'px top');});seek_bar.on('mouseenter touchstart',function(){timeline_thumbs.fadeIn('fast');});seek_bar.on('mouseleave touchcancel touchend',function(){timeline_thumbs.fadeOut('fast');});this.on('userinactive',function(){timeline_thumbs.fadeOut('fast');});}
videojs.registerPlugin('timelineThumbs',timelineThumbs);function timelinePositions(duration){if(!$('ul.positions li.p').length||$('.vjs-timeline-positions-holder').length)return;var this_player=this;var player_element=$('#'+this.id_);var seek_bar=player_element.find('.vjs-progress-control');var control_bar=player_element.find('.vjs-control-bar');seek_bar.addClass('with-positions');control_bar.append('<div class="vjs-timeline-positions-holder"><div class="vjs-timeline-positions"></div></div>');control_bar.find('.vjs-timeline-positions-holder').css({'padding-left':seek_bar.position().left+'px','padding-right':(control_bar.outerWidth()-seek_bar.outerWidth()-seek_bar.position().left)+'px'})
var timeline_positions=control_bar.find('.vjs-timeline-positions');$('ul.positions li.p').each(function(){position_name=$(this).text();position_timestamp=$(this).data('timestamp');var this_position=$('<strong>');var this_wrapper=$('<span>');this_position.addClass(position_name);this_position.data('timestamp',position_timestamp).data('position',position_name).on('click',function(event){if(event)event.stopPropagation();this_position_ts=$(this).data('timestamp');this_position_name=$(this).data('position');seek_player(this_position_ts,this_position_name);});this_wrapper.css("left",parseInt((position_timestamp/duration)*100)+'%');timeline_positions.append(this_wrapper.html(this_position));});}
videojs.registerPlugin('timelinePositions',timelinePositions);function playerPerformance(){var load_time=window.page_load_time;var start_delay=0;var seek_count=0;var buffer_count=0;var raw_buffer_count=0;var buffer_delay=0;var buffer_time=0;var current_seek_pos=0;var last_seek_pos=0;var watch_duration=0;var segment_data=[];var buffering_detected=0;var seek_start_time;var debug=false;var player=this;setInterval(function(){watch_duration=watch_duration+1},1000);var buffer_calc=function(){if(buffering_detected==1)return;buffering_detected=1;current_play_pos=player.currentTime();if(debug)console.log('buffer detected');if(debug)console.log(current_play_pos,current_seek_pos-2,current_seek_pos+2);if(debug)console.log(isBetween(current_play_pos,current_seek_pos-2,current_seek_pos+2));if(current_play_pos>2&&!isBetween(current_play_pos,current_seek_pos-2,current_seek_pos+2)){if(debug)console.log('buffer counting',buffer_count);buffer_count=buffer_count+1;if(debug)console.log('buffer counted',buffer_count);}
raw_buffer_count=raw_buffer_count+1;buffer_time=Math.round(new Date().getTime()/1000);}
var generate_payload=function(){var player_source=player.currentSrc();var file_extension=player_source.split(/\#|\?/)[0].split('.').pop().trim();var sub_domain=player_source.split('.')[0].replace('https://','').replace(/-/g,"_");return[parseInt(seek_count)||0,parseInt(buffer_count)||0,parseInt(Math.round(new Date().getTime()/1000)-load_time)||0,parseInt(buffer_delay)||0,parseInt(start_delay)||0,sub_domain,file_extension,parseInt(raw_buffer_count)||0,player_source.replace(/-/g,"_")].join('-');}
this.on('waiting',function(e){if(debug)console.log('waiting',e);if(player.seeking())return;buffer_calc();});this.on('stalled',function(e){if(debug)console.log('stalled',e);});this.on('suspend',function(e){if(debug)console.log('suspend',e);});this.on('seeked',function(e){if(last_seek_pos){watch_duration=parseInt(new Date().getTime()/1000-last_seek_time);if(watch_duration>5){segment_data.push(parseInt(new Date().getTime()/1000-last_seek_time)+'@'+last_seek_pos);}}
last_seek_time=parseInt(new Date().getTime()/1000);last_seek_pos=parseInt(player.currentTime());current_seek_pos=last_seek_pos;seek_count=seek_count+1;if(debug)console.log('seeked',e);});this.on('seeking',function(e){current_seek_pos=player.currentTime();if(debug){console.log('seeking',e);seek_start_time=Math.round(new Date().getTime());}});this.on('playing',function(e){if(buffering_detected==1){buffer_delay=buffer_delay+(Math.round(new Date().getTime()/1000)-buffer_time);}
buffering_detected=0;watch_duration=0;if(debug){console.log('playing',Math.round(new Date().getTime())-seek_start_time);}});window.addEventListener('beforeunload',function(e){if(window.main_player_has_played){analytics_track_event('player','performance',generate_payload(),'away');if(segment_data.length){analytics_track_event('player','seek_segments',segment_data.join('|'),'away');}}},false);document.addEventListener('pagehide',function(){if(window.main_player_has_played){analytics_track_event('player','performance',generate_payload(),'away');if(segment_data.length){analytics_track_event('player','seek_segments',segment_data.join('|'),'away');}}},false);setTimeout(function(){if(window.main_player_has_played){analytics_track_event('player','performance_5m',generate_payload(),'away');if(segment_data.length){analytics_track_event('player','seek_segments_3m',segment_data.join('|'),'away');}}},180*1000);if(debug){setInterval(function(){if(window.main_player_has_played){console.log(generate_payload());console.log(segment_data.join('|'));}},5000)}}
videojs.registerPlugin('playerPerformance',playerPerformance);function desktopUI(duration){var player=this;var trigger_time;var debug=false;var player_element=$('#'+this.id_);$(".ttaa2v3").appendTo('#'+this.id_);var text_ad_link=player_element.find(".ttaa2v3");this.on('userinactive',function(){text_ad_link.fadeOut('fast');});this.on('useractive',function(){text_ad_link.fadeIn('fast');});player.on('waiting',function(e){clearTimeout(trigger_time);if(!player.paused())return;trigger_time=setTimeout(function(){player.play();if(debug)console.log('UI manual currentTime trigger',e);},500);if(debug)console.log('UI waiting',e);});player.controlBar.progressControl.seekBar.on('pointerup',function(event){if(event)event.stopPropagation();var seekBarEl=this.el();var seekBarRect=videojs.dom.getBoundingClientRect(seekBarEl);var seekBarPoint=videojs.dom.getPointerPosition(seekBarEl,event).x;var seekBarClickedTime=videojs.formatTime(seekBarPoint*duration,duration);player.currentTime(parseInt(seekBarPoint*duration));});}
videojs.registerPlugin('desktopUI',desktopUI);window.main_player_has_played=0;window.page_load_time=Math.round(new Date().getTime()/1000);function check_vast_availablity(){if(logged_in==1||window.canRunAds===false)return false;if(typeof force_preroll!=='undefined'&&force_preroll===true)return'adshare';var preroll_skip=getCookie('preroll_skip');if(!preroll_skip)return'first';if(preroll_skip=='1'){try{var current_session=fetch_browse_session('get');}catch(e){var current_session=false;}
if(current_session&&current_session['vpv']>3)return'second';}
return false;}
function load_player(should_play_vast){if(should_play_vast&&window.vast_v2_player){window.main_player.pause();window.vast_v2_player.play();}else{window.main_player.play();}
window.main_player_has_played=1;$('.play_cover').hide();$('#video_container').show();}
function seek_player(second,position_name){second=parseInt(second);if($('#player_wrapper_outer .play_cover').is(":visible")){var should_play_vast=check_vast_availablity();load_player(should_play_vast);window.main_player.ready(function(){setTimeout(function(){window.main_player.currentTime(second);},100);});}else{window.main_player.currentTime(second);}
if(position_name){api_call('positions/log',stream_raw_id,position_name);}}
function setup_main_player(){var should_play_vast=check_vast_availablity();if(should_play_vast)create_vast_player_v2(should_play_vast);console.log('player setup @',new Date()-window.start_loading_page)
var results=window.stream_data;cover_image=results['cover_image'];thumbnail_image=results['thumbnail'];stream_sheet=results['stream_sheet'];stream_raw_id=results['stream_raw_id'];stream_u_id=results['stream_u_id'];window.main_player=videojs('main_video_player',{controls:true,autoplay:!$('#player_wrapper_outer .play_cover').is(":visible"),preload:'metadata',html5:{nativeAudioTracks:videojs.browser.IS_ANY_SAFARI,nativeVideoTracks:videojs.browser.IS_ANY_SAFARI,hls:{overrideNative:!videojs.browser.IS_ANY_SAFARI,useBandwidthFromLocalStorage:true,smoothQualityChange:false,limitRenditionByPlayerDimensions:true,useDevicePixelRatio:true,}},playbackRates:[0.5,1,1.5,2,3],plugins:{airplayButton:{}},},function onPlayerReady(){this.qualitySelectorSB(results);var this_player=this;var player_cover=$('#player_wrapper_outer .play_cover')
player_cover.on('click',function(){load_player(should_play_vast);}).css('cursor','pointer');this.hotkeys({alwaysCaptureHotkeys:true,enableHoverScroll:true,enableVolumeScroll:false});this.theaterMode({elementToToggle:'video_container',className:'theater-mode'});this.on('theaterMode',function(elm,data){if(data.theaterModeIsOn){$('#video_container').prependTo('#video_theater');$('#video_theater').show();$('html,body').animate({scrollTop:$("#video_theater").offset().top});}else{$('#video_theater').hide();$('#video_container').prependTo('#player_wrapper_outer');$('html,body').animate({scrollTop:$("#video_container").offset().top});}});this.one('play',function(){this.timelineThumbs(results['stream_sheet']);this.timelinePositions(results['length']);this.playerPerformance();this.desktopUI(results['length']);if(logged_in==1){setTimeout(function(){api_call('history/watch',stream_raw_id);},10000);}
setTimeout(function(){analytics_track_event('video','watch_mark',60);},60000);setTimeout(function(){analytics_track_event('video','watch_mark',180);},180000);setTimeout(function(){analytics_track_event('video','watch_mark',720);},720000);setTimeout(function(){analytics_track_event('video','watch_mark',1200);},1200000);setTimeout(function(){analytics_track_event('video','watch_mark',1800);},1800000);})
this.one('error',function(){e=this_player.error();var sub_domain=this_player.currentSrc().split('.')[0].replace('https://','').replace(/-/g,"_");analytics_track_event('player','error_v2',e['message']+'||'+e['code']+'||'+sub_domain);});this.one('ended',function(){var postroll_skip=getCookie('postroll_skip');if(!postroll_skip){create_vast_player_v2('postroll');}});});}