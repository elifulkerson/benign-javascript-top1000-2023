"undefined"==typeof window.Mozilla&&(window.Mozilla={}),function(){"use strict";window.dataLayer=window.dataLayer||[];var t={COOKIE_CODE_ID:"moz-stub-attribution-code",COOKIE_SIGNATURE_ID:"moz-stub-attribution-sig",DLSOURCE:"mozorg"};t.experimentName,t.experimentVariation,t.successCallback,t.timeoutCallback,t.requestComplete=!1,t.withinAttributionRate=function(){return Math.random()<t.getAttributionRate()},t.getAttributionRate=function(){var t=document.getElementsByTagName("html")[0].getAttribute("data-stub-attribution-rate");return isNaN(t)||!t?0:Math.min(Math.max(parseFloat(t),0),1)},t.hasCookie=function(){return Mozilla.Cookies.hasItem(t.COOKIE_CODE_ID)&&Mozilla.Cookies.hasItem(t.COOKIE_SIGNATURE_ID)},t.setCookie=function(e){if(e.attribution_code&&e.attribution_sig){var o=new Date;o.setTime(o.getTime()+864e5);var i=o.toUTCString();Mozilla.Cookies.setItem(t.COOKIE_CODE_ID,e.attribution_code,i,"/",undefined,!1,"lax"),Mozilla.Cookies.setItem(t.COOKIE_SIGNATURE_ID,e.attribution_sig,i,"/",undefined,!1,"lax")}},t.getCookie=function(){return{attribution_code:Mozilla.Cookies.getItem(t.COOKIE_CODE_ID),attribution_sig:Mozilla.Cookies.getItem(t.COOKIE_SIGNATURE_ID)}},t.updateBouncerLinks=function(e){if(e.attribution_code&&e.attribution_sig&&t.meetsRequirements())for(var o=document.querySelectorAll(".download-list .download-link, .c-button-download-thanks .download-link, .download-platform-list .download-link, .firefox-platform-button .download-link"),i=0;i<o.length;i++){var n,r,a=o[i];a.href&&(-1!==a.href.indexOf("https://download.mozilla.org")||-1!==a.href.indexOf("https://bouncer-bouncer.stage.mozaws.net/"))||-1!==a.href.indexOf("https://dev.bouncer.nonprod.webservices.mozgcp.net")?(n=a.getAttribute("data-download-version"))&&/win/.test(n)&&(a.href=Mozilla.StubAttribution.appendToDownloadURL(a.href,e)):a.href&&-1!==a.href.indexOf("/firefox/download/thanks/")&&(r=a.getAttribute("data-direct-link"))&&a.setAttribute("data-direct-link",Mozilla.StubAttribution.appendToDownloadURL(r,e))}},t.appendToDownloadURL=function(t,e){if(!e.attribution_code||!e.attribution_sig)return t;for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&("attribution_code"!==o&&"attribution_sig"!==o||(t+=(t.indexOf("?")>-1?"&":"?")+o+"="+e[o]));return t},t.onRequestSuccess=function(e){e.attribution_code&&e.attribution_sig&&!t.requestComplete&&(t.updateBouncerLinks(e),t.setCookie(e),t.requestComplete=!0,"function"==typeof t.successCallback&&t.successCallback())},t.onRequestTimeout=function(){t.requestComplete||(t.requestComplete=!0,"function"==typeof t.timeoutCallback&&t.timeoutCallback())},t.requestAuthentication=function(e){var o=window.location.protocol+"//"+window.location.host+"/en-US/firefox/stub_attribution_code/",i=new window.XMLHttpRequest,n=setTimeout(t.onRequestTimeout,1e4);i.open("GET",o+"?"+window._SearchParams.objectToQueryString(e)),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.onreadystatechange=function(){if(4===i.readyState){var e=i.status;if(e&&e>=200&&e<400)try{var o=JSON.parse(i.responseText);clearTimeout(n),t.onRequestSuccess(o)}catch(r){t.onRequestTimeout()}}},i.timeout=1e4,i.send()},t.getUserAgent=function(t){return t=void 0!==t?t:navigator.userAgent,/MSIE|Trident/i.test(t)?"ie":/Edg|Edge/i.test(t)?"edge":/Firefox/.test(t)?"firefox":/Chrome/.test(t)?"chrome":"other"},t.getGAClientID=function(){try{var t=window.ga.getAll()[0].get("clientId");return t&&"string"==typeof t&&""!==t?t:null}catch(e){return null}},t.createSessionID=function(){return Math.floor(1e9+9e9*Math.random()).toString()},t.waitForGoogleAnalytics=function(e){var o,i=0;!function n(){clearTimeout(o),t.getGAClientID()?e(!0):i<=20?(i+=1,o=window.setTimeout(n,100)):e(!1)}()},t.getReferrer=function(t){var e="string"==typeof t?t:document.referrer;return"undefined"!=typeof window.Mozilla.Analytics?Mozilla.Analytics.getReferrer(e):e},t.getAttributionData=function(e){var o=new window._SearchParams,i=o.utmParams(),n=o.get("experiment")||t.experimentName,r=o.get("variation")||t.experimentVariation,a=t.getReferrer(e),u=t.getUserAgent(),s=t.getGAClientID(),l={utm_source:i.utm_source,utm_medium:i.utm_medium,utm_campaign:i.utm_campaign,utm_content:i.utm_content,referrer:a,ua:u,experiment:n,variation:r,client_id:s,session_id:s?t.createSessionID():null,dlsource:t.DLSOURCE};for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&("undefined"!=typeof l[d]&&null!==l[d]||delete l[d]);return l},t.hasValidData=function(t){if("string"==typeof t.utm_content&&"string"==typeof t.referrer){var e=t.utm_content;if(e.length>150)return!1;for(;-1!==e.indexOf("%");)try{var o=decodeURIComponent(e);if(o===e)break;e=o}catch(i){break}if(/^rta:/.test(e)&&-1===t.referrer.indexOf("https://addons.mozilla.org"))return!1}return!0},t.isFirefoxNewScene2=function(t){return(t=void 0!==t?t:window.location.href).indexOf("/firefox/download/thanks/")>-1},t.meetsRequirements=function(){return"undefined"!=typeof window.site&&"undefined"!=typeof Mozilla.Cookies&&"undefined"!=typeof window._SearchParams&&!!Mozilla.Cookies.enabled()&&"windows"===window.site.platform&&!Mozilla.dntEnabled()},t.init=function(e,o){var i={};t.meetsRequirements()&&("function"==typeof e&&(t.successCallback=e),"function"==typeof o&&(t.timeoutCallback=o),t.hasCookie()?(i=t.getCookie(),t.updateBouncerLinks(i)):t.isFirefoxNewScene2()||t.waitForGoogleAnalytics((function(){(i=t.getAttributionData())&&t.withinAttributionRate()&&t.hasValidData(i)&&(t.requestAuthentication(i),i.client_id&&i.session_id&&window.dataLayer.push({event:"stub-session-id",eLabel:i.session_id}))})))},window.Mozilla.StubAttribution=t}(),function(){"use strict";Mozilla.StubAttribution.init()}();