var topLevelClass=".vscom-dropdown-menu-container",DEBUG_MODE=!1;jQuery.fn.setup_dropdowns=function(n_settings){var thisDropdown=this;settings={containerClass:".vscom-dropdown-menu-container",menuHoverClass:".show-menu",addHoverClass:"show-menu",topLinkClass:".toplink",subMenuClass:".vscom-subnav",subLinkClass:".sublink"},n_settings&&(settings=jQuery.extend(settings,n_settings));var keyCodeMap={9:"TAB",13:"ENTER",27:"ESCAPE",32:"SPACE",37:"LEFT_ARROW",38:"UP_ARROW",39:"RIGHT_ARROW",40:"DOWN_ARROW"},topLevelButton=jQuery(this).find(settings.topLinkClass);DEBUG_MODE&&console.log(Math.floor(Date.now()/1e3)+" "+JSON.stringify(topLevelButton));var links=jQuery(this).find(settings.subLinkClass);function openMenu(element,event){if(DEBUG_MODE&&console.log(Math.floor(Date.now()/1e3)+" fn openMenu"),event&&event.preventDefault(),jQuery(topLevelButton).attr("aria-expanded","true"),!element)throw"VSCOM Error: fn openMenu missing required parameter";jQuery(element).addClass(settings.addHoverClass).find("a").attr("tabIndex",0)}function closeMenu(element,event){DEBUG_MODE&&console.log(Math.floor(Date.now()/1e3)+" fn closeMenu"),event&&event.preventDefault(),element?(0!=jQuery(element).closest(settings.containerClass).find(":focus").length&&jQuery(element).closest(settings.containerClass).find(settings.topLinkClass).attr("aria-expanded","false").focus(),jQuery(element).removeClass(settings.addHoverClass).find("a").attr("tabIndex",-1)):(jQuery(topLevelButton).attr("aria-expanded","false"),jQuery(thisDropdown).find(settings.subMenuClass+settings.menuHoverClass).removeClass(settings.addHoverClass).find("a").attr("tabIndex",-1))}function toggleMenu(element,event){var submenu;if(DEBUG_MODE&&console.log(Math.floor(Date.now()/1e3)+" fn toggleMenu"),event&&event.preventDefault(),!element)throw"VSCOM Error: fn toggleMenu missing required parameter";var submenu=jQuery(thisDropdown).find(settings.subMenuClass);jQuery(settings.subMenuClass+".show-menu").removeClass("show-menu"),DEBUG_MODE&&console.log(Math.floor(Date.now()/1e3)+" - "+jQuery(submenu).length+" "+JSON.stringify(submenu)),jQuery(submenu).length>0&&(jQuery(submenu).hasClass(settings.addHoverClass)?closeMenu(submenu,event):openMenu(submenu,event))}function selectLast(element,event){if(DEBUG_MODE&&console.log(Math.floor(Date.now()/1e3)+" fn selectLast"),event&&event.preventDefault(),!element)throw"VSCOM Error: fn selectLast missing required parameter";var submenu=jQuery(thisDropdown).find(settings.subMenuClass);jQuery(submenu).length>0&&(jQuery(submenu).hasClass(settings.addHoverClass)||jQuery(submenu).addClass(settings.addHoverClass),jQuery(submenu).find("a").attr("tabIndex",0).last().focus())}function selectFirst(element,event){if(DEBUG_MODE&&console.log(Math.floor(Date.now()/1e3)+" fn selectFirst"),event&&event.preventDefault(),!element)throw"VSCOM Error: fn selectFirst missing required parameter";var submenu=jQuery(thisDropdown).find(settings.subMenuClass);jQuery(submenu).length>0&&(jQuery(submenu).hasClass(settings.addHoverClass)||jQuery(submenu).addClass(settings.addHoverClass),jQuery(submenu).find("a").attr("tabIndex",0).first().focus())}function moveUp(element,event){if(DEBUG_MODE&&console.log(Math.floor(Date.now()/1e3)+" fn moveUp"),event&&event.preventDefault(),!element)throw"VSCOM Error: fn moveUp missing required parameter";0===jQuery(element).closest("li").prev("li").length?jQuery(topLevelButton).focus():jQuery(element).closest("li").prev("li").find("a").focus()}function moveDown(element,event){if(DEBUG_MODE&&console.log(Math.floor(Date.now()/1e3)+" fn moveDown"),event&&event.preventDefault(),!element)throw"VSCOM Error: fn moveDown missing required parameter";0===jQuery(element).closest("li").next("li").length?jQuery(topLevelButton).focus():jQuery(element).closest("li").next("li").find("a").focus()}DEBUG_MODE&&console.log(Math.floor(Date.now()/1e3)+" "+JSON.stringify(links)),jQuery(topLevelButton).attr("tabindex","0"),jQuery(links).attr("tabIndex",-1),jQuery(thisDropdown).hover((function(e){DEBUG_MODE&&console.log(Math.floor(Date.now()/1e3)+" container level hover in")}),(function(e){DEBUG_MODE&&console.log(Math.floor(Date.now()/1e3)+" container level hover out"),0==jQuery(settings.containerClass).has(e.target).length&&closeMenu()})),jQuery(topLevelButton).click((function(e){toggleMenu(this,e)})).hover((function(e){DEBUG_MODE&&console.log(Math.floor(Date.now()/1e3)+" top button hover in"),openMenu(jQuery(this).closest(settings.subMenuClass),e)}),(function(e){DEBUG_MODE&&console.log(Math.floor(Date.now()/1e3)+" top button hover out")})).keydown((function(e){switch(DEBUG_MODE&&console.log(Math.floor(Date.now()/1e3)+" fn topLevelButton keydown "+keyCodeMap[e.keyCode]),keyCodeMap[e.keyCode]){case"UP_ARROW":selectLast(this,e);break;case"TAB":e.shiftKey&&closeMenu();break;case"DOWN_ARROW":selectFirst(this,e);break;case"ESCAPE":closeMenu(this,e)}})),jQuery(links).keydown((function(e){switch(DEBUG_MODE&&console.log(Math.floor(Date.now()/1e3)+" fn links keydown "+keyCodeMap[e.keyCode]),keyCodeMap[e.keyCode]){case"UP_ARROW":moveUp(this,e);break;case"DOWN_ARROW":moveDown(this,e);break;case"TAB":if(e.shiftKey)break;jQuery(this).closest("li").is(":last-child")&&closeMenu(jQuery(this).closest(settings.subMenuClass));break;case"ESCAPE":closeMenu(jQuery(this).closest(settings.subMenuClass),e)}})),jQuery(document).click((function(e){DEBUG_MODE&&console.log(Math.floor(Date.now()/1e3)+" fn document click handler"),"click"===e.type&&0==jQuery(settings.containerClass).has(e.target).length&&(DEBUG_MODE&&console.log(Math.floor(Date.now()/1e3)+" clicked outside topLevelClass elements"),closeMenu())}))},jQuery(document).ready((function(){jQuery(topLevelClass).each((function(){jQuery(this).setup_dropdowns()}))}));