const __thg_event=function(){var paymenttmode;function UrlParameter(name,url){if(!url)url=location.href;name=name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");var regexS="[\\?&]"+name+"=([^&#]*)";var regex=new RegExp(regexS,"i");var results=regex.exec(url);return results==null?null:results[1];}
var Clientdevice={"xlarge":"(min-width: 1600px)","large":"(min-width: 1024px) and (max-width: 1599px)","small":"(max-width: 767px)","medium":"(min-width: 768px) and (max-width: 1023px)"};var thg={isMobile:false,isTablet:false,isDesktop:false,isLargeDesktop:false};for(var type in Clientdevice){if(window.matchMedia(Clientdevice[type]).matches){switch(type){case"xlarge":thg.isLargeDesktop=true;break;case"large":thg.isDesktop=true;break;case"medium":thg.isTablet=true;break;case"small":thg.isMobile=true;break;}
break;}}
function platform(){var Platform=thg.isMobile==true?'MWEB':'WEB';if(location.pathname=="/appwebview/android/"){Platform='Android';}
else if(location.pathname=="/appwebview/ios/"){Platform='iOS';}
else if(location.pathname=="/appwebview/ipad/"){Platform='iPad';}
return Platform;}
function utmSource(){return UrlParameter("utm_source")!==null?UrlParameter("utm_source"):'Direct';}
function utmMedium(){return UrlParameter("utm_medium")!==null?UrlParameter("utm_medium"):'Direct';}
function utmCampaign(){return UrlParameter("utm_campaign")!==null?UrlParameter("utm_campaign"):'Direct';}
function sectionName(){var pathnames=location.pathname.split("/");var section=pathnames[pathnames.length-2];if(location.href.match(/article[\d]*.ece/)!=null){section=pathnames[pathnames.length-3];}
return(section!="undefined"&&section!="")?section:"HomePage";}
function registerSuccess(data,reg_id,reg){_debug('info','registerSuccess:',data);clevertaploginpush(data);clevertapAuthEvent("Sign Up Successful",data);var dataLayer=window.dataLayer||[];dataLayer.push({"event":"loginSuccess","userDetails":{"loginStatus":"logged","subscriberId":data.params.uid}});if(typeof fbq==="function"){fbq('track','Lead');}
if(data.source=="PIANOID"&&reg){_debug('info','register Term id:',reg_id);if(reg_id&&!(/^\s*$/.test(reg_id))){tp.api.callApi("/conversion/registration/create",{term_id:reg_id},function(conversionData){_debug('info','Registration Term =',conversionData);if(conversionData.code===0){try{if(typeof cX!="undefined"&&typeof cX.callQueue==="object"){cX.callQueue.push(['sendEvent','Free Trial Activated',{subscriptionStartDate:new Date(conversionData.conversion.user_access.start_date*1000),subscriptionEndDate:new Date(conversionData.conversion.user_access.expire_date*1000),Platform:platform(),Source:utmSource(),Medium:utmMedium(),Campaign:utmCampaign()}]);}
}catch(e){console.error(e);}
tp.user.refreshAccessToken(true,function(accessTokenList){window.location.reload();});}});}else{window.location.reload();}}}
function loginSuccess(data){_debug('info','loginSuccess:',data);clevertapAuthEvent("Log In Successful",data);var dataLayer=window.dataLayer||[];dataLayer.push({"event":"loginSuccess","userDetails":{"loginStatus":"logged","subscriberId":data.params.uid}});if(typeof fbq==="function"){fbq('track','Lead');}
if(data.source=="PIANOID"){setTimeout(function(){window.location.reload();},1000);}}
function logOut(data){_debug('info','logOut:',data);if(typeof cX!="undefined"&&typeof cX.callQueue==="object"){cX.callQueue.push(['sendEvent','Sign Out User',{Platform:platform(),Source:utmSource(),Medium:utmMedium(),Campaign:utmCampaign()}]);}
var dataLayer=window.dataLayer||[];dataLayer.push({"event":"signout_successful","data":{"email":data.email,"uid":data.uid,"platform":platform()}});}
function clevertaploginpush(data){}
function clevertapAuthEvent(eventname,data){try{if(typeof cX!="undefined"&&typeof cX.callQueue==="object"){cX.callQueue.push(['sendEvent',eventname,{registeredID:data.params.uid,Platform:platform(),Source:utmSource(),Medium:utmMedium(),Campaign:utmCampaign()}]);}}
catch(e){console.error(e);}}
function paymentSuccess(conversion){_debug('info','paymentSuccess =',conversion);var ud=typeof readCookie==="function"?(readCookie("userplandetails")!=null?JSON.parse(readCookie("userplandetails")):''):'';var paymentMode=typeof readCookie==="function"?(readCookie("paymentMode")!=null?readCookie("paymentMode"):''):'';if(typeof Android!="undefined"&&location.pathname=="/appwebview/registration/"&&typeof conversion.type!="undefined"&&conversion.type=="registration"){try{if(typeof cX!="undefined"&&typeof cX.callQueue==="object"){cX.callQueue.push(['sendEvent','Free Trial Activated',{subscriptionStartDate:new Date(conversion.startedAt),subscriptionEndDate:new Date(conversion.expires*1000),Platform:'Android',Source:utmSource(),Medium:utmMedium(),Campaign:utmCampaign()}]);}}
catch(e){console.error(e);}
if(typeof Android.onFreeTrialActivation=="function"){Android.onFreeTrialActivation(conversion.uid,new Date(conversion.startedAt).toString(),new Date(conversion.expires*1000).toString(),utmSource(),utmMedium(),utmCampaign());}
if(typeof Android.PaymentSuccess=="function"){Android.PaymentSuccess();}}
else if(window.webkit&&location.pathname=="/appwebview/registration/"&&typeof conversion.type!="undefined"&&conversion.type=="registration"){try{if(typeof cX!="undefined"&&typeof cX.callQueue==="object"){cX.callQueue.push(['sendEvent','Free Trial Activated',{subscriptionStartDate:new Date(conversion.startedAt),subscriptionEndDate:new Date(conversion.expires*1000),Platform:'iOS',Source:utmSource(),Medium:utmMedium(),Campaign:utmCampaign()}]);}}
catch(e){console.error(e);}
window.webkit.messageHandlers.freetrailactivated.postMessage({name:"Free trial activated"})}
else if(typeof conversion.type!="undefined"&&(conversion.type=="payment"||conversion.type=="subscription")){try{if(typeof cX!="undefined"&&typeof cX.callQueue==="object"){cX.callQueue.push(['sendEvent','Charged',{subscriptionStartDate:new Date(conversion.startedAt),subscriptionEndDate:new Date(conversion.expires*1000),packValue:conversion.chargeAmount.toString(),packCurrency:conversion.chargeCurrency,planDuration:typeof ud.planDuration!="undefined"?ud.planDuration:'',packName:typeof ud.packName!="undefined"?ud.packName:'',autoRenew:(typeof ud.recurring!="undefined"&&ud.recurring==true)?'On':'Off',promotionApplied:conversion.promotionId!=null?"On":"Off",paymentMode:typeof paymentMode!="undefined"?paymentMode:'',Platform:platform(),Source:utmSource(),Medium:utmMedium(),Campaign:utmCampaign()}]);}
var dataLayer=window.dataLayer=window.dataLayer||[];var date=new Date(conversion.startedAt);var year=date.getFullYear();var month=date.getMonth()+1;var day=date.getDate();if(month<10){month="0"+month}
if(day<10){day="0"+day}
var StartDate=year+"-"+month+"-"+day;dataLayer.push({"event":"subscribeSuccessful","userDetails":{"loginStatus":"logged","subscriberId":conversion.uid,"subscriptionStatus":"subscriber","subscriptionProduct":"digital","subscriptionPackName":typeof ud.packName!="undefined"?ud.packName:'',"subscriptionDate":StartDate}});dataLayer.push({"event":"PurchaseSuccess","purchaseDetails":{"rid":conversion.rid,"chargeAmount":typeof conversion.chargeAmount!="undefined"?conversion.chargeAmount:'1000',"chargeCurrency":typeof conversion.chargeCurrency!="undefined"?conversion.chargeCurrency:'INR',"termConversionId":conversion.termConversionId,"termId":conversion.termId,"subscriptionPackName":typeof ud.packName!="undefined"?ud.packName:'',"uid":conversion.uid}});}
catch(e){console.error(e);}
if(typeof Android!="undefined"&&location.pathname=="/appwebview/android/"){if(typeof Android.onCharged=="function"){var AppplanDuration=typeof ud.planDuration!="undefined"?ud.planDuration:'';var ApppackValue=typeof conversion.chargeAmount!="undefined"?conversion.chargeAmount.toString():'1000';var AppautoRenew=(typeof ud.recurring!="undefined"&&ud.recurring==true)?'On':'Off';var ApppromotionApplied=conversion.promotionId!=null?"On":"Off";var ApppaymentSelected=typeof paymentMode!="undefined"?paymentMode:'';var startDate=typeof conversion.startedAt!="undefined"?conversion.startedAt:new Date().getTime();var enddate=typeof conversion.expires!="undefined"?conversion.expires*1000:new Date().setFullYear(new Date().getFullYear()+1);Android.onCharged(AppplanDuration,ApppackValue,AppautoRenew,ApppromotionApplied,ApppaymentSelected,new Date(startDate).toString(),new Date(enddate).toString(),utmSource(),utmMedium(),utmCampaign());}
if(typeof Android.PaymentSuccess=="function"){Android.PaymentSuccess();}
if(typeof Android.onCallbackToAndroid=="function"){Android.onCallbackToAndroid("Subscription_Successful",typeof ud.packName!="undefined"?ud.packName:'');}}}}
function checkoutClose(event){_debug('info','checkoutClose =',event);switch(event.state){case'checkoutCompleted':if(typeof Android!="undefined"&&(location.pathname=="/appwebview/android/"||location.pathname=="/appwebview/registration/")){if(typeof Android.close=="function"){Android.close();}}
if(window.webkit&&location.pathname=="/appwebview/registration/"){window.webkit.messageHandlers.checkoutClose.postMessage({name:"Close"});}
break;case'alreadyHasAccess':if(typeof Android!="undefined"&&(location.pathname=="/appwebview/android/"||location.pathname=="/appwebview/registration/")){if(typeof Android.PaymentSuccess=="function"){Android.PaymentSuccess();}
if(typeof Android.close=="function"){Android.close();}}
else if(window.webkit&&location.pathname=="/appwebview/registration/"){window.webkit.messageHandlers.checkoutClose.postMessage({name:"Close"});}
else{location.reload();}
break;case'close':if(typeof Android!="undefined"&&(location.pathname=="/appwebview/android/"||location.pathname=="/appwebview/registration/")){if(typeof Android.close=="function"){Android.close();}}
if(window.webkit&&location.pathname=="/appwebview/registration/"){window.webkit.messageHandlers.checkoutClose.postMessage();}}}
function customEvent(event){_debug('info','customEvent =',event);if(typeof event.eventName!="undefined"&&event.eventName.indexOf("offer-subscribe")>-1){if(typeof fbq==="function"){fbq('track','InitiateCheckout');}}
switch(event.eventName){case'iosInApp':_debug('info','iosInApp Product Id =',event.params.productid);_debug('info','iosInApp Term Id =',event.params.termid);if(window.webkit&&(location.pathname=="/appwebview/ios/"||location.pathname=="/appwebview/ipad/")){window.webkit.messageHandlers.subscriptionPlan.postMessage({productId:event.params.productid,termId:event.params.termid,planName:typeof event.params.planname!="undefined"?event.params.planname:'',planValidity:typeof event.params.planvalidity!="undefined"?event.params.planvalidity:'',amount:typeof event.params.amount!="undefined"?event.params.amount:'',currency:typeof event.params.currency!="undefined"?event.params.currency:''});}
break;case'paymentselect':if(event.params.paymentmethod=='pay_u_india_cc'){paymenttmode="Debit/Credit Card";}
else if(event.params.paymentmethod=='pay_u_india_nb'){paymenttmode="Net Banking"}
else if(event.params.paymentmethod=='pay_u_india_upi'){paymenttmode="UPI"}
else if(typeof event.params.paymentmethod!='undefined'&&event.params.paymentmethod!=''){paymenttmode=event.params.paymentmethod}
var ud=typeof readCookie==="function"?(readCookie("userplandetails")!=null?JSON.parse(readCookie("userplandetails")):''):'';createCookie("paymentMode",paymenttmode,0.5);try{if(typeof cX!="undefined"&&typeof cX.callQueue==="object"){cX.callQueue.push(['sendEvent','Payment Selected',{paymentSelected:paymenttmode,Platform:platform(),Source:utmSource(),Medium:utmMedium(),Campaign:utmCampaign()}]);}
if(typeof Android!="undefined"&&location.pathname!="/appwebview/registration/"){if(typeof Android.onCallbackToAndroid=="function"){Android.onCallbackToAndroid(paymenttmode,typeof ud.packName!="undefined"?ud.packName:'');}
if(typeof Android.onPaymentSelected=="function"){Android.onPaymentSelected(paymenttmode,utmSource(),utmMedium(),utmCampaign());}}}catch(e){console.error(e);}
break;case'close':}}
function onMeterExpired(event){_debug('info','onMeterExpired =',event);}
function onMeterActive(event){_debug('info','onMeterActive =',event);}
function meterpaywall(){try{if(typeof cX!="undefined"&&typeof cX.callQueue==="object"){cX.callQueue.push(['sendEvent','Meter Paywall Hit',{sections:sectionName(),Platform:platform(),Source:utmSource(),Medium:utmMedium(),Campaign:utmCampaign()}]);}
}catch(e){console.error(e);}}
function hardpaywall(){try{if(typeof cX!="undefined"&&typeof cX.callQueue==="object"){cX.callQueue.push(['sendEvent','Hard Paywall Hit',{sections:sectionName(),Platform:platform(),Source:utmSource(),Medium:utmMedium(),Campaign:utmCampaign()}]);}
}catch(e){console.error(e);}}
function premiumpaywall(){try{if(typeof cX!="undefined"&&typeof cX.callQueue==="object"){cX.callQueue.push(['sendEvent','Premium Article Paywall',{sections:sectionName(),Platform:platform(),Source:utmSource(),Medium:utmMedium(),Campaign:utmCampaign()}]);}
}catch(e){console.error(e);}}
function articleread(number){try{if(typeof cX!="undefined"&&typeof cX.callQueue==="object"){cX.callQueue.push(['sendEvent','Article Read '+number,{sections:sectionName(),Platform:platform(),Source:utmSource(),Medium:utmMedium(),Campaign:utmCampaign()}]);}
}catch(e){console.error(e);}}
function completepayment(paymentdata){_debug('info','completepayment =',paymentdata);if(paymentdata.term.type=="payment"){try{if(typeof cX!="undefined"&&typeof cX.callQueue==="object"){cX.callQueue.push(['sendEvent','Complete Purchase',{planDuration:paymentdata.term.firstPeriod,packValue:paymentdata.term.chargeAmount.toString(),packCurrency:paymentdata.term.chargeCurrency,packName:paymentdata.term.name,autoRenew:paymentdata.term.forceAutoRenew==true?'On':'Off',Platform:platform(),Source:utmSource(),Medium:utmMedium(),Campaign:utmCampaign()}]);}
if(typeof fbq==="function"){fbq('track','Purchase',{value:paymentdata.term.chargeAmount,currency:paymentdata.term.chargeCurrency});}}catch(e){console.error(e);}
if(typeof Android!="undefined"&&location.pathname!="/appwebview/registration/"){if(typeof Android.onCompletePurchase=="function"){Android.onCompletePurchase(tp.pianoId.getUser().uid,paymentdata.term.firstPeriod,paymentdata.term.chargeAmount.toString(),paymentdata.term.name,paymentdata.term.chargeCurrency,paymentdata.term.forceAutoRenew==true?'On':'Off')}}}}
function checkoutStateChange(stateView){_debug('info','checkoutStateChange =',stateView);switch(stateView.stateName){case'state1':case'offer':try{if(typeof cX!="undefined"&&typeof cX.callQueue==="object"){cX.callQueue.push(['sendEvent','Plans Shown',{sections:sectionName(),Platform:platform(),Source:utmSource(),Medium:utmMedium(),Campaign:utmCampaign()}]);}
}catch(e){console.error(e);}
if(typeof Android!="undefined"&&location.pathname!="/appwebview/registration/"){if(typeof Android.onPlansShown=="function"){Android.onPlansShown(utmSource(),utmMedium(),utmCampaign());}}
break;case'state2':try{var userplandetails={"packName":stateView.term.name,"planDuration":stateView.term.firstPeriod,"recurring":stateView.term.forceAutoRenew}
createCookie("userplandetails",JSON.stringify(userplandetails),0.5);if(typeof cX!="undefined"&&typeof cX.callQueue==="object"){cX.callQueue.push(['sendEvent','Plan Selected',{planDuration:stateView.term.firstPeriod,packValue:stateView.term.chargeAmount.toString(),packCurrency:stateView.term.chargeCurrency,packName:stateView.term.name,Platform:platform(),Source:utmSource(),Medium:utmMedium(),Campaign:utmCampaign()}]);}
}catch(e){console.error(e);}
if(typeof Android!="undefined"&&location.pathname!="/appwebview/registration/"){if(typeof Android.onPlanSelected=="function"){Android.onPlanSelected(stateView.term.firstPeriod,stateView.term.chargeAmount.toString(),stateView.term.name);}}
break;}}
function updateprofile(data){_debug('info','Updateprofile =',data);tp.pianoId.loadExtendedUser({extendedUserLoaded:function(UserData){_debug('info','UserData =',UserData);}});}
function checkoutError(data){_debug('info','checkoutError =',data);if(data.message=="Payment could not be processed"){var ud=typeof readCookie==="function"?(readCookie("userplandetails")!=null?JSON.parse(readCookie("userplandetails")):''):'';if(typeof Android!="undefined"&&location.pathname=="/appwebview/android/"){if(typeof Android.onCallbackToAndroid=="function"){Android.onCallbackToAndroid("Payment_failure",typeof ud.packName!="undefined"?ud.packName:'');}}}}
function registerShown(){try{if(typeof cX!="undefined"&&typeof cX.callQueue==="object"){cX.callQueue.push(['sendEvent','Sign Up Page Shown',{Platform:platform(),Source:utmSource(),Medium:utmMedium(),Campaign:utmCampaign()}]);}
}catch(e){console.error(e);}}
function loginShown(){try{if(typeof cX!="undefined"&&typeof cX.callQueue==="object"){cX.callQueue.push(['sendEvent','Log In Page Shown',{Platform:platform(),Source:utmSource(),Medium:utmMedium(),Campaign:utmCampaign()}]);}
}catch(e){console.error(e);}}
return{triggerRegister:registerSuccess,triggerLogin:loginSuccess,triggerLogOut:logOut,triggerPaymentComplete:paymentSuccess,triggerClose:checkoutClose,triggercustomEvent:customEvent,triggerMeterActive:onMeterActive,triggerMeterExpired:onMeterExpired,triggerHardpaywall:hardpaywall,triggerPremiumpaywall:premiumpaywall,triggerArticleRead:articleread,triggerMeterpaywall:meterpaywall,triggerStateChange:checkoutStateChange,triggerPayment:completepayment,triggerProfileupdate:updateprofile,triggerLoginShown:loginShown,triggercheckoutError:checkoutError,triggerRegisterShown:registerShown}}();function _debug(m){if(typeof consoledebug!="undefined"&&consoledebug&&typeof console==='object'&&(typeof m==='object'||typeof console[m]==='function')){if(typeof m==='object'){var args=[];for(var sMethod in m){if(typeof console[sMethod]==='function'){args=(m[sMethod].length)?m[sMethod]:[m[sMethod]];console[sMethod].apply(console,args);}else{console.log.apply(console,args);}}}else{console[m].apply(console,Array.prototype.slice.call(arguments,1));}}}
tp=window.tp||[];tp.push(["addHandler","showOffer",function(offerParams){_debug('info','showOffer =',offerParams);}]);tp.push(["addHandler","showTemplate",function(templateParams){_debug('info','showOffer =',templateParams);}]);tp.push(["addHandler","startCheckout",function(data){_debug('info','startCheckout =',data);}]);tp.push(["addHandler","submitPayment",function(paymentdata){__thg_event.triggerPayment(paymentdata);}]);tp.push(["addHandler","checkoutStateChange",function(stateView){__thg_event.triggerStateChange(stateView);}]);tp.push(["addHandler","checkoutSelectTerm",function(termDetails,iframeId){_debug('info','checkoutSelectTerm =',termDetails);_debug('info','checkoutSelectTerm IframeID =',iframeId);}]);tp.push(["addHandler","checkoutError",function(errorData){__thg_event.triggercheckoutError(errorData);}]);