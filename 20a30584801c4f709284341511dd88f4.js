!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(n=n||self).MailScanLogin=t()}(this,(function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var n,t=function(){return(t=Object.assign||function(n){for(var t,e=1,i=arguments.length;e<i;e++)for(var o in t=arguments[e])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n}).apply(this,arguments)},e=(navigator.userAgent.toLowerCase().match(/(ipod|iphone|android|coolpad|mmp|smartphone|midp|wap|xoom|symbian|j2me|blackberry|wince)/i),document);(window.location.host.match(/\d+/)||[])[0];function i(n){return document.getElementById(n)}function o(n){return document.querySelectorAll?document.querySelectorAll(n):function(n,t){if(n.getElementsByClassName)return n.getElementsByClassName(t);for(var e=document.getElementsByTagName("*"),i=[],o=0;o<e.length;o++){var r=e[o].className.split(" ");a(t,r)&&i.push(e[o])}return i}(document,n.replace(".",""))}function a(n,t){for(var e=0;e<t.length;e++)if(t[e]==n)return!0;return!1}function r(n,t,e,i){i=!!i,n.addEventListener?n.addEventListener(t,e,i):n.attachEvent&&n.attachEvent("on"+t,e)}function c(n,t,e){if(n){var i=n,o=i.className.indexOf(t);if("add"===e){if(-1!==o)return;i.className=i.className+" "+t}if("remove"===e&&-1!==o){t="\\s"+t;var a=new RegExp(t,"g");i.className=i.className.replace(a,"")}}}var s=function(n,t,e){return arguments[2]||(e=!1),e?"?"+n+"="+t:"&"+n+"="+t},p=function(n){var t="?";if("object"==typeof n)for(var e in n.t=Date.now(),n)t+=e+"="+n[e]+"&";return t.slice(0,-1)},d=document,l=function(n,t){for(var e in t)n[e]=t[e];return n},u=Array.prototype.slice,h=Array.prototype.push,m=function(n,t){for(var e=0;e<n.length;e++){var i=n[e];if(!1===t.call(i,e-1,i))return!1}},g=/^[\],:{}\s]*$/,f=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,v=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,w=/(?:^|:|,)(?:\s*\[)+/g,y=function(n){return"string"==typeof n&&n?(n=n.replace(/(^\s*)|(\s*$)/g,""),window.JSON&&window.JSON.parse?window.JSON.parse(n):g.test(n.replace(f,"@").replace(v,"]").replace(w,""))?new Function("return "+n)():void 0):null},_={};m(["isString","isFunction","isArray","isNull","isUndefined"],(function(n,t){var e;e="[object "+t.substring(2,t.length)+"]",_[t]=function(n){return Object.prototype.toString.call(n)===e}}));var S,L=function(){return function(){}},b=function(){return+new Date},x=function(n,t){for(var e=[],i=t||0,o=n.length;i<o;i++)e.push(n[i]);return e},k=function(){var n=[];return{add:function(t){return n.push(t),n},dequeue:function(){return n.length&&n.shift()},clear:function(){return n.length=0},isEmpty:function(){return 0===n.length},each:function(t){return m(n,t)},get:function(){return n}}},T=function(){var n={},t=this,e=function(t,e){n[t]||(n[t]=k()),n[t].add(e)};return{listen:e,one:function(t,i){n[t]&&n[t].clear(),e(t,i)},trigger:function(e){var i=n[e];if(i&&!i.isEmpty()){var o=x(arguments,1);return i.each((function(n,e){try{return e.apply(t,o)}catch(n){alert(n.message)}}))}}}},C=function(){var n,t,e,i,o,a={send:{}},r={},c=function(n){try{delete window[n]}catch(t){window[n]=null}};a.send={get:function(n,t,e,i){void 0===i&&(i="get");var o=n.url,a=n.headers,r=function(){var n,t=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],e=null;if(window.XMLHttpRequest)try{e=new XMLHttpRequest}catch(n){}if(!e)for(var i=0;i<3;i++){var o=t[i];try{e=new ActiveXObject(o)}catch(t){n=t}if(e){t=[o];break}}if(!e)throw new Error("XMLHTTP not available:"+n);return e}();if("get"===i&&(o+=p(n.param)),r.open(i||"get",o,!0),r.onreadystatechange=function(){if(4===r.readyState){if(r.status>=200&&r.status<300||304===r.status||1223===r.status||0===r.status)try{var n=y(r.responseText);n?t.call(window,n):e.call(window,n)}catch(n){throw e.call(window,n),new Error(n)}else e.call(window,r);r=null}},a)for(var c in a)a[c]&&r.setRequestHeader(c,a[c]);"get"==i?r.send(null):"post"==i&&(r.setRequestHeader("Content-Type","application/json; charset=UTF-8"),r.send(JSON.stringify(n.param)))},post:function(n,t,e){a.send.get(n,t,e,"post")},jsonp:function(n,t,e){var i=n.callbackName||"sing_"+b()+(1e4*Math.random()|0),o=d.getElementsByTagName("head")[0],a=d.createElement("script"),r=l({},n.param);r.callback=i,a.src=n.url+s(r),a.setAttribute("nonce","csp-script-inline"),o.appendChild(a),window[i]=function(n){try{t&&t.call(window,n)}catch(n){throw console&&console.error(n),new Error("jsonp request error")}finally{c(i),o.removeChild(a)}}},iframe:(t=b(),e=function(n,t){var e=d.createElement(n);for(var i in t)e[i]=t[i],e.setAttribute(i,t[i]);return e},i=function(n){return n.style.display="none",n},o=function(){var o=d.body;return n||(n=e("iframe",{id:t,name:t}),o.appendChild(i(n)))},function(n,a){o();var r,s="sing_"+b()+(1e4*Math.random()|0),p=l({},n.param);p.callback="top."+s;var u=e("form",{target:t,method:"post",action:n.url});for(var h in d.body.appendChild(i(u)),p)r=e("input",{name:h,value:p[h]}),u.appendChild(r);window[s]=function(n){try{a&&a.call(window,n)}catch(n){throw new Error("iframe request error")}finally{c(s),function(n){for(;n.firstChild;)n.removeChild(n.firstChild);n.parentNode&&n.parentNode.removeChild(n)}(u)}},u.submit()})};var s=function(n){var t=[];for(var e in n)t.push(e+"="+n[e]);return"?"+t.join("&")};return function(){var n,t=function(){};return{start:function(e){var i=this;e=e||{},n=a.send[e.type||"get"];var o,c=e.callback||t,p=function(n){o.clear(),e.error&&e.error(n)};e.timeout&&(o=function(n){var t=function(){},e=setTimeout((function(){t()}),n);return{timeout:function(n){t=n},clear:function(){clearTimeout(e),e=null}}}(e.timeout)).timeout((function(){o.clear(),c=L,p({error:"timeout"}),i.trigger("error","timeout")}));var d=e.url+s(e.param);return t=function(n){o&&o.clear(),e.cache&&(r[d]=n),c.apply(this,x(arguments))},r[d]?t(r[d]):n(e,t,p),!0},done:function(n){return t=n||t,this}}}}(),E=((S=function(n){this.config={},this.param={},this.event=T.call(this),this.data={},this.cache=!1,this.paramCurry=!1,this.reviseParam(n)}).prototype.reviseParam=function(n){this.config=_.isString(n)?{url:n}:l({},n),this.param=this.config.param=this.config.param?l(this.config.param):{},this.name=this.config.name,this.cache=!!this.config.cache},S.prototype.setParam=function(n){this.param=this.config.param=l({},n)},S.prototype.chain=function(){return this.queue=R(),this.queue.chain.apply(this,x(arguments))},S.prototype.start=function(n){var t=this;t.chain(),_.isFunction(this.param)&&(this.param=this.config.param=function(){try{t.param.call(t,n)}catch(n){return{}}}()),C().done((function(n){if(_.isString(n))try{n=y(n)}catch(t){n={},this.trigger("error","json parse error")}t.data=n,!1!==t.event.trigger("done",n)&&t.event.trigger("queueContinue")})).start.call(this,this.config)},S.prototype.error=function(n){var t=this,e=n,i=n;n=function(){!0===i.apply(this,x(arguments))&&(t.data={},!1!==t.event.trigger("done",t.data)&&t.event.trigger("queueContinue")),!0===e.apply(this,x(arguments))&&(t.data={},!1!==t.event.trigger("done",t.data)&&t.event.trigger("queueContinue"))},this.event.listen("error",n)},S.prototype.trigger=function(){var n=x(arguments);this.event.trigger.apply(this,n),n.splice(2,0,this),this.queue.event.trigger.apply(this.queue,n)},m(["beforeSend","done"],(function(n,t){S.prototype[t]=function(n){this.event.listen(t,n)}})),m(["useCache","stopCache"],(function(n,t){S.prototype[t]=function(){this.cache=!n}})),function(n){return new S(n)}),R=function(){var n,t=x(arguments),e=0,i=!1,o=function(t){return n[n.length]=t,n.length+=1,n},a=function(t){if(!((t=t||0)>=n.length))for(var o,r=n[e=t].length,c=r;r--;)(o=n[e][r]).event.one("queueContinue",(function(){if(!0!==i)return 0==--c?a(++e):void 0})),o.before=n[e-1]&&n[e-1][0]||{},o.queue=n,o.start(o.before)},r=function(){return i=!1,a(),n},c=function(){i=!0},s=function(){a(++e)},p=function(){return n[e]},d=function(t){return o(x(arguments)),n},l=function(t){n.event.listen("error",t)},g=function(){var t=e+1,i=n.length,o=u.call(n,(i||t)+1||n.length);return n.length=t<0?n.length+t:t,h.apply(n,o),n};return(n={length:0,start:r,now:p,stop:c,contine:s,chain:d,error:l,cut:g}).event=T.call(n),m(["useCache","stopCache"],(function(t,e){n[e]=function(){m(n,(function(n,t){t[e]()}))}})),t.length&&o(t),n},B="dashi.163.com"===location.hostname,F="/fgw/master-account-web/proxy",N="/fgw/master-account-web";B&&(F="/account/proxy",N="/account");var I={"二维码已失效":"The QR code is invalid","二维码加载失败":"QR code loading failed","请点击刷新":"Refresh","扫描成功，请在手机上确认登录":'Scan successfully, please click "Confirm to login" on your mobile phone',"返回二维码扫描":"Return to QR code scanning page","抱歉，系统维护中，暂时无法提供服务":"Sorry, the system is undergoing maintenance and the service is temporarily unavailable"},q=function(n,t){return"en_US"!==t||void 0===I[n]?n:I[n]};return function(){function a(n){this.includeBox=null,this.options={},this.gOption={},this._currDomain="",this._accountType="",this._malFrom="mail163",this.INTERVAL=2e3,this._timer=null,this._bFirst=!0,this._product="",this._uuid="",this._usage="0",this._language="zh_CN",this._getCodeIdURL=F+"/getqrcodeid",this._getCodeURL=F+"/getUrlQrcode",this._getStatusURL=F+"/ngxqrcodeauthstatus",this._getAuthURL=F+"/qrcodeauth",this._loginURL="https://reg.163.com/services/ticketlogin",this._maLoginUrl="https://dashi.163.com/account/view/ma/login",this._maMailAuthUrl=N+"/ma/mailauth",this._noScanLoginUrl=N+"/ma/freescanlogin/confirm",this._noScanLoginCheckUrl=N+"/ma/freescanlogin/check",this._entryUrl="https://mail.163.com/entry/login.jsp",this._urls={"@163.com":{entryDaShiUrl:"https://dashi.163.com/163entry/cgi/ntesdoor",url2:"https://mail.163.com/errorpage/error163.htm"},"@126.com":{entryDaShiUrl:"https://dashi.163.com/126entry/cgi/ntesdoor",url2:"https://mail.126.com/errorpage/error126.htm"},"@yeah.net":{entryDaShiUrl:"https://dashi.163.com/yeahentry/cgi/ntesdoor",url2:"https://mail.yeah.net/errorpage/err_yeah.htm"},"@vip.163.com":{entryDaShiUrl:"https://dashi.163.com/vip163entry/cgi/ntesdoor",url2:"https://vip.163.com/"},"@vip.126.com":{entryDaShiUrl:"https://dashi.163.com/vip126entry/cgi/ntesdoor",url2:"https://vip.126.com/"},"@188.com":{entryDaShiUrl:"https://dashi.163.com/vip188entry/cgi/ntesdoor",url2:"https://vip.188.com/"}},this._codeSlowTimer=null,this._codeSlowStamp=3e3,this._codeTimeoutTimer=null,this._codeTimerStamp=2e4,this._isCodeImgTimeout=!1,this.currentStyleTag=null,this.noScanLoginShow=!1,this.noScanConfig=null,this.codeStartTime=0;var i,o=n.includeBox,a=n.product,r=n.currDomain,c=void 0===r?"":r,s=n.initReady;this.includeBox=(i=o,("object"==typeof HTMLElement?i instanceof HTMLElement:i&&"object"==typeof i&&(1===i.nodeType||9===i.nodeType)&&"string"==typeof i.nodeName)?o:document.getElementById(o)),this.options=t({},n),this._product=a,this._currDomain=c,n.language&&(this._language=n.language),this._malFrom=n.malFrom;try{var p=function(n){var t=n+"=";if(e.cookie.length>0){var i=e.cookie.indexOf(t);if(-1!==i){i+=t.length;var o=e.cookie.indexOf(";",i);return-1===o&&(o=e.cookie.length),decodeURIComponent(e.cookie.substring(i,o))}return""}}("MASTER_FSL")||"{}",d=JSON.parse(p);d&&d.muid&&(this.noScanLoginShow=!0,this.noScanConfig=d)}catch(n){console.log(n)}this.initStyle(),this.render(),this.init(),this.listen(),s&&s()}return a.prototype.initStyle=function(){if(!this.currentStyleTag){var n=function(n){void 0===n&&(n={});var t=n.codeWidth,e=void 0===t?160:t;return"\n    .w-mc-content {\n        position: relative;\n        width: 284px;\n        margin: 0 auto;\n        font-family: PingFang SC, sans-serif;\n    }\n    \n    .w-mc-codeWrap {\n        text-align: center;\n        margin-bottom: 24px;\n    }\n    \n    .w-mc-scanTips {\n        height: 20px;\n        line-height: 20px;\n        margin-top: 16px;\n        margin-bottom: 22px;\n        font-size: 14px;\n        color: #666666;\n    }\n    \n    .w-mc-scanTips a {\n        text-decoration: none;\n        color: #538ff4;\n    }\n    \n    .appCodeBox-inner {\n        position: relative;\n    }\n    \n    .appCodeBox-inner-show-hover::after {\n        position: absolute;\n        top: 0;\n        left: 50%;\n        width: 128px;\n        height: 152px;\n        margin-left: "+((e+128)/2-128)+'px;\n        content: ".";\n        font-size: 0;\n        line-height: 0;\n        opacity: 0;\n        transition: all .3s;\n        display: none9;\n        background: url(https://mimg.127.net/vip/newindex/img/urs_sprite.png) no-repeat;\n        background-position: 0 -167px;\n    }\n    .appCodeBox-inner-show-hover:hover::after {\n        display: block;\n        opacity: 1;\n    }\n    \n    .w-mc-codeRefresh + .w-mc-scanTips {\n        height: 36px;\n        line-height: 36px;\n        margin: 0;\n    }\n    \n    .w-mc-codeWrap img {\n        border: none;\n    }\n    \n    .w-mc-appCode-wrap {\n        margin: 0 auto;\n        width: '+e+"px;\n        height: "+e+"px;\n    }\n    \n    .w-mc-appCode-wrap img {\n        display: block;\n        width: 100%;\n        transition: all .4s;\n    }\n    \n    .appCodeBox-inner-show-hover:hover .w-mc-codeRefresh, .appCodeBox-inner-show-hover:hover .w-mc-appCode-wrap img {\n        transform: translateX(-"+((e+128)/2-e/2)+"px);\n    }\n    \n    .w-mc-sLoading img {\n        display: none;\n    }\n    \n    .w-mc-loading {\n        position: absolute;\n        width: 80px;\n        height: 80px;\n        left: 50%;\n        top: "+(e-80)/2+"px;\n        margin-left: -40px;\n        background: #F3F3F3;\n        border-radius: 12px;\n    }\n    \n    .w-mc-loading img {\n        display: block;\n        margin: 15px auto;\n        animation: loading-rotate 1s linear infinite;\n        -webkit-animation: loading-rotate 1s linear infinite;\n        -moz-animation: loading-rotate 1s linear infinite;\n        -o-animation: loading-rotate 1s linear infinite;\n    }\n    \n    .w-mc-codeRefresh {\n        position: absolute;\n        top: 0px;\n        left: 50%;\n        margin-left: -"+e/2+"px;\n        width: "+e+"px;\n        height: "+e+"px;\n        transition: all .4s;\n    }\n    \n    .w-mc-codeRefresh-mask {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: #fff;\n        opacity: .85;\n        filter: alpha(opacity=85);\n    }\n    \n    .w-mc-codeRefresh-main {\n        position: relative;\n        display: table;\n        width: 100%;\n        height: 100%;\n        font-style: normal;\n        font-weight: 500;\n        font-size: 14px;\n        line-height: 20px;\n        color: #333333;\n    }\n    \n    .w-mc-codeRefresh-main__inner {\n        display: table-cell;\n        width: 100%;\n        height: 100%;\n        vertical-align: middle;\n        text-align: center;\n    }\n    \n    .w-mc-codeRefresh-main p {\n        margin: 0 auto 12px;\n    }\n    \n    .w-mc-codeRefresh-main a {\n        display: block;\n        width: 100px;\n        height: 36px;\n        text-decoration: none;\n        background-color: #3b78dd;\n        color: #fff;\n        line-height: 36px;\n        margin: 12px auto 0;\n        -webkit-border-radius: 4px;\n        -moz-border-radius: 4px;\n        border-radius: 4px;\n    }\n    \n    .w-mc-appLogin-scanSuc {\n        padding-top: 46px;\n        padding-bottom: 44px;\n        text-align: center;\n    }\n    \n    .w-mc-appLogin-scanSuc-img {\n        margin: 0 auto;\n        width: 72px;\n        height: 72px;\n        background-image: url(https://mimg.127.net/p/freemail/index/lib/img/applogin-scan-suc.png);background-position: 0 0;\n        background-repeat: no-repeat;\n        background-size: 100% 100%;\n    }\n    \n    .w-mc-appLogin-scantxt {\n        margin: 26px 0 10px;\n        line-height: 22px;\n        font-weight: 500;\n        font-size: 16px;\n    }\n    \n    .w-mc-txt-suc {\n        color: #33A853;\n    }\n        \n    .w-mc-appLogin-scanSuc a {\n        line-height: 20px;\n        font-size: 14px;\n        color: #3B78DD;\n        text-decoration: none;\n    }\n    \n    .s-noScan-active .w-mc-codeWrap, .s-noScan-active .w-mc-appLogin-scanSuc {\n        display: none !important;\n    }\n    .s-noScan-active .w-mc-appLogin-noScan{\n        display: block !important;\n    }\n    .w-mc-appLogin-noScan {\n        display: none;\n        margin-top: 40px;\n        text-align: center;\n    }\n    \n    .w-mc-appLogin-noScan-avatar {\n        width: 100px;\n        height: 100px;\n        margin: 0 auto;\n        border-radius: 50px;\n        overflow: hidden;\n    }\n    .w-mc-appLogin-noScan-avatar img {\n        display: block;\n        width: 100%;\n    }\n    \n    .w-mc-appLogin-noScan-nickname {\n        margin: 12px 0;\n        font-weight: 500;\n        font-size: 16px;\n        height: 22px;\n        line-height: 22px;\n        color: #333;\n        overflow: hidden;\n        white-space: nowrap;\n        text-overflow: ellipsis;\n    }\n    \n    .w-mc-appLogin-noScan_waitTips {\n        display: none;\n        margin: 40px auto 0 auto;\n        line-height: 22px;\n        font-size: 14px;\n        color: #878787;\n    }\n    .w-mc-appLogin-noScan-loginBtn {\n        width: 220px;\n        height: 50px;\n        line-height: 50px;\n        margin: 40px auto 0 auto;\n        font-size: 20px;\n        color: #fff;\n        background: #3370FF;\n        border-radius: 4px;\n        cursor: pointer;\n        user-select: none;\n    }\n    \n    .w-mc-appLogin-noScan-wait .w-mc-appLogin-noScan_waitTips {\n        display: block;\n    }\n    \n    .w-mc-appLogin-noScan-wait .w-mc-appLogin-noScan-loginBtn {\n        display: none;\n    }\n    \n    .w-mc-appLogin-noScan-loginBtn:hover {\n        background: #477EFF;\n    }\n    .w-mc-appLogin-noScan-loginBtn:active {\n        background: #2E65E6;\n    }\n    \n    .w-mc-appLogin-noScan-switchBtn {\n        margin-top: 16px;\n        cursor: pointer;\n        font-size: 14px;\n        line-height: 20px;\n        color: #3370FF;\n        user-select: none;\n    }\n    .w-mc-appLogin-noScan-switchBtn:hover {\n        color: #477EFF;\n    }\n    .w-mc-appLogin-noScan-switchBtn:active {\n        color: #2E65E6;\n    }\n    @keyframes loading-rotate {\n        0% {\n            transform: rotate(90deg) skew(0deg) scale(1);\n            -ms-transform: rotate(90deg) skew(0deg) scale(1);\n            /* IE 9 */\n            -moz-transform: rotate(90deg) skew(0deg) scale(1);\n            /* Firefox */\n            -webkit-transform: rotate(90deg) skew(0deg) scale(1);\n            /* Safari ºÍ Chrome */\n            -o-transform: rotate(90deg) skew(0deg) scale(1);\n        }\n    \n        100% {\n            transform: rotate(450deg) skew(0deg) scale(1);\n            -ms-transform: rotate(450deg) skew(0deg) scale(1);\n            /* IE 9 */\n            -moz-transform: rotate(450deg) skew(0deg) scale(1);\n            /* Firefox */\n            -webkit-transform: rotate(450deg) skew(0deg) scale(1);\n            /* Safari ºÍ Chrome */\n            -o-transform: rotate(450deg) skew(0deg) scale(1);\n        }\n    }\n\n    "}({codeWidth:this.options.codeWidth||160}),t=document,e=t.getElementsByTagName("head")[0];if(t.createStyleSheet){t.createStyleSheet().cssText=n}else{var i=t.createElement("style");i.type="text/css",i.innerHTML=n,e.appendChild(i),this.currentStyleTag=i}}},a.prototype.getHtml=function(){var n=this.options.tipsPos,t=p(this.options.utmData||{}),e='<div class="w-mc-scanTips">请打开<a id="appDlLink" href="https://mail.163.com/dashi/dlpro.html'+t+'" rel="noopener norefferrer" target="_blank"> 网易邮箱大师App </a>扫一扫登录</div>';return"en_US"===this._language&&(e='<div class="w-mc-scanTips">Please open "Scan" on your<a id="appDlLink" href="https://mail.163.com/dashi/dlpro.html'+t+'" rel="noopener norefferrer" target="_blank"> MailMaster </a>to log in</div>'),"boolean"==typeof n||n||(n="top"),'\n            <div class="w-mc-content">\n                \x3c!-- 二维码扫描界面 --\x3e\n                <div id="appLoginWait" class="w-mc-codeWrap">\n                    <div class="appLoginWaitInner">\n                        <div id="appCodeWrap">\n                            <div id="appCodeBox">\n                                '+("top"===n?e:"")+'\n                                <div class="appCodeBox-inner '+(this.options.hoverGuide?"appCodeBox-inner-show-hover":"")+'">\n                                    <div class="w-mc-appCode-wrap w-mc-sLoading" id="appCodeMain">\n                                        <img id="appCode" />\n                                    </div>\n                                    <div class="w-mc-loading" id="appCodeLoadingWrap">\n                                        <img id="appCodeLoading" width="50" height="50" src="https://mimg.127.net/p/freemail/index/lib/img/loading@2x.png" />\n                                    </div>\n                                    <div id="appCodeRefresh" class="w-mc-codeRefresh" style="display: none;">\n                                        <div class="w-mc-codeRefresh-mask"></div>\n                                        <div class="w-mc-codeRefresh-main">\n                                            <div class="w-mc-codeRefresh-main__inner">\n                                                <p id="appLoginTxt">'+q("二维码已失效",this._language)+'</p>\n                                                <a href="javascript:void(0)">'+q("请点击刷新",this._language)+"</a>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                "+("bottom"===n?e:"")+'\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                \x3c!-- 扫码确认界面 --\x3e\n                <div id="appLoginScan" class="w-mc-appLogin-scanSuc">\n                    <div class="w-mc-appLogin-scanSuc-img" id="appLoginScanSuc"></div>\n                    <p class="w-mc-appLogin-scantxt w-mc-txt-suc">'+q("扫描成功，请在手机上确认登录",this._language)+'</p>\n                    <a id="appLoginRestart" href="javascript:void(0)">'+q("返回二维码扫描",this._language)+'</a>\n                </div>\n                \x3c!-- 免扫界面 --\x3e\n                <div id="noScanWrap" class="w-mc-appLogin-noScan">\n                    <div class="w-mc-appLogin-noScan_main">\n                        <div class="w-mc-appLogin-noScan-avatar" id="noScanAvatar"></div>\n                        <div class="w-mc-appLogin-noScan-nickname" id="noScanNickname"></div>\n                        <div class="w-mc-appLogin-noScan-operation">\n                            <div class="w-mc-appLogin-noScan_waitTips">请在邮箱大师App上点击确认登录</div>\n                            <div class="w-mc-appLogin-noScan-loginBtn" id="scanConfirmBtn">立即登录</div>\n                            <div class="w-mc-appLogin-noScan-switchBtn" id="scanReScanBtn">重新扫码</div>\n                        </div>\n                    </div>\n                </div>\n\n                <form id="appLoginForm" method="post" action="" autocomplete="off" target="_self"></form>\n                <form id="maLoginForm" method="post" action="" autocomplete="off" target="_self"></form>\n            </div>\n        '},a.prototype.confirmNoScan=function(){var n=this,t={product:this._product,type:0,usage:this._usage,malfrom:this._malFrom},e={type:"get",url:this._noScanLoginUrl,param:t,callback:function(t){n.getCode(t,"noScan")},error:function(){n.showError({key:"b_appLogin_confirmNoScan_api_fail"})}};E(e).start()},a.prototype.getCodeId=function(){var n=this,t={product:this._product,usage:this._usage},e="";this.options.mailStats&&this.options.mailStats.deviceId&&(e=this.options.mailStats.deviceId);var i={type:"get",url:this._getCodeIdURL,param:t,timeout:5e3,headers:{deviceId:e},callback:function(t){n.getCode(t,"getCodeId")},error:function(t){var e="b_appLogin_qrcodeid_load_fail";t&&"timeout"===t.error&&(e="b_appLogin_qrcodeid_load_timeout"),n.showError({text:q("二维码加载失败",n._language),key:e})}};E(i).start()},a.prototype.getCode=function(n,t){if(!n)return this.showError({key:"b_appLogin_qrcodeid_load_fail",type:t}),clearTimeout(this._codeSlowTimer),clearTimeout(this._codeTimeoutTimer),!1;if(200===n.code){var e=i("noScanWrap"),o=n.result;if(this._uuid=o.l.i,this.noScanLoginShow)c(e,"w-mc-appLogin-noScan-wait","add"),this.statistics("b_noscan_confirm_pane_show",{},"show");else{var a=this._getCodeURL+"?uuid="+this._uuid+"&product="+this._product+"&size=340&malfrom="+this._malFrom+"&blackRgb=000";this.options.showLogo&&(a+="&showLogo="+!0),i("appCode").src=a,c(e,"w-mc-appLogin-noScan-wait","remove"),this.statistics("b_mailmasterLoginQrcode_show",{},"show"),this.watchCodeLoad()}"noScan"===t&&this.getStatus(this._uuid)}else this.noScanLoginShow?(this.noScanLoginShow=!1,this.refresh()):this.showError({key:"b_mailmasterLogin_get_code_error",type:t,code:n.code,text:q("二维码加载失败",this._language)})},a.prototype.getStatus=function(n){var t=this,e=this,i=this.options.onScanSuc,o={uuid:this._uuid,product:this._product},a={type:"get",url:this._getStatusURL,param:o,callback:function(o){var a=o.result||{},r=a.qrcodeStatus,c=a.accountType;t.handleStatus(n,r.toString(),(function(){if(e._accountType=c,1===c){var n={uuid:e._uuid,product:e._product},o={type:"get",url:e._getAuthURL,headers:{deviceId:t.options.deviceId||""},param:n,callback:function(n){t.getAuth(n)},error:function(){t.showError({key:"b_appLogin_getAuth_api_fail"})}};E(o).start()}else 2===c&&(e.statistics("b_mailmasterLoginDashi_success",{},"show"),i&&i(),setTimeout((function(){e.submitMaLogin()}),500))}))},error:function(){t.showError({key:"b_appLogin_getStatus_api_fail"})}};E(a).start()},a.prototype.handleStatus=function(n,t,e){var o=this,a=o.options.onScan;if(o._uuid&&n===o._uuid)switch(t){case"200":e();break;case"404":if(this.noScanLoginShow)return this.noScanLoginShow=!1,this.refresh(),!1;var r=i("appLoginWait"),c=i("appLoginScan");"none"===r.style.display&&(r.style.display="block",c.style.display="none"),this.showError({key:"b_mailmasterLoginTimeout_show"});break;case"408":o.startPoll((function(){o.getStatus.call(o,n)}));break;case"409":o._bFirst&&(o._bFirst=!1,o.INTERVAL=1e3,i("appLoginWait").style.display="none",i("appLoginScan").style.display="block",o.statistics("b_mailmasterLoginWaitPanel_show",{},"show"),a&&a()),o.startPoll((function(){o.getStatus.call(o,n)}));break;default:o.showError({key:"b_mailmasterLogin_check_status_error",code:t})}},a.prototype.getAuth=function(n){void 0===n&&(n={});var t=n||{},e=t.code,i=t.result,o=this,a=i.retCode||"";i.scan;200===e?o.handleStatus(this._uuid,a.toString(),(function(){o.statistics("b_mailmasterLogin_success",{},"show"),o.submitLogin(i)})):(o.init(),o.showError({key:"b_mailmasterLogin_check_auth_error",code:e}))},a.prototype.submitMaLogin=function(){var n=['<input type="hidden" name="product" value="'+this._product+'">','<input type="hidden" name="uuid" value="'+this._uuid+'">'].join("");this.options.url2?n+='<input type="hidden" name="url2" value="'+this.options.url2+'">':n+='<input type="hidden" name="url2" value="'+("https://dashi.163.com/projects/scanerror/?url2="+encodeURIComponent(window.location.href))+'">';this.options.mailStats&&(this.options.mailStats.commonData.sdid&&(n+='<input type="hidden" name="sdid" value="'+this.options.mailStats.commonData.sdid+'">'),this.options.mailStats.deviceId&&(n+='<input type="hidden" name="deviceId" value="'+this.options.mailStats.deviceId+'">')),document.getElementById("maLoginForm").innerHTML=n,document.getElementById("maLoginForm").action=this._maLoginUrl,document.getElementById("maLoginForm").submit()},a.prototype.submitLogin=function(n){var t=this.options.onScanSuc,e="mailmaster_mail_",i=this._entryUrl,o="",a="",r="";this.options.mailStats&&(this.options.mailStats.deviceId&&(a=this.options.mailStats.deviceId),this.options.mailStats.commonData.sdid&&(r=this.options.mailStats.commonData.sdid)),this._currDomain=n.domain,n.domain?(o=this._urls[n.domain].url2,2===this._accountType&&(i=this._urls[n.domain].entryDaShiUrl,e="mailmaster_web_")):o="https://mail.163.com/errorpage/error163.htm";var c=s("df",e+(this.options.df||this._product),!0)+s("uuid",this._uuid)+s("style",13)+s("allssl",!0)+s("from","web")+s("t",(new Date).getTime());a&&(c+=s("deviceId",a)),r&&(c+=s("sdid",r));var p="";switch(n.domain){case"@126.com":p="126.com";break;case"@vip.126.com":p=".vip.126.com";break;case"@vip.163.com":p=".vip.163.com";break;case"@188.com":p=".188.com";break;case"@yeah.net":p="yeah.net";break;default:p=""}var d=['<input type="hidden" name="product" value="'+this._product+'">','<input type="hidden" name="domains" value="'+p+'" />','<input type="hidden" name="noRedirect" value="1">','<input type="hidden" name="url" value="'+i+c+'" />','<input type="hidden" name="url2" value="'+o+'" />','<input type="hidden" name="ticket" value="'+n.ticket+'">'].join("");document.getElementById("appLoginForm").innerHTML=d,document.getElementById("appLoginForm").action=this._loginURL,t&&t(),setTimeout((function(){document.getElementById("appLoginForm").submit()}),500)},a.prototype.startPoll=function(n){this.clearPoll(),this._timer=setTimeout((function(){n&&n()}),this.INTERVAL)},a.prototype.clearPoll=function(){clearTimeout(this._timer)},a.prototype.showError=function(n){var t=n.code,e=n.text,o=n.key,a=n.type,r=q("二维码已失效",this._language),c=i("appLoginTxt"),s=i("appCodeRefresh"),p={};i("appCodeLoadingWrap").style.display="none",c.innerHTML=e||r,t&&(p.errorCode=t),a&&(p.type=a),o&&this.statistics(o,p,"show"),s.style.display="block"},a.prototype.init=function(){this._bFirst=!0,this.INTERVAL=2e3,this._uuid="",this._accountType="",this._currDomain="",this.clearPoll(),i("appLoginWait").style.display="block",i("appLoginScan").style.display="none",i("appCodeLoadingWrap").style.display="block",c(i("appCodeMain"),"w-mc-sLoading","add"),this.noScanLoginShow?this.checkNoScanStatus():(this.codeStartTime=Date.now(),this.options.onModeChange&&this.options.onModeChange("scan"),this.getCodeId())},a.prototype.watchCodeLoad=function(){var n=this;clearTimeout(this._codeSlowTimer),this._codeSlowTimer=setTimeout((function(){n.statistics("b_appLogin_qrcode_slow")}),this._codeSlowStamp),clearTimeout(this._codeTimeoutTimer),this._codeTimeoutTimer=setTimeout((function(){n._isCodeImgTimeout=!0,n.showError({text:q("二维码加载失败",n._language),key:"b_appLogin_qrcodeimg_timeout"})}),this._codeTimerStamp)},a.prototype.listen=function(){var n=this,t=i("appLoginRestart"),e=i("appDlLink"),o=i("appCodeRefresh"),a=i("scanConfirmBtn"),s=i("scanReScanBtn"),p=i("noScanWrap"),d=document.querySelector(".w-mc-content");r(t,"click",(function(){n.statistics("b_appLogin_goBack_qrcode_click"),n.refresh()}),!1),e&&r(e,"click",(function(){n.statistics("b_appLogin_mailmaster_download_click",n.options.utmData||{})}),!1),r(o,"click",(function(){n.statistics("b_appLogin_refresh_qrcode_click"),o.style.display="none",n.refresh()}),!1),i("appCode").onload=function(){if(n._isCodeImgTimeout)return!1;n.getStatus(n._uuid),i("appCodeLoadingWrap").style.display="none",c(i("appCodeMain"),"w-mc-sLoading","remove"),clearTimeout(n._codeSlowTimer),clearTimeout(n._codeTimeoutTimer),n.statistics("b_appLogin_qrcodeimg_load_success",{loadingTime:Date.now()-n.codeStartTime},"show")},i("appCode").onerror=function(){clearTimeout(n._codeSlowTimer),clearTimeout(n._codeTimeoutTimer),n.showError({text:q("二维码加载失败",n._language),key:"b_appLogin_qrcodeimg_load_fail"})},r(a,"click",(function(){n.confirmNoScan(),n.statistics("b_noscan_confirm_btn_click",{},"click")}),!1),r(s,"click",(function(){var t,e=(t="w-mc-appLogin-noScan-wait",!!p.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)")));c(d,"s-noScan-active","remove"),n.noScanLoginShow=!1,n.refresh(),e?n.statistics("b_noscan_confirm_pane_rescan_btn_click",{},"click"):n.statistics("b_noscan_rescan_btn_click",{},"click")}),!1)},a.prototype.statistics=function(n,e,i){void 0===e&&(e={}),void 0===i&&(i="click");var o=this.options,a=o.username,r=o.mailStats,c=o.origin,s=void 0===c?"normal":c,p=o.malFrom,d=void 0===p?"":p,l=a&&""!=a?-1===a.indexOf("@")?a+"@"+this._currDomain:a:"";if(r)switch(i){case"show":r.show(n,t({uid:l,malFrom:d,domain:this._currDomain,origin:s},e));break;default:r.click(n,t({uid:l,malFrom:d,domain:this._currDomain,origin:s},e))}},a.prototype.refresh=function(){var n=i("appCodeRefresh"),t=document.querySelector(".w-mc-content");if(this._isCodeImgTimeout=!1,this.noScanLoginShow)return!1;n.style.display="none",c(t,"s-noScan-active","remove"),c(this.includeBox,"no-scan-codebox","remove"),this.noScanConfig=null,this.noScanLoginShow=!1,this.clearPoll(),this.init()},a.prototype.render=function(){this.includeBox&&(this.includeBox.innerHTML=this.getHtml())},a.prototype.checkNoScanStatus=function(){var n=this,t={type:"get",url:this._noScanLoginCheckUrl,param:{},callback:function(t){t&&200===t.code?(n.showNoScanPane(),n.options.onModeChange&&n.options.onModeChange("noScan"),c(n.includeBox,"no-scan-codebox","add")):(n.noScanLoginShow=!1,n.refresh())},error:function(){n.noScanLoginShow=!1,n.showError({key:"b_appLogin_checkNoScanStatus_fail"})}};E(t).start()},a.prototype.showNoScanPane=function(){var t=document.querySelector(".w-mc-content"),e=i("noScanAvatar"),o=i("noScanNickname");c(t,"s-noScan-active","add");var a=document.createElement("img");a.src=this.noScanConfig.mava||"https://onegoods.nosdn.127.net/resupload/2021/11/4/3712055530d6d91405b57ca222182bbd.png",e.appendChild(a),o.innerHTML=this.noScanConfig.mnkn?function(t){n||(n=document.createElement("DIV"));var e=n.cloneNode(!1),i=document.createTextNode(t);return e.appendChild(i),e.innerHTML}(this.noScanConfig.mnkn):"",this.statistics("b_noscan_pane_show",{},"show")},a.prototype.destroy=function(){var n=this.includeBox||document.body,t=document.getElementsByTagName("head")[0],e=o(".w-mc-content");this.clearPoll(),e.length&&(e=e[0],n.removeChild(e)),this.currentStyleTag&&t.removeChild(this.currentStyleTag)},a}()}));
