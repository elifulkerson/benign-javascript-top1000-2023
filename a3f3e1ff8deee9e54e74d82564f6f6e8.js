!function(){"use strict";var f,h,a,e,l,m,y,r,d,c,g,u,v,C,_,b,p,w,S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e,t){return f.seed instanceof o?f.seed.init(e,t):this instanceof o?this.init(e,t):f.seed=new o(e,t),f.seed}function n(){return Math.floor(1+65535*Math.random()).toString(16).substring(1)}function L(e,t){var o;this.appnm=e,this.sendQueue={},this.msid=(e=[],o=new Date,e.push(o.toString(16)),e.push(n()),e.push(n()),e.push(n()),e.join("-")),this.lxcuid=Date.now()+Math.ceil(1e3*Math.random()),this.seq=0,this.reqid=(new Date).toString(16)+"-"+Math.floor(65535*Math.random())+"-"+Math.floor(65535*Math.random())}function T(e,t){this.batchs=[],this.mtsiProject="com.sankuai.yoda.spiderindefence.mtsi",this.project="Yoda-FE",this.catVersion=1,this.catSdk="1.9.5",this.origin=f.location.href,this.unionId=e||"";var e=-1===["staging","test","dev"].indexOf(t)?"prod":"dev",o=(this.host={prod:"//catfront.dianping.com",dev:"//catfront.51ping.com"}[e],this);setTimeout(function(){o.sendBatch()},500)}function x(i,e,t,o){if(null!==e&&"object"===(void 0===e?"undefined":S(e))){var n,s=[];for(n in e)s.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));e=s.join("&")}var a={"Content-Type":"application/x-www-form-urlencoded"},r=Date.now();o&&(a["Content-Type"]=o);try{var d,c=function(e,t){var o,n=-1!==i.indexOf("//catfront")?"raptor":"page_data";w<1&&(o="raptor"==n?"info":"error",f.Yoda.CAT.sendLog(i,"ajaxError",n+e,t.status+" | "+t.readyState+" | "+(Date.now()-r),o)),w++,-1!==i.indexOf("page_data")&&f.seed.handleError(e)},u=new f.XMLHttpRequest;if("withCredentials"in u){if(u.open("post",i,!0),a)for(var p in a)a.hasOwnProperty(p)&&u.setRequestHeader(p,a[p]);u.timeout=5e3,u.onload=function(){4===u.readyState&&(200<=u.status&&u.status<300||304===u.status)&&(t(u.responseText),u=null)}}else void 0!==f.XDomainRequest?(u=new f.XDomainRequest,d=0<i.indexOf("?")?"&"+e:"?"+e,u.open("get",i+d),u.timeout=5e3,u.onload=function(){t(u.responseText),u=null}):f.Yoda.CAT.sendLog(i,"jsError","种子代码创建XHR失败","xhr error","error");u.ontimeout=function(){c("请求超时",u),u.abort()},u.onerror=function(){c("请求错误",u),u.abort()},u.send(e)}catch(e){throw f.Yoda.CAT.postBatch(i,0,0,Date.now()-r,"500|0","ajax"),f.Yoda.CAT.sendBatch(),f.Yoda.CAT.sendLog(i,"ajaxError","种子代码请求异常",e.stack,"error"),new Error("请求服务器发生异常: "+e.message)}}function N(e,t){for(var o in t)t.hasOwnProperty(o)&&t[o]&&(e[o]=t[o]);return e}(f=window).Yoda||f.YodaSeed||(h=document,e=f.navigator.userAgent.toString(),a=/mobile|iPhone|Android|htc|Lenovo|huawei/i.test(e),f.Yoda={},f.YODA_CONFIG={},m={pro:l="https://verify.meituan.com",staging:"//verify.inf.st.meituan.com",test:e="//verify.inf.test.meituan.com",development:e},y="https://s3plus.meituan.net/static-prod01/com.sankuai.secfe.yoda-files/",p=b=_=C=v=u=g=c=d=r="",o.prototype.init=function(e,t){r=Date.now(),d=!1,p=b=_=C=v=u=g="",this.env=t||"pro",this.loadingSource=null;var o=new T(e.requestCode,this.env),o=(f.Yoda.CAT=o,new L("yoda_seed",this.env));f.Yoda.LX=o;e&&e.requestCode&&e.root||f.Yoda.CAT.sendLog(location.href,"jsError","初始化参数不合法",e,"error");var o=document.getElementById(e.root),n=(o||f.Yoda.CAT.sendLog(location.href,"jsError","获取root节点失败",o,"info"),this.options=e,this.options.env=t,a=void 0===e.isMobile?a:e.isMobile,this.feVersion="1.6.0",this.source=a?3:1,this.options.requestCode),i=f.KNB,s=this;i&&i.env&&i.env.isTitans?i.ready(function(){i.use("yoda.yodaInfo",{success:function(e){var t=e.version,e=e.source;s.getConf(n,t,e)},fail:function(){s.getConf(n)}}),e.webviewNav&&i.setNavButtons({position:"LL",icon:"H5_Back",handle:function(){f.seed.handleError({message:"退出验证",code:"200123"})}})}):s.getConf(n)},o.prototype.getConf=function(e,t,o){var n=m[this.env]||m.pro,i=n+"/v2/ext_api/page_data",n={requestCode:e,feVersion:this.feVersion,source:this.source,layer:-1!==n.indexOf(f.location.hostname)?1:2},s=(t&&(n.yodaAppVersion=t),o&&(n.yodaAppSource=o),this),a=Date.now();f.Yoda.LX.report("c_techportal_verify","b_techportal_pagedata_mv",{custom:{requestCode:e}}),x(i,n,function(e){e=JSON.parse(e);var t=Date.now()-a,o={kvs:{pagedata:[t],TTFB:[t]},tags:{action:e.data?e.data.action:"",type:e.data?e.data.type:"",result:e.status||""},ts:Date.now()};f.Yoda.CAT.metric(o),f.Yoda.CAT.postBatch(i,0,0,t,"200|"+e.status,"ajax"),s.confBack(e)})},o.prototype.confBack=function(e){var t,o,n,i;1===e.status&&e.data?(f.Yoda.CAT.setProject(e.data.action||""),this.options.requestCode=e.data.request_code,this.config=N(e.data,this.options),this.config.category=this.config.isHideSwitch?"MULTIPLE":this.config.category,this._yoda_config||(this._yoda_config=JSON.stringify(this.config),this._yoda_options=JSON.stringify(this.options),this._yoda_listIndex=e.data.defaultIndex||0,this._yoda_riskLevel=this.config.riskLevel),t=e.data.yodaVersion,o=e.data.verifyMethodVersion,(n=this.config.category)&&"GROUP"===n.toLocaleUpperCase()&&!f.YODA_Bridge&&f.sessionStorage.setItem("_yoda_category_","group"),this.filterRiskLevel(function(){this.checkRiskLevel(u,this.config.requestCode,this.config.env,function(){this.ensureVersion(t,o)}.bind(this))}.bind(this))):(n="端信息："+this.source+" \n 返回信息："+JSON.stringify(e),i=e.error&&e.error.message||n,f.Yoda.CAT.sendLog(m[this.env]+"/v2/ext_api/page_data","ajaxError",i,n,"info"),this.handleError(e.error||"pagedata请求错误"))},o.prototype.ensureVersion=function(t,e){t=JSON.parse(t),e=JSON.parse(e),t&&(p=a?t.i:t.d);try{var o=JSON.parse(this.config.riskLevelInfo)[Number(u)];g=JSON.parse(o).name,(e=JSON.parse(e[g]))&&(b=a?e.i:e.d),this.getSourcePath(),this.loadSource()}catch(e){t="端信息："+this.source+" \n 解析内容："+this.config.riskLevelInfo+" \n 错误信息："+e.stack;f.Yoda.CAT.sendLog(m[this.env]+"/v2/ext_api/page_data","ajaxError",e.message,t,"error"),this.handleError("验证中心初始化失败")}},o.prototype.isNeedLoad=function(){},o.prototype.loadSource=function(){var u=this,p={css:e("link"),js:e("script")};function e(c){return function(o,n,i){var s="script"===c&&n===g;if(s&&u.loadingSource===g)f.Yoda.CAT.sendLog(location.href,"resourceError",o,"阻止请求锁生效","info");else{s&&(u.loadingSource=n);var a=Date.now(),r=h.createElement(c),e=h.head,t="src",d="link"===c?"css":"js";switch(r.onload=function(){r.onload=r.onerror=r.onreadystatechange=null,r=null,s&&(u.loadingSource=null);var e=Date.now()-a;f.Yoda.CAT.postBatch(o,0,0,e,"200|1",d),f.YODA_CONFIG.__API_URL__=m[u.env]||l,"function"==typeof i&&i()},r.onerror=function(e){if(s&&(u.loadingSource=null),-1!==r.src.indexOf(y))return t=r.src.replace(y,"https://s3.meituan.net/static-prod01/com.sankuai.secfe.yoda-files/"),void p.js(t,n,i);var t=e&&e.stack||"";f.Yoda.CAT.sendLog(location.href,"resourceError",o,t,"error"),"yoda"!==n?(u.handleError("静态资源加载失败"),e=Date.now()-a,f.Yoda.CAT.postBatch(o,0,0,e,"500|0",d)):(console.error("加载资源["+o+"]失败"),i())},c){case"script":r.type="text/javascript",r.async=!1,r.defer=!0;break;case"link":r.type="text/css",r.rel="stylesheet",t="href"}r[t]=o,e.appendChild(r)}}}var t,o,n={custom:{requestCode:this.options.requestCode,method:"yoda"}},i=(f.Yoda&&void 0===f.Yoda.Ballade&&p.js(C,"yoda",function(){f.Yoda.LX.report("c_techportal_verify","b_techportal_yoda_req_mc",n),c=!c,u.moduleInit()}),new f.XMLHttpRequest),s=b.substring(0,b.length-1),a=f.seed[g],s=a&&a.initModule&&a.initModule.config&&a.initModule.config.verifyMethodVersion&&-1===a.initModule.config.verifyMethodVersion.indexOf(s);"withCredentials"in i&&(void 0===a||s)?(t={custom:{requestCode:this.options.requestCode,method:g}},p.js(v,g,function(){f.Yoda.LX.report("c_techportal_verify","b_techportal_module_mv",t),d=!0,u.moduleInit()})):"undefined"==typeof XDomainRequest||void 0!==a&&!s||(o=f.setInterval(function(){void 0!==f.Yoda.Ballade&&p.js(v,g,function(){d=!0,u.moduleInit(),f.clearInterval(o)})},1e3)),"object"===S(f.seed[g])&&!1===s&&(d=!0,u.moduleInit()),_&&p.css(_)},o.prototype.moduleInit=function(){if(d&&c){if(this[g]={},this.config.yodaInitTime=r,d=!1,"function"==typeof f.Yoda[g])return this[g].initModule=new f.Yoda[g](this.config),f.Yoda.LX.report("c_techportal_verify","b_techportal_moduleInit_mv",{custom:{requestCode:this.options.requestCode,method:g}}),!1;var e=h.createElement("script");e.type="text/javascript",e.appendChild(h.createTextNode(this.moduleText)),h.body.appendChild(e),this[g].initModule=new f.Yoda[g](this.config)}},o.prototype.getSourcePath=function(){var e,t=a?"i":"d";p=p?p+".":"",b=b?b+".":"","development"===this.env?(v="/modules/"+g+"/"+(e="i"==t?"mobile":"desktop")+"/"+g+".js",_="/modules/"+g+"/"+e+"/"+g+".css",C="./yoda-"+e+".js"):(C=y+t+"/js/yoda."+p+"js",v=y+t+"/js/"+g+"."+b+"js")},o.prototype.handleError=function(e){var t,o=f.seed||this,s=e.message||e,a=e.code||"121333",n=o.options.failCallbackFun,r=o.options.requestCode,i={status:0,code:a,msg:s,requestCode:r},e=(n&&"function"==typeof f[n]&&setTimeout(function(){f[n](i)},1e3),o.options.succCallbackKNBFun),d=(f.KNB&&e&&(t=i,"1"===o.options.YodaKNB&&(t=JSON.stringify({action:e,data:i})),f.KNB.publish({type:"native",action:e,data:t,success:function(){},fail:function(){}})),o.options.failCallbackUrl);d&&setTimeout(function(){(i=document.createElement("a")).href=d;var e=i.origin||i.protocol+"//"+i.host,t=i.pathname,o=i.search,n=i.hash,i=null,i="code="+a+"&msg="+s+"&requestCode="+r;o?o+="&"+i:o="?"+i,f.location.replace(e+t+o+n)},1e3),this.notifyErr(s)},o.prototype.notifyErr=function(e){var t,o=h.getElementById(this.options.root),n=null,i="z-index: 99999;font-size: 16px;position: absolute;width: 78%;top: 18%;left: 50%;line-height: 2em;transform: translateX(-50%); border-radius: 0.5em;background: #000000;opacity: 0.7;color: #FFFFFF;text-align: center;";a?(n=h.createElement("div"),(t=h.createElement("div")).textContent=e,n.setAttribute("style",i),n.appendChild(t)):((n=h.createElement("div")).textContent=e,n.setAttribute("style",i)),setTimeout(function(){n&&(n.style.display="none")},3e3),o.appendChild(n)},o.prototype.handleSuccess=function(e,t){var o,n,i,s,a,r=f.seed||this,d=r.options.succCallbackFun,c={status:1,requestCode:e,responseCode:t},u=(d&&"function"==typeof f[d]&&setTimeout(function(){f[d](c)},1e3),r.options.succCallbackKNBFun),p=f.KNB,r=(p&&p.env&&p.env.isTitans&&u&&(o=function(e){"close"===e&&p.closePage({})},p.publish({type:"native",action:u,data:c,success:function(){},fail:function(){}}),p.setResult({resultCode:p.setResult.RESULT_OK,resultData:JSON.stringify(c),success:function(){f.Yoda.CAT.sendLog(location.href,"jsError","knb setResult success",c,"info"),o(u)},fail:function(){f.Yoda.CAT.sendLog(location.href,"jsError","knb setResult fail",c,"error"),o(u)}})),r.options.succCallbackUrl);r&&((a=document.createElement("a")).href=r,r=a.origin||a.protocol+"//"+a.host,n=a.pathname,i=a.search,s=a.hash,a=null,a="requestCode="+e+"&responseCode="+t,a+="&request_code="+e+"&response_code="+t,i?i+="&"+a:i="?"+a,f.location.replace(r+n+i+s))},o.prototype.resetVariable=function(e){r=Date.now(),d=e.moduleLoaded||!1,g=e.MODULE_NAME||"",v=e.MODULE_URL||"",C=e.YODA_URL||"",_=e.CSS_URL||"",b=e.MODULE_VERSION||"",p=e.YODA_VERSION||""},o.prototype.filterRiskLevel=function(e){var c=f.seed||this,t=c.config.riskLevel,o=t.split(/[,|]/g);return o[0]&&1===o.length?(u=t,void e()):(o=c.options&&c.options.listIndex&&c.options.listIndex.toString()||!1,t=c.options&&c.options.next||!1,o&&t?(u=t,c._yoda_listIndex=o,void e()):void this.isKnbEnv(function(e,t,o){e=e[t].split(",");u=e[0],c._yoda_listIndex=t,o()},function(e,t,o){for(var n=JSON.parse(c.config.riskLevelInfo),i=JSON.parse(c.config.verifyMethodVersion);t<e.length;t++){for(var s=e[t].split(","),a=0,r=1;a<s.length;a++){var d=JSON.parse(n[Number(s[a])]);if(!d.name||!i[d.name]){r=0;break}}if(r){u=s[0],c._yoda_listIndex=t;break}}o()},e))},o.prototype.isKnbEnv=function(e,t,o){var n=f.seed||this,i=n.config.riskLevel.split("|"),s=n._yoda_listIndex||0,a=f.KNB;a?a.ready(function(){(a.env&&(a.env.isTitans||a.env.isDPApp)?e:t)(i,s,o)}):t(i,s,o)},o.prototype.checkRiskLevel=function(n,i,s,e){var a=f.seed||this,r=a._yoda_listIndex,t=a.options.succCallbackKNBFun,o=-1<[106,108,109,122].indexOf(Number(n)),d=a.options.YodaKNB,c=a.options.YodaWeb,u=f.KNB,p=f.YODA_Bridge;if(o&&(p||"1"===c||"1"===d))return c=JSON.stringify({action:t,data:o?{status:2,requestCode:i,listIndex:r,next:n}:{status:0,code:"101103",msg:"验证方式不支持"}}),"1"===d?u.publish({type:"native",action:t,data:c}):p.publish(c),!1;if(u&&o&&u.env&&(u.env.isTitans||u.env.isDPApp)){var h="yoda",l="YODA_CALLBACK_ACTION";switch(s){case"staging":s=2;break;case"dev":s=3;break;case"test":case"development":s=5;break;default:s=1}return u.subscribe({action:l,handle:function(e){var t;0===e.code?(f.Yoda.CAT.sendLog(location.href,"jsError","knb subscribe handle success",e,"info"),a.handleSuccess(e.requestCode,e.responseCode)):(t=JSON.stringify(e),f.Yoda.CAT.sendLog("www.meituan.com/verify","jsError","KNB.subscribe handle",t,"info"),a.handleError({code:e.errorCode,message:e.message}))},success:function(){},fail:function(e){e="错误信息："+JSON.stringify(e);f.Yoda.CAT.sendLog("www.meituan.com/verify","jsError","KNB.subscribe fail",e,"info")}}),u.getUA({success:function(e){"ios"!==e.osName||"meituan"!==e.appName&&"dianping"!==e.appName||(h="imeituan"),"ios"===e.osName&&0<e.appName.indexOf("waimai")&&(h="meituanwaimai");var e=(e=a.options.yodaCommonThemeColor)&&"&yodaCommonThemeColor="+encodeURIComponent(e),t=(t=a.options.yodaButtonTextColor)&&"&yodaButtonTextColor="+encodeURIComponent(t),o=h+"://www.meituan.com/verify?requestCode="+i+"&action="+l+"&env="+s+"&listIndex="+r+"&next="+n+"&isFullScreen=1&_knbopeninapp=1&openInApp=1"+e+t;f.Yoda.CAT.postBatch(h+"://www.meituan.com/verify",0,0,10,"200|1","js"),u.openPage({url:o,success:function(){f.Yoda.CAT.sendLog(h+"://www.meituan.com/verify","ajaxError","h5不支持的验证",o,"info")},fail:function(e){e="错误信息："+JSON.stringify(e);f.Yoda.CAT.sendLog(o,"jsError","KNB.openPage fail",e,"info")}})},fail:function(e){e="错误信息："+JSON.stringify(e);f.Yoda.CAT.sendLog("www.meituan.com/verify","jsError","KNB.getUA fail",e,"info")}}),!1}f.Yoda.CAT.sendLog(f.location.href,"jsError","not is native env",JSON.stringify({moduleId:n,requestCode:i,env:s}),"info"),e()},L.prototype.report=function(e,t,o){var n={appnm:this.appnm,channel:"techportal",ct:a?"i":"www",ch:"web",sc:f.screen.width+"*"+f.screen.height,sdk_env:"online",lxcuid:this.lxcuid,msid:this.msid,ua:navigator.userAgent},e={nm:"MV",tm:Date.now(),nt:5,isauto:6,val_cid:e,val_bid:t,val_lab:o,req_id:this.reqid,seq:this.seq++};this.addToSendQueue(n,e)},L.prototype.addToSendQueue=function(e,t){var o,n=this.sendQueue[e.channel],i=(n?o=n.data:this.sendQueue[e.channel]={conf:e,data:o=[]},o.push(t),this);setTimeout(function(){i.send()},0)},L.prototype.send=function(){var e,t,o,n,i,s=[];for(e in this.sendQueue)this.sendQueue.hasOwnProperty(e)&&(t=e,o=this.sendQueue[e],n=void 0,(n=N(n=o.conf,{appnm:n.appnm,category:"data_sdk_"+t,evs:o.data}))&&s.push(n));0<s.length&&(i="https://report.meituan.com/?_lxskd_rnd="+Date.now()+Math.ceil(1e3*Math.random()),this.sendStatic(i,{data:s})),this.sendQueue={}},L.prototype.sendStatic=function(t,e){if(0===e.data.length)return!1;try{var o=new f.XMLHttpRequest;"withCredentials"in o?o.open("POST",t,!0):void 0!==f.XDomainRequest?(o=new f.XDomainRequest).open("POST",t):f.Yoda.CAT.sendLog(t,"ajaxError","[LX创建XHR对象失败]","xhr error","info"),o.timeout=5e3,o.ontimeout=function(){f.Yoda.CAT.sendLog(t,"ajaxError","[LX请求超时]",o.status+" | "+o.readyState,"info"),o.abort()},o.onerror=function(){f.Yoda.CAT.sendLog(t,"ajaxError","[LX请求错误]",o.status+" | "+o.readyState,"info"),o.abort()},o.send(JSON.stringify(e.data))}catch(e){f.Yoda.CAT.sendLog(t,"ajaxError","[LX请求异常]",e.stack,"info")}return!0},T.prototype.setProject=function(e){this.project="spiderindefence"===e?this.mtsiProject:this.project},T.prototype.postBatch=function(e,t,o,n,i,s){e={resourceUrl:e,connectType:location.protocol,type:s,timestamp:Date.now(),requestbyte:t,responsebyte:o,responsetime:n,project:this.project,pageUrl:this.origin,realUrl:location.href,statusCode:i,logContent:""};this.batchs.push(e)},T.prototype.sendBatch=function(){var e,t;0<this.batchs.length&&(e=this.host+"/batch?v="+this.catVersion+"&sdk="+this.catSdk+"&pageId="+this.unionId,t={region:"",operator:"",network:"",container:"",os:"",unionId:this.unionId,infos:this.batchs},this.sendStatic(e,JSON.stringify(t),"text/plain;charset=UTF-8"),this.batchs=[])},T.prototype.speed=function(e,t){var o=f.location.href,o="&project="+this.project+"&pageurl="+o+"&unionId="+this.unionId+"&timestamp="+Date.now()+"&speed="+e+"&customspeed="+t,e=this.host+"/api/speed?v="+this.catVersion+o,n=new f.XMLHttpRequest;n.open("GET",e),n.timeout=5e3,n.ontimeout=function(){n.abort()},n.onerror=function(){n.abort()},n.send()},T.prototype.sendLog=function(e,t,o,n,i){e=[{project:this.project,pageUrl:f.location.href,resourceUrl:e||"",category:t,sec_category:o,level:i||"error",unionId:this.unionId,timestamp:Date.now(),content:n||""}],t=this.host+"/api/log?v="+this.catVersion;this.sendStatic(t,{c:JSON.stringify(e)})},T.prototype.metric=function(e){var t=this.host+"/api/metric?v="+this.catVersion+"&p="+this.project;this.sendStatic(t,{data:JSON.stringify(e)})},T.prototype.sendStatic=function(e,t,o){return x(e,t,function(){},o),!0},T.prototype.byte=function(e){var t=0,o=e.length;if(e){for(var n=0;n<o;n++)255<e.charCodeAt(n)?t+=2:t++;return t}return 0},w=0,f.YodaSeed=o)}();