$.fx.speeds._default=500;var interval,folder_id=0;$(document).ready(function(){var e=580;$.browser.msie&&"7.0"==$.browser.version&&(e=580),$("#upload_widget_window").dialog({autoOpen:!1,show:"fade",hide:"fade",width:e,height:450,title:LABELS.ADVANCED_UPLOAD,resizable:!1,modal:!0,beforeClose:function(e,t){s.cancelAll(),s.clearStoredFiles(),clearInterval(interval)},open:function(e,t){$(".ui-widget-overlay").css("width","100%"),$.browser.msie&&"9.0"==$.browser.version&&$("#upload_widget_window").css("width","550px")},close:function(e,t){$("body").css("overflow","auto")}}),$("body").on("click",".fakefile, #opener, .upload-files",function(){return 1==is_guest?location.href=please_login:$(".terms input").prop("checked")?upload?($("#upload_widget_window").dialog("open"),window.scrollTo(0,0)):$("#exceeded_storage").dialog("open"):alert(LABELS.YOUMUSTAGREE),!1});var o=[],d=0,s=new qq.FineUploader({autoUpload:!1,element:document.getElementById("uploader"),maxConnections:5,request:request_params,cors:{expected:!1,sendCredentials:!0,allowXdr:!1},failedUploadTextDisplay:{mode:"custom",responseProperty:"error"},callbacks:{onUpload:function(a,e){var o=this.getFile(a),s=new qq.Promise,i=this,r="li[qq-file-id='"+a+"'] ";return $(r+"span.qq-upload-status-text").text("file hash calculation"),browserMD5File(o,function(e,t){e?s.failure(e):$.ajax({method:"POST",dataType:"json",url:ep,data:{hash:t,size:o.size,name:o.name,folder_id:d,id:a,uuid:i.getUuid(a),multipart:request_params.forceMultipart}}).done(function(e){$(r+"span.qq-upload-status-text").text(""),e.hasOwnProperty("endpoint")&&e.endpoint?(i.setEndpoint(setProtocol(e.endpoint),a),i.setParams(is_ajax,a),e.uuid&&i.setUuid(a,e.uuid),s.success()):e.error?(s.failure({error:e.error}),$(r+"span.qq-upload-status-text").text(e.error),$(r+"button.qq-upload-cancel-selector").remove()):e.hasOwnProperty("success")&&e.success?($(r+"span.qq-upload-size").text(i.formatSize(o.size)).removeClass("qq-hide"),$(r).addClass("qq-upload-success").removeClass("qq-in-progress"),$(r+"button.qq-upload-cancel-selector").remove(),$(r).attr("file-id32",e.id32),s.success({pause:!0})):s.failure({preventRetry:!0})})},function(e){$(r+"div.qq-progress-bar-container-selector").removeClass("qq-hide"),$(r+'[role="progressbar"]').css("width",Math.round(100*e)+"%")}),s},onComplete:function(e,t,a){var o=this.getFile(e),s="li[qq-file-id='"+e+"'] ";$(s+"span.qq-upload-size").text(this.formatSize(o.size)),$(s+"div.qq-progress-bar-container-selector").css("width","100%").removeClass("qq-hide"),$(s+'[role="speed"]').text(""),$(s+"span.qq-upload-status-text").text(""),$(s).removeClass("qq-upload-success").addClass("qq-in-progress")},onProgress:function(e,t,a,o){var s="li[qq-file-id='"+e+"'] ";speed=function(e,t){var a=(e/t).toFixed(2);if(isNaN(a)||1<=a)$("#progress-text").text("");else{var o=(100*a).toFixed()+"% total";$("#progress-text").text(o)}n.push({totalUploadedBytes:e,currentTime:(new Date).getTime()});20<n.length&&n.shift();if(speed=!1,6<=n.length)try{var s=n[0],i=n[n.length-1],r=i.totalUploadedBytes-s.totalUploadedBytes,d=i.currentTime-s.currentTime,l=(r/(d/1e3)/1048576).toFixed(2);0<l&&(remaining=((t-e)/1048576/l).toFixed(0),speed=l+" MBps / remaining: "+remaining.toHHMMSS())}catch(e){}return speed}(a,o),0!=speed&&$(s+'[role="speed"]').text(speed)}}}),n=[];String.prototype.toHHMMSS=function(){var e=parseInt(this,10),t=Math.floor(e/3600),a=Math.floor((e-3600*t)/60),o=e-3600*t-60*a;return t<10&&(t="0"+t),a<10&&(a="0"+a),o<10&&(o="0"+o),t+":"+a+":"+o},qq(document.getElementById("upload-button")).attach("click",function(){interval=window.setInterval(function(){uuid=[],$.each(s.getUploads({status:[qq.status.UPLOAD_SUCCESSFUL,qq.status.PAUSED]}),function(e,t){t.uuid in o||(o[t.uuid]=!1),o[t.uuid]||uuid.push({uuid:t.uuid})}),0!==uuid.length&&$.ajax({method:"POST",dataType:"json",url:upload_state,data:{uuid:uuid}}).done(function(e){$.each(e,function(e,t){var a=s.getUploads({uuid:e});t.success?(o[e]=!0,$("li[qq-file-id="+a.id+"]").attr("file-id32",t.id32),$("li[qq-file-id="+a.id+"]").addClass("qq-upload-success").removeClass("qq-in-progress")):t.failed&&(o[e]=!0,$("li[qq-file-id='"+a.id+"'] span.qq-upload-status-text").text(t.error),$("li[qq-file-id='"+a.id+"']").addClass("qq-upload-fail").removeClass("qq-upload-success"))})})},4e3),s.uploadStoredFiles()}),qq.extend(qq.FineUploader.prototype,{formatSize:function(e){return this._formatSize(e)}}),$(".choose-folder select").change(function(){d=$(this).val()}),$("#get-link-button").click(function(){var a=[];$.each($("li.qq-upload-success"),function(e,t){void 0!==$(t).attr("file-id32")&&a.push(["f",$(t).attr("file-id32")])}),0!=a.length?0<a.length?$.ajax({type:"POST",url:url_GetLink,data:{id:JSON.stringify(a),domain:dl_path},async:!0,success:function(e){links_array=JSON.parse(e),makeLinks(links_array),$("#links-dialog").dialog("open")},error:function(e,t){ajaxError(e,t)}}):($("#text").find("textarea").html(txt_alert1),$("#html").find("textarea").html(txt_alert1),$("#bbcode").find("textarea").html(txt_alert1)):alert("No uploaded files!")})});