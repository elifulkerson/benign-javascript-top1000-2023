!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).resourceSDK=t()}(this,(function(){"use strict";function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function t(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach((function(e){c(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,s(i.key),i)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function c(e,t,n){return(t=s(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,c,a=[],u=!0,s=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(i=o.call(n)).done)&&(a.push(i.value),a.length!==t);u=!0);}catch(e){s=!0,r=e}finally{try{if(!u&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(s)throw r}}return a}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function s(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var l,d,h="device",f="os",p="model",m="name",g="vendor",v="version",b="undefined"==typeof window?void 0:window.navigator||void 0;null==b||b.userAgentData,c(l={},"".concat(h),["type",p,g]),c(l,"".concat(f),[m,v]),c({},"".concat(f),[v]),c({},"".concat(f),/ ?os$/i),c(d={},"".concat(h),[g,p]),c(d,"".concat(f),[m,v]);var y,w,S=o((function e(){var r=this;i(this,e),c(this,"msg",""),c(this,"data",{}),c(this,"init",(function(){if(void 0!==("undefined"==typeof window?"undefined":n(window))){var e=r.getDevieceRatio(),t=r.getDeviceScreen()||{},i=t.width,o=t.height,c=r.getDeviceMemory(),a=r.getHardwareConcurrency();r.setDeviceData({pixelRatio:e,width:i,height:o,memory:c,concurrency:a})}else r.msg="not support window"})),c(this,"getDevieceRatio",(function(){if(window.devicePixelRatio)return window.devicePixelRatio})),c(this,"getDeviceScreen",(function(){if(window.screen){var e=window.screen;return{width:e.width,height:e.height}}})),c(this,"getDeviceMemory",(function(){if(window.navigator){var e=window.navigator;return null==e?void 0:e.deviceMemory}})),c(this,"getHardwareConcurrency",(function(){if(window.navigator){var e=window.navigator;return null==e?void 0:e.hardwareConcurrency}})),c(this,"setDeviceData",(function(e){r.data=t(t({},r.data),e)})),c(this,"getResult",(function(){return{msg:r.msg,data:r.data}})),this.init()}));!function(e){e.isSlow2G="slow-2g",e.is2G="2g",e.is3G="3g",e.is4G="4g"}(y||(y={})),function(e){e.bluetooth="bluetooth",e.cellular="cellular",e.ethernet="ethernet",e.none="none",e.wifi="wifi",e.wimax="wimax",e.other="other",e.unknown="unknown"}(w||(w={}));var C="RESOURCE_ADAPT",E="".concat(C,"_WEBP"),A="_thumbnail_",O=["img.shein.com","img.romwe.com","img.ltwebstatic.com","imgdeal-test01.shein.com"],I={"320-720":720,"720-1080":720,"1080-1280":1080,"1280-1440":1280,"1440-1680":1440,"1680-1920":1680,"1920-3080":1920,"3080-4080":1920},k=function(e){var t;!(t=E,decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(t).replace(/[-.+*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null||"")&&e&&function(e){var t=e.key,n=e.value,i=e.end,r=e.path,o=void 0===r?"/":r,c=e.domain,a=e.secure,u=e.curMainDomain;if(!t||/^(?:expires|max-age|path|domain|secure)$/i.test(t))return"";u&&(c="."+location.hostname.split(".").slice(1).join("."));var s="";i&&("number"==typeof i?s=i===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+i:"string"==typeof i?s="; expires="+i:i instanceof Date&&(s="; expires="+i.toUTCString())),document.cookie="".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n)).concat(s).concat(c?"; domain="+c:"").concat(o?"; path="+o:"").concat(a?"; secure":"")}({key:E,value:"1",path:"/"})},D=o((function e(t){var n=this;i(this,e),c(this,"deviceWidth",0),c(this,"isSupportWebp",!1),c(this,"isMoble",!1),c(this,"designSize",0),c(this,"calculateWidth",0),c(this,"score",0),c(this,"isServer",!1),c(this,"isCookieSet",!1),c(this,"isSupprotCut",!1),c(this,"currentScene",""),c(this,"sceneMap",{}),c(this,"init",(function(e){n.setIsServer(),n.setDeviceData(e),n.setSupportWebpState(),n.isServer||(n.isSupportWebp?n.setLocaWebpState("true"):n.checkClientSupportWebp())})),c(this,"setIsServer",(function(){n.checkIsServer()&&(n.isServer=!0)})),c(this,"setDeviceData",(function(e){var t=e.width,i=e.isMobile,r=e.score,o=e.isSupportWebp,c=e.isSupprotCut,a=e.sceneMap,u=e.scene;n.isMoble=i||!1,n.isSupprotCut=c||!1,n.deviceWidth=n.getDeviceWidth(t),n.score=r||0,n.sceneMap=a||{},n.currentScene=u||"",o&&(n.isSupportWebp=o),n.designSize=i?750:1366,n.calculateWidth=n.getCalculateWidth()})),c(this,"getDeviceWidth",(function(e){var t=e||n.getDefaultDeviceWidthByCookie();return!n.isMoble&&t<=1920?1920:t})),c(this,"getDefaultDeviceWidthByCookie",(function(){return n.isMoble?375:1366})),c(this,"setSupportWebpState",(function(){n.isServer||(n.isSupportWebp=Boolean(n.getLocalWebpState()))})),c(this,"checkClientSupportWebp",(function(){(n.checkSupportWebpByCanvas()||n.checkSupportWebpByElement())&&(n.isSupportWebp=!0,n.setLocaWebpState("true")),n.checkSupportWebpByBase64()})),c(this,"checkIsServer",(function(){return"undefined"==typeof window})),c(this,"getCalculateWidth",(function(){for(var e=Object.keys(I),t=n.isMoble?2*n.deviceWidth:n.deviceWidth,i=0;i<e.length;i++){var r=a(e[i].split("-"),2),o=r[0],c=r[1];if(t>=Number(o)&&t<Number(c)||i===e.length-1&&t>=Number(c))return n.calculateWidthByScore(i,e)}return 720})),c(this,"calculateWidthByScore",(function(e,t){var i=t[e];if(3===n.score||2===n.score||0===n.score)return I[i];1===n.score&&(i=t[e-1>=0?e-1:0]);return I[i]})),c(this,"getLocalKey",(function(){return"".concat(C,"__").concat("WEBP_SUPPORT")})),c(this,"getLocalWebpState",(function(){return localStorage.getItem(n.getLocalKey())||!1})),c(this,"setLocaWebpState",(function(e){localStorage.setItem(n.getLocalKey(),e),n.isCookieSet||(n.isCookieSet=!0,k(!0))})),c(this,"checkSupportWebpByBase64",(function(){var e=new Image;e.onload=function(){e.width>0&&e.height>0&&!n.isSupportWebp&&(n.isSupportWebp=!0,n.setLocaWebpState("true"))},e.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="})),c(this,"checkSupportWebpByCanvas",(function(){var e=document.createElement("canvas");return e&&0===e.toDataURL("image/webp").indexOf("data:image/webp")})),c(this,"checkSupportWebpByElement",(function(){var e;try{var t=document,n=t.createElement("object");n.type="image/webp",n.innerHTML="!",t.body.appendChild(n),e=!n.offsetWidth,t.body.removeChild(n)}catch(t){e=!1}return e})),c(this,"cutWidth",(function(e,t,i){var r=e*n.calculateWidth/n.designSize;if(r=48*Math.round(r/48),i&&r<i)return i;if(t&&r>t)return t;var o=n.isMoble?2:4,c=Math.floor(e+48*o);return Math.floor(r)>c?c:Math.floor(r)})),c(this,"isSupportCutImgType",(function(e){return/\b(\.webp|\.png|\.jpg\b)/.test(e)})),c(this,"isSupportCutImg",(function(e){return O.some((function(t){return e.indexOf(t)>-1}))})),c(this,"img2Webp",(function(e,t){return t?e.replace(/\b(\.jpg|\.png|\.gif)\b/,".webp"):e})),c(this,"checkIsGif",(function(e){return/\b(\.gif\b)/.test(e)})),c(this,"cutImg",(function(e){var t=e.imgUrl,i=e.width,r=e.max,o=e.min,c=t.indexOf(A)>-1,u=n.cutWidth(i,r,o);if(c)return t.replace(/(\d+)x(\d*)(\.)(webp|png|jpg)$/,(function(e){var t=a(e.split("."),2),n=t[0],i=t[1],r=a(n.split("x"),1)[0],o=u>Number(r)?Number(r):u;return"".concat(o,"x.").concat(i)}));var s=t.lastIndexOf("."),l=t.slice(s);return"".concat(t.slice(0,s)).concat(A).concat(u,"x").concat(l)})),c(this,"transfromImg",(function(e){var t=e.imgUrl,i=void 0===t?"":t,r=e.width,o=void 0===r?0:r,c=e.exp,a=(void 0===c?{}:c)||{},u=a.unCut,s=void 0===u?0:u,l=a.max,d=void 0===l?0:l,h=a.min,f=void 0===h?0:h,p=n.checkIsGif(i);if(!i)return"data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=";var m=n.isSupportCutImg(i);n.isSupportWebp&&(i=n.img2Webp(i,m));var g=!n.currentScene||n.sceneMap[n.currentScene]&&Boolean(n.sceneMap[n.currentScene]);return n.isSupprotCut&&m&&g&&o&&!s&&!p&&n.isSupportCutImgType(i)&&(i=n.cutImg({imgUrl:i,width:o,max:d,min:f})),i.replace(/^\w+:/,"")})),c(this,"updataScore",(function(e){n.score=e||0,n.calculateWidth=n.getCalculateWidth()})),c(this,"updateScene",(function(e){n.currentScene=e})),this.init(t)})),W=["scroll","resize","orientationChange"],R=["focus","mouseover","click","load","transitionend","animationend"],L=["DOMNodeInserted","DOMAttrModified"],M=o((function e(n){var r,o,u,s,l,d,h,f,p,m,g,v=this;i(this,e),c(this,"isInit",!1),c(this,"isCompleted",!1),c(this,"startTime",0),c(this,"options",{lazyClass:"lazyload",srcAttr:"data-src",bgAttr:"data-background-image",designAttr:"data-design-width",expAttr:"data-exp",autoInit:!0,throttleDelay:200,debounceDelay:300,transfromImg:function(e){return e.imgUrl},reportLog:function(){}}),c(this,"intersectionObserver",void 0),c(this,"throttledCheckElement",void 0),c(this,"debounceCheckElement",void 0),c(this,"init",(function(){v.isInit||(v.isInit=!0,v.loader())})),c(this,"checkElement",(function(){try{var e=v.getLazyClass();e&&null!=e&&e.length&&(v.intersectionObserver?v.checkElementByIntersection():v.checkElementByViewPort())}catch(e){return void console.warn("RESOURCE_SDK_CHECK_CATCH:",e)}})),c(this,"loader",(function(){v.startTime=Date.now(),v.addListener(),v.addMutationObserver(),v.addIntersectionObserver(),v.onload();var e=v.getLazyClass();e&&null!=e&&e.length?v.checkElement():v.throttledCheckElement()})),c(this,"addListener",(function(){W.forEach((function(e){window.addEventListener(e,v.debounceCheckElement,!0)})),R.forEach((function(e){document.addEventListener(e,v.throttledCheckElement,!0)}))})),c(this,"addMutationObserver",(function(){var e;if(!window.MutationObserver)return L.forEach((function(e){document.documentElement.addEventListener(e,v.throttledCheckElement,!0)})),void console.log("RESOURCE_SDK_UN_SUPPORT_MUTATIONOBSERVER");null!==(e=document)&&void 0!==e&&e.documentElement||console.log("RESOURCE_SDK_UN_SUPPORT_DOCUMENTELEMENT"),new MutationObserver(v.throttledCheckElement).observe(document.documentElement,{childList:!0,subtree:!0,attributes:!0})})),c(this,"addIntersectionObserver",(function(){window.IntersectionObserver?v.intersectionObserver=new IntersectionObserver(v.intersectionCallback,{root:null,rootMargin:"0px 0px 20% 0px",threshold:0}):console.log("RESOURCE_SDK_UN_SUPPORT_INTERSECTIONOBSERVER:")})),c(this,"onload",(function(){/d$|^c/.test(document.readyState)?v.load():(window.addEventListener("load",v.load),document.addEventListener("DOMContentLoaded",v.throttledCheckElement))})),c(this,"load",(function(){v.isCompleted||(Date.now()-v.startTime<1e3&&setTimeout(v.load,1e3),v.isCompleted=!0,v.throttledCheckElement())})),c(this,"checkElementByIntersection",(function(){var e,t=v.getLazyClass();null==t||null===(e=t.forEach)||void 0===e||e.call(t,(function(e){var t;v.checkIsLoaded(e)||null===(t=v.intersectionObserver)||void 0===t||t.observe(e)}))})),c(this,"checkElementByViewPort",(function(){var e,t=v.getLazyClass();null==t||null===(e=t.forEach)||void 0===e||e.call(t,(function(e){if(!v.checkIsLoaded(e)){var t=e.getBoundingClientRect()||{},n=t.top,i=t.bottom,r=t.left,o=t.right,c=window.innerHeight||document.documentElement.clientHeight,a=window.innerWidth||document.documentElement.clientWidth;n<1.3*c&&i>0&&r<a&&o>0&&v.loadImage(e)}}))})),c(this,"intersectionCallback",(function(e,t){e.forEach((function(e){var n=e||{},i=n.intersectionRatio,r=n.isIntersecting,o=n.target;if(i>0||r){if(t.unobserve(o),v.checkIsLoaded(o))return;v.loadImage(o)}}))})),c(this,"checkIsLoaded",(function(e){try{if(!e||!e.getAttribute)return!0;var t=e.getAttribute("loaded");if("loading"===t)return!0;if(!t)return!1;if("true"===t){var n="",i=e.getAttribute("src")||"",r=e.getAttribute(v.options.srcAttr)||"",o=e.getAttribute(v.options.bgAttr)||"",c=Boolean(o&&!r);if(c){if((e.getAttribute("style")||"").replace(/url\(\"?\/\/(.+?)\"?\)/,(function(e,t){return n=t,""})),!n||!o)return!0}else if(!r)return!0;var a=v.getOriginUrl(c?"//".concat(n):i),u=v.getOriginUrl(c?o:r);return a===u&&""!==a&&""!==u}return!1}catch(e){return console.warn("RESOURCE_SDK_LAZY_IMG_CATCH:",e),!0}})),c(this,"getOriginUrl",(function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!n)return"";var i=a((null==n||null===(e=n.replace(/\b(\.jpg|\.png|\.gif|\.webp)\b/,""))||void 0===e||null===(t=e.replace(/^\w+:/,""))||void 0===t?void 0:t.split("_thumbnail_"))||[],1);return origin=i[0],origin||""})),c(this,"setIsLoaded",(function(e){e.setAttribute("loaded","true")})),c(this,"setIsLoading",(function(e){e.setAttribute("loaded","loading")})),c(this,"loadImage",(function(e){try{var t=v.getImgCutData(e),n=t.imgUrl,i=t.width,r=t.exp,o=t.isBg;if(!n)return;var c=v.options.transfromImg({imgUrl:n,width:i,exp:r});v.setIsLoading(e);var a=new Image;a.addEventListener("load",(function(){v.setIsLoaded(e),o?e.style.backgroundImage="url('".concat(c,"')"):e.setAttribute("src",c)})),a.addEventListener("error",(function(t){console.warn("RESOURCE_SDK_LAZY_IMG_LOAD:",t,"img: ".concat(c,", imgUrl: ").concat(n)),v.setIsLoaded(e)})),a.src=c}catch(e){return void console.warn("RESOURCE_SDK_LAZY_IMG_CATCH:",e)}})),c(this,"getImgCutData",(function(e){var t=e.getAttribute(v.options.srcAttr)||"",n=e.getAttribute(v.options.bgAttr)||"",i=e.getAttribute(v.options.designAttr)||0,r=e.getAttribute(v.options.expAttr)||"",o=Boolean(n&&!t),c={};return r.length&&r.split("#").forEach((function(e){var t=a(e.split("="),2),n=t[0],i=t[1];c[n]=Number(i)})),{imgUrl:t||n,width:Number.isNaN(i)?0:Number(i),exp:c,isBg:o}})),c(this,"getLazyClass",(function(){return document.querySelectorAll(".".concat(v.options.lazyClass))})),this.throttledCheckElement=function(e){var t,n,i,r,o=e.func,c=e.wait,a=void 0===c?0:c,u=e.options,s=void 0===u?{}:u,l=s.leading,d=void 0===l||l,h=s.trailing,f=void 0===h||h,p=0,m=0;function g(e){var i=t,r=n;return t=n=void 0,p=e,o.apply(i,r)}var v=function(){for(var e=arguments.length,o=new Array(e),c=0;c<e;c++)o[c]=arguments[c];n=o,t=this;var u=(new Date).getTime(),s=u-m;return m=u,new Promise((function(e){(!p||s>=a)&&!1===d&&(p=u);var t=a-(u-p);t<=0||t>a?(r&&(clearTimeout(r),r=null),i=g(u),e(i)):r||!1===f||(r=setTimeout((function(){p=!1===d?0:(new Date).getTime(),r=null,i=g(p),e(i)}),t))}))};return v.cancel=function(){r&&clearTimeout(r),r=null,m=p=0,t=n=void 0},v}({func:this.checkElement,wait:this.options.throttleDelay}),this.debounceCheckElement=(r={func:this.checkElement,wait:this.options.debounceDelay},l=r.func,d=r.wait,h=void 0===d?0:d,f=r.options,p=(void 0===f?{}:f).leading,m=void 0!==p&&p,g=function(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return new Promise((function(t){if(s=e,o&&clearTimeout(o),m){var i=!o;o=setTimeout((function(){o=null}),h),i&&(u=l.apply(s,n),t(u))}else o=setTimeout((function(){u=l.apply(s,n),t(u),o=s=null}),h)}))},g.cancel=function(){o&&clearTimeout(o),o=s=null},g);try{this.options=t(t({},this.options),n),this.options.autoInit&&this.init()}catch(e){return void console.warn("RESOURCE_SDK_INIT_CATCH:",e)}}));return function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})||{},t=e.isSupprotCut,n=void 0!==t&&t,i=e.sceneMap,r=void 0===i?{}:i,o=(new S).getResult(),c=new D({width:o.data.width,isMobile:!1,isSupprotCut:n,sceneMap:r});return{lazyCheckElement:new M({transfromImg:c.transfromImg,reportLog:function(){}}).checkElement,updateCutScene:c.updateScene}}}));