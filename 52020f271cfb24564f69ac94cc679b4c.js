const products=[],productArray=[],bodyObj={assetTypes:["Microsoft.VisualStudio.Ide.Payload","Microsoft.VisualStudio.Services.VsixManifest","Microsoft.VisualStudio.Services.Icons.Small","Microsoft.VisualStudio.Services.Icons.Default","Microsoft.VisualStudio.Services.Icons.Wide","Microsoft.VisualStudio.Services.Icons.Branding"],filters:[{direction:2,pageSize:100,pageNumber:1,sortBy:0,sortOrder:0,pagingToken:null}],flags:2978},cardMap=new Map;async function fetchExtensionCardJSON(){return fetch("https://marketplace.visualstudio.com/_apis/public/gallery/extensionquery",{method:"POST",headers:{Accept:"application/json;api-version=7.1-preview.1","Content-Type":"application/json"},body:JSON.stringify(bodyObj)})}function checkError(response){if(!response.ok){const message=`An error has occured: ${response.status}`;throw new Error(message)}return response}function extractData(res){const dataMap=new Map;return res.results[0].extensions.forEach(extension=>{const productId=`${extension.publisher.publisherName}.${extension.extensionName}`,installStatistics=extension.statistics.filter(statistic=>"install"===statistic.statisticName),averageRatings=extension.statistics.filter(statistic=>"averagerating"===statistic.statisticName),migrationInstall=extension.statistics.filter(statistic=>"migratedInstallCount"===statistic.statisticName),additionalMigrationInstall=0===migrationInstall.length?0:migrationInstall[0].value;dataMap.set(productId,{installs:formatNum(installStatistics[0].value+additionalMigrationInstall),avgRating:(Math.round(2*averageRatings[0].value)/2).toFixed(1)})}),dataMap}function assignValue(extDataMap){cardMap.forEach((productCardParts,productId)=>{const extData=extDataMap.get(productId);productCardParts.install.append(extData.installs),productCardParts.rating.setAttribute("ratingvalue",extData.avgRating)})}document.querySelectorAll(".vscom-extension-cards-wrapper .vscom-extension-card").forEach(card=>{const installNum=card.querySelector(".service-box-installs-count .install-number"),rating=card.querySelector(".clip-star"),url=card.querySelector(".hover-link a"),urlParams=new URL(url).searchParams,productId=urlParams.get("itemName");productArray.push({filterType:7,value:""+productId}),cardMap.set(productId,{install:installNum,rating:rating})}),bodyObj.filters[0].criteria=productArray,fetchExtensionCardJSON().then(checkError).then(resp=>resp.json()).then(extractData).then(assignValue).catch(error=>{console.log("Error with extension card json:",error)});const formatNum=n=>n<1e3?n:n>=1e3&&n<1e6?+(n/1e3).toFixed(1)+"K":n>=1e6&&n<1e9?+(n/1e6).toFixed(1)+"M":n>=1e9&&n<1e12?+(n/1e9).toFixed(1)+"B":n>=1e12?+(n/1e12).toFixed(1)+"T":void 0;