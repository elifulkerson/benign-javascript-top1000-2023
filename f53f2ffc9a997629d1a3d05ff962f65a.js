"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4715],{14715:function(e,t,r){r.d(t,{x:function(){return o},Q:function(){return el}});var n,o,i=r(59499),l=r(85893),a=r(67294),s=r(96333),c=r(96722),f=r(19521),d=r(56947),u=r.n(d),p=r(55163),O=r(23957),v=r(4730),m=r(5763),y=r(80221),g=r(6481);let _=["className","data-test","hasWarning","isConfirmed","isFullWidth","isPending","onClick","size"];function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach(function(t){(0,i.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let R=(0,a.forwardRef)((e,t)=>{let{className:r,"data-test":n,hasWarning:o,isConfirmed:i,isFullWidth:a,isPending:s,onClick:c,size:f}=e,d=(0,v.Z)(e,_),p=Number.parseInt("sm"===f?u().font.size.text.medium:u().font.size.text.base,10);return(0,l.jsx)(g.i,E(E({confirmedText:"Offer saved",initialText:"Save offer",warningText:"Offer not saved. Try again"},d),{},{className:r,"data-test":n,hasWarning:o,isConfirmed:i,isFullWidth:a,isPending:s,onClick:c,ref:t,renderLeadingConfirmed:(0,l.jsx)(m.D,{color:u().colors.palette.green.light,width:p}),renderLeadingInitial:(0,l.jsx)(y.N,{color:u().colors.palette.white,width:p}),size:f}))});R.displayName="ButtonOffer";let b=(0,f.ZP)(R).withConfig({displayName:"ButtonOfferSecondary",componentId:"sc-272k6x-0"})(["button{","}"],({isConfirmed:e})=>e?`
      ${O.QJ}

      &:hover {
        ${O.Ky}
      }

      &:active {
        ${O.BH}
      }
      svg stop {
        stop-color: ${d.colors.palette.green.light};
      }
  `:`
      font-weight: normal;
      ${p._f}

      &:hover {
        ${p.ID}
      }

      &:active {
        ${p.h5}
        svg stop {
          stop-color: ${d.colors.palette.white};
        }
      }
      svg {
        color: inherit;
      }
      svg stop {
        stop-color: ${d.colors.palette.gray.medium};
      }
    `);b.displayName="ButtonOfferSecondary";var F=r(21303),w=r(92828),j=r(44281),D=r(35216),P=r(44350),I=r(23451);let k=async e=>{let{apis:{loyaltyGuestOfferLists:t},baseUrl:r,circleOfferLoyaltyKeys:n}=(0,P.config)().services.apiPlatform,o=`${r}/${t.endpointPaths.postOfferV1}/${null==e?void 0:e.offerId}`,{data:i,ok:l,statusText:a}=await (0,I.v_)(o,{headers:{Authorization:n.loyaltyClientKey,"x-api-key":n.loyaltyApiKey},parameters:{location_id:null==e?void 0:e.storeId},errorTag:"circle_post_offer_error",timerTag:"circle_post_offer_call",credentials:"include"});if(l)return i;throw Error(`${a}`)},{useMutation:A}=(0,D.F)({name:"@web/domain-circle-offers/post-offer-v1",mutationFn:e=>k(e)}),S=["LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED"],x=async e=>{let{apis:{offersV16:t},baseUrl:r}=(0,P.config)().services.circle,n=new URL(`${r}/${t.endpointPaths.postOfferV16}/${null==e?void 0:e.offerId}`).toString(),{data:o,ok:i,statusText:l}=await (0,I.v_)(n,{errorTag:"circle_post_offer_error",timerTag:"circle_post_offer_call",credentials:"include"});if(i)return o;throw Error(`${l}`)},{useMutation:C}=(0,D.F)({name:"@web/domain-circle-offers/post-offer-v16",mutationFn:e=>{let t=null!=e?e:{},{LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED:r=!1}=t,n=(0,v.Z)(t,S),o=(0,P.flags)("LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED")||r;return o?k(n):x(n)}}),N=async e=>{let{apis:{loyaltyGuestOfferLists:t},circleOfferLoyaltyKeys:r,baseUrl:n}=(0,P.config)().services.apiPlatform,o=`${n}/${t.endpointPaths.deleteOfferV1}/${null==e?void 0:e.offerId}`,{data:i,ok:l,statusText:a}=await (0,I.IV)(o,{headers:{Authorization:r.loyaltyClientKey,"x-api-key":r.loyaltyApiKey},errorTag:"circle_delete_offer_error",timerTag:"circle_delete_offer_call",credentials:"include"});if(l)return i;throw Error(`${a}`)},{useMutation:$}=(0,D.F)({name:"@web/domain-circle-offers/delete-offer-v1",mutationFn:e=>N(e)}),T=["LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED"],L=async e=>{let{apis:{offersV16:t},baseUrl:r}=(0,P.config)().services.circle,n=new URL(`${r}/${t.endpointPaths.deleteOfferV16}/${null==e?void 0:e.offerId}`).toString(),{data:o,ok:i,statusText:l}=await (0,I.IV)(n,{errorTag:"circle_delete_offer_error",timerTag:"circle_delete_offer_call",credentials:"include"});if(i)return o;throw Error(`${l}`)},{useMutation:M}=(0,D.F)({name:"@web/domain-circle-offers/delete-offer-v16",mutationFn:e=>{let t=null!=e?e:{},{LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED:r=!1}=t,n=(0,v.Z)(t,T),o=(0,P.flags)("LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED")||r;return o?N(n):L(n)}});var V=r(26797),z=r(32657),B=r(6153),K=r(43430);function Y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(r),!0).forEach(function(t){(0,i.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let G=(e,t)=>{var r,n,o;let i=null!==(r=null==e?void 0:null===(n=e.components)||void 0===n?void 0:n[0])&&void 0!==r?r:{};return{name:null!==(o=null==i?void 0:i.title)&&void 0!==o?o:null==i?void 0:i.id,position:String(t),component:null!=i&&i.title?`${null==i?void 0:i.id} || ${null==i?void 0:i.title}`:null==i?void 0:i.id,componentType:null==i?void 0:i.type_name,contentType:null==i?void 0:i.content_type}},W=(e,t,r)=>{let{trackEvent:n}=(0,K.rS)(),i=(0,B.Kk)(),l=(0,z.ew)(i),a=null==e?void 0:e.strategyId,s=G(t,r);return t=>{let r,c;let{offerId:f,action:d,offerAriaLabel:u}=null!=t?t:{};f&&(d===o.ADDED_OFFER?r=!0:d===o.ADD_OFFER_ERROR&&(r=!1),d===o.REMOVED_OFFER?c=!0:d===o.REMOVE_OFFER_ERROR&&(c=!1),n({appState:{url:i,cmsPageId:l},guest:{eventType:"click"},offerInfo:Z(Z(Z({},r?{addOffer:r}:{}),c?{removeOffer:c}:{}),{},{offers:[{offerId:f,offerSelected:void 0!==r||void 0!==c,offerType:"cartwheel"}]}),promotionInfo:{promos:[{id:f,omtOfferId:f,added:r,removed:c,longTagSpecialOffer:u}]}}),a&&(0,K.OK)({recClick:{type:"promo",offerId:f,position:null==e?void 0:e.position,strategyId:null==e?void 0:e.strategyId,strategyName:null==e?void 0:e.strategyName},contentClick:s}))}};var H=r(86235);let J=()=>{let{openJoinCircleModal:e,closeJoinCircleModal:t,isCircleEnrolled:r,isGuestLoggedIn:n}=(0,a.useContext)(H.j);return{closeJoinCircleModal:t,openJoinCircleModal:e,isCircleEnrolled:r,isGuestLoggedIn:n}};var U=r(78503),Q=r(50411),q=r(13347);let X=({isPopoverOpen:e,offerButtonRef:t,setIsPopoverOpenToggle:r,isErrorState:n,errorMessage:o=V._r,isIconOnly:i})=>{let s=(0,a.useRef)(null),c=(0,a.useCallback)(()=>{var e;null===(e=s.current)||void 0===e||e.focus()},[]),f=(0,a.useCallback)(e=>{null==e||e.preventDefault(),(0,q.zB)(window.location.href)},[]);return(0,l.jsx)(F.J,{isOpen:e,onOpen:c,renderInline:!0,role:n?"alert":"tooltip",tailPosition:i?"end":void 0,target:t,toggle:r,variant:n?"warning":"primary",zIndex:1100,children:n?(0,l.jsx)("span",{"data-test":"save-offer-popover-error",ref:s,tabIndex:-1,children:o}):(0,l.jsx)(Q.F,{className:"h-margin-a-tiny",color:"onDark","data-test":"save-offer-popover-sign-in-link",onClick:f,ref:s,underline:"always",children:V.IY})})};X.displayName="SaveCircleOfferPopover";let ee=f.ZP.svg.withConfig({displayName:"AnimatedIcon__AnimatedSvg",componentId:"sc-x6qm3h-0"})([".plus{clip-path:",";transition:clip-path 300ms;transition-delay:100ms;",";}.checkmark{clip-path:inset(0 100% 0 0);transition:clip-path 100ms;transition-delay:0;","}@media (prefers-reduced-motion){.plus,.checkmark{transition:none;transition-delay:0;}}"],"polygon(0% 0%, 0% 100%, 50% 100%, 50% 50%, 50% 50%, 50% 50%, 50% 50%, 50% 100%, 100% 100%, 100% 0%)",e=>e.isOfferAdded?`
    clip-path: polygon(0% 0%, 0% 100%, 0 100%, 0 0, 100% 0, 100% 100%, 0 100%, 0 100%, 100% 100%, 100% 0%);
    transition: clip-path 100ms;
    transition-delay: 0;
    `:"",e=>e.isOfferAdded?`
    clip-path: inset(0);
    transition: clip-path 300ms;
    transition-delay: 100ms;
    `:""),et=({isOfferAdded:e=!1,size:t=24})=>(0,l.jsxs)(ee,{focusable:"false",height:t,isOfferAdded:e,role:"presentation",viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",children:[(0,l.jsx)("path",{className:"plus",d:"M12.75 3.25v8h8v1.5h-8v8h-1.5v-8h-8v-1.5h8v-8z",fill:d.colors.palette.red.default}),(0,l.jsx)("path",{className:"checkmark",d:"M8.923 16.443l-4.395-4.364-1.056 1.064 5.451 5.414L20.528 7.032l-1.056-1.064z",fill:d.colors.palette.green.light})]});et.displayName="AnimatedIcon";let er=f.ZP.a.withConfig({displayName:"styles__PreLineLink",componentId:"sc-122dvwh-0"})(["white-space:pre-line;"]);function en(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function eo(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?en(Object(r),!0).forEach(function(t){(0,i.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):en(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}(n=o||(o={})).ADDED_OFFER="ADDED_OFFER",n.ADD_OFFER_ERROR="ADD_OFFER_ERROR",n.REMOVED_OFFER="REMOVED_OFFER",n.REMOVE_OFFER_ERROR="REMOVE_OFFER_ERROR";let ei=e=>e===V.a0?V.rL:e===V.mF?V.b0:void 0,el=({buttonSize:e,confirmedText:t,initialText:r,isOfferAddedDefault:n,offerId:i,offerAriaLabel:f,onAddOffer:d,onRemoveOffer:u,variation:p,trackingDetails:O,shouldTrack:v=!0,metadata:m,order:y})=>{var g;let[_,h]=(0,U.H)(),{openJoinCircleModal:E,isGuestLoggedIn:D,isCircleEnrolled:P}=J(),I=(0,j.l)(),{pricingStoreId:k}=(0,s.K)(),{screenSmMax:A}=(0,c.l)(),{0:S,1:x}=(0,a.useState)(void 0),{0:N,1:$}=(0,a.useState)(!1),{0:T,1:L}=(0,a.useState)(!1),z=W(O,m,y),B=n?V.mF:V.KL,{0:K,1:Y}=(0,a.useState)(B),{0:Z,1:G}=(0,a.useState)(!1),H=i?null==_?void 0:null===(g=_[i])||void 0===g?void 0:g.added:void 0,{0:Q,1:q}=(0,a.useState)("");(0,a.useEffect)(()=>{if(!0===H){if(K===V.mF)return;return Y(V.mF)}if(!1===H){if(K===V.a0)return;return Y(V.a0)}Y(B)},[H,B,K,i]);let ee=(0,a.useCallback)(e=>{let t={action:e,offerId:i,offerAriaLabel:f};null==d||d(t),v&&z(t)},[i,f,d,v,z]),en=(0,a.useCallback)(e=>{let t={action:e,offerId:i,offerAriaLabel:f};null==u||u(t),v&&z(t)},[i,f,u,v,z]),el=(0,a.useCallback)(e=>{if((null==e?void 0:e.status)===409){var t,r,n;x(null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(r=t.data)||void 0===r?void 0:null===(n=r.errors)||void 0===n?void 0:n.NOT_ENOUGH_SLOTS)}G(!0),ee(o.ADD_OFFER_ERROR),Y(V.a0)},[ee]),ea=(0,a.useCallback)(()=>{Z&&G(!1),ee(o.ADDED_OFFER),Y(V.mF),q("Offer saved"),h&&h({type:V.NE.ADD_OFFER,value:{offerId:i}})},[ee,Z,i,h]),[es]=C({onError:el,onSuccess:ea}),ec=(0,a.useCallback)(()=>{var e;L(!1),null===(e=eO.current)||void 0===e||e.focus()},[]),ef=(0,a.useCallback)(()=>{Z&&G(!1),en(o.REMOVED_OFFER),Y(V.a0),q("Offer removed"),h&&h({type:V.NE.REMOVE_OFFER,value:{offerId:i}})},[en,Z,i,h]),ed=(0,a.useCallback)(()=>{G(!0),en(o.REMOVE_OFFER_ERROR),Y(V.mF)},[en]),[eu]=M({onError:ed,onSuccess:ef});(0,a.useEffect)(()=>{Z&&$(e=>!e||e)},[Z]);let ep=(0,a.useCallback)(async()=>{if(!Z){if(!D)return $(!0);if(D&&!P)return E();switch(Y(V.rR),K){case V.KL:case V.a0:if(i)return L(!0),es({offerId:i,LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED:I,storeId:k});break;case V.mF:if(i)return eu({offerId:i,LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED:I})}}},[es,Z,eu,P,D,i,K,E,$,k,I]),eO=(0,a.useRef)(null),ev=(0,a.useCallback)(()=>{$(e=>(e&&(x(void 0),G(!1)),!e))},[]),em="secondary"===p?b:R,ey="iconOnly"===p,eg=(0,a.useRef)(null),e_=(0,a.useCallback)(()=>{var e;null===(e=eg.current)||void 0===e||e.focus()},[]);return i?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(X,{errorMessage:null!=S?S:ei(K),isErrorState:Z,isIconOnly:ey,isPopoverOpen:N,offerButtonRef:eO,setIsPopoverOpenToggle:ev}),i===V.U4&&(0,l.jsx)(F.J,{isDismissible:!0,isOpen:T,onDismiss:ec,onOpen:e_,renderInline:!0,role:"tooltip",target:eO,variant:"primary",children:(0,l.jsx)(er,{ref:eg,tabIndex:-1,children:V.YJ})}),ey?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"h-sr-only",role:"alert",children:Q}),(0,l.jsx)(w.H,{"aria-label":K===V.mF?`Remove offer: ${f}`:`Save offer: ${f}`,className:"h-padding-a-tiny",onClick:ep,ref:eO,renderIcon:(0,l.jsx)(et,{isOfferAdded:K===V.mF,size:36}),type:"button"})]}):(0,l.jsx)(em,eo(eo({"aria-label":K===V.mF?`Remove offer: ${f}`:`Save offer: ${f}`,"data-test":"save-circle-offer-button",isConfirmed:K===V.mF,isFullWidth:!0,isPending:K===V.rR,onClick:ep,ref:eO,size:null!=e?e:A?"sm":"lg"},t?{confirmedText:t}:{}),r?{initialText:r}:{}))]}):null};el.displayName="SaveCircleOfferButton"}}]);