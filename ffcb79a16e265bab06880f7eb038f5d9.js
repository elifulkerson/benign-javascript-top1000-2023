;try{var runDataGatherer={gathererScriptId:"",gathererLogLevel:"",event:{},nativeEvent:{},element:{},attributes:{},lock:!1,dataPoints:[],sharedAttributes:{},spyReportingToGaCallbacks:[],pushStateCallbacks:[],xhrCallbacks:[],xhrRequestOpenArguments:[],fetchCallbacks:[],plugin:{},isTrackingEnabled:!0,customUserId:null,remoteDataRequested:!1,getConfig:function(){try{var i={"script_id":"default","running":!0,"run_conditions":{"expressions":["!(new RegExp('AdsBot-Google')).test(navigator.userAgent);","!(new RegExp('Googlebot')).test(navigator.userAgent);","!(new RegExp('YandexMobileBot')).test(navigator.userAgent);","!(new RegExp('screenshot-generator')).test(navigator.userAgent);","location.href.indexOf('livingsocial') < 0;"]},"variables":"runDataGatherer.getUrlGathererDataProvider = function() {return \"https:\/\/us-publicapi.databreakers.com\/v2\/gatherer-data-provider\";};runDataGatherer.getUrl = function() {return \"https:\/\/us-api.databreakers.com\/v1\/groupon_us\/dataPoint\";};","declarations":"runDataGatherer.storeLazyEvent = function(name, type, attributes) {var lazyEvent = JSON.stringify({'name': name,'type': type,'attributes': attributes});sessionStorage.setItem('db_lazy_event', lazyEvent);};runDataGatherer.sendLazyEvent = function() {var lazyEvent = sessionStorage.getItem('db_lazy_event');if (lazyEvent) {lazyEvent = JSON.parse(lazyEvent);runDataGatherer.sendCustomEvent(lazyEvent['name'], lazyEvent['type'], lazyEvent['attributes']);sessionStorage.removeItem('db_lazy_event');}};runDataGatherer.getIndex = function(el) {var iterator = 0;do {iterator++;} while (el = el.previousElementSibling);return iterator;};runDataGatherer.getPageType = function() {if (location.pathname === '\/') {return 'homepage'}if (location.pathname === '\/cart') {return 'basket'}if (location.pathname.indexOf('\/deals\/') === 0 && location.pathname.split('\/').length === 3) {return 'product_detail'}if (location.pathname === '\/search') {return 'search'}if (location.pathname.indexOf('\/goods') === 0 || location.pathname.indexOf('\/local') === 0 || location.pathname.indexOf('\/occasion') === 0 || location.pathname.indexOf('\/getaways') === 0) {return 'category'}return null;};","log_level":"error","batch_time":10,"batch_event_type_black_list":["click"],"batch_event_type_white_list":[],"user_identification":{"handler":"var bCookie = runDataGatherer.loadCookie({'mode': 'specific','parameters': ['b']})['b'];runDataGatherer.customUserId = bCookie;"},"location":{"ip":!0,"country_code":!0,"country_name":!0,"region_code":!0,"region_name":!0,"city":!0,"zip_code":!0,"time_zone":!0,"latitude":!0,"longitude":!0,"metro_code":!0},"device":{"type":!0,"brand":!0,"model":!0,"orientation":!0,"resolution":!0,"battery":!0,"max_touch_points":!0,"hardware_concurrency":!0,"device_pixel_ratio":!0},"os":{"name":!0,"version":!0,"platform":!0,"family":!0},"browser":{"type":!0,"name":!0,"version":!0,"engine":!0,"engine_version":!0,"user_agent":!0,"history":!0,"window_size":!0,"language":!0,"family":!0,"cookie":{"mode":"specific","parameters":["_ga","b","c","c_s"]}},"asn":{"autonomous_system_number":!0,"autonomous_system_organization":!0,"ip_address":!0,"network":!0},"network":{"downlink":!0,"downlinkMax":!0,"effectiveType":!0,"rtt":!0,"saveData":!0,"type":!0},"global_variables":{"parameters":[]},"custom_attributes":{"abTestGroup":"var abTests = JSON.stringify(sessionStorage.getItem('db_abtests'));abTests.indexOf('recommendation') >= 0 ? 'recommendation' : (abTests.indexOf('original') >= 0 ? 'original' : null);","cCookie":"var cCookie = runDataGatherer.loadCookie({'mode': 'specific','parameters': ['c']})['c'];\/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$\/.test(cCookie) ? cCookie : null","coordinates":"runDataGatherer.loadCookie({'mode': 'specific','parameters': ['ell']}).ell ? decodeURIComponent(runDataGatherer.loadCookie({'mode': 'specific','parameters': ['ell']}).ell) : (LS_Mustache_Params.hasOwnProperty('gigConfig') ? LS_Mustache_Params.gigConfig.division.lat.toString() + ',' + LS_Mustache_Params.gigConfig.division.lng.toString() : LS_Mustache_Params.mobileConfig.division.lat.toString() + ',' + LS_Mustache_Params.mobileConfig.division.lng.toString())","grouponUserId":"__LS_INITIAL_STATE__.auth.user.id","pageType":"runDataGatherer.getPageType()","pageType_2":"window.hasOwnProperty('TrackingHub') && window.TrackingHub.hasOwnProperty('page') && window.TrackingHub.page.hasOwnProperty('metadata') && window.TrackingHub.page.metadata.hasOwnProperty('type') ? window.TrackingHub.page.metadata.type : 'null'","webVersion":"window.hasOwnProperty('__NEXT_DATA__') ? 'mbnxt' : 'legacy'","webVersion_2":"window.hasOwnProperty('TrackingHub') && window.TrackingHub.hasOwnProperty('page') && window.TrackingHub.page.hasOwnProperty('metadata') && window.TrackingHub.page.metadata.hasOwnProperty('isMobileNext') ? 'mbnxt' : 'legacy'","window.databreakersAudience":"window.databreakersAudience","window.databreakersBucketedInExperiment":"window.databreakersBucketedInExperiment"},"url":{"mode":"specific","parameters":["utm_source","utm_medium","utm_campaign","utm_term","utm_content","db_report","uu","date","sid"]},"events":{"groups":[{"name":"pageview","running":!0,"selector":{"mode":"css","selection":["body"]},"type":["inview"],"handler":""},{"name":"map_click","running":!0,"selector":{"mode":"css","selection":["#map-filter-box"]},"type":["click"],"handler":""},{"name":"search_autocomplete_input","running":!0,"selector":{"mode":"css","selection":["#ls-search","#ls-search-landing"]},"type":["input"],"handler":"runDataGatherer.attributes.input = runDataGatherer.element.value;"},{"name":"detail_view","running":!0,"selector":{"mode":"css","selection":["body"]},"type":["inview"],"handler":"if (location.pathname.indexOf('\/deals\/') === 0 && location.pathname.split('\/').length === 3) {if (window.hasOwnProperty('payload')) {runDataGatherer.attributes.id = payload.dealUuid;} else {runDataGatherer.attributes.url = location.href.split('#').pop();}runDataGatherer.sendLazyEvent();} else {runDataGatherer.lock = true;}"},{"name":"basket_add","running":!0,"selector":{"mode":"css","selection":["[data-bhw=BuyButton]","[data-bhw=getawaysBookButton]","#add-to-cart","[data-bhw=getawaysContinueButton]"]},"type":["click"],"handler":"if (location.pathname.indexOf('\/deals\/') === 0 && location.pathname.split('\/').length === 3 && payload) {runDataGatherer.attributes.id = payload.dealUuid;} else {runDataGatherer.lock = true;}"},{"name":"user_merge","running":!0,"selector":{"mode":"css","selection":["body"]},"type":["inview"],"handler":"if (window.hasOwnProperty('__LS_INITIAL_STATE__')) {var id = __LS_INITIAL_STATE__.auth.user.id;if (id) {runDataGatherer.attributes.id = id;} else {runDataGatherer.lock = true;}} else {runDataGatherer.lock = true;}"},{"name":"user_merge","running":!1,"selector":{"mode":"css","selection":["body"]},"type":["inview"],"handler":"var id = runDataGatherer.loadCookie({'mode': 'specific','parameters': ['c']})['c'];if (id) {runDataGatherer.attributes.id = id;} else {runDataGatherer.lock = true;}"},{"name":"user_merge","running":!0,"selector":{"mode":"css","selection":["body"]},"type":["inview"],"handler":"if (window.hasOwnProperty('__NEXT_DATA__')) {var obj = __NEXT_DATA__['props']['pageProps']['__APOLLO_STATE__'];for (let key in obj) {if (key.indexOf('UserInfo:') >= 0) {runDataGatherer.attributes.id = obj[key]['id'];break;}runDataGatherer.lock = true;}} else {runDataGatherer.lock = true;}"},{"name":"purchase","running":!0,"selector":{"mode":"css","selection":["[data-bhw=CompleteOrderButton]","[data-bhw=PayPal_PlaceOrder_CTA]","[data-bhw=googlepay-button]","[data-bhw=BottomProceedToCheckout]","#cart-overview-container .google-pay-button-container button"]},"type":["click"],"handler":"var items = [];document.querySelectorAll('#items li').forEach(function(el) {items.push({'id': el.querySelector('a').getAttribute('href').split('\/').pop(),'price': parseFloat(el.querySelector('p:last-child.relative.whitespace-nowrap.font-extrabold').innerText),'quantity': parseFloat(el.querySelector('.ml-1.font-bold').innerText.replace('x', ''))});});sessionStorage.setItem('db_basket', JSON.stringify(items));runDataGatherer.lock = true;"},{"name":"purchase","running":!0,"selector":{"mode":"css","selection":["[data-bhw=CompleteOrderButton]","[data-bhw=PayPal_PlaceOrder_CTA]","[data-bhw=googlepay-button]"]},"type":["click"],"handler":"var items = [];var data = JSON.parse(gtmData.data)[0];var ids = data['dl_deal_option_uuid'].split(',');var prices = data['dl_deal_price'].split(',');var quantities = data['dl_quantity'].split(',');ids.forEach(function(id, num) {items.push({'id': id,'price': parseFloat(prices[num]) * 100,'quantity': parseFloat(quantities[num])});});sessionStorage.setItem('db_basket', JSON.stringify(items));runDataGatherer.lock = true;"},{"name":"purchase","running":!0,"selector":{"mode":"css","selection":["body"]},"type":["inview"],"handler":"if (location.pathname.indexOf('\/receipt\/') === 0 && sessionStorage.getItem('db_basket')) {var orderId = location.pathname.split('\/').pop();var items = JSON.parse(sessionStorage.getItem('db_basket'));items.forEach(function(item) {runDataGatherer.sendCustomEvent('purchase', 'inview', {'id': item.id,'price': item.price,'quantity': item.quantity,'order': orderId});});sessionStorage.removeItem('db_basket');}runDataGatherer.lock = true;"},{"name":"homepage_featured_position_view","running":!0,"selector":{"mode":"css","selection":["#small-featured"]},"type":["inview"],"handler":"var id = 'homepage_featured_position_view';if (runIndividualizer.durationLock && !runIndividualizer.durationLock.hasOwnProperty(id)) {runIndividualizer.durationLock[id] = true;runDataGatherer.attributes.duration = (new Date().getTime() - runIndividualizer.startTime);runDataGatherer.attributes.group = JSON.stringify(runIndividualizer.abTests).indexOf('\"recommendation\"') > 0 ? 'recommendation' : 'original';} else {runDataGatherer.lock = true;}"},{"name":"homepage_featured_view","running":!0,"selector":{"mode":"css","selection":["#small-featured figure"]},"type":["inview"],"handler":"if (location.pathname === '\/') {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"homepage_featured_view","running":!0,"selector":{"mode":"css","selection":["[data-bhw=HomeDesktopCards] > div:first-child a[data-bhc]"]},"root_selector":{"mode":"css","selection":"[data-bhw=HomeDesktopCards] > div:first-child"},"type":["inview"],"handler":"if (location.pathname === '\/') {var el = runDataGatherer.element;runDataGatherer.attributes.id = el.getAttribute('data-bhc').split(':').pop();runDataGatherer.attributes.image_link = el.querySelector('img.object-cover').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('h3').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"homepage_featured_click","running":!0,"selector":{"mode":"css","selection":["#small-featured figure a"]},"type":["click"],"handler":"if (location.pathname === '\/') {runDataGatherer.attributes.id = runDataGatherer.element.closest('figure').getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element.closest('figure');runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"homepage_featured_click","running":!0,"selector":{"mode":"css","selection":["[data-bhw=HomeDesktopCards] > div:first-child a[data-bhc]"]},"type":["click"],"handler":"if (location.pathname === '\/') {if ((runDataGatherer.nativeEvent.target.tagName === 'path' && runDataGatherer.nativeEvent.target.parentElement.parentElement.tagName === 'BUTTON') || (runDataGatherer.nativeEvent.target.tagName === 'svg' && runDataGatherer.nativeEvent.target.parentElement.tagName === 'BUTTON') || runDataGatherer.nativeEvent.target.tagName === 'BUTTON') {runDataGatherer.lock = true;} else {var el = runDataGatherer.element;runDataGatherer.attributes.id = el.getAttribute('data-bhc').split(':').pop();runDataGatherer.attributes.image_link = el.querySelector('img.object-cover').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('h3').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);}} else {runDataGatherer.lock = true;}"},{"name":"homepage_popular_view","running":!0,"selector":{"mode":"css","selection":["#popular-on-groupon figure"]},"type":["inview"],"handler":"if (location.pathname === '\/') {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"homepage_popular_view","running":!0,"selector":{"mode":"css","selection":["[data-bhw=HomeDesktopCards] > div:last-child a[data-bhc]"]},"type":["inview"],"handler":"if (location.pathname === '\/') {var el = runDataGatherer.element;runDataGatherer.attributes.id = el.getAttribute('data-bhc').split(':').pop();runDataGatherer.attributes.image_link = el.querySelector('img.object-cover').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('h3').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"homepage_popular_click","running":!0,"selector":{"mode":"css","selection":["#popular-on-groupon figure a"]},"type":["click"],"handler":"if (location.pathname === '\/') {runDataGatherer.attributes.id = runDataGatherer.element.closest('figure').getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element.closest('figure');runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"homepage_popular_click","running":!0,"selector":{"mode":"css","selection":["[data-bhw=HomeDesktopCards] > div:last-child a[data-bhc]"]},"type":["click"],"handler":"if (location.pathname === '\/') {if ((runDataGatherer.nativeEvent.target.tagName === 'path' && runDataGatherer.nativeEvent.target.parentElement.parentElement.tagName === 'BUTTON') || (runDataGatherer.nativeEvent.target.tagName === 'svg' && runDataGatherer.nativeEvent.target.parentElement.tagName === 'BUTTON') || runDataGatherer.nativeEvent.target.tagName === 'BUTTON') {runDataGatherer.lock = true;} else {var el = runDataGatherer.element;runDataGatherer.attributes.id = el.getAttribute('data-bhc').split(':').pop();runDataGatherer.attributes.image_link = el.querySelector('img.object-cover').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('h3').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);}} else {runDataGatherer.lock = true;}"},{"name":"homepage_all_view","running":!0,"selector":{"mode":"css","selection":["#all-deals figure"]},"type":["inview"],"handler":"if (location.pathname === '\/') {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"homepage_all_click","running":!0,"selector":{"mode":"css","selection":["#all-deals figure a"]},"type":["click"],"handler":"if (location.pathname === '\/') {runDataGatherer.attributes.id = runDataGatherer.element.closest('figure').getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element.closest('figure');runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"category_position_view","running":!0,"selector":{"mode":"css","selection":["#pull-deal-feed"]},"type":["inview"],"handler":"var query = runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query;if (!query && LS_Mustache_Params && LS_Mustache_Params.gigConfig) {var id = 'category_position_view';if (runIndividualizer.durationLock && !runIndividualizer.durationLock.hasOwnProperty(id)) {runIndividualizer.durationLock[id] = true;runDataGatherer.attributes.duration = (new Date().getTime() - runIndividualizer.startTime);runDataGatherer.attributes.group = JSON.stringify(runIndividualizer.abTests).indexOf('\"recommendation\"') > 0 ? 'recommendation' : 'original';} else {runDataGatherer.lock = true;}} else {runDataGatherer.lock = true;}"},{"name":"category_view","running":!0,"selector":{"mode":"css","selection":["#pull-deal-feed figure[data-bhc]"]},"type":["inview"],"handler":"var query = runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query;if (!query && LS_Mustache_Params && LS_Mustache_Params.gigConfig) {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"category_click","running":!0,"selector":{"mode":"css","selection":["#pull-deal-feed figure a"]},"type":["click"],"handler":"var query = runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query;if (!query && LS_Mustache_Params && LS_Mustache_Params.gigConfig) {runDataGatherer.attributes.id = runDataGatherer.element.closest('figure').getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element.closest('figure');runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"category_mobile_position_view","running":!0,"selector":{"mode":"css","selection":["#pull-mobile-cards"]},"type":["inview"],"handler":"var query = runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query;if (!query && LS_Mustache_Params && LS_Mustache_Params.mobileConfig) {var id = 'category_mobile_position_view';if (runIndividualizer.durationLock && !runIndividualizer.durationLock.hasOwnProperty(id)) {runIndividualizer.durationLock[id] = true;runDataGatherer.attributes.duration = (new Date().getTime() - runIndividualizer.startTime);runDataGatherer.attributes.group = JSON.stringify(runIndividualizer.abTests).indexOf('\"recommendation\"') > 0 ? 'recommendation' : 'original';} else {runDataGatherer.lock = true;}} else {runDataGatherer.lock = true;}"},{"name":"category_mobile_view","running":!0,"selector":{"mode":"css","selection":["#pull-mobile-cards figure[data-bhc*='deal:']"]},"type":["inview"],"handler":"var query = runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query;if (!query && LS_Mustache_Params && LS_Mustache_Params.mobileConfig) {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"category_mobile_click","running":!0,"selector":{"mode":"css","selection":["#pull-mobile-cards figure a"]},"type":["click"],"handler":"var query = runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query;if (!query && LS_Mustache_Params && LS_Mustache_Params.mobileConfig) {runDataGatherer.attributes.id = runDataGatherer.element.closest('figure').getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element.closest('figure');runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);runDataGatherer.storeLazyEvent('category_mobile_click', 'click', {'id': runDataGatherer.attributes.id,'image_link': runDataGatherer.attributes.image_link,'title': runDataGatherer.attributes.title,'order': runDataGatherer.attributes.order});runDataGatherer.lock = true;} else {runDataGatherer.lock = true;}"},{"name":"category_occasion_position_view","running":!0,"selector":{"mode":"css","selection":["#result-list"]},"type":["inview"],"handler":"var query = runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query;if (!query && LS_Mustache_Params && LS_Mustache_Params.gigConfig) {var id = 'category_occasion_position_view';if (runIndividualizer.durationLock && !runIndividualizer.durationLock.hasOwnProperty(id)) {runIndividualizer.durationLock[id] = true;runDataGatherer.attributes.duration = (new Date().getTime() - runIndividualizer.startTime);runDataGatherer.attributes.group = JSON.stringify(runIndividualizer.abTests).indexOf('\"recommendation\"') > 0 ? 'recommendation' : 'original';} else {runDataGatherer.lock = true;}} else {runDataGatherer.lock = true;}"},{"name":"category_occasion_view","running":!0,"selector":{"mode":"css","selection":["#result-list figure[data-bhc]:not(.cui-collection-pagination)"]},"type":["inview"],"handler":"var query = runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query;if (!query && LS_Mustache_Params && LS_Mustache_Params.gigConfig) {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('.cui-image-lazy-container img').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();if (el.closest('li')) {el = el.closest('li');}runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"category_occasion_click","running":!0,"selector":{"mode":"css","selection":["#result-list figure:not(.cui-collection-pagination) a"]},"type":["click"],"handler":"var query = runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query;if (!query && LS_Mustache_Params && LS_Mustache_Params.gigConfig) {runDataGatherer.attributes.id = runDataGatherer.element.closest('figure').getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element.closest('figure');runDataGatherer.attributes.image_link = el.querySelector('.cui-image-lazy-container img').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();if (el.closest('li')) {el = el.closest('li');}runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"category_mobile_occasion_position_view","running":!0,"selector":{"mode":"css","selection":["#result-list"]},"type":["inview"],"handler":"var query = runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query;if (!query && LS_Mustache_Params && LS_Mustache_Params.mobileConfig) {var id = 'category_mobile_occasion_position_view';if (runIndividualizer.durationLock && !runIndividualizer.durationLock.hasOwnProperty(id)) {runIndividualizer.durationLock[id] = true;runDataGatherer.attributes.duration = (new Date().getTime() - runIndividualizer.startTime);runDataGatherer.attributes.group = JSON.stringify(runIndividualizer.abTests).indexOf('\"recommendation\"') > 0 ? 'recommendation' : 'original';} else {runDataGatherer.lock = true;}} else {runDataGatherer.lock = true;}"},{"name":"category_mobile_occasion_view","running":!0,"selector":{"mode":"css","selection":["#result-list figure[data-bhc]:not(.cui-collection-pagination)"]},"type":["inview"],"handler":"var query = runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query;if (!query && LS_Mustache_Params && LS_Mustache_Params.mobileConfig) {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"category_mobile_occasion_click","running":!0,"selector":{"mode":"css","selection":["#result-list figure:not(.cui-collection-pagination) a"]},"type":["click"],"handler":"var query = runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query;if (!query && LS_Mustache_Params && LS_Mustache_Params.mobileConfig) {runDataGatherer.attributes.id = runDataGatherer.element.closest('figure').getAttribute('data-bhc').split(':').pop();runDataGatherer.storeLazyEvent('category_mobile_occasion_click', 'click', {'id': runDataGatherer.attributes.id});var el = runDataGatherer.element.closest('figure');runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);runDataGatherer.lock = true;} else {runDataGatherer.lock = true;}"},{"name":"category_getaways_position_view","running":!0,"selector":{"mode":"css","selection":["#flash-deals"]},"type":["inview"],"handler":"var query = runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query;if (!query && LS_Mustache_Params && LS_Mustache_Params.gigConfig) {var id = 'category_getaways_position_view';if (runIndividualizer.durationLock && !runIndividualizer.durationLock.hasOwnProperty(id)) {runIndividualizer.durationLock[id] = true;runDataGatherer.attributes.duration = (new Date().getTime() - runIndividualizer.startTime);runDataGatherer.attributes.group = JSON.stringify(runIndividualizer.abTests).indexOf('\"recommendation\"') > 0 ? 'recommendation' : 'original';} else {runDataGatherer.lock = true;}} else {runDataGatherer.lock = true;}"},{"name":"category_getaways_view","running":!0,"selector":{"mode":"css","selection":["#flash-deals figure[data-bhc]:not(.cui-collection-pagination)"]},"type":["inview"],"handler":"var query = runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query;if (!query && LS_Mustache_Params && LS_Mustache_Params.gigConfig) {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('.cui-image-lazy-container img').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"category_getaways_click","running":!0,"selector":{"mode":"css","selection":["#flash-deals figure:not(.cui-collection-pagination) a"]},"type":["click"],"handler":"var query = runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query;if (!query && LS_Mustache_Params && LS_Mustache_Params.gigConfig) {runDataGatherer.attributes.id = runDataGatherer.element.closest('figure').getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element.closest('figure');runDataGatherer.attributes.image_link = el.querySelector('.cui-image-lazy-container img').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"search_position_view","running":!0,"selector":{"mode":"css","selection":["#pull-deal-feed"]},"type":["inview"],"handler":"var query = runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query;if (query) {var id = 'search_position_view';if (runIndividualizer.durationLock && !runIndividualizer.durationLock.hasOwnProperty(id)) {runIndividualizer.durationLock[id] = true;runDataGatherer.attributes.duration = (new Date().getTime() - runIndividualizer.startTime);runDataGatherer.attributes.group = JSON.stringify(runIndividualizer.abTests).indexOf('\"recommendation\"') > 0 ? 'recommendation' : 'original';} else {runDataGatherer.lock = true;}} else {runDataGatherer.lock = true;}"},{"name":"search_view","running":!0,"selector":{"mode":"css","selection":["#pull-deal-feed figure[data-bhc]"]},"type":["inview"],"handler":"var query = runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query;if (query) {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"search_click","running":!0,"selector":{"mode":"css","selection":["#pull-deal-feed figure a"]},"type":["click"],"handler":"var query = runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query;if (query) {runDataGatherer.attributes.id = runDataGatherer.element.closest('figure').getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element.closest('figure');runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"search_mobile_position_view","running":!0,"selector":{"mode":"css","selection":["#pull-mobile-cards"]},"type":["inview"],"handler":"var query = runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query;if (query) {var id = 'search_mobile_position_view';if (runIndividualizer.durationLock && !runIndividualizer.durationLock.hasOwnProperty(id)) {runIndividualizer.durationLock[id] = true;runDataGatherer.attributes.duration = (new Date().getTime() - runIndividualizer.startTime);runDataGatherer.attributes.group = JSON.stringify(runIndividualizer.abTests).indexOf('\"recommendation\"') > 0 ? 'recommendation' : 'original';} else {runDataGatherer.lock = true;}} else {runDataGatherer.lock = true;}"},{"name":"search_mobile_view","running":!0,"selector":{"mode":"css","selection":["#pull-mobile-cards figure[data-bhc*='deal:']"]},"type":["inview"],"handler":"var query = runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query;if (query) {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"search_mobile_click","running":!0,"selector":{"mode":"css","selection":["#pull-mobile-cards figure a"]},"type":["click"],"handler":"var query = runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query;if (query) {runDataGatherer.attributes.id = runDataGatherer.element.closest('figure').getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element.closest('figure');runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"search_autocomplete_view","running":!0,"selector":{"mode":"css","selection":["#db_search_autocomplete a"]},"type":["inview"],"handler":"if (LS_Mustache_Params && LS_Mustache_Params.gigConfig) {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('img').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el.closest('.css-1dbjc4n'));} else {runDataGatherer.lock = true;}"},{"name":"search_autocomplete_view","running":!0,"selector":{"mode":"css","selection":[".w-searchModal article"]},"type":["inview"],"handler":"var el = runDataGatherer.element.closest('a');runDataGatherer.attributes.url = el.href;runDataGatherer.attributes.image_link = el.querySelector('img').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('h3').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);"},{"name":"search_autocomplete_click","running":!0,"selector":{"mode":"css","selection":["#db_search_autocomplete a"]},"type":["click"],"handler":"if (LS_Mustache_Params && LS_Mustache_Params.gigConfig) {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('img').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el.closest('.css-1dbjc4n'));} else {runDataGatherer.lock = true;}"},{"name":"search_autocomplete_click","running":!0,"selector":{"mode":"css","selection":[".w-searchModal article"]},"type":["click"],"handler":"if ((runDataGatherer.nativeEvent.target.tagName === 'path' && runDataGatherer.nativeEvent.target.parentElement.parentElement.tagName === 'BUTTON') || (runDataGatherer.nativeEvent.target.tagName === 'svg' && runDataGatherer.nativeEvent.target.parentElement.tagName === 'BUTTON') || runDataGatherer.nativeEvent.target.tagName === 'BUTTON') {runDataGatherer.lock = true;} else {var el = runDataGatherer.element.closest('a');runDataGatherer.attributes.url = el.href;runDataGatherer.attributes.image_link = el.querySelector('img').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('h3').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);}"},{"name":"search_autocomplete_mobile_view","running":!0,"selector":{"mode":"css","selection":["#db_search_autocomplete_mobile a"]},"type":["inview"],"handler":"if (LS_Mustache_Params && LS_Mustache_Params.mobileConfig) {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('img').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el.closest('.css-1dbjc4n'));} else {runDataGatherer.lock = true;}"},{"name":"search_autocomplete_mobile_click","running":!0,"selector":{"mode":"css","selection":["#db_search_autocomplete_mobile a"]},"type":["click"],"handler":"if (LS_Mustache_Params && LS_Mustache_Params.mobileConfig) {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('img').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el.closest('.css-1dbjc4n'));} else {runDataGatherer.lock = true;}"},{"name":"homepage_mobile_directly_view","running":!0,"selector":{"mode":"css","selection":["[data-bhc='compound:homepage_flexible_touch_customer_affinity_widget'] figure"]},"type":["inview"],"handler":"if (location.pathname === '\/') {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"homepage_mobile_directly_click","running":!0,"selector":{"mode":"css","selection":["[data-bhc='compound:homepage_flexible_touch_customer_affinity_widget'] figure a"]},"type":["click"],"handler":"if (location.pathname === '\/') {runDataGatherer.attributes.id = runDataGatherer.element.closest('figure').getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element.closest('figure');runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"homepage_mobile_feed_view","running":!0,"selector":{"mode":"css","selection":["#main-feed > figure[data-bhc*='deal:']"]},"type":["inview"],"handler":"if (location.pathname === '\/') {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"homepage_mobile_feed_click","running":!0,"selector":{"mode":"css","selection":["#main-feed > figure[data-bhc*='deal:'] a"]},"type":["click"],"handler":"if (location.pathname === '\/') {runDataGatherer.attributes.id = runDataGatherer.element.closest('figure').getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element.closest('figure');runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"homepage_mobile_inspired_by_history_view","running":!0,"selector":{"mode":"css","selection":["[data-bhc='compound:homepage_touch_richrelevance_placement2'] figure"]},"type":["inview"],"handler":"if (location.pathname === '\/') {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"homepage_mobile_inspired_by_history_click","running":!0,"selector":{"mode":"css","selection":["[data-bhc='compound:homepage_touch_richrelevance_placement2'] figure a"]},"type":["click"],"handler":"if (location.pathname === '\/') {runDataGatherer.attributes.id = runDataGatherer.element.closest('figure').getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element.closest('figure');runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"homepage_mobile_news_view","running":!0,"selector":{"mode":"css","selection":["[data-bhc='compound:homepage_flexible_touch_new_deals_widget'] figure"]},"type":["inview"],"handler":"if (location.pathname === '\/') {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"homepage_mobile_news_click","running":!0,"selector":{"mode":"css","selection":["[data-bhc='compound:homepage_flexible_touch_new_deals_widget'] figure a"]},"type":["click"],"handler":"if (location.pathname === '\/') {runDataGatherer.attributes.id = runDataGatherer.element.closest('figure').getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element.closest('figure');runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"homepage_mobile_category_1_view","running":!0,"selector":{"mode":"css","selection":["[data-bhc='compound:homepage_flexible_touch_category_carousel_1'] figure"]},"type":["inview"],"handler":"if (location.pathname === '\/') {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"homepage_mobile_category_1_click","running":!0,"selector":{"mode":"css","selection":["[data-bhc='compound:homepage_flexible_touch_category_carousel_1'] figure a"]},"type":["click"],"handler":"if (location.pathname === '\/') {runDataGatherer.attributes.id = runDataGatherer.element.closest('figure').getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element.closest('figure');runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"homepage_mobile_category_2_view","running":!0,"selector":{"mode":"css","selection":["[data-bhc='compound:homepage_flexible_touch_category_carousel_2'] figure"]},"type":["inview"],"handler":"if (location.pathname === '\/') {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"homepage_mobile_category_2_click","running":!0,"selector":{"mode":"css","selection":["[data-bhc='compound:homepage_flexible_touch_category_carousel_2'] figure a"]},"type":["click"],"handler":"if (location.pathname === '\/') {runDataGatherer.attributes.id = runDataGatherer.element.closest('figure').getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element.closest('figure');runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"homepage_mobile_category_3_view","running":!0,"selector":{"mode":"css","selection":["[data-bhc='compound:homepage_flexible_touch_category_carousel_3'] figure"]},"type":["inview"],"handler":"if (location.pathname === '\/') {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"homepage_mobile_category_3_click","running":!0,"selector":{"mode":"css","selection":["[data-bhc='compound:homepage_flexible_touch_category_carousel_3'] figure a"]},"type":["click"],"handler":"if (location.pathname === '\/') {runDataGatherer.attributes.id = runDataGatherer.element.closest('figure').getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element.closest('figure');runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"product_detail_1_view","running":!0,"selector":{"mode":"css","selection":["#db_product_detail_1 figure","#cards-bottom-placeholder figure[data-bhc='compound:crossChannel_dealpage_richrelevance_rr_recs1'] figure"]},"root_selector":{"mode":"css","selection":".cui-c-compound .cui-cards-wrapper"},"type":["inview"],"handler":"if (LS_Mustache_Params && LS_Mustache_Params.gigConfig) {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"product_detail_1_view","running":!0,"selector":{"mode":"css","selection":["#cards-bottom-placeholder figure"]},"type":["inview"],"handler":"if (LS_Mustache_Params && (LS_Mustache_Params.gigConfig || LS_Mustache_Params.mobileConfig)) {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"product_detail_1_click","running":!0,"selector":{"mode":"css","selection":["#db_product_detail_1 figure a","#cards-bottom-placeholder figure[data-bhc='compound:crossChannel_dealpage_richrelevance_rr_recs1'] figure a"]},"type":["click"],"handler":"if (LS_Mustache_Params && LS_Mustache_Params.gigConfig) {runDataGatherer.attributes.id = runDataGatherer.element.closest('figure').getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element.closest('figure');runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"product_detail_1_click","running":!0,"selector":{"mode":"css","selection":["#cards-bottom-placeholder figure a"]},"type":["click"],"handler":"if (LS_Mustache_Params && (LS_Mustache_Params.gigConfig || LS_Mustache_Params.mobileConfig)) {runDataGatherer.attributes.id = runDataGatherer.element.closest('figure').getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element.closest('figure');runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"product_detail_mobile_1_view","running":!0,"selector":{"mode":"css","selection":["#db_product_detail_mobile_1 figure","#cards-bottom-placeholder figure[data-bhc='compound:crossChannel_dealpage_richrelevance_rr_recs1'] figure"]},"type":["inview"],"handler":"if (LS_Mustache_Params && LS_Mustache_Params.mobileConfig) {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"product_detail_mobile_1_click","running":!0,"selector":{"mode":"css","selection":["#db_product_detail_mobile_1 figure a","#cards-bottom-placeholder figure[data-bhc='compound:crossChannel_dealpage_richrelevance_rr_recs1'] figure a"]},"type":["click"],"handler":"if (LS_Mustache_Params && LS_Mustache_Params.mobileConfig) {runDataGatherer.attributes.id = runDataGatherer.element.closest('figure').getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element.closest('figure');runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"product_detail_2_view","running":!0,"selector":{"mode":"css","selection":["#db_product_detail_2 figure","#cards-bottom-placeholder figure[data-bhc='compound:crossChannel_dealpage_richrelevance_rr_recs2'] figure"]},"root_selector":{"mode":"css","selection":".cui-c-compound .cui-cards-wrapper"},"type":["inview"],"handler":"if (LS_Mustache_Params && LS_Mustache_Params.gigConfig) {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"product_detail_2_click","running":!0,"selector":{"mode":"css","selection":["#db_product_detail_2 figure a","#cards-bottom-placeholder figure[data-bhc='compound:crossChannel_dealpage_richrelevance_rr_recs2'] figure a"]},"type":["click"],"handler":"if (LS_Mustache_Params && LS_Mustache_Params.gigConfig) {runDataGatherer.attributes.id = runDataGatherer.element.closest('figure').getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element.closest('figure');runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"product_detail_mobile_2_view","running":!0,"selector":{"mode":"css","selection":["#db_product_detail_mobile_2 figure","#cards-bottom-placeholder figure[data-bhc='compound:crossChannel_dealpage_richrelevance_rr_recs2'] figure"]},"type":["inview"],"handler":"if (LS_Mustache_Params && LS_Mustache_Params.mobileConfig) {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"product_detail_mobile_2_click","running":!0,"selector":{"mode":"css","selection":["#db_product_detail_mobile_2 figure a","#cards-bottom-placeholder figure[data-bhc='compound:crossChannel_dealpage_richrelevance_rr_recs2'] figure a"]},"type":["click"],"handler":"if (LS_Mustache_Params && LS_Mustache_Params.mobileConfig) {runDataGatherer.attributes.id = runDataGatherer.element.closest('figure').getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element.closest('figure');runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"product_detail_3_view","running":!0,"selector":{"mode":"css","selection":["#db_product_detail_3 figure"]},"root_selector":{"mode":"css","selection":".cui-c-compound .cui-cards-wrapper"},"type":["inview"],"handler":"if (LS_Mustache_Params && LS_Mustache_Params.gigConfig) {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"product_detail_3_click","running":!0,"selector":{"mode":"css","selection":["#db_product_detail_3 figure a"]},"type":["click"],"handler":"if (LS_Mustache_Params && LS_Mustache_Params.gigConfig) {runDataGatherer.attributes.id = runDataGatherer.element.closest('figure').getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element.closest('figure');runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"product_detail_mobile_3_view","running":!0,"selector":{"mode":"css","selection":["#db_product_detail_mobile_3 figure"]},"type":["inview"],"handler":"if (LS_Mustache_Params && LS_Mustache_Params.mobileConfig) {runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"product_detail_mobile_3_click","running":!0,"selector":{"mode":"css","selection":["#db_product_detail_mobile_3 figure a"]},"type":["click"],"handler":"if (LS_Mustache_Params && LS_Mustache_Params.mobileConfig) {runDataGatherer.attributes.id = runDataGatherer.element.closest('figure').getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element.closest('figure');runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);} else {runDataGatherer.lock = true;}"},{"name":"basket_view","running":!0,"selector":{"mode":"css","selection":["#db_basket figure"]},"root_selector":{"mode":"css","selection":".cui-c-compound .cui-cards-wrapper"},"type":["inview"],"handler":"runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);"},{"name":"basket_click","running":!0,"selector":{"mode":"css","selection":["#db_basket figure a"]},"type":["click"],"handler":"runDataGatherer.attributes.id = runDataGatherer.element.closest('figure').getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element.closest('figure');runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);"},{"name":"basket_mobile_view","running":!0,"selector":{"mode":"css","selection":["#db_basket_mobile figure"]},"type":["inview"],"handler":"runDataGatherer.attributes.id = runDataGatherer.element.getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element;runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);"},{"name":"basket_mobile_click","running":!0,"selector":{"mode":"css","selection":["#db_basket_mobile figure a"]},"type":["click"],"handler":"runDataGatherer.attributes.id = runDataGatherer.element.closest('figure').getAttribute('data-bhc').split(':').pop();var el = runDataGatherer.element.closest('figure');runDataGatherer.attributes.image_link = el.querySelector('.cui-image').getAttribute('src');runDataGatherer.attributes.title = el.querySelector('.cui-udc-title').innerText.trim();runDataGatherer.attributes.order = runDataGatherer.getIndex(el);"},{"name":"capture_abtestgroup","running":!0,"selector":{"mode":"","selection":[]},"type":["fetch"],"handler":"var eventUrl = runDataGatherer.nativeEvent[0];if (eventUrl != null && (typeof eventUrl === 'string' || eventUrl instanceof String) && eventUrl.indexOf('client-rapi-us-west.recombee.com') != -1) {var event = runDataGatherer.nativeEvent[1];if (event.body != null) {var bodyJson = JSON.parse(event.body);if (bodyJson.additionalData != null) {runDataGatherer.attributes.recombeeTestEnabled = bodyJson.additionalData.abTestEnabled;runDataGatherer.attributes.recombeeTestGroup = bodyJson.additionalData.abGroup;}}}if (runDataGatherer.attributes.recombeeTestEnabled == null) {runDataGatherer.lock = true;}"}],"point":!0}};return JSON.parse(JSON.stringify(i))}catch(e){this.errorHandler(e,"getConfig")}},getAccountId:function(){return"groupon_us"},getUrl:function(){return"https://api.databreakers.com/v1/groupon_us/dataPoint"},getUrlGathererDataProvider:function(){return"https://publicapi.databreakers.com/v2/gatherer-data-provider"},getVersionOfScript:function(){return 1694720888},getVersionOfConfig:function(){return 1697807472},errorHandler:function(e,r,a,t){try{if(t)return;if(["warning","error"].indexOf(this.gathererLogLevel)>=0){var n=this.prepareOuput(this.getConfig(),!0);n["dataPoints"][0]["attributes"]["message_type"]="error";n["dataPoints"][0]["attributes"]["error_name"]=e.name;n["dataPoints"][0]["attributes"]["error_message"]="area: "+r+", "+e.message;if(a&&getPropertyNames(a).length!==0){n.dataPoints[0].attributes.original_request={"type":a.type,"method":a.method,"source_url":{"page":a.url}};if(a.hasOwnProperty("body")){n.dataPoints[0].attributes.original_request.body=JSON.stringify(a.body,null)}};var s=this.createCORSRequest("POST",this.getUrl());s.onerror=function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();s.onerror=null;return!1};if(s){s.send(JSON.stringify(n))}}}catch(i){}},warningHandler:function(e){try{if(this.gathererLogLevel==="warning"){var a={"dataPoints":[{"attributes":{"script_id":this.gathererScriptId,"script_version":this.getVersionOfScript(),"config_version":this.getVersionOfConfig(),"script_type":"gatherer","source_url":{"page":location.href},"user_agent":navigator.userAgent,"message_type":"warning","warning_type":"not_possible_to_read","warning_message":"It is not possible to read: "+e}}]};var r=this.createCORSRequest("POST",this.getUrl());r.onerror=function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();r.onerror=null;return!1};if(r){r.send(JSON.stringify(a))}}}catch(i){}},main:function(){try{var i=this.getConfig();this.gathererScriptId=i["script_id"];this.gathererLogLevel=i["log_level"];if(i["running"]&&this.resolveRunConditions(i["run_conditions"]["expressions"])){if(!window.hasOwnProperty("runIndividualizer")){this.initPolyfills();this.initInView()};if(i.hasOwnProperty("variables")){eval(i["variables"])};if(i.hasOwnProperty("declarations")){eval(i["declarations"])};this.setRemoteData();this.initReporting(i,this.getUrl());this.updateCookieExpiration()}}catch(e){this.errorHandler(e,"main")}},makeCorsRequest:function(e,r,a,t,s,l){try{var n=this.createCORSRequest(a,r),d=this;if(!n){console.log("CORS not supported");return};if(e["dataPoints"]){n.body=e["dataPoints"][0]};n.onreadystatechange=function(){if(typeof t=="function"&&n.readyState===n.DONE&&[200,204].indexOf(n.status)>=0){t(n)}};n.onerror=function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();n.onerror=null;d.errorHandler(e,"makeCorsRequest",n,l);return!1};n.send(JSON.stringify(e))}catch(i){}},initReporting:function(e,a){var i=this;try{e["events"]["groups"].forEach(function(r){if(!r.hasOwnProperty("running")||r["running"]){r["type"].forEach(function(t){if(t==="inview"){var n=function(t){try{i.element=t;i.event={};i.event["type"]="inview";i.event["threshold"]=r.hasOwnProperty("threshold")?r["threshold"]:0;i.event["name"]=r["name"];i.event["selector"]={};i.event["selector"]["mode"]=r["selector"]["mode"];if(r["selector"]["mode"]==="xpath"){i.event["selector"]["selection"]=i.getElementTreeXPath(i.element)}
else{i.event["selector"]["selection"]=i.getElementTreeCss(i.element)};i.lock=!1;i.attributes={};eval(r["handler"]);if(i.lock)return;if(getPropertyNames(i.attributes).length!==0){i.event["attributes"]=i.attributes};var s=i.prepareOuput(e);s["dataPoints"][0]["attributes"]["event"]=i.event;var d=e["batch_event_type_black_list"].indexOf("inview")<0,u=e["batch_event_type_white_list"].length==0||e["batch_event_type_white_list"].indexOf("inview")>=0;if(e["batch_time"]!=0&&d&&u){var l={"attributes":{"event":s["dataPoints"][0]["attributes"]["event"],"global_variables":s["dataPoints"][0]["attributes"]["global_variables"],"custom_attributes":s["dataPoints"][0]["attributes"]["custom_attributes"]}};if(i.dataPoints.length>0){i.dataPoints.push(l)}
else{delete s["dataPoints"][0]["attributes"]["event"];delete s["dataPoints"][0]["attributes"]["global_variables"];delete s["dataPoints"][0]["attributes"]["custom_attributes"];i.dataPoints.push(l);i.sharedAttributes=s["dataPoints"][0]["attributes"];setTimeout(function(){i.makeCorsRequest({"dataPoints":i.dataPoints,"sharedAttributes":i.sharedAttributes},a,"POST",null,!0);i.dataPoints=[]},e["batch_time"])}}
else{i.makeCorsRequest(s,a,"POST",null,!0)}}catch(n){i.errorHandler(n,"initReporting callback inview, event: "+r["name"])}},o=function(){var e=[];r["selector"]["selection"].forEach(function(a){if(r["selector"]["mode"]==="xpath"){e=e.concat(i.selectElements(a))}
else{e=e.concat(Array.prototype.slice.call(document.querySelectorAll(a)))}});return e};i.appear({appear:n,bounds:r.hasOwnProperty("threshold")?r["threshold"]:0,getElements:o,reappearOption:r.hasOwnProperty("reappear")?r["reappear"]:!1,rootSelector:r.hasOwnProperty("root_selector")?r["root_selector"]:!1})};if(t==="pushState"){var n=function(){try{i.element=null;i.event={};i.event["type"]="pushState";i.event["name"]=r["name"];i.lock=!1;i.attributes={};eval(r["handler"]);if(i.lock)return;if(getPropertyNames(i.attributes).length!==0){i.event["attributes"]=i.attributes};var n=i.prepareOuput(e);n["dataPoints"][0]["attributes"]["event"]=i.event;i.makeCorsRequest(n,a,"POST",null,!0)}catch(t){i.errorHandler(t,"initReporting callback pushState, event: "+r["name"])}};if(i.pushStateCallbacks.length===0){var u=history.pushState;history.pushState=function(){u.apply(this,arguments);i.pushStateCallbacks.forEach(function(e){e()})}};i.pushStateCallbacks.push(n)};if(t==="fetch"){var n=function(t){try{i.element=null;i.event={};i.nativeEvent=t;i.event["type"]="fetch";i.event["name"]=r["name"];i.lock=!1;i.attributes={};eval(r["handler"]);if(i.lock)return;if(getPropertyNames(i.attributes).length!==0){i.event["attributes"]=i.attributes};var s=i.prepareOuput(e);s["dataPoints"][0]["attributes"]["event"]=i.event;i.makeCorsRequest(s,a,"POST",null,!0)}catch(n){i.errorHandler(n,"initReporting callback fetch, event: "+r["name"])}};if(i.fetchCallbacks.length===0){var d=window.fetch;window.fetch=function(){var e=arguments;i.fetchCallbacks.forEach(function(i){i(e)});return d.apply(this,arguments)}};i.fetchCallbacks.push(n)};if(t==="xhr"){var n=function(t){try{i.element=null;i.event={};i.nativeEvent=t;i.event["type"]="xhr";i.event["name"]=r["name"];i.lock=!1;i.attributes={};eval(r["handler"]);if(i.lock)return;if(getPropertyNames(i.attributes).length!==0){i.event["attributes"]=i.attributes};var s=i.prepareOuput(e);s["dataPoints"][0]["attributes"]["event"]=i.event;i.makeCorsRequest(s,a,"POST",null,!0)}catch(n){i.errorHandler(n,"initReporting callback xhr, event: "+r["name"])}};if(i.xhrCallbacks.length===0){var l=window.XMLHttpRequest.prototype.open;window.XMLHttpRequest.prototype.open=function(){var e=[].slice.call(arguments);i.xhrRequestOpenArguments=e;return l.apply(this,e)};var s=window.XMLHttpRequest.prototype.send;window.XMLHttpRequest.prototype.send=function(){var e=i.xhrRequestOpenArguments.concat([].slice.call(arguments));i.xhrCallbacks.forEach(function(i){i(e)});s.apply(this,arguments)}};i.xhrCallbacks.push(n)};if(t!=="inview"&&t!=="pushState"&&t!=="fetch"&&t!=="xhr"){var n=function(t){var d=[],c;r["selector"]["selection"].forEach(function(e){if(e=="document"){d.push(document)}
else{if(r["selector"]["mode"]==="xpath"){d=d.concat(i.selectElements(e))}
else{d=d.concat(Array.prototype.slice.call(document.querySelectorAll(e)))}}});for(var o=0;o<d.length;o++){try{var s;if(t.hasOwnProperty("path")&&Array.isArray(t.path)&&t.path.length>=2){s=t.path}
else{s=[];var u=t.target;while(u){s.push(u);u=u.parentElement};if(s.indexOf(window)===-1&&s.indexOf(document)===-1)s.push(document);if(s.indexOf(window)===-1)s.push(window)};c=s.indexOf(d[o]);if(c<0)continue;i.element=s[c];i.event={};i.nativeEvent=t;i.event["point"]=i.loadPoint(e["events"]["point"],t);i.event["type"]=t["type"];i.event["name"]=r["name"];i.event["selector"]={};i.event["selector"]["mode"]=r["selector"]["mode"];if(r["selector"]["mode"]==="xpath"){i.event["selector"]["selection"]=i.getElementTreeXPath(i.element)}
else{i.event["selector"]["selection"]=i.getElementTreeCss(i.element)};i.lock=!1;i.attributes={};eval(r["handler"]);if(i.lock)return;if(getPropertyNames(i.attributes).length!==0){i.event["attributes"]=i.attributes};var l=i.prepareOuput(e);l["dataPoints"][0]["attributes"]["event"]=i.event;var v=e["batch_event_type_black_list"].indexOf(t["type"])<0,m=e["batch_event_type_white_list"].length==0||e["batch_event_type_white_list"].indexOf(t["type"])>=0;if(e["batch_time"]!=0&&v&&m){var p={"attributes":{"event":l["dataPoints"][0]["attributes"]["event"],"global_variables":l["dataPoints"][0]["attributes"]["global_variables"],"custom_attributes":l["dataPoints"][0]["attributes"]["custom_attributes"]}};if(i.dataPoints.length>0){i.dataPoints.push(p)}
else{delete l["dataPoints"][0]["attributes"]["event"];delete l["dataPoints"][0]["attributes"]["global_variables"];delete l["dataPoints"][0]["attributes"]["custom_attributes"];i.dataPoints.push(p);i.sharedAttributes=l["dataPoints"][0]["attributes"];setTimeout(function(){i.makeCorsRequest({"dataPoints":i.dataPoints,"sharedAttributes":i.sharedAttributes},a,"POST",null,!0);i.dataPoints=[]},e["batch_time"])}}
else{i.makeCorsRequest(l,a,"POST",null,!0)};break}catch(n){i.errorHandler(n,"initReporting callback noinview, event: "+r["name"]);break}}};document.addEventListener(t,n,!0)}})}})}catch(r){this.errorHandler(r,"initReporting")}},createCORSRequest:function(e,r){try{var a=new XMLHttpRequest();if("withCredentials" in a){a.open(e,r);a.type="XMLHttpRequest"}
else if(typeof XDomainRequest!="undefined"){a=new XDomainRequest();a.open(e,r);a.type="XDomainRequest"}
else{return null};a.setRequestHeader("Content-Type","text/plain;charset=utf-8");a.url=r;a.method=e;return a}catch(i){}},prepareOuput:function(e,r){try{var a={"dataPoints":[{"attributes":{"device":{},"browser":{},"os":{},"location":{},"asn":{}}}]};a["dataPoints"][0]["attributes"]["script_id"]=e["script_id"];a["dataPoints"][0]["attributes"]["script_version"]=this.getVersionOfScript();a["dataPoints"][0]["attributes"]["config_version"]=this.getVersionOfConfig();a["dataPoints"][0]["attributes"]["script_type"]="gatherer";var z=this.loadUserId(e["user_identification"],r);if(z){a["dataPoints"][0]["attributes"]["user_identification"]={};a["dataPoints"][0]["attributes"]["user_identification"]["id"]=z;var b=this.loadUserIdCrossDomain(r);if(b){a["dataPoints"][0]["attributes"]["user_identification"]["cross_domain_id"]=b}};a["dataPoints"][0]["attributes"]["is_tracking_enabled"]=this.isTrackingEnabled;var t=this.loadRemoteData({"device":e["device"],"browser":e["browser"],"os":e["os"],"location":e["location"],"asn":e["asn"]},r);if(t&&t.hasOwnProperty("device")&&getPropertyNames(t["device"]).length!==0){a["dataPoints"][0]["attributes"]["device"]=t["device"]};var y=this.loadOrientation(e["device"]["orientation"],r);if(y){a["dataPoints"][0]["attributes"]["device"]["orientation"]=y};var v=this.loadResolution(e["device"]["resolution"],r);if(v&&getPropertyNames(v).length!==0){a["dataPoints"][0]["attributes"]["device"]["resolution"]=v};var p=this.loadBattery(e["device"]["battery"],r);if(p&&getPropertyNames(p).length!==0){a["dataPoints"][0]["attributes"]["device"]["battery"]=p};var f=this.loadMaxTouchPoints(e["device"]["max_touch_points"],r);if(f){a["dataPoints"][0]["attributes"]["device"]["max_touch_points"]=f};var g=this.loadHardwareConcurrency(e["device"]["hardware_concurrency"],r);if(g){a["dataPoints"][0]["attributes"]["device"]["hardware_concurrency"]=g};var h=this.loadDevicePixelRatio(e["device"]["device_pixel_ratio"],r);if(h){a["dataPoints"][0]["attributes"]["device"]["device_pixel_ratio"]=h};if(t&&t.hasOwnProperty("browser")&&getPropertyNames(t["browser"]).length!==0){a["dataPoints"][0]["attributes"]["browser"]=t["browser"]};var I=this.loadUserAgent(e["browser"]["user_agent"],r);if(I){a["dataPoints"][0]["attributes"]["browser"]["user_agent"]=I};var c=this.loadCookie(e["browser"]["cookie"],r);if(c&&getPropertyNames(c).length!==0){a["dataPoints"][0]["attributes"]["browser"]["cookie"]=c};var o=this.loadHistory(e["browser"]["history"],r);if(o&&getPropertyNames(o).length!==0){a["dataPoints"][0]["attributes"]["browser"]["history"]=o};var u=this.loadWindowSize(e["browser"]["window_size"],r);if(u&&getPropertyNames(u).length!==0){a["dataPoints"][0]["attributes"]["browser"]["window_size"]=u};var m=this.loadLanguage(e["browser"]["language"],r);if(m){a["dataPoints"][0]["attributes"]["browser"]["language"]=m};if(t&&t.hasOwnProperty("os")&&getPropertyNames(t["os"]).length!==0){a["dataPoints"][0]["attributes"]["os"]=t["os"]};var d=this.loadNetwork(e["network"],r);if(d&&getPropertyNames(d).length!==0){a["dataPoints"][0]["attributes"]["network"]=d};if(t&&t.hasOwnProperty("location")&&getPropertyNames(t["location"]).length!==0){a["dataPoints"][0]["attributes"]["location"]=t["location"]};if(t&&t.hasOwnProperty("asn")&&getPropertyNames(t["asn"]).length!==0){a["dataPoints"][0]["attributes"]["asn"]=t["asn"]};var l=this.loadGlobalVariables(e["global_variables"],r);if(l&&getPropertyNames(l).length!==0){a["dataPoints"][0]["attributes"]["global_variables"]=l};var s=this.loadCustomAttributes(e["custom_attributes"],r);if(s&&getPropertyNames(s).length!==0){a["dataPoints"][0]["attributes"]["custom_attributes"]=s};var n=this.loadUrl(e["url"],r);if(n&&getPropertyNames(n).length!==0){a["dataPoints"][0]["attributes"]["source_url"]=n};return a}catch(i){this.errorHandler(i,"prepareOuput",{},r)}},selectElements:function(e,r){try{var t=document.evaluate(e,r?r:document,null,XPathResult.ANY_TYPE,null),n=[],s=0,a=t.iterateNext();while(a){n[s]=a;a=t.iterateNext();++s};return n}catch(i){this.errorHandler(i,"selectElements")}},saveToCookie:function(e,r){try{var a="."+location.hostname.replace("www.","");document.cookie=e+"="+r+";max-age="+(60*60*24*365*2)+";path=/; domain="+a+";"}catch(i){this.errorHandler(i,"saveToCookie")}},setRemoteData:function(e){var r=this;try{function n(){try{if(r.localStorageErrorTimestamp&&(new Date().getTime()-r.localStorageErrorTimestamp)<300000)return;if(r.remoteDataRequested)return;r.remoteDataRequested=!0;var a=r.getUrlGathererDataProvider(),t=function(i){try{if(i.readyState===i.DONE&&i.status===200){var t=JSON.parse(i.responseText),l="";if(t&&typeof t==="object"){try{for(var s in t){for(var n in t[s]){if(t[s][n]==="")continue;if(n==="ip"){l=l.concat(s+"-"+n+"="+t[s][n]+","+Date.now()+"; ")}
else{l=l.concat(s+"-"+n+"="+t[s][n]+"; ")}}};localStorage.setItem("db_data_gatherer",r.getBase64Object().encode(l))}catch(a){r.localStorageErrorTimestamp=new Date().getTime();r.errorHandler(a,"setRemoteData (gatherer_data_provider service response)")}}}
else{r.errorHandler({"name":"bad_request","message":"xhr.status: "+i.status},"setRemoteData (gatherer_data_provider service response)")}}catch(a){r.errorHandler({"name":"bad_request","message":"xhr.status: "+i.status},"getRemoteData callback",{},e)}};r.makeCorsRequest("",a,"GET",t,!0,e)}catch(i){r.errorHandler(i,"setRemoteData makeCorsRequest",{},e)}};var t=localStorage.getItem("db_data_gatherer");if(t){var a=/ip=([^;]+)/.exec(this.getBase64Object().decode(t))};if(!a){n();return};var s=new Date(),l=new Date(parseInt(a[1].split(",")[1],10)),d=(s-l)/60000;if(d>=30){n()}}catch(i){this.errorHandler(i,"setRemoteData",{},e)}},setUserIdCrossDomain:function(){var a=this;try{if(/db_uicd=([^;]+)/.exec(document.cookie))return;var i=document.createElement("iframe");i.onload=function(){i.contentWindow.postMessage(window.location.href,"https://www.databreakers.com")};var r=function(e){if(e.origin==="https://www.databreakers.com"){a.saveToCookie("db_uicd",e.data)}};window.addEventListener("message",r,!1);i.setAttribute("src","https://www.databreakers.com/cookie-maker");i.style.display="none";setTimeout(function(){try{document.getElementsByTagName("head")[0].appendChild(i)}catch(e){this.errorHandler(e,"setUserIdCrossDomain appendChild(iframe)")}},1)}catch(e){this.errorHandler(e,"setUserId")}},updateCookieExpiration:function(){var i=/db_ui=([^;]+)/.exec(document.cookie);if(i){this.saveToCookie("db_ui",i[1])};var e=/db_uicd=([^;]+)/.exec(document.cookie);if(e){this.saveToCookie("db_uicd",e[1])}},loadUserId:function(e,r){try{if(e.hasOwnProperty("handler")&&e["handler"]!==""){eval(e["handler"])};if(this.isTrackingEnabled){var a=/db_ui=([^;]+)/.exec(document.cookie);if(a){if(this.customUserId){return this.customUserId};return a[1]};a=this.generateGUID();this.saveToCookie("db_ui",a);this.setUserIdCrossDomain();if(this.customUserId){return this.customUserId};return a}
else{return this.customUserId}}catch(i){this.errorHandler(i,"loadUserId",{},r)}},loadUserIdCrossDomain:function(e){try{var r=/db_uicd=([^;]+)/.exec(document.cookie);if(r){return r[1]}}catch(i){this.errorHandler(i,"loadUserIdCrossDomain",{},e)}},loadRemoteData:function(e,r){try{if(e){var a={};var t,s,n,l=localStorage.getItem("db_data_gatherer");if(!l){this.setRemoteData(r);return a};this.getBase64Object().decode(l).split("; ").forEach(function(e){if(e.split("-").length>1){t=e.split("-")[0];if(!a.hasOwnProperty(t)){a[t]={}};s=e.split("-")[1].split("=")[0];n=e.split("-")[1].split("=")[1];if(s==="ip"){n=n.split(",")[0]};a[t][s]=n}});if(getPropertyNames(a).length===0){this.setRemoteData(r)};return a}}catch(i){this.errorHandler(i,"loadRemoteData",{},r)}},loadResolution:function(e,r){try{if(e){if(screen.width!==undefined&&screen.height!==undefined){return{"width":screen.width,"height":screen.height}}
else{this.warningHandler("device resolution")}}}catch(i){this.errorHandler(i,"loadResolution",{},r)}},loadUserAgent:function(e,r){try{if(e){if(navigator.userAgent!==undefined){return navigator.userAgent}
else{this.warningHandler("browser user agent")}}}catch(i){this.errorHandler(i,"loadUserAgent",{},r)}},loadMaxTouchPoints:function(e,r){try{if(e){if(navigator.maxTouchPoints!==undefined){return navigator.maxTouchPoints}
else{this.warningHandler("device max_touch_points")}}}catch(i){this.errorHandler(i,"loadMaxTouchPoints",{},r)}},loadDevicePixelRatio:function(e,r){try{if(e){if(window.devicePixelRatio!==undefined){return window.devicePixelRatio}
else{this.warningHandler("device pixel ratio")}}}catch(i){this.errorHandler(i,"loadDevicePixelRatio",{},r)}},loadHardwareConcurrency:function(e,r){try{if(e){if(navigator.hardwareConcurrency!==undefined){return navigator.hardwareConcurrency}
else{this.warningHandler("device hardware concurrency")}}}catch(i){this.errorHandler(i,"loadHardwareConcurrency",{},r)}},loadOrientation:function(e,r){try{if(e){if(screen.orientation!==undefined&&screen.orientation.type!==undefined){return screen.orientation.type}
else{this.warningHandler("device orientation")}}}catch(i){this.errorHandler(i,"loadOrientation",{},r)}},loadLanguage:function(e,r){try{if(e){if(navigator.language!==undefined){return navigator.language}
else{this.warningHandler("browser language")}}}catch(i){this.errorHandler(i,"loadLanguage",{},r)}},loadWindowSize:function(e,r){try{if(e){var a={};if(window.outerWidth!==undefined){a["width"]=window.outerWidth}
else{this.warningHandler("browser window size width")};if(window.outerHeight!==undefined){a["height"]=window.outerHeight}
else{this.warningHandler("browser window size height")};return a}}catch(i){this.errorHandler(i,"loadWindowSize",{},r)}},loadNetwork:function(e,r){try{if(e){var n=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(n!==undefined){var t={};for(var a in e){if(e[a]&&navigator.connection[a]!==undefined){t[a]=navigator.connection[a]}};return t}
else{this.warningHandler("navigator connection")}}}catch(i){this.errorHandler(i,"loadNetwork",{},r)}},loadBattery:function(e,r){try{if(e){if(navigator.getBattery!==undefined&&typeof navigator.getBattery().then==="function"){navigator.getBattery().then(function(e){sessionStorage.charging=e.charging;sessionStorage.level=e.level});return{"charging":sessionStorage.charging,"level":sessionStorage.level}}
else{this.warningHandler("device battery")}}}catch(i){this.errorHandler(i,"loadBattery",{},r)}},loadHistory:function(e,r){try{if(e){var a={};if(history!==undefined&&history.length!==undefined){a["length"]=history.length}
else{this.warningHandler("browser history length")};if(document.referrer!==undefined){if(document.referrer){a["referrer"]=document.referrer}}
else{this.warningHandler("browser history referrer")};return a}}catch(i){this.errorHandler(i,"loadHistory",{},r)}},loadGlobalVariables:function(e,r){var t=this;try{if(e&&e.hasOwnProperty("parameters")){var a={};e.parameters.forEach(function(e){try{var r=eval(e);a[e]=r}catch(i){t.warningHandler("global variable "+e)}});return a}}catch(i){this.errorHandler(i,"loadGlobalVariable",{},r)}},loadCustomAttributes:function(e,r){var s=this;try{if(e&&getPropertyNames(e).length>0){var t={};for(var a in e){try{var n=eval(e[a]);t[a]=n}catch(i){s.warningHandler("custom attribute"+a)}};return t}}catch(i){this.errorHandler(i,"loadCustomAttributes",{},r)}},loadCookie:function(e,r){var n=this;try{if(e&&e.hasOwnProperty("mode")&&e["mode"]){switch(e["mode"]){case"all":if(document.cookie!==undefined){var t={};document.cookie.split(";").forEach(function(e){e=e.replace(/^\s+|\s+$/g,"").split("=");t[e[0]]=e[1]});return t}
else{this.warningHandler("browser cookie")};case"specific":if(e.hasOwnProperty("parameters")&&e["parameters"]){if(document.cookie!==undefined){var a={};e["parameters"].forEach(function(e){var r=new RegExp(e+"=([^;]+)"),i=r.exec(document.cookie);if(i&&i.hasOwnProperty(1)){a[e]=i[1]}
else{n.warningHandler("browser cookie specific parameter "+e)}});return a}
else{this.warningHandler("browser cookie")}}
else{this.warningHandler("browser cookie specific mode parameters")};case"none":return}}}catch(i){this.errorHandler(i,"loadCookie",{},r)}},loadUrl:function(e,r){var d=this;try{var a={};var t={};var l={};var n;if(e&&e.hasOwnProperty("mode")&&e["mode"]){switch(e["mode"]){case"all":if(location&&location.href!==undefined&&location["href"]){a["page"]=location.href;a["pathname"]=location.pathname;a["hostname"]=this.extractHostname(location.href);var s=location.href.split("?")[1];if(s){s.split("&").forEach(function(e){n=e.split("=");t[n[0]]=n[1]})};if(getPropertyNames(t).length!==0){a["parameters"]=t};return a}
else{this.warningHandler("url")};case"specific":if(e.hasOwnProperty("parameters")&&e["parameters"]){if(location&&location.href!==undefined&&location["href"]){a["page"]=location.href;a["pathname"]=location.pathname;a["hostname"]=this.extractHostname(location.href);a["parameters"]={};var s=location.href.split("?")[1];if(s){s.split("&").forEach(function(e){n=e.split("=");t[n[0]]=n[1]});e["parameters"].forEach(function(e){if(t.hasOwnProperty(e)&&t[e]){l[e]=t[e]}
else{d.warningHandler("url specific parameter "+e)}});if(getPropertyNames(l).length!==0){a["parameters"]=l}};return a}
else{this.warningHandler("url")}}
else{this.warningHandler("url specific parameters")}}}}catch(i){this.errorHandler(i,"loadUrl",{},r)}},loadPoint:function(e,r){try{if(e){if(r.x!==undefined&&r.y!==undefined){return{x:r.x,y:r.y}}
else{this.warningHandler("event point")}}}catch(i){this.errorHandler(i,"loadPoint")}},generateGUID:function(){try{function i(){return Math.floor((1+Math.random())*0x10000).toString(16).substring(1)};return i()+i()+"-"+i()+"-"+i()+"-"+i()+"-"+i()+i()+i()}catch(e){this.errorHandler(e,"guid")}},getElementTreeXPath:function(e){try{var n=[];for(;e&&e.nodeType==Node.ELEMENT_NODE;e=e.parentNode){var a=0,t=!1;for(var r=e.previousSibling;r;r=r.previousSibling){if(r.nodeType==Node.DOCUMENT_TYPE_NODE)continue;if(r.nodeName==e.nodeName)++a};for(var r=e.nextSibling;r&&!t;r=r.nextSibling){if(r.nodeName==e.nodeName)t=!0};var s=(e.prefix?e.prefix+":":"")+e.localName,l=(a||t?"["+(a+1)+"]":"");n.splice(0,0,s+l)};return n.length?"/"+n.join("/"):null}catch(i){this.errorHandler(i,"getElementTreeXPath")}},getElementTreeCss:function(e){try{if(!(e instanceof Element))return;var n=[];while(e.nodeType===Node.ELEMENT_NODE){var r=e.nodeName.toLowerCase(),a=e,t=1;while(a=a.previousElementSibling){if(a.nodeName.toLowerCase()==r)t++};if(t!=1)r+=":nth-of-type("+t+")";n.unshift(r);e=e.parentNode};return n.join(" > ")}catch(i){this.errorHandler(i,"getElementTreeCss")}},initInView:function(){var i=this;try{this.appear=(function(){"use strict";var r=null,a=0,e={};function n(){var i=window.scrollY||window.pageYOffset;if(r!=null){e.velocity=i-r;e.delta=(e.velocity>=0)?e.velocity:(-1*e.velocity)};r=i;if(a){clearTimeout(a)};a=setTimeout(function(){r=null},30)};addEventListener("scroll",n,!0);function t(e,r,a){var t=e.getBoundingClientRect(),n,l,s=((t.top+t.height)>=0&&(t.left+t.width)>=0&&(t.bottom-t.height)<=((window.innerHeight||document.documentElement.clientHeight)-(r*t.height))&&(t.right-t.width)<=((window.innerWidth||document.documentElement.clientWidth)-(r*t.width)));if(s&&a){if(a["mode"]==="xpath"){n=i.selectElements(a["selection"])}
else{n=document.querySelectorAll(a["selection"])};if(n.length>0){for(var d=0;d<n.length;d++){l=n[d].getBoundingClientRect();s=(Math.round(t.width+t.left)>Math.round(l.left))&&(Math.round(t.left)<Math.round(l.left+l.width)-10);if(s){break}}}
else{s=!1}};return s};return function(r){return(function(r){var p=!1,I=[],n=new HashMap,l,u,a={},h,o;function g(e,i){return function(){var r=this,a=arguments;clearTimeout(l);l=setTimeout(function(){e.apply(r,a)},i)}};function s(){if(e.delta<a.delta.speed){if(!u){u=!0;d();setTimeout(function(){u=!1},a.delta.timeout)}}(g(function(){d()},a.debounce)())};function v(){d();addEventListener("scroll",s,!0);addEventListener("resize",s,!0);o=new MutationObserver(s);o.observe(document.body,{childList:!0,subtree:!0,attributes:!0})};function f(){I=[];if(l){clearTimeout(l)};m()};function m(){removeEventListener("scroll",s,!0);removeEventListener("resize",s,!0);o.disconnect()};function d(){try{var r=a.getElements();r.forEach(function(e){if(e==undefined)return;if(n.get(e)===undefined)n.set(e,!0);var i=window.getComputedStyle(e);if(e&&t(e,a.bounds,a.rootSelector)&&n.get(e)&&i.display!=="none"&&i.visibility!=="hidden"&&i.opacity!=="0"){var r=e,s,l=!0;while(r){s=window.getComputedStyle(r);if(s.display=="none"||s.visibility=="hidden"||s.opacity=="0"){l=!1;break};r=r.parentElement};if(l){a.appear(e);n.set(e,!1)}};if(a.reappearOption&&(!t(e,a.bounds,a.rootSelector)||i.display==="none"||i.visibility==="hidden"||i.opacity==="0")){n.set(e,!0)}})}catch(e){i.errorHandler(e,"initInView doCheckAppear")}};function c(){if(p){return};p=!0;if(a.init){a.init()};h=a.getElements;v()};return function(e){e=e||{};a={init:e.init,elements:e.elements,appear:e.appear,disappear:e.disappear,done:e.done,reappearOption:e.reappearOption,reappear:e.reappear,bounds:e.bounds||0,debounce:e.debounce||50,delta:{speed:e.deltaSpeed||50,timeout:e.deltaTimeout||500},getElements:e.getElements,rootSelector:e.rootSelector};addEventListener("DOMContentLoaded",c,!1);var r=!1;if(Function("/*@cc_on return document.documentMode===10@*/")()){r=!0};var i=document.readyState==="complete"||document.readyState==="loaded";if(r){if(i){c()}}
else{if(i||document.readyState==="interactive"){c()}};return{trigger:function(){d()},pause:function(){m()},resume:function(){v()},destroy:function(){f()}}}}()(r))}}())}catch(e){this.errorHandler(e,"initInView")}},initPolyfills:function(){try{window.getPropertyNames=Object.getOwnPropertyNames||function(e){var r=[];for(var i in e){if(e.hasOwnProperty(i)){r.push(i)}};return r};if(typeof Array.prototype.forEach!="function"){Array.prototype.forEach=function(e,i){if(typeof this.length!="number")return;if(typeof e!="function")return;if(typeof this=="object"){for(var r=0;r<this.length;r++){if(r in this){e.call(i||this,this[r],r,this)}
else{return}}}}};if(window.NodeList&&!NodeList.prototype.forEach){NodeList.prototype.forEach=function(e,i){i=i||window;for(var r=0;r<this.length;r++){e.call(i,this[r],r,this)}}};if(!Array.prototype.indexOf){Array.prototype.indexOf=function(e){var r=this.length>>>0,i=Number(arguments[1])||0;i=(i<0)?Math.ceil(i):Math.floor(i);if(i<0)i+=r;for(;i<r;i++){if(i in this&&this[i]===e)return i};return-1}};!function(e){var i=e.Element.prototype;"function"!=typeof i.matches&&(i.matches=i.msMatchesSelector||i.mozMatchesSelector||i.webkitMatchesSelector||function(e){for(var r=(this.document||this.ownerDocument).querySelectorAll(e),i=0;r[i]&&r[i]!==this;)++i;return Boolean(r[i])}),"function"!=typeof i.closest&&(i.closest=function(e){for(var i=this;i&&1===i.nodeType;){if(i.matches(e))return i;i=i.parentNode};return null})}(window);if(!Object.keys){Object.keys=(function(){var i=Object.prototype.hasOwnProperty,r=!({toString:null}).propertyIsEnumerable("toString"),e=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],a=e.length;return function(t){if(typeof t!=="object"&&typeof t!=="function"||t===null)throw new TypeError("Object.keys called on non-object");var s=[];for(var l in t){if(i.call(t,l))s.push(l)};if(r){for(var n=0;n<a;n++){if(i.call(t,e[n]))s.push(e[n])}};return s}})()}}catch(e){this.errorHandler(e,"initPolyfills")}},resolveRunConditions:function(e){try{if(e.length>0){var r=[];e.forEach(function(e){r.push(eval(e))});return r.every(function(e){return e})}
else{return!0}}catch(i){this.errorHandler(i,"resolveRunConditions")}},extractHostname:function(e){try{var r;if(e.indexOf("://")>-1){r=e.split("/")[2]}
else{r=e.split("/")[0]};r=r.split(":")[0];r=r.split("?")[0];r=r.replace("www.","");return r}catch(i){this.errorHandler(i,"extractHostname")}},getBase64Object:function(){try{var i=this;return{_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var s="",l,r,a,u,o,d,t,n=0;e=i.getBase64Object()._utf8_encode(e);while(n<e.length){l=e.charCodeAt(n++);r=e.charCodeAt(n++);a=e.charCodeAt(n++);u=l>>2;o=(l&3)<<4|r>>4;d=(r&15)<<2|a>>6;t=a&63;if(isNaN(r)){d=t=64}
else if(isNaN(a)){t=64};s=s+this._keyStr.charAt(u)+this._keyStr.charAt(o)+this._keyStr.charAt(d)+this._keyStr.charAt(t)};return s},decode:function(e){var r="",l,d,u,o,n,t,s,a=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(a<e.length){o=this._keyStr.indexOf(e.charAt(a++));n=this._keyStr.indexOf(e.charAt(a++));t=this._keyStr.indexOf(e.charAt(a++));s=this._keyStr.indexOf(e.charAt(a++));l=o<<2|n>>4;d=(n&15)<<4|t>>2;u=(t&3)<<6|s;r=r+String.fromCharCode(l);if(t!=64){r=r+String.fromCharCode(d)};if(s!=64){r=r+String.fromCharCode(u)}};r=i.getBase64Object()._utf8_decode(r);return r},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");var r="";for(var a=0;a<e.length;a++){var i=e.charCodeAt(a);if(i<128){r+=String.fromCharCode(i)}
else if(i>127&&i<2048){r+=String.fromCharCode(i>>6|192);r+=String.fromCharCode(i&63|128)}
else{r+=String.fromCharCode(i>>12|224);r+=String.fromCharCode(i>>6&63|128);r+=String.fromCharCode(i&63|128)}};return r},_utf8_decode:function(e){var a="",i=0,r=c1=c2=0;while(i<e.length){r=e.charCodeAt(i);if(r<128){a+=String.fromCharCode(r);i++}
else if(r>191&&r<224){c2=e.charCodeAt(i+1);a+=String.fromCharCode((r&31)<<6|c2&63);i+=2}
else{c2=e.charCodeAt(i+1);c3=e.charCodeAt(i+2);a+=String.fromCharCode((r&15)<<12|(c2&63)<<6|c3&63);i+=3}};return a}}}catch(e){this.errorHandler(e,"getBase64Object")}},sendCustomEvent:function(e,r,a){try{var s=runDataGatherer.getConfig(),l=runDataGatherer.getUrl(),n=runDataGatherer.prepareOuput(s),t={};t.name=e;t.type=r;t.attributes=a;n["dataPoints"][0]["attributes"]["event"]=t;runDataGatherer.makeCorsRequest(n,l,"POST",null,!0)}catch(i){}},sendCustomEvents:function(e){try{var t=runDataGatherer.getConfig(),n=runDataGatherer.getUrl(),s=runDataGatherer.prepareOuput(t),a=[],r;e.forEach(function(e){r=JSON.parse(JSON.stringify(s["dataPoints"][0]));r["attributes"]["event"]={name:e.name,type:e.type,attributes:e.attributes};a.push(r)});runDataGatherer.makeCorsRequest({"dataPoints":a},n,"POST",null,!0)}catch(i){}},getAbTestData:function(){var e=JSON.parse(localStorage.getItem("db_abtests"));for(var i in e){if(e[i]["type"]==="main"){return{"abTestId":e[i]["id"],"abTestGroup":e[i]["tags"].join(",")}}};return!1},saveAbTestGroupToLocalStorage:function(e,r){try{var n=localStorage.getItem("db_last_ab_test_report"),t=this;if(n){var d=(new Date()-new Date(parseInt(n,10)))/60000;if(d<60){return}
else{localStorage.removeItem("db_abtests")}};var a=this.loadUserId(t.getConfig()["user_identification"]);if(e){a=e};if(!r){r=["main"]};var s="https://api.databreakers.com/v1/groupon_us/abtests/users/"+a+"/",l=function(e){try{if(e.readyState===e.DONE&&e.status===200){localStorage.setItem("db_abtests",e.responseText)}
else{t.errorHandler({},"saveAbTestGroupToLocalStorage (abtests api response) 1, xhr.status: "+e.status+", xhr.readyState: "+e.readyState+", xhr.responseText: "+e.responseText)}}catch(i){t.errorHandler(i,"saveAbTestGroupToLocalStorage (abtests api response) 2, xhr.status: "+e.status+", xhr.readyState: "+e.readyState+", xhr.responseText: "+e.responseText)}};if(a){this.makeCorsRequest({"abtestTypes":r},s,"POST",l,!0)}}catch(i){this.errorHandler(i,"saveAbTestGroupToLocalStorage")}},runAbTestGroupReportingToGa:function(e,r,t,n,l,c,d){try{this.saveAbTestGroupToLocalStorage(c,t);let _this=this;var p=localStorage.getItem("db_last_ab_test_report");if(!d&&d!==0){d=600};if(p){var v=(new Date()-new Date(parseInt(p)))/1000;if(v<d){return}};var a=null,s=null;if(e==="gtag.js"){var u=0,o=setInterval(function(){u++;if(u>20){clearInterval(o);_this.errorHandler({"name":"ReferenceError","message":"gtag or abTestData has not been loaded, dataLayer: "+window.hasOwnProperty("gtag")+", abTestId: "+!!a+", abTestGroup: "+!!s,},"runAbTestGroupReportingToGa")};if(n&&l){a=n;s=l}
else{var t=_this.getAbTestData();if(t){a=t["abTestId"];s=t["abTestGroup"]}};if(window.hasOwnProperty("gtag")&&a&&s){clearInterval(o);var e=s.split(",");if(e.length>1){e.forEach(function(e){gtag("event","databreakers_reporting",{"send_to":r,"abtest_id":a,"abtest_group":e})});for(var i=0;i<e.length;i++){if(["original","recommendation"].indexOf(e[i])<0){gtag("event","databreakers_reporting",{"send_to":r,"user_properties":{"abtest_id":a,"abtest_group":e[i]}});break}}}
else{e.forEach(function(e){gtag("event","databreakers_reporting",{"send_to":r,"abtest_id":a,"abtest_group":e,"user_properties":{"abtest_id":a,"abtest_group":e}})})};runDataGatherer.sendCustomEvent("ga_debug","inview",{"clientId":runDataGatherer.loadCookie({"mode":"specific","parameters":["_ga"]})["_ga"],"sessionId":runDataGatherer.loadCookie({"mode":"specific","parameters":["_ga_"+r.split("-").pop()]})["_ga_"+r.split("-").pop()],"abTestId":a,"abTestGroup":s});localStorage.setItem("db_last_ab_test_report",Date.now())}},500)};if(e==="GTM"){var u=0,o=setInterval(function(){u++;if(u>20){clearInterval(o);_this.errorHandler({"name":"ReferenceError","message":"dataLayer or abTestData has not been loaded, dataLayer: "+window.hasOwnProperty("dataLayer")+", abTestId: "+!!a+", abTestGroup: "+!!s,},"runAbTestGroupReportingToGa")};if(n&&l){a=n;s=l}
else{var t=_this.getAbTestData();if(t){a=t["abTestId"];s=t["abTestGroup"]}};if(window.hasOwnProperty("dataLayer")&&a&&s){clearInterval(o);var e=s.split(",");if(e.length>1){e.forEach(function(e){dataLayer.push({"event":"databreakers_reporting","send_to":r,"abtest_id":a,"abtest_group":e})});for(var i=0;i<e.length;i++){if(["original","recommendation"].indexOf(e[i])<0){dataLayer.push({"event":"databreakers_reporting","send_to":r,"user_properties":{"abtest_id":a,"abtest_group":e[i]}});break}}}
else{e.forEach(function(e){dataLayer.push({"event":"databreakers_reporting","send_to":r,"abtest_id":a,"abtest_group":e,"user_properties":{"abtest_id":a,"abtest_group":e}})})};runDataGatherer.sendCustomEvent("ga_debug","inview",{"clientId":runDataGatherer.loadCookie({"mode":"specific","parameters":["_ga"]})["_ga"],"sessionId":runDataGatherer.loadCookie({"mode":"specific","parameters":["_ga_"+r.split("-").pop()]})["_ga_"+r.split("-").pop()],"abTestId":a,"abTestGroup":s});localStorage.setItem("db_last_ab_test_report",Date.now())}},500)}}catch(i){this.errorHandler(i,"runAbTestGroupReportingToGa")}}};function HashMap(e){this.current=undefined;this.size=0;if(e===!1)this.disableLinking()};HashMap.noop=function(){return this};HashMap.illegal=function(){throw new Error("illegal operation for maps without linking")};HashMap.from=function(e,i){var a=new HashMap;for(var r in e){if(i||e.hasOwnProperty(r))a.set(r,e[r])};return a};HashMap.prototype.disableLinking=function(){this.link=HashMap.noop;this.unlink=HashMap.noop;this.disableLinking=HashMap.noop;this.next=HashMap.illegal;this.key=HashMap.illegal;this.value=HashMap.illegal;this.removeAll=HashMap.illegal;return this};HashMap.prototype.hash=function(e){return(typeof e)+" "+(e instanceof Object?(e.__hash||(e.__hash=++arguments.callee.current)):e.toString())};HashMap.prototype.hash.current=0;HashMap.prototype.get=function(e){var i=this[this.hash(e)];return i===undefined?undefined:i.value};HashMap.prototype.set=function(e,i){var r=this.hash(e);if(this[r]===undefined){var a={key:e,value:i};this[r]=a;this.link(a);++this.size}
else this[r].value=i;return this};HashMap.prototype.remove=function(e){var i=this.hash(e),r=this[i];if(r!==undefined){--this.size;this.unlink(r);delete this[i]};return this};HashMap.prototype.removeAll=function(){while(this.size)this.remove(this.key());return this};HashMap.prototype.link=function(e){if(this.size==0){e.prev=e;e.next=e;this.current=e}
else{e.prev=this.current.prev;e.prev.next=e;e.next=this.current;this.current.prev=e}};HashMap.prototype.unlink=function(e){if(this.size==0)this.current=undefined;else{e.prev.next=e.next;e.next.prev=e.prev;if(e===this.current)this.current=e.next}};HashMap.prototype.next=function(){this.current=this.current.next};HashMap.prototype.key=function(){return this.current.key};HashMap.prototype.value=function(){return this.current.value};var runIndividualizer={individualizerScriptId:"",individualizerLogLevel:"",element:{},nativeEvent:{},requestData:{},responseData:{},responseItem:{},responseVariant:{},responseVariantIndex:0,responseVariants:{},responses:{},recommendations:{},totalResults:{},durations:{},requests:{},lastRequest:null,observers:{},observersAttempts:{},config:{},pushStateCallbacks:[],replaceStateCallbacks:[],xhrCallbacks:[],xhrRequestOpenArguments:[],fetchCallbacks:[],lock:!1,idRequest:"",plugin:{},abTests:null,getConfig:function(){try{if(!this.config.hasOwnProperty("script_id")){var i={"script_id":"default","running":!0,"log_level":"warning","run_conditions":["!(new RegExp('AdsBot-Google')).test(navigator.userAgent);","!(new RegExp('Googlebot')).test(navigator.userAgent);","!(new RegExp('YandexMobileBot')).test(navigator.userAgent);","!(new RegExp('screenshot-generator')).test(navigator.userAgent);","location.href.indexOf('livingsocial') < 0;"],"hibernation":{"running":!0,"duration":1800000},"variables":"runIndividualizer.getUrl = function() {return \"https:\/\/us-individualizer.databreakers.com\/v1\/individualizer\";};runDataGatherer.getUrlGathererDataProvider = function() {return \"https:\/\/us-publicapi.databreakers.com\/v2\/gatherer-data-provider\";};runDataGatherer.getUrl = function() {return \"https:\/\/us-api.databreakers.com\/v1\/groupon_us\/dataPoint\";};runIndividualizer.translations = {'bookOnline': 'Book Online','bought': 'bought','viewedToday': 'viewed today','ratings': 'Ratings','currencySymbol': '$','priceDecimalChar': '.','priceFrom': 'From','priceMask': '{currencySymbol}{price}','categoryGetaways': 'Getaways','perNightSymbol': '\/nt','discountBadgeText': 'OFF','limitedTime': 'Limited Time','distanceUnit': 'mi','productDetailHeadline1': 'Similar deals','productDetailHeadline2': 'Recommended deals','productDetailHeadline3': 'Other deals from the same merchant','basketHeadline': 'Recommended deals','of': 'of','freeToClaim': 'Free to Claim','priceHidden': 'Price Hidden','memberPricing': 'Member Pricing:','locationPopupAccept': \"Yes, It's right\",'locationPopupDeny': \"No, It's wrong\",\"locationPopupDescription\": \"Are we looking in the right place?\",\"locationDialogAcceptText\": \"Excellent! We hope you find something great.\",\"priceThousandsChar\": \",\",'withPromo': 'with promo'};runIndividualizer.featureSwitch = {showLocationDialog: true};runIndividualizer.showLocationDialog = function() {if (!runIndividualizer.featureSwitch || !runIndividualizer.featureSwitch.hasOwnProperty('showLocationDialog')) {return;};if (sessionStorage.getItem('db_show_location_dialog')) {return;};var cookies = runDataGatherer.loadCookie({\"mode\": \"specific\",\"parameters\": [\"ipll\", \"ell\", \"cll\"]});if (cookies.cll) {return;};if (cookies.ipll && cookies.cll) {return;};if (cookies.ipll && cookies.ell) {return;};runIndividualizer.getAbTest(function(response) {var stringifiedTests = JSON.stringify(response);if (stringifiedTests.indexOf(\"location_dialog_on\") != -1) {startScript()} else {return;}}, 'frontend_location_dialog');var defaultTop = 0;function startScript() {var observer = new MutationObserver(function(mutationsList, observer) {for (var iterator in mutationsList) {if (mutationsList[iterator][\"target\"][\"id\"] === \"ls-landing-search-form\") {initPopup();syncScroll();}}});window.addEventListener(\"scroll\", syncScroll);observer.observe(document.querySelector(\"body\"), {attributes: true,childList: true,subtree: true});};function removePopup(delayed) {var popupExists = document.querySelector(\"#db_location_dialog\");var timeout = delayed ? 5000 : 10;setTimeout(function() {popupExists.remove()}, timeout);}function handleClickAccept() {var acceptHtml = \"<svg xmlns='http:\/\/www.w3.org\/2000\/svg'  viewBox='0 0 64 64' width='20px' height='25px' fill='#318200'><path d='M32,6C17.641,6,6,17.641,6,32c0,14.359,11.641,26,26,26s26-11.641,26-26C58,17.641,46.359,6,32,6z M29,42L18,31l2-3l9,6 l13.957-12L46,25L29,42z'\/><\/svg>\" + runIndividualizer.translations.locationDialogAcceptText;var dialog = document.querySelector(\"#db_location_dialog\");dialog.innerHTML = acceptHtml;sessionStorage.setItem('db_show_location_dialog', true);removePopup(true);syncScroll()}function handleClickDeny() {sessionStorage.setItem('db_show_location_dialog', true);var button = document.querySelector(\"#ls-location-cx\");setTimeout(function() {button.click();removePopup(false);syncScroll();}, 10)}function createPopup(refEl, positionClass) {var css = runIndividualizer.createElementFromHTML(\"<style id='db_location_dialog_css'>#db_location_dialog { display: flex;height: 50px;box-shadow:0 0 5px rgba(0,0,0,.20);z-index: 300;position: absolute;padding: 6px 15px; align-items:center;background: white;left: 0; right: 0; margin: auto;border-radius:5px;max-width:100%;} #db_location_dialog.top { bottom: calc(100% + 10px); }#db_location_dialog svg{margin-right: 10px;}#db_location_dialog.bottom:before{z-index: 100;content: ''; background: white;position: absolute;margin: auto; display: block;height: 18px; width: 30px;left:0;right:0;top: 0;}#db_location_dialog.top:before{z-index: 100;content: '';position: absolute;margin: auto; display: block;width: 30px;background: white; height: 18px;left:0;right:0;bottom: 0;}#db_location_dialog.top:after{content:'';box-shadow:0 0 5px rgba(0,0,0,.20);transform: rotate(45deg);background: white;margin: auto;display: block;position:absolute;height:20px;width:20px;left:0;right:0;top:calc(100% - 10px);}#db_location_dialog.bottom:after{content:'';box-shadow:0 0 5px rgba(0,0,0,.20);transform: rotate(45deg);background: white;;margin: auto;display: block;position:absolute;height:20px;width:20px;left:0;right:0;bottom:calc(100% - 10px);} #db_location_dialog.bottom { top: calc(100% + 10px); }#db_location_dialog button {height: 35px;padding: 0 10px; background: none; outline: none;border: none;color: #0E7FDB; font-weight: 600; border-radius: 5px;}#db_location_dialog button.deny{margin-left:25px;}#db_location_dialog button.accept{border: 1px solid #0E7FDB; margin-left: 10px;}#db_location_dialog span{font-weight: 700;}#db_location_dialog button.accept:hover{background: #0E7FDB; color: white;}<\/style>\");document.querySelector('head').append(css);var popupEl = runIndividualizer.createElementFromHTML(\"<div id='db_location_dialog'><svg width='16' height='16' data-ds-type='Icon' viewBox='0 0 32 32' fill='#BF0020' xmlns='http:\/\/www.w3.org\/2000\/svg' class='r-4qtqp9 r-dnmrzs r-bnwqim r-1plcrui r-lrvibr'><path d='M24.5 4.56C22.52 2.36 19.26 1 16 1S9.48 2.36 7.5 4.56C5.17 7.14 4.51 9.9 5.27 13.82c1.03 5.3 9.58 16.33 9.94 16.8a1 1 0 0 0 1.58-.01c.36-.47 8.91-11.5 9.94-16.8.76-3.91.1-6.67-2.23-9.25zM16 16a4 4 0 1 1 0-8 4 4 0 0 1 0 8z'><\/path><\/svg><span>\" + runIndividualizer.translations.locationPopupDescription + \"<\/span><button class='deny'>\" + runIndividualizer.translations.locationPopupDeny + \"<\/button><button class='accept'>\" + runIndividualizer.translations.locationPopupAccept + \"<\/button><\/div>\");document.body.appendChild(popupEl);popupEl.classList.add(positionClass);popupEl.querySelector('.accept').addEventListener('click', function(event) {handleClickAccept();});popupEl.querySelector('.deny').addEventListener('click', function(event) {handleClickDeny();});syncScroll()}function setPopupPosition(popupEl, refEl, offsetTop) {var parentWidth = refEl.offsetWidth;var parentHeight = refEl.offsetHeight;var parentRect = refEl.getBoundingClientRect();const dialogWidth = popupEl.offsetWidth;const dialogHeight = popupEl.offsetHeight;const dialogTop = (parentHeight - dialogHeight) \/ 2;const dialogLeft = parentRect.left + parentRect.width \/ 2 - dialogWidth \/ 2;popupEl.style.position = \"fixed\";popupEl.style.top = dialogTop + offsetTop + \"px\";popupEl.style.left = dialogLeft + \"px\";popupEl.style.right = \"auto\";popupEl.style.bottom = \"auto\";defaultTop = dialogTop - dialogHeight;}function initPopup() {var popupExists = document.querySelector(\"#db_location_dialog\");if (popupExists) {syncScroll();return;};var position = \"top\";var refEl = document.querySelector('#ls-landing-search-form');if (!refEl) {refEl = document.querySelector('#ls-search-form');position = \"bottom\";if (!refEl) {refEl = document.querySelector(\"#location-search\");position = \"bottom\";}if (!refEl) {return;}}createPopup(refEl, position);syncScroll()}function syncScroll() {var headerSelector = document.querySelector(\"#ls-header-wrapper\");var popupRef = document.querySelector(\"#db_location_dialog\");if (!popupRef) {return;}if (headerSelector.classList.contains(\"inverse\")) {var refEl = document.querySelector('#ls-landing-search-form');popupRef.classList.add(\"top\");popupRef.classList.remove(\"bottom\");setPopupPosition(popupRef, refEl, defaultTop - window.pageYOffset);} else {popupRef.classList.add(\"bottom\");popupRef.classList.remove(\"top\");var locationSelector = document.querySelector(\"#location-search svg:first-child\").parentElement;setPopupPosition(popupRef, locationSelector, locationSelector.offsetHeight + popupRef.offsetHeight + 10);}}};runIndividualizer.showLocationDialog();runIndividualizer.abTestProductDetailTitleUp = true;","declarations":"runIndividualizer.getIndexOfVariant = function(responseItem) {var arr = JSON.parse(responseItem['price_array']);var min = Math.min.apply(null, arr);var index = arr.indexOf(min);return index;};runIndividualizer.getFormattedPrice = function(price, currency) {var priceMask = runIndividualizer.translations.priceMask;var currencySymbol = runIndividualizer.translations.currencySymbol;if (currency) {if (runIndividualizer.priceMasks[currency]) {priceMask = runIndividualizer.priceMasks[currency];}if (runIndividualizer.currencySymbols[currency]) {currencySymbol = runIndividualizer.currencySymbols[currency];}}var formattedPrice = priceMask;formattedPrice = formattedPrice.replace(\"{price}\", runIndividualizer.formatPrice(price \/ 100, null, runIndividualizer.translations.priceDecimalChar, null, runIndividualizer.translations.priceThousandsChar));formattedPrice = formattedPrice.replace(\"{currencySymbol}\", currencySymbol);return formattedPrice;};runIndividualizer.getNearestLocation = function(locations) {var contextVariables = runIndividualizer.getContextVariables();var lat = contextVariables.lat;var lng = contextVariables.lng;var distances = [];locations.forEach(function(location) {distances.push(runIndividualizer.calcDistance(lat, lng, location.lat, location.lng));});var min = Math.min.apply(null, distances);var index = distances.indexOf(min);if (!locations[index]) {runDataGatherer.sendCustomEvent('debug_getNearestLocation', 'inview', {'locations': JSON.stringify(locations),'index': index,'distances': JSON.stringify(distances),'min': min});}locations[index]['distanceInKm'] = min;return locations[index];};runIndividualizer.calcDistance = function(lat1, lon1, lat2, lon2) {var R = 6371;var dLat = runIndividualizer.toRad(lat2 - lat1);var dLon = runIndividualizer.toRad(lon2 - lon1);var lat1 = runIndividualizer.toRad(lat1);var lat2 = runIndividualizer.toRad(lat2);var a = Math.sin(dLat \/ 2) * Math.sin(dLat \/ 2) + Math.sin(dLon \/ 2) * Math.sin(dLon \/ 2) * Math.cos(lat1) * Math.cos(lat2);var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));var d = R * c;return d;};runIndividualizer.toRad = function(value) {return value * Math.PI \/ 180;};runIndividualizer.initDesktopCarousel = function(rootEl) {var wrapEl = rootEl.closest('.cui-c-compound');var count = rootEl.childElementCount;var totalPagesEl = wrapEl.querySelector('.total-pages');var currentPageEl = wrapEl.querySelector('.current-page');var previousEl = wrapEl.querySelector('.cui-arrow-previous');var nextEl = wrapEl.querySelector('.cui-arrow-next');var maxScrollLeft = rootEl.scrollWidth - rootEl.clientWidth;totalPagesEl.innerHTML = count \/ 4;currentPageEl.innerHTML = 1;previousEl.addEventListener('click', function() {if (rootEl.scrollLeft === 0) {rootEl.classList.add('cui-bounce-left');setTimeout(function() {rootEl.classList.remove('cui-bounce-left');}, 300);} else {rootEl.scrollLeft -= rootEl.clientWidth;var temp = parseInt(currentPageEl.innerText) - 1;if (temp > 0) {currentPageEl.innerText = temp;}}});nextEl.addEventListener('click', function() {if (rootEl.scrollLeft === maxScrollLeft) {rootEl.classList.add('cui-bounce-right');setTimeout(function() {rootEl.classList.remove('cui-bounce-right');}, 300);} else {rootEl.scrollLeft += rootEl.clientWidth;var temp = parseInt(currentPageEl.innerText) + 1;if (temp <= (count \/ 4)) {currentPageEl.innerText = temp;}}});};runIndividualizer.initCarouselPaginatorNumbers = function(rootEl) {var wrapEl = rootEl.closest('.cui-c-compound');var count = rootEl.childElementCount;var totalPagesEl = wrapEl.querySelector('.total-pages');var currentPageEl = wrapEl.querySelector('.current-page');totalPagesEl.innerHTML = count \/ 4;currentPageEl.innerHTML = 1;};runIndividualizer.parseFilterParameters = function(href) {var parameters = {};var split = href.split('?');if (split.length === 1) {return parameters;}split[1].split('&').forEach(function(param) {split = param.split('=');parameters[split[0]] = split[1];});return parameters;};runIndividualizer.isPossibleToUseFilter = function(parameters) {var blackList = ['available', 'sort', 'badge_type'];for (var key in parameters) {if (blackList.indexOf(key) >= 0) {return false;}if (key.split('-').length === 5) {return false;}if (key === 'with_feature' && parameters[key] !== 'bookable') {return false;}}return true;};runIndividualizer.getFilter = function(parameters) {var filter = [];var base = `(customer_taxonomy_hierarchy_translations LIKE '%\"###\"%' OR customer_taxonomy_hierarchy LIKE '%\"###\"%')`;var temp;var temp2;var temp3;if (parameters.subcategory3 || parameters.subcategory4 || parameters.subcategory5) {return 'FALSE';} else if (parameters.subcategory2) {filter.push(base.replace(\/###\/g, parameters.subcategory2));} else if (parameters.subcategory) {filter.push(base.replace(\/###\/g, parameters.subcategory));} else if (parameters.category) {filter.push(base.replace(\/###\/g, parameters.category));} else if (parameters.topcategory) {filter.push(base.replace(\/###\/g, parameters.topcategory));}if (parameters.price) {temp = [];parameters.price.split(',').forEach(function(item) {temp2 = item.replace('[', '').replace(']', '').split('..');temp.push('(price_min >= ' + (parseFloat(temp2[0]) * 100) + ' AND price_min <= ' + (parseFloat(temp2[1]) * 100) + ')');});filter.push(temp.join(' OR '));}if (parameters.rating) {temp = parameters.rating.replace('[', '').replace(']', '').split('..');filter.push('rating_value >= ' + temp[0] + ' AND rating_value <= ' + temp[1]);}if (parameters.with_feature && parameters.with_feature === 'bookable') {filter.push('is_bookable = true');}if (parameters.distance) {temp = parameters.distance.replace('[', '').replace(']', '').split('..');temp2 = runIndividualizer.getContextVariables();if (runIndividualizer.translations.distanceUnit === 'mi') {temp3 = parseFloat(temp[1]) * 1000 * 1.609;} else {temp3 = parseFloat(temp[1]) * 1000;}filter.push(`min_geo_distance('{\"lat\": ` + temp2.lat + `,\"lng\": ` + temp2.lng + `}',geo_coordinates) < ` + temp3);}if (filter.length === 0) {return 'TRUE';}return filter.join(' AND ');};runIndividualizer.getFilterForOccassion = function(expression) {var result = '';var categories = ['subcategory2_uuid:', 'subcategory_uuid:', 'topcategory_uuid:', 'category_uuid:', 'subcategory2:', 'subcategory:', 'topcategory:', 'category:'];var andArray = expression.split(' AND ');var finalArray = [];var orArray = [];for (var iteratorI = 0; iteratorI < andArray.length; iteratorI++) {orArray = andArray[iteratorI].split(' OR ');for (var iteratorJ = 0; iteratorJ < orArray.length; iteratorJ++) {finalArray.push(orArray[iteratorJ]);if (iteratorJ < orArray.length - 1) {finalArray.push(' OR ');}}if (iteratorI < andArray.length - 1) {finalArray.push(' AND ');}}finalArray.forEach(function(item) {if (item.indexOf('deal_type:') >= 0) {item = item.replaceAll('deal_type:', 'json_array_contains_string(merchandising_tags,\\'');if (item.slice(-2) === '))') {item = item.slice(0, -2);item += \"')))\";} else if (item.slice(-1) === ')') {item = item.slice(0, -1);item += \"'))\";} else {item += \"')\";}}for (var index in categories) {if (item.indexOf(categories[index]) >= 0) {item = item.replaceAll(categories[index], 'customer_taxonomy_hierarchy LIKE \\'%');if (item.slice(-2) === '))') {item = item.slice(0, -2);item += \"%'))\";} else if (item.slice(-1) === ')') {item = item.slice(0, -1);item += \"%')\";} else {item += \"%'\";}break;}};if (item.indexOf('price:') >= 0) {orArray = [];item.split('price:').pop().split(';').forEach(function(priceRange) {priceRange = priceRange.replace('[', '').replace(']', '').split('..');orArray.push('(price_min >= ' + (parseFloat(priceRange[0]) * 100) + ' AND price_min <= ' + (parseFloat(priceRange[1]) * 100) + ')');});item = '(' + orArray.join(' OR ') + ')';}result += item;});return result;};runIndividualizer.getFilterForOccassionFromUrl = function() {var url = location.href.split('?');if (url.length !== 2) {return;}var parametersFinal = [];var parameters = decodeURIComponent(url.pop()).split('&');var categories = ['subcategory', 'topcategory', 'category'];parameters.forEach(function(parameter) {if (parameter.indexOf('priceFilters=') === 0) {parameter = parameter.replace('priceFilters=', 'price:');parameter = parameter.replaceAll(',', ';');parametersFinal.push(parameter);}categories.forEach(function(category) {if (parameter.indexOf(category + '=') === 0) {var arrayOr = [];parameter.split(category + '=').pop().split(',').forEach(function(categoryName) {arrayOr.push(category + ':' + categoryName);});parametersFinal.push('(' + arrayOr.join(' OR ') + ')');}});});return parametersFinal.join(' AND ');};runIndividualizer.isSalePriceInEffect = function(responseItem) {var index = runIndividualizer.getIndexOfVariant(responseItem);var now = Math.floor(new Date().getTime() \/ 1000);var startAt = responseItem['sale_price_start_at'];var endAt = responseItem['sale_price_end_at'];var currentPrice = JSON.parse(responseItem['price_array'])[index];var salePrice = responseItem['sale_price'];if (startAt && endAt && now > startAt && now < endAt && salePrice && salePrice < currentPrice) {return true;}return false;};runIndividualizer.getTitle = function(responseItem) {var merchantName = responseItem['merchant_name'];var titleArray = responseItem['title_array'];var titleGeneral = responseItem['title_general'].trim();if ((merchantName === titleGeneral || titleGeneral === '') && titleArray) {var index = runIndividualizer.getIndexOfVariant(responseItem);return JSON.parse(titleArray)[index];}return titleGeneral;};runIndividualizer.getAbTestGroupFromTheirAbTester = function() {if (false && location.host.slice(-4) === '.com' && !localStorage.getItem('db_forced_ab_tests')) {if (window.databreakersAudience === 'Control' && window.databreakersBucketedInExperiment === true) {return {'forcedAbTests': [{'abTestSelector': {'abTestId': 'groupon_abtest_main_off_on_5_5'},'groupSelector': {'abTestGroup': 0}}]};}if (window.databreakersAudience === 'Treatment') {return {'forcedAbTests': [{'abTestSelector': {'abTestId': 'groupon_abtest_main_off_on_5_5'},'groupSelector': {'abTestGroup': 1}}]};}if (window.databreakersAudience === 'Control' && window.databreakersBucketedInExperiment === false) {return {'forcedAbTests': [{'abTestSelector': {'abTestId': 'groupon_abtest_main_off_on_5_5'},'groupSelector': {'abTestGroup': 2}}]};}}return null;};runIndividualizer.getAbTestGroup = function(type) {var abTests = JSON.stringify(runIndividualizer.abTests);if (type === 'product_detail_2') {if (runIndividualizer.abTestProductDetailTitleUp) {if (abTests.indexOf('product_detail_title_up') >= 0) {return 'product_detail_title_up';}return 'product_detail_merchant_up';}return 'product_detail_title_up';}if (type === 'product_card') {return 'product_card_title_up';}if (type === 'product_detail') {return 'product_detail_description_up';}};runIndividualizer.hidePaginator = function(totalResults, count) {var page;var ellipsesEl;document.querySelectorAll('#pull-pagination a').forEach(function(el) {page = parseInt(el.href.split('page=').pop());if ((page * count) - totalResults > count) {el.parentElement.style.display = 'none';ellipsesEl = el.parentElement.nextElementSibling;if (ellipsesEl && ellipsesEl.classList.contains('ellipses')) {ellipsesEl.style.display = 'none';}ellipsesEl = el.parentElement.previousElementSibling;if (ellipsesEl && ellipsesEl.classList.contains('ellipses')) {ellipsesEl.style.display = 'none';}}});};runIndividualizer.cloneSponsoredDeals = function(idPosition) {var sponsoredDeals = [];var rootEl = runIndividualizer['config']['positions'][idPosition]['root_selector']['selection'];rootEl = document.querySelector(rootEl);var offset = rootEl.hasAttribute('data-offset') ? parseInt(rootEl.getAttribute('data-offset')) : 0;rootEl.querySelectorAll('figure[data-bhc]').forEach(function(el, index) {if (el.querySelector('.cui-sponsored-title') && index >= offset) {var image = el.querySelector('.cui-image');if (image.hasAttribute('data-srcset') && !image.classList.contains('lazy-loaded')) {image.setAttribute('src', image.getAttribute('data-srcset').split(',').pop().trim().split(' ')[0]);}sponsoredDeals.push({'index': index,'html': el.cloneNode(true)});}});runIndividualizer.sponsoredDeals[idPosition] = sponsoredDeals;};runIndividualizer.applySponsoredDeals = function(idPosition) {var deals = runIndividualizer.sponsoredDeals[idPosition];var rootEl = runIndividualizer['config']['positions'][idPosition]['root_selector']['selection'];rootEl = document.querySelector(rootEl);deals.forEach(function(sponsoredDeal, index) {var refEl = rootEl.querySelectorAll('figure[data-bhc]')[sponsoredDeal['index']];refEl.parentElement.insertBefore(sponsoredDeal['html'], refEl);});if (LS_Mustache_Params.gigConfig) {var count = deals.length;var elements = Array.prototype.slice.call(rootEl.querySelectorAll('figure[data-bhc]'));if (count > 0) {elements.slice((-1) * count).forEach(function(deal) {deal.remove();});}runIndividualizer.removedDealsCount[idPosition] = count;}};runIndividualizer.prepareMapDeals = function(recommendations) {var mapDeals = [];var el;var locations;var locationsCleaned;var rootEl = runIndividualizer['config']['positions']['category']['root_selector']['selection'];rootEl = document.querySelector(rootEl);recommendations.forEach(function(recommendation) {locations = recommendation['attributes']['redemption_locations_short'];if (locations) {locationsCleaned = [];locations = JSON.parse(locations);locations.forEach(function(location) {if (location.lat && location.lng) {locationsCleaned.push({'lat': location.lat,'lng': location.lng});}});el = rootEl.querySelector(\"[data-bhc='deal:\" + recommendation['itemId'] + \"']\");if (el && locationsCleaned.length > 0) {el = el.cloneNode(true);el.classList.add('cui-map-deal-card');mapDeals.push({'cardHtml': el.outerHTML,'locations': locationsCleaned,'markerImage': runIndividualizer.getMapMarker(recommendation['attributes']['category']),'markerImageDefault': 'https:\/\/www2.grouponcdn.com\/browse\/assets\/marker-default-a232ac1c8c.svg'});}}});runIndividualizer.mapDeals = mapDeals;};runIndividualizer.getMapMarker = function(category) {if (category.indexOf('Food & Drink') > 0) {return 'https:\/\/www2.grouponcdn.com\/browse\/assets\/marker-food-and-drink-581e615af8.svg';}if (category.indexOf('Things To Do') > 0 || category.indexOf('Health & Fitness') > 0) {return 'https:\/\/www2.grouponcdn.com\/browse\/assets\/marker-things-to-do-2202a43e3e.svg';}if (category.indexOf('Beauty & Spas') > 0) {return 'https:\/\/www1.grouponcdn.com\/browse\/assets\/marker-beauty-and-spas-6bfbf44d51.svg';}if (category.indexOf('Health & Beauty') > 0) {return 'https:\/\/www2.grouponcdn.com\/browse\/assets\/marker-health-and-fitness-7a707fd299.svg';}return 'https:\/\/www2.grouponcdn.com\/browse\/assets\/marker-default-a232ac1c8c.svg';};runIndividualizer.initMap = function() {if (runIndividualizer.mapHasBeenInitialized) {return;}runIndividualizer.mapHasBeenInitialized = true;if (location.href.indexOf('map=showMapView') > 0) {var interval = setInterval(function() {if (window.BrowseMapsApplication) {clearInterval(interval);setTimeout(function() {window.BrowseMapsApplication.handleFetchSuccess({\"mapCards\": runIndividualizer.mapDeals});}, 1000);}}, 300);}var observer = new MutationObserver(function(entries) {if (entries.length === 1 && entries[0]['attributeName'] === 'class') {setTimeout(function() {window.BrowseMapsApplication.handleFetchSuccess({\"mapCards\": runIndividualizer.mapDeals});}, 2000);}});observer.observe(document.querySelector('#pull-map-container'), {attributes: true,childList: false,subtree: false});};runIndividualizer.getContextVariables = function() {var ell = runDataGatherer.loadCookie({'mode': 'specific','parameters': ['ell']}).ell;var division = runDataGatherer.loadCookie({'mode': 'specific','parameters': ['division']}).division;var isDesktop = LS_Mustache_Params.hasOwnProperty('gigConfig');var data = isDesktop ? LS_Mustache_Params.gigConfig.division : LS_Mustache_Params.mobileConfig.division;var divisionPermalink = isDesktop ? LS_Mustache_Params.gigConfig.division.id : LS_Mustache_Params.mobileConfig.division.id;if (ell) {var lat = decodeURIComponent(ell).split(',')[0].toString();var lng = decodeURIComponent(ell).split(',')[1].toString();} else {var lat = data.lat.toString();var lng = data.lng.toString();}if (division) {var city = division.charAt(0).toUpperCase() + division.slice(1);} else {var city = data.name;}var obj = {'city': city,'lat': lat,'lng': lng,'device_type': isDesktop ? 'desktop' : 'touch','division_permalink': divisionPermalink};if (location.host.slice(-4) === '.com' && window.hasOwnProperty('__LS_INITIAL_STATE__') && __LS_INITIAL_STATE__.hasOwnProperty('location') && __LS_INITIAL_STATE__.location.hasOwnProperty('address')) {obj.country = __LS_INITIAL_STATE__.location.address.indexOf('Canada') >= 0 ? 'CA' : 'US';}return obj;};runIndividualizer.addBandCards = function(idPosition) {var rootEl = runIndividualizer['config']['positions'][idPosition]['root_selector']['selection'];rootEl = document.querySelector(rootEl);var refEl;if (idPosition === 'search') {refEl = rootEl.querySelector('#pull-pagination');if (refEl && runIndividualizer.bandCards) {rootEl.insertBefore(runIndividualizer.bandCards, refEl);}}if (idPosition === 'search_mobile') {if (runIndividualizer.bandCards) {rootEl.append(runIndividualizer.bandCards);}}};runIndividualizer.addAds = function(idPosition) {var rootEl = runIndividualizer['config']['positions'][idPosition]['root_selector']['selection'];rootEl = document.querySelector(rootEl);var refEl;if (idPosition === 'search') {refEl = rootEl.querySelector('figure.card-ui:nth-of-type(12)');if (refEl && runIndividualizer.ads.length > 0) {rootEl.insertBefore(runIndividualizer.ads[0], refEl.nextSibling);}if (runIndividualizer.ads.length > 1) {rootEl.append(runIndividualizer.ads[1]);}}if (idPosition === 'search_mobile') {refEl = rootEl.querySelector('figure.card-ui:nth-of-type(4)');if (refEl && runIndividualizer.ads.length > 0) {rootEl.insertBefore(runIndividualizer.ads[0], refEl.nextSibling);}refEl = rootEl.querySelector('figure.card-ui:nth-of-type(6)');if (refEl && runIndividualizer.ads.length > 1) {rootEl.insertBefore(runIndividualizer.ads[1], refEl.nextSibling);}}if (idPosition === 'category') {if (runIndividualizer.ads.length > 0) {rootEl.prepend(runIndividualizer.ads[0]);}refEl = rootEl.querySelector('figure.card-ui:nth-of-type(12)');if (refEl && runIndividualizer.ads.length > 1) {rootEl.insertBefore(runIndividualizer.ads[1], refEl.nextSibling);}if (runIndividualizer.ads.length > 2) {rootEl.append(runIndividualizer.ads[2]);}}if (idPosition === 'category_mobile') {if (runIndividualizer.ads.length > 0) {rootEl.prepend(runIndividualizer.ads[0]);}refEl = rootEl.querySelector('figure.card-ui:nth-of-type(4)');if (refEl && runIndividualizer.ads.length > 1) {rootEl.insertBefore(runIndividualizer.ads[1], refEl.nextSibling);}refEl = rootEl.querySelector('figure.card-ui:nth-of-type(6)');if (refEl && runIndividualizer.ads.length > 2) {rootEl.insertBefore(runIndividualizer.ads[2], refEl.nextSibling);}}};runIndividualizer.isCashBackDeal = function(responseItem) {var index = runIndividualizer.getIndexOfVariant(responseItem);var price = JSON.parse(responseItem['price_array'])[index];if (responseItem['gallery_title'] && responseItem['gallery_title'].indexOf('% Cash Back') > 0 && price === 0 && runIndividualizer.translations.freeToClaim) {return true;}return false;};runIndividualizer.getCashBack = function(responseItem) {return responseItem['gallery_title'].split('% Cash Back')[0] + '% Cash Back';};runIndividualizer.initScrollTo = function() {var state = history.state;if (state.dbScrollTop) {document.documentElement.scrollTo(0, state.dbScrollTop);}window.addEventListener('scroll', function() {var state = history.state;state.dbScrollTop = document.documentElement.scrollTop;history.replaceState(state, '');});};runIndividualizer.hideReviews = function() {if (location.host.slice(-4) === '.com') {return;}if (runIndividualizer.reviewsHaveBeenHidden) {return;}runIndividualizer.reviewsHaveBeenHidden = true;var css = runIndividualizer.createElementFromHTML(\"<style id='db_product_detail_css_reviews'>article.pitch { visibility: hidden; }<\/style>\");document.querySelector('head').append(css);};runIndividualizer.moveAndShowReviews = function() {if (location.host.slice(-4) === '.com') {return;}if (runIndividualizer.reviewsHaveBeenMoved) {return;}runIndividualizer.reviewsHaveBeenMoved = true;var css = document.querySelector('#db_product_detail_css_reviews');if (css) {css.remove();}var abTestGroup = runIndividualizer.getAbTestGroup('product_detail');if (abTestGroup !== 'product_detail_description_up') {return;}var tips = document.querySelector('#tips');var refEl = document.querySelector('article.pitch');if (LS_Mustache_Params && LS_Mustache_Params.mobileConfig) {refEl = document.querySelector('.merchant-section');}if (tips && refEl) {if (LS_Mustache_Params && LS_Mustache_Params.mobileConfig) {var el = tips.cloneNode(true);refEl.parentElement.insertBefore(el, refEl.nextSibling);tips.remove();}if (LS_Mustache_Params && LS_Mustache_Params.gigConfig) {refEl.append(tips);}}};runIndividualizer.hideDealTitleAndMerchantTitle = function() {if (runIndividualizer.dealTitleAndMerchantTitleHaveBeenHidden) {return;}runIndividualizer.dealTitleAndMerchantTitleHaveBeenHidden = true;var el = document.querySelector('.deal-title-group.with-prominent-merchant-v2');if (!el) {return;}var css = runIndividualizer.createElementFromHTML(\"<style id='db_product_detail_css_title'>.deal-title-group { visibility: hidden; }<\/style>\");document.querySelector('head').append(css);};runIndividualizer.moveAndShowDealTitleAndMerchantTitle = function() {if (runIndividualizer.dealTitleAndMerchantTitleHaveBeenMoved) {return;}runIndividualizer.dealTitleAndMerchantTitleHaveBeenMoved = true;var css = document.querySelector('#db_product_detail_css_title');if (css) {css.remove();}var abTestGroup = runIndividualizer.getAbTestGroup('product_detail_2');if (abTestGroup !== 'product_detail_title_up') {return;}var el = document.querySelector('.deal-title-group.with-prominent-merchant-v2');var dealTitleEl = document.querySelector('#deal-title');var merchantTitleEl = document.querySelector('.deal-title-group .deal-with-tag');if (!el || !dealTitleEl || !merchantTitleEl) {return;}var dealTitleText = dealTitleEl.textContent;var merchantTitleText = merchantTitleEl.textContent;dealTitleEl.innerHTML = merchantTitleText;merchantTitleEl.innerHTML = \"<svg xmlns='http:\/\/www.w3.org\/2000\/svg' width='32' height='32' viewBox='0 0 32 32' class='subtitle-icon' title='subtitle-info' aria-hidden='true' role='img' focusable='false' aria-labelledby='deal-with-tag'><path d='M14.25 29.96c-.51 0-1.02-.19-1.41-.58L2.63 19.16a2.01 2.01 0 0 1 0-2.83L16.38 2.59c.38-.38.88-.59 1.41-.59H28a2 2 0 0 1 2 2v10.21a2 2 0 0 1-.58 1.41L15.66 29.37a2 2 0 0 1-1.41.59zM17.79 4 4.04 17.75l10.21 10.2L28 14.21V4H17.79zm2.71 11a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7zm0-5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3z'><\/path><\/svg>\" + dealTitleText;};runIndividualizer.showLocationPopup = function() {return;if (!localStorage.getItem('db_forced_ab_tests')) {return;}if (!runIndividualizer.featureSwitch.hasOwnProperty('showLocationPopup')) {return;}if (sessionStorage.getItem('db_show_location_popup')) {return;}var css = runIndividualizer.createElementFromHTML(\"<style id='db_location_popup_css'>#db_location_popup { position: absolute; #db_location_popup.top { top: 100%; } #db_location_popup.bottom { bottom: 100%; } }<\/style>\");document.querySelector('head').append(css);var popupEl = runIndividualizer.createElementFromHTML(\"<div id='db_location_popup'><button class='accept'>\" + runIndividualizer.translations.locationPopupAccept + \"<\/button><button class='deny'>\" + runIndividualizer.translations.locationPopupDeny + \"<\/button><\/div>\");var refEl = document.querySelector('#ls-landing-search-form');var isHomepageVersion = true;popupEl.classList.add('top');if (!refEl) {refEl = document.querySelector('#ls-search-form');popupEl.classList.remove('top');popupEl.classList.add('bottom');isHomepageVersion = false;if (!refEl) {return;}}popupEl.querySelector('.accept').addEventListener('click', function(event) {sessionStorage.setItem('db_show_location_popup');});popupEl.querySelector('.deny').addEventListener('click', function(event) {sessionStorage.setItem('db_show_location_popup');if (isHomepageVersion) {}var button = document.querySelector('#ls-location-wrap');button.click();});};runIndividualizer.isCouponDeal = function(responseItem) {var inventoryServiceId = responseItem['inventory_service_id'];if (inventoryServiceId && inventoryServiceId === 'coupons') {return true;}return false;};runIndividualizer.isMembersOnlyDeal = function(responseItem) {var isUserLoggedIn = __LS_INITIAL_STATE__.auth.user.id;var restricted = responseItem['restricted'];var restrictedReason = responseItem['restricted_reason'];if (!isUserLoggedIn && restricted && restrictedReason && restrictedReason.indexOf('MEMBER_ONLY') >= 0 && runIndividualizer.translations.priceHidden && runIndividualizer.translations.memberPricing) {return true;}return false;};runIndividualizer.isGetawaysDeal = function(responseItem) {var channel = responseItem['channel'];if (channel && channel === 'getaways' && location.host.slice(-4) === '.com') {return true;}return false;};runIndividualizer.isPossibleToShowDiscount = function(responseItem) {if (!responseItem.hasOwnProperty('show_discount') || responseItem['show_discount'] === 1) {return true;}return false;};runIndividualizer.showLocationPopup();runDataGatherer.makeCustomPostRequest = function(url, body, callback) {fetch(url, {method: 'POST',body: JSON.stringify(body),headers: {'Content-type': 'application\/json; charset=UTF-8'}}).then(function(response) {return response.json();}).then(function(json) {callback(json);});};runIndividualizer.purplePrices = {};runIndividualizer.getPurplePrices = function(idRequest, callback) {var items = runIndividualizer.recommendations[idRequest];if (!items || items.length === 0) {return;}var consumerId;if (window.hasOwnProperty('__LS_INITIAL_STATE__') && __LS_INITIAL_STATE__.hasOwnProperty('auth') && __LS_INITIAL_STATE__.auth.hasOwnProperty('user') && __LS_INITIAL_STATE__.auth.user.hasOwnProperty('id')) {consumerId = __LS_INITIAL_STATE__.auth.user.id;} else {consumerId = null;}var body = {'context': {'country': document.querySelector('head').getAttribute('data-country'),'locale': document.querySelector('head').getAttribute('data-locale'),'enablePersonalization': true},'consumer': {'consumerId': consumerId,'bCookie': runDataGatherer.loadCookie({'mode': 'specific','parameters': ['b']})['b']},'deals': []};items.forEach(function(item) {var index = runIndividualizer.getIndexOfVariant(item['attributes']);var attributes = {};attributes['inventory_product_id'] = item['attributes']['inventory_product_id'];attributes['price_array'] = JSON.parse(item['attributes']['price_array']);attributes['currency'] = item['attributes']['currency'];attributes['inventory_service_id'] = item['attributes']['inventory_service_id'];attributes['channel_id'] = item['attributes']['channel_id'];attributes['pds_id'] = item['attributes']['pds_id'];attributes['eligible_for_groupon_incentives'] = item['attributes']['eligible_for_groupon_incentives'];if (localStorage.getItem('db_forced_ab_tests')) {if (!attributes['eligible_for_groupon_incentives']) {return;}} else {if (runIndividualizer.isSalePriceInEffect(item['attributes']) || !attributes['eligible_for_groupon_incentives']) {return;}};body.deals.push({'id': item['itemId'],'eligibleForGrouponIncentives': attributes['eligible_for_groupon_incentives'],'channels': [attributes['channel_id']],'categoryIds': [attributes['pds_id']],'inventoryProducts': [{'id': attributes['inventory_product_id'],'isid': attributes['inventory_service_id'],'priceSummary': {'price': {'amount': attributes['price_array'][index],'currencyCode': attributes['currency']}},'programType': runIndividualizer.isSalePriceInEffect(item['attributes']) ? 'SALE' : null,'sellerOfRecord': null}]});});var url = 'https:\/\/' + location.host + '\/browse\/api\/proxy\/bulkBestPromotionOnDeal';runDataGatherer.makeCustomPostRequest(url, body, function(response) {var purplePrices = response;callback(idRequest, purplePrices);});};runIndividualizer.renderPurplePrices = function(idRequest, rootEl) {var attempts = 0;var interval = setInterval(function() {attempts++;if (attempts > 15) {clearInterval(interval);return;}if (runIndividualizer.purplePrices[idRequest]) {clearInterval(interval);rootEl.querySelectorAll('[data-bhc]').forEach(function(el) {var id = el.getAttribute('data-bhc').split('deal:').pop();var purplePrice = runIndividualizer.purplePrices[idRequest][id];var purplePriceEl = el.querySelector('.cui-purple-price-container');if (purplePrice && !purplePriceEl) {var refEl = el.querySelector('.cui-combined-section');purplePriceEl = runIndividualizer.createElementFromHTML(\"<div class='cui-single-section'><div class='cui-purple-price-container'><div class='cui-purple cui-offer'><div class='cui-sr-only'>\" + purplePrice.price + ' ' + runIndividualizer.translations['withPromo'] + ' ' + purplePrice.promoCode + \"<\/div><div class='cui-purple-price' aria-hidden='true'>\" + purplePrice.price + \"<\/div><div class='cui-purple-price-text'>\" + runIndividualizer.translations['withPromo'] + ' ' + purplePrice.promoCode + \"<\/div><\/div><\/div><\/div>\");refEl.parentNode.insertBefore(purplePriceEl, refEl.nextSibling);}});}}, 300);};runIndividualizer.getAndSavePurplePrices = function(idRequest) {runIndividualizer.getPurplePrices(idRequest, function(idRequest, purplePrices) {var result = {};purplePrices['promotions'].forEach(function(promotion) {result[promotion['dealId']] = {'price': promotion['eligiblePromotions'][0]['finalDiscountedPrice'],'promoCode': promotion['eligiblePromotions'][0]['promocode']}});runIndividualizer.purplePrices[idRequest] = result;});};runIndividualizer.currencySymbols = {'AED': 'AED','AUD': '$','NZD': '$','EUR': '\u20ac','HKD': 'HKD','PLN': 'z\u0142','GBP': '\u00a3','CAD': 'C$','SEK': 'kr','USD': '$'};runIndividualizer.priceMasks = {'AED': '{currencySymbol}{price}','AUD': '{currencySymbol}{price}','NZD': '{currencySymbol}{price}','EUR': '{price} {currencySymbol}','HKD': '{price} {currencySymbol}','PLN': '{price} {currencySymbol}','GBP': '{currencySymbol}{price}','CAD': '{currencySymbol}{price}','SEK': '{price} {currencySymbol}','USD': '{currencySymbol}{price}'};runIndividualizer.startTime = new Date().getTime();runIndividualizer.durationLock = {};runIndividualizer.homepageMobileItems = [];runIndividualizer.sponsoredDeals = {};runIndividualizer.removedDealsCount = {};runIndividualizer.mapDeals = [];runIndividualizer.ads = [];","positions":{"basket":{"type":"recommendation","running":!0,"run_condition":"location.pathname === '\/cart' && LS_Mustache_Params && LS_Mustache_Params.gigConfig","multiple":!0,"apply_only_last_request":!0,"root_selector":{"mode":"css","selection":"#db_basket"},"run_handler":"var css = runIndividualizer.createElementFromHTML(\"<style id='db_basket_css'>.cui-c-desktop-carousel .cui-compound-header, .cui-flex-text-row{-webkit-box-pack: justify;-moz-box-pack: justify;-o-box-pack: justify;-ms-flex-pack: justify;display: -webkit-box;display: -moz-box;display: -webkit-flex;display: -ms-flexbox;display: box;display: flex;-webkit-justify-content: space-between;justify-content: space-between}.cui-compound-header{font-size: 1.6rem;margin: 0;padding: 0 12px 16px;position: relative}.cui-compound-header .compound-title{color: var(--color-black);font-weight: 800;line-height: 32px;margin: 0}.cui-carousel-pagination{-webkit-box-align: end;-moz-box-align: end;-o-box-align: end;-ms-flex-align: end;-webkit-align-items: flex-end;align-items: flex-end;display: -webkit-box;display: -moz-box;display: -webkit-flex;display: -ms-flexbox;display: box;display: flex}.cui-pagination-numbers{font-weight: 600;margin-right: 1.6rem}.cui-arrow-next, .cui-arrow-previous, .cui-pagination-numbers{-webkit-box-pack: center;-moz-box-pack: center;-o-box-pack: center;-ms-flex-pack: center;-webkit-box-align: center;-moz-box-align: center;-o-box-align: center;-ms-flex-align: center;-webkit-align-items: center;align-items: center;display: -webkit-box;display: -moz-box;display: -webkit-flex;display: -ms-flexbox;display: box;display: flex;height: 4rem;-webkit-justify-content: center;justify-content: center}.cui-arrow-next, .cui-arrow-previous{border: .1rem solid #d5d8db;border-radius: 20px;color: #333;cursor: pointer;text-decoration: none;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;width: 4rem}.cui-arrow-next svg, .cui-arrow-next svg path, .cui-arrow-previous svg, .cui-arrow-previous svg path{pointer-events: none}.cui-arrow-next:hover, .cui-arrow-previous:hover{border-color: #333}.cui-arrow-previous{margin-right: .8rem}.carousel-content{scroll-behavior: smooth;}.cui-bounce-right{-webkit-animation: cui-bounce-right .3s ease-in-out;-moz-animation: cui-bounce-right .3s ease-in-out;-o-animation: cui-bounce-right .3s ease-in-out;-ms-animation: cui-bounce-right .3s ease-in-out;animation: cui-bounce-right .3s ease-in-out}@-moz-keyframes cui-bounce-right{0%{-webkit-transform: translateX(0);-moz-transform: translateX(0);-o-transform: translateX(0);-ms-transform: translateX(0);transform: translateX(0)}50%{-webkit-transform: translateX(-40px);-moz-transform: translateX(-40px);-o-transform: translateX(-40px);-ms-transform: translateX(-40px);transform: translateX(-40px)}to{-webkit-transform: translateX(0);-moz-transform: translateX(0);-o-transform: translateX(0);-ms-transform: translateX(0);transform: translateX(0)}}@-webkit-keyframes cui-bounce-right{0%{-webkit-transform: translateX(0);-moz-transform: translateX(0);-o-transform: translateX(0);-ms-transform: translateX(0);transform: translateX(0)}50%{-webkit-transform: translateX(-40px);-moz-transform: translateX(-40px);-o-transform: translateX(-40px);-ms-transform: translateX(-40px);transform: translateX(-40px)}to{-webkit-transform: translateX(0);-moz-transform: translateX(0);-o-transform: translateX(0);-ms-transform: translateX(0);transform: translateX(0)}}@-o-keyframes cui-bounce-right{0%{-webkit-transform: translateX(0);-moz-transform: translateX(0);-o-transform: translateX(0);-ms-transform: translateX(0);transform: translateX(0)}50%{-webkit-transform: translateX(-40px);-moz-transform: translateX(-40px);-o-transform: translateX(-40px);-ms-transform: translateX(-40px);transform: translateX(-40px)}to{-webkit-transform: translateX(0);-moz-transform: translateX(0);-o-transform: translateX(0);-ms-transform: translateX(0);transform: translateX(0)}}@keyframes cui-bounce-right{0%{-webkit-transform: translateX(0);-moz-transform: translateX(0);-o-transform: translateX(0);-ms-transform: translateX(0);transform: translateX(0)}50%{-webkit-transform: translateX(-40px);-moz-transform: translateX(-40px);-o-transform: translateX(-40px);-ms-transform: translateX(-40px);transform: translateX(-40px)}to{-webkit-transform: translateX(0);-moz-transform: translateX(0);-o-transform: translateX(0);-ms-transform: translateX(0);transform: translateX(0)}}.cui-bounce-left{-webkit-animation: cui-bounce-left .3s ease-in-out;-moz-animation: cui-bounce-left .3s ease-in-out;-o-animation: cui-bounce-left .3s ease-in-out;-ms-animation: cui-bounce-left .3s ease-in-out;animation: cui-bounce-left .3s ease-in-out}@-moz-keyframes cui-bounce-left{0%{-webkit-transform: translateX(0);-moz-transform: translateX(0);-o-transform: translateX(0);-ms-transform: translateX(0);transform: translateX(0)}50%{-webkit-transform: translateX(40px);-moz-transform: translateX(40px);-o-transform: translateX(40px);-ms-transform: translateX(40px);transform: translateX(40px)}to{-webkit-transform: translateX(0);-moz-transform: translateX(0);-o-transform: translateX(0);-ms-transform: translateX(0);transform: translateX(0)}}@-webkit-keyframes cui-bounce-left{0%{-webkit-transform: translateX(0);-moz-transform: translateX(0);-o-transform: translateX(0);-ms-transform: translateX(0);transform: translateX(0)}50%{-webkit-transform: translateX(40px);-moz-transform: translateX(40px);-o-transform: translateX(40px);-ms-transform: translateX(40px);transform: translateX(40px)}to{-webkit-transform: translateX(0);-moz-transform: translateX(0);-o-transform: translateX(0);-ms-transform: translateX(0);transform: translateX(0)}}@-o-keyframes cui-bounce-left{0%{-webkit-transform: translateX(0);-moz-transform: translateX(0);-o-transform: translateX(0);-ms-transform: translateX(0);transform: translateX(0)}50%{-webkit-transform: translateX(40px);-moz-transform: translateX(40px);-o-transform: translateX(40px);-ms-transform: translateX(40px);transform: translateX(40px)}to{-webkit-transform: translateX(0);-moz-transform: translateX(0);-o-transform: translateX(0);-ms-transform: translateX(0);transform: translateX(0)}}@keyframes cui-bounce-left{0%{-webkit-transform: translateX(0);-moz-transform: translateX(0);-o-transform: translateX(0);-ms-transform: translateX(0);transform: translateX(0)}50%{-webkit-transform: translateX(40px);-moz-transform: translateX(40px);-o-transform: translateX(40px);-ms-transform: translateX(40px);transform: translateX(40px)}to{-webkit-transform: translateX(0);-moz-transform: translateX(0);-o-transform: translateX(0);-ms-transform: translateX(0);transform: translateX(0)}}<\/style>\");document.querySelector('head').append(css);css = runIndividualizer.createElementFromHTML(\"<style id='db_basket_css_2'>[data-bhc='compound:crossChannel_cart_rich_relevance_recs1'], [data-bhc='compound:crossChannel_Cart_Summary_All'], #app #info { display: none; }<\/style>\");document.querySelector('head').append(css);css = runIndividualizer.createElementFromHTML(\"<style id='db_basket_css_3'>#info { display: none; }<\/style>\");document.querySelector('head').append(css);","input_handler":"runIndividualizer.requestData.returnedAttributes = ['title_array', 'sale_price_start_at', 'sale_price_end_at', 'gallery_title', 'currency', 'category', 'inventory_service_id', 'restricted_reason', 'restricted', 'show_discount', 'deal_option_id_array', 'category_guids_object', 'category_guids', 'eligible_for_groupon_incentives', 'pds_id', 'channel_id', 'inventory_product_id'];runIndividualizer.requestData.output = ['scriptAbTest', 'mainAbTest'];runIndividualizer.requestData.contextVariables = runIndividualizer.getContextVariables();var items = [];var data = JSON.parse(gtmData.data.replace(\/&quot;\/g, '\"'));var ids = data['dl_deal_option_uuid'];if (ids) {ids = ids.split(',');ids.forEach(function(id, num) {items.push({'itemId': id});});};runIndividualizer.requestData.items = items;var abTestGroup = runIndividualizer.getAbTestGroupFromTheirAbTester();if (abTestGroup) {runIndividualizer.requestData.abTests = abTestGroup;}","received_response_handler":"sessionStorage.setItem('db_abtests', JSON.stringify(runIndividualizer.abTests));runIndividualizer.getAndSavePurplePrices(runIndividualizer.idRequest);","before_render_handler":"var positionEl = \"<section class='main'><div class='row page-container'><figure class='card-ui cui-c-compound cui-four-up cui-c-desktop-carousel'><figcaption class='cui-compound-header'><div class='compound-header-left-container'><h2 class='compound-title' style='font-weight:800;'>\" + runIndividualizer.translations['basketHeadline'] + \"<\/h2><\/div><div class='cui-carousel-pagination'><span class='cui-pagination-numbers'><span class='current-page'><\/span>&nbsp;<span>\" + runIndividualizer.translations['of'] + \"<\/span>&nbsp;<span class='total-pages'><\/span><\/span> <button aria-label='Previous' class='cui-arrow-previous disabled' data-bhc='carousel:previous'><svg height='24px' viewbox='0 0 32 32' width='24px' xmlns='http:\/\/www.w3.org\/2000\/svg'><path d='M20.71 25.29a1 1 0 1 1-1.41 1.41l-10-10a1 1 0 0 1 0-1.41l10-10a1 1 0 1 1 1.41 1.41l-9.3 9.3 9.3 9.29z'><\/path><\/svg><\/button> <button aria-label='Next' class='cui-arrow-next' data-bhc='carousel:next'><svg height='24px' viewbox='0 0 32 32' width='24px' xmlns='http:\/\/www.w3.org\/2000\/svg'><path d='M11.29 25.29a1 1 0 1 0 1.41 1.41l10-10a1 1 0 0 0 0-1.41l-10-10a1 1 0 1 0-1.41 1.41l9.3 9.3-9.3 9.29z'><\/path><\/svg><\/button><\/div><\/figcaption><div class='cui-content-holder'><div class='cui-cards-wrapper carousel'><div id='db_basket' class='cui-content carousel-content has-scroll-listener'><\/div><\/div><\/div><\/figure><\/div><\/section>\";var itemEl = \"<figure class='card-ui cui-c-udc price-badge-filled-background left-aligned-card is-getaways-booking has-additional-discount-percent' data-bhc=''><div class='cui-content'><a href=''><div class='cui-udc-image-container rounded-corners'><div class='cui-udc-image-overlay'><\/div><div class='cui-image-lazy-container cui-image-hover-zoom'><img class='cui-svg-placeholder' height='211' width='349'><img class='cui-image lazy-load lazy-loaded' data-ll-status='loaded' src='' style='position: absolute; top: 0;'><\/div><\/div><div class='cui-udc-details cui-udc-left-aligned-details'><div class='cui-single-section'><div class='cui-udc-title one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-location cui-truncate cui-has-distance' style='display: none;'><span class='cui-location-name'><\/span><span class='cui-location-separator'>\u2022<\/span><span class='cui-location-distance'><\/span><\/div><\/div><div class='cui-single-section'><div class='cui-review-rating' style='display: none;'><div aria-hidden='true' class='numeric-count'><\/div><ul class='rating rating-numeric'><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><\/ul><div class='rating-count'><\/div><\/div><\/div><div class='cui-bottom-body'><div class='cui-combined-section'><div class='cui-price' data-pingdom-id='deal-price'><div aria-hidden='true' class='cui-price-original c-txt-gray-dk' style='display: none;'><\/div><div aria-hidden='true' class='cui-price-discount c-txt-price'><div class='cui-price-descriptor' style='display: none;'><\/div><span><\/span><div class='cui-price-descriptor' style='display: none;'><\/div><\/div><\/div><div class='cui-promotions'><div class='cui-detail-badge cui-discount-badge' style='display: none;'><\/div><div class='cui-urgent cui-offer' style='display: none;'><div><\/div><div class='cui-verbose-urgency-price' aria-hidden='true'><\/div><div class='cui-verbose-urgency-text'><\/div><\/div><\/div><\/div><div class='cui-single-section'><div class='cui-udc-subtitle one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-urgency-message' data-bhc><\/div><\/div><\/div><\/div><\/a><div class='cui-book-online-cta__container' style='display: none;'><a class='cui-book-online-cta' href=''>\" + runIndividualizer.translations.bookOnline + \"<\/a> <\/div><\/div><\/figure>\";var refEl = document.querySelector('#app');refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML(positionEl), refEl.nextElementSibling);var rootEl = document.querySelector('#db_basket');rootEl.innerHTML = itemEl;var infoEl = document.querySelector('#info');if (infoEl) {refEl = rootEl.closest('.main');var ourInfoEl = infoEl.cloneNode(true);refEl.parentElement.insertBefore(ourInfoEl, refEl.nextElementSibling);infoEl.remove();}","output_handler":"var interval = setInterval(function() {var messages = document.querySelectorAll('#db_basket .cui-urgency-message');if (messages[0].innerHTML === '') {clearInterval(interval);messages.forEach(function(el) {el.innerHTML = el.getAttribute('data-message');});}}, 100);setTimeout(function() {clearInterval(interval);}, 3000);var rootEl = document.querySelector('#db_basket');runIndividualizer.initDesktopCarousel(rootEl);el = document.querySelector('#db_basket_css_3');if (el) {el.remove();};runIndividualizer.renderPurplePrices(runIndividualizer.idRequest, rootEl);","empty_response_handler":"var el = document.querySelector('#db_basket_css_2');if (el) {el.remove();}el = document.querySelector('#db_basket_css_3');if (el) {el.remove();}","events":[{"type":["DOMContentLoaded"],"selector":{"mode":"css","selection":"#app"},"input_handler":"","timeout_handler":"if (!runIndividualizer.recommendations.hasOwnProperty(runIndividualizer.idRequest)) {var el = document.querySelector('#db_basket_css_2');if (el) {el.remove();}}el = document.querySelector('#db_basket_css_3');if (el) {el.remove();}","timeout":10000}],"item_attributes":{"_customer_item_id":{"property":"data-bhc","output_handler":"runIndividualizer.element.setAttribute('data-bhc', 'deal:' + runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":""},"required":!0},"channel":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseData === 'marketrate-hotel' || runIndividualizer.responseItem['is_travel_bookable_deal']) {runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"discount_percent_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = JSON.parse(runIndividualizer.responseItem['value_array'])[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && data[index] > 0 && !isSalePriceInEffect && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = data[index] + '% ' + runIndividualizer.translations.discountBadgeText;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-discount-badge"},"required":!0},"is_bookable":{"property":"data-style","output_handler":"if (runIndividualizer.responseData) {runIndividualizer.element.style.display = 'flex';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-book-online-cta__container"},"required":!0},"is_travel_bookable_deal":{"property":"data-is-travel-bookable-deal","output_handler":"runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"med_image":{"property":"src","output_handler":"runIndividualizer.responseData = runIndividualizer.responseData.replace('t300x182.jpg', 'c349x211.webp');","run_condition":"","internal_selector":{"mode":"css","selection":".cui-image"},"required":!0},"merchant_name":{"property":"innerHTML","output_handler":"var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') < 0 && !isCashBackDeal && !isGetawaysDeal) {var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {runIndividualizer.element.classList.remove('one-line-truncate');var title = runIndividualizer.getTitle(runIndividualizer.responseItem);if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}runIndividualizer.responseData = title;}}var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.translations.memberPricing + ' ' + runIndividualizer.responseData;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-title"},"required":!0},"price_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);runIndividualizer.responseData = runIndividualizer.getFormattedPrice(data[index], runIndividualizer.responseItem['currency']);var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {var el = runIndividualizer.element.parentElement;el.classList.remove('c-txt-price');el.classList.add('cui-price-message', 'cui-price-hidden');el.innerHTML = runIndividualizer.translations.priceHidden;} else {if (isCashBackDeal) {runIndividualizer.responseData = runIndividualizer.getCashBack(runIndividualizer.responseItem);} else {if (data.length > 1) {var wrapEl = runIndividualizer.element.parentElement;var el = wrapEl.querySelector('.cui-price-discount .cui-price-descriptor:first-child');if (isSalePriceInEffect) {wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');wrapEl.closest('figure').querySelector('.cui-promotions .cui-offer div:first-child').innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';} else {el.innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';}el.style.display = 'block';}if (data.length === 1 && isSalePriceInEffect) {var wrapEl = runIndividualizer.element.parentElement;wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');}}var isCouponDeal = runIndividualizer.isCouponDeal(runIndividualizer.responseItem);if (isCouponDeal) {runIndividualizer.element.parentElement.parentElement.style.display = 'none';}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount span"},"required":!0},"purchases_total_displayed":{"property":"innerHTML","output_handler":"var num = runIndividualizer.responseData;var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (num > 10 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(num \/ 10) * 10) + '+ ' + runIndividualizer.translations.bought;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1},"rating_count":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_value']) {runIndividualizer.responseData = runIndividualizer.responseData + ' ' + runIndividualizer.translations.ratings;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .rating-count"},"required":!1},"rating_value":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_count']) {var value = runIndividualizer.responseData;var wrapEl = runIndividualizer.element.closest('.cui-review-rating');wrapEl.style.display = 'flex';var stars = wrapEl.querySelectorAll('ul li span');stars.forEach(function(el, num) {if (num + 0.8 <= value) {el.classList.value = 'full-star';} else if (num + 0.3 <= value) {el.classList.value = 'half-star';} else {el.classList.value = 'empty-star';}});} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .numeric-count"},"required":!1},"redemption_locations_short":{"property":"data-location","output_handler":"var locations = JSON.parse(runIndividualizer.responseData);var filteredLocations = [];locations.forEach(function(location) {if (location.hasOwnProperty('lat') && location.hasOwnProperty('lng')) {filteredLocations.push(location);}});locations = filteredLocations;if (locations.length > 0) {var location = runIndividualizer.getNearestLocation(locations);var address = [];if (location['streetAddress1']) {address.push(location['streetAddress1']);}if (location['city']) {address.push(location['city']);}var el = runIndividualizer.element.querySelector('.cui-location-name');if (el) {el.innerHTML = address.join(', ');}var distance = location['distanceInKm'];var unit = runIndividualizer.translations.distanceUnit;if (unit === 'mi') {distance = distance \/ 1.609;}distance = Math.round(distance * 10) \/ 10;var el = runIndividualizer.element.querySelector('.cui-location-distance');if (el) {el.innerHTML = distance + ' ' + unit;}runIndividualizer.element.style.display = 'block';} else {runIndividualizer.element.style.display = 'none';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-location"},"required":!1},"sale_price":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isSalePriceInEffect && !isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(runIndividualizer.responseData, runIndividualizer.responseItem['currency']);var wrapEl = runIndividualizer.element.parentElement;wrapEl.querySelector('.cui-verbose-urgency-text').innerHTML = runIndividualizer.translations.limitedTime;wrapEl.style.display = 'flex';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-offer .cui-verbose-urgency-price"},"required":!1},"title_general":{"property":"innerHTML","output_handler":"var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') >= 0) {var title = runIndividualizer.responseData.trim();if (title === '') {var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseItem['title_array']);var title = data[index];}if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}var el = runIndividualizer.element.closest('figure').querySelector('.cui-udc-title');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {el.classList.remove('one-line-truncate');if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}}el.innerHTML = title;runIndividualizer.responseData = '';} else {var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (isCashBackDeal) {runIndividualizer.element.classList.add('c-txt-gray-dk');runIndividualizer.responseData = runIndividualizer.translations.freeToClaim;} else {var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (['product_card_merchant_name_up'].indexOf(abTestGroup) >= 0 || isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.getTitle(runIndividualizer.responseItem);}if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0 && !isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.responseItem['merchant_name'];}}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-subtitle"},"required":!0},"url":{"property":"href","output_handler":"","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"value_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = data[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(originalPrice, runIndividualizer.responseItem['currency']);runIndividualizer.element.style.display = 'block';var refEl = runIndividualizer.element.nextElementSibling;refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML('<span>&nbsp;<\/span>'), refEl)} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-original"},"required":!0},"views_24h":{"property":"innerHTML","output_handler":"var numViews = runIndividualizer.responseData;var numPurchases = runIndividualizer.responseItem['purchases_total_displayed'];var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if ((!numPurchases || numPurchases <= 10) && numViews >= 150 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(numViews \/ 10) * 10) + '+ ' + runIndividualizer.translations.viewedToday;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1}}},"basket_mobile":{"type":"recommendation","running":!0,"run_condition":"location.pathname === '\/cart' && LS_Mustache_Params && LS_Mustache_Params.mobileConfig","multiple":!0,"apply_only_last_request":!0,"root_selector":{"mode":"css","selection":"#db_basket_mobile"},"run_handler":"var css = runIndividualizer.createElementFromHTML(\"<style id='db_basket_mobile_css'>.is-touch .cui-c-compound>.cui-content-holder>.cui-cards-wrapper>.cui-content.carousel-content .card-ui.cui-c-udc{margin: 0 0 0 24px !important;}<\/style>\");document.querySelector('head').append(css);css = runIndividualizer.createElementFromHTML(\"<style id='db_basket_mobile_css_2'>#app .card-list-container { display: none; }<\/style>\");document.querySelector('head').append(css);","input_handler":"runIndividualizer.requestData.returnedAttributes = ['title_array', 'sale_price_start_at', 'sale_price_end_at', 'gallery_title', 'currency', 'category', 'inventory_service_id', 'restricted_reason', 'restricted', 'show_discount', 'deal_option_id_array', 'category_guids_object', 'category_guids', 'eligible_for_groupon_incentives', 'pds_id', 'channel_id', 'inventory_product_id'];runIndividualizer.requestData.output = ['scriptAbTest', 'mainAbTest'];var remoteData = runDataGatherer.loadRemoteData({'os': true});runIndividualizer.requestData.contextVariables = runIndividualizer.getContextVariables();var items = [];var data = JSON.parse(gtmData.data.replace(\/&quot;\/g, '\"'));var ids = data['dl_deal_option_uuid'].split(',');ids.forEach(function(id, num) {items.push({'itemId': id});});runIndividualizer.requestData.items = items;var abTestGroup = runIndividualizer.getAbTestGroupFromTheirAbTester();if (abTestGroup) {runIndividualizer.requestData.abTests = abTestGroup;}","received_response_handler":"sessionStorage.setItem('db_abtests', JSON.stringify(runIndividualizer.abTests));runIndividualizer.getAndSavePurplePrices(runIndividualizer.idRequest);","before_render_handler":"var positionEl = \"<figure class='card-ui cui-c-compound''><figcaption class='cui-compound-header'><div class='cui-flex-text-row'><h1 class='compound-title' style='padding: 0;'>\" + runIndividualizer.translations['basketHeadline'] + \"<\/h2><\/div><\/figcaption><div class='cui-content-holder'><div class='cui-cards-wrapper carousel'><div id='db_basket_mobile' class='cui-content carousel-content has-scroll-listener'><\/div><\/div><\/div><\/figure>\";var itemEl = \"<figure class='card-ui cui-c-udc price-badge-filled-background left-aligned-card is-getaways-booking has-additional-discount-percent' data-bhc=''><div class='cui-content'><a href=''><div class='cui-udc-image-container rounded-corners'><div class='cui-udc-image-overlay'><\/div><div class='cui-image-lazy-container cui-image-hover-zoom'><img class='cui-svg-placeholder' height='211' width='349'><img class='cui-image lazy-load lazy-loaded' data-ll-status='loaded' src='' style='position: absolute; top: 0;'><\/div><\/div><div class='cui-udc-details cui-udc-left-aligned-details'><div class='cui-single-section'><div class='cui-udc-title one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-location cui-truncate cui-has-distance' style='display: none;'><span class='cui-location-name'><\/span><span class='cui-location-separator'>\u2022<\/span><span class='cui-location-distance'><\/span><\/div><\/div><div class='cui-single-section'><div class='cui-review-rating' style='display: none;'><div aria-hidden='true' class='numeric-count'><\/div><ul class='rating rating-numeric'><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><\/ul><div class='rating-count'><\/div><\/div><\/div><div class='cui-bottom-body'><div class='cui-combined-section'><div class='cui-price' data-pingdom-id='deal-price'><div aria-hidden='true' class='cui-price-original c-txt-gray-dk' style='display: none;'><\/div><div aria-hidden='true' class='cui-price-discount c-txt-price'><div class='cui-price-descriptor' style='display: none;'><\/div><span><\/span><div class='cui-price-descriptor' style='display: none;'><\/div><\/div><\/div><div class='cui-promotions'><div class='cui-detail-badge cui-discount-badge' style='display: none;'><\/div><div class='cui-urgent cui-offer' style='display: none;'><div><\/div><div class='cui-verbose-urgency-price' aria-hidden='true'><\/div><div class='cui-verbose-urgency-text'><\/div><\/div><\/div><\/div><div class='cui-single-section'><div class='cui-udc-subtitle one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-urgency-message' data-bhc><\/div><\/div><\/div><\/div><\/a><div class='cui-book-online-cta__container' style='display: none;'><a class='cui-book-online-cta' href=''>\" + runIndividualizer.translations.bookOnline + \"<\/a> <\/div><\/div><\/figure>\";var refEl = document.querySelector('#app .cart-list-container');refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML(positionEl), refEl.nextElementSibling);var rootEl = document.querySelector('#db_basket_mobile');rootEl.innerHTML = itemEl;","output_handler":"var interval = setInterval(function() {var messages = document.querySelectorAll('#db_basket_mobile .cui-urgency-message');if (messages[0].innerHTML === '') {clearInterval(interval);messages.forEach(function(el) {el.innerHTML = el.getAttribute('data-message');});}}, 100);setTimeout(function() {clearInterval(interval);}, 3000);var el = document.querySelector('#app .extra-padding');if (el) {el.remove();}el = document.querySelector('#app .checkout-button-container');if (el && !document.querySelector('#app .checkout-button-container .extra-padding')) {el.append(runIndividualizer.createElementFromHTML(\"<div class='extra-padding'><\/div>\"));};var rootEl = document.querySelector('#db_basket_mobile');runIndividualizer.renderPurplePrices(runIndividualizer.idRequest, rootEl);","empty_response_handler":"var el = document.querySelector('#db_basket_mobile_css_2');if (el) {el.remove();}","events":[{"type":["DOMContentLoaded"],"selector":{"mode":"css","selection":"#app .cart-list-container"},"input_handler":"","timeout_handler":"if (!runIndividualizer.recommendations.hasOwnProperty(runIndividualizer.idRequest)) {var el = document.querySelector('#db_basket_mobile_css_2');if (el) {el.remove();}}","timeout":10000}],"item_attributes":{"_customer_item_id":{"property":"data-bhc","output_handler":"runIndividualizer.element.setAttribute('data-bhc', 'deal:' + runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":""},"required":!0},"channel":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseData === 'marketrate-hotel' || runIndividualizer.responseItem['is_travel_bookable_deal']) {runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"discount_percent_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = JSON.parse(runIndividualizer.responseItem['value_array'])[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && data[index] > 0 && !isSalePriceInEffect && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = data[index] + '% ' + runIndividualizer.translations.discountBadgeText;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-discount-badge"},"required":!0},"is_bookable":{"property":"data-style","output_handler":"if (runIndividualizer.responseData) {runIndividualizer.element.style.display = 'flex';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-book-online-cta__container"},"required":!0},"is_travel_bookable_deal":{"property":"data-is-travel-bookable-deal","output_handler":"runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"med_image":{"property":"src","output_handler":"runIndividualizer.responseData = runIndividualizer.responseData.replace('t300x182.jpg', 'c349x211.webp');","run_condition":"","internal_selector":{"mode":"css","selection":".cui-image"},"required":!0},"merchant_name":{"property":"innerHTML","output_handler":"var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') < 0 && !isCashBackDeal && !isGetawaysDeal) {var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {runIndividualizer.element.classList.remove('one-line-truncate');var title = runIndividualizer.getTitle(runIndividualizer.responseItem);if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}runIndividualizer.responseData = title;}}var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.translations.memberPricing + ' ' + runIndividualizer.responseData;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-title"},"required":!0},"price_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);runIndividualizer.responseData = runIndividualizer.getFormattedPrice(data[index], runIndividualizer.responseItem['currency']);var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {var el = runIndividualizer.element.parentElement;el.classList.remove('c-txt-price');el.classList.add('cui-price-message', 'cui-price-hidden');el.innerHTML = runIndividualizer.translations.priceHidden;} else {if (isCashBackDeal) {runIndividualizer.responseData = runIndividualizer.getCashBack(runIndividualizer.responseItem);} else {if (data.length > 1) {var wrapEl = runIndividualizer.element.parentElement;var el = wrapEl.querySelector('.cui-price-discount .cui-price-descriptor:first-child');if (isSalePriceInEffect) {wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');wrapEl.closest('figure').querySelector('.cui-promotions .cui-offer div:first-child').innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';} else {el.innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';}el.style.display = 'block';}if (data.length === 1 && isSalePriceInEffect) {var wrapEl = runIndividualizer.element.parentElement;wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');}}var isCouponDeal = runIndividualizer.isCouponDeal(runIndividualizer.responseItem);if (isCouponDeal) {runIndividualizer.element.parentElement.parentElement.style.display = 'none';}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount span"},"required":!0},"purchases_total_displayed":{"property":"innerHTML","output_handler":"var num = runIndividualizer.responseData;var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (num > 10 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(num \/ 10) * 10) + '+ ' + runIndividualizer.translations.bought;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1},"rating_count":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_value']) {runIndividualizer.responseData = runIndividualizer.responseData + ' ' + runIndividualizer.translations.ratings;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .rating-count"},"required":!1},"rating_value":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_count']) {var value = runIndividualizer.responseData;var wrapEl = runIndividualizer.element.closest('.cui-review-rating');wrapEl.style.display = 'flex';var stars = wrapEl.querySelectorAll('ul li span');stars.forEach(function(el, num) {if (num + 0.8 <= value) {el.classList.value = 'full-star';} else if (num + 0.3 <= value) {el.classList.value = 'half-star';} else {el.classList.value = 'empty-star';}});} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .numeric-count"},"required":!1},"redemption_locations_short":{"property":"data-location","output_handler":"var locations = JSON.parse(runIndividualizer.responseData);var filteredLocations = [];locations.forEach(function(location) {if (location.hasOwnProperty('lat') && location.hasOwnProperty('lng')) {filteredLocations.push(location);}});locations = filteredLocations;if (locations.length > 0) {var location = runIndividualizer.getNearestLocation(locations);var address = [];if (location['streetAddress1']) {address.push(location['streetAddress1']);}if (location['city']) {address.push(location['city']);}var el = runIndividualizer.element.querySelector('.cui-location-name');if (el) {el.innerHTML = address.join(', ');}var distance = location['distanceInKm'];var unit = runIndividualizer.translations.distanceUnit;if (unit === 'mi') {distance = distance \/ 1.609;}distance = Math.round(distance * 10) \/ 10;var el = runIndividualizer.element.querySelector('.cui-location-distance');if (el) {el.innerHTML = distance + ' ' + unit;}runIndividualizer.element.style.display = 'block';} else {runIndividualizer.element.style.display = 'none';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-location"},"required":!1},"sale_price":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isSalePriceInEffect && !isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(runIndividualizer.responseData, runIndividualizer.responseItem['currency']);var wrapEl = runIndividualizer.element.parentElement;wrapEl.querySelector('.cui-verbose-urgency-text').innerHTML = runIndividualizer.translations.limitedTime;wrapEl.style.display = 'flex';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-offer .cui-verbose-urgency-price"},"required":!1},"title_general":{"property":"innerHTML","output_handler":"var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') >= 0) {var title = runIndividualizer.responseData.trim();if (title === '') {var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseItem['title_array']);var title = data[index];}if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}var el = runIndividualizer.element.closest('figure').querySelector('.cui-udc-title');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {el.classList.remove('one-line-truncate');if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}}el.innerHTML = title;runIndividualizer.responseData = '';} else {var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (isCashBackDeal) {runIndividualizer.element.classList.add('c-txt-gray-dk');runIndividualizer.responseData = runIndividualizer.translations.freeToClaim;} else {var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (['product_card_merchant_name_up'].indexOf(abTestGroup) >= 0 || isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.getTitle(runIndividualizer.responseItem);}if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0 && !isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.responseItem['merchant_name'];}}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-subtitle"},"required":!0},"url":{"property":"href","output_handler":"","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"value_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = data[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(originalPrice, runIndividualizer.responseItem['currency']);runIndividualizer.element.style.display = 'block';var refEl = runIndividualizer.element.nextElementSibling;refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML('<span>&nbsp;<\/span>'), refEl)} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-original"},"required":!0},"views_24h":{"property":"innerHTML","output_handler":"var numViews = runIndividualizer.responseData;var numPurchases = runIndividualizer.responseItem['purchases_total_displayed'];var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if ((!numPurchases || numPurchases <= 10) && numViews >= 150 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(numViews \/ 10) * 10) + '+ ' + runIndividualizer.translations.viewedToday;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1}}},"category":{"type":"recommendation","running":!0,"run_condition":"!runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query && ['pull', 'goods'].indexOf(document.querySelector('head').getAttribute('data-app')) >= 0 && LS_Mustache_Params && LS_Mustache_Params.gigConfig","multiple":!0,"apply_only_last_request":!0,"root_selector":{"mode":"css","selection":"#pull-deal-feed"},"run_handler":"var css = runIndividualizer.createElementFromHTML(\"<style id='db_category_css'>#pull-deal-feed {visibility: hidden;}<\/style>\");document.querySelector('head').append(css);setTimeout(function() {var el = document.querySelector('#db_category_css');if (el) {el.remove();}}, 4000);","input_handler":"runIndividualizer.requestData.returnedAttributes = ['title_array', 'sale_price_start_at', 'sale_price_end_at', 'gallery_title', 'currency', 'category', 'inventory_service_id', 'restricted_reason', 'restricted', 'show_discount', 'deal_option_id_array', 'category_guids_object', 'category_guids', 'eligible_for_groupon_incentives', 'pds_id', 'channel_id', 'inventory_product_id'];runIndividualizer.requestData.output = ['scriptAbTest', 'mainAbTest'];runIndividualizer.ads = [];runIndividualizer.requestData.contextVariables = runIndividualizer.getContextVariables();var abTestGroup = runIndividualizer.getAbTestGroupFromTheirAbTester();if (abTestGroup) {runIndividualizer.requestData.abTests = abTestGroup;}","received_response_handler":"if (!runIndividualizer.startTimeObserver) {runIndividualizer.startTimeObserver = new Date().getTime();}sessionStorage.setItem('db_abtests', JSON.stringify(runIndividualizer.abTests));runIndividualizer.getAndSavePurplePrices(runIndividualizer.idRequest);","before_render_handler":"if (runIndividualizer.ads.length === 0) {document.querySelectorAll('#pull-deal-feed .ai-inventory-placement-container').forEach(function(item) {runIndividualizer.ads.push(item.cloneNode(true));});}runIndividualizer.cloneSponsoredDeals('category');var itemEl = \"<figure class='card-ui cui-c-udc price-badge-filled-background left-aligned-card is-getaways-booking has-additional-discount-percent' data-bhc=''><div class='cui-content'><a href=''><div class='cui-udc-image-container rounded-corners'><div class='cui-udc-image-overlay'><\/div><div class='cui-image-lazy-container cui-image-hover-zoom'><img class='cui-svg-placeholder' height='211' width='349'><img class='cui-image lazy-load lazy-loaded' data-ll-status='loaded' src='' style='position: absolute; top: 0;'><\/div><\/div><div class='cui-udc-details cui-udc-left-aligned-details'><div class='cui-single-section'><div class='cui-udc-title one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-location cui-truncate cui-has-distance' style='display: none;'><span class='cui-location-name'><\/span><span class='cui-location-separator'>\u2022<\/span><span class='cui-location-distance'><\/span><\/div><\/div><div class='cui-single-section'><div class='cui-review-rating' style='display: none;'><div aria-hidden='true' class='numeric-count'><\/div><ul class='rating rating-numeric'><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><\/ul><div class='rating-count'><\/div><\/div><\/div><div class='cui-bottom-body'><div class='cui-combined-section'><div class='cui-price' data-pingdom-id='deal-price'><div aria-hidden='true' class='cui-price-original c-txt-gray-dk' style='display: none;'><\/div><div aria-hidden='true' class='cui-price-discount c-txt-price'><div class='cui-price-descriptor' style='display: none;'><\/div><span><\/span><div class='cui-price-descriptor' style='display: none;'><\/div><\/div><\/div><div class='cui-promotions'><div class='cui-detail-badge cui-discount-badge' style='display: none;'><\/div><div class='cui-urgent cui-offer' style='display: none;'><div><\/div><div class='cui-verbose-urgency-price' aria-hidden='true'><\/div><div class='cui-verbose-urgency-text'><\/div><\/div><\/div><\/div><div class='cui-single-section'><div class='cui-udc-subtitle one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-urgency-message'><\/div><\/div><\/div><\/div><\/a><div class='cui-book-online-cta__container' style='display: none;'><a class='cui-book-online-cta' href=''>\" + runIndividualizer.translations.bookOnline + \"<\/a> <\/div><\/div><\/figure>\";var paginationEl = document.querySelector('#pull-pagination');if (paginationEl) {runIndividualizer.categoryPaginationEl = paginationEl;paginationEl.parentElement.removeChild(paginationEl);}var rootEl = document.querySelector('#pull-deal-feed');rootEl.innerHTML = itemEl;if (runIndividualizer.startTimeObserver) {runDataGatherer.sendCustomEvent('category_observer_duration', 'inview', {'duration': (new Date().getTime() - runIndividualizer.startTimeObserver)});runIndividualizer.startTimeObserver = null;}","output_handler":"runIndividualizer.applySponsoredDeals('category');runIndividualizer.prepareMapDeals(runIndividualizer.recommendations[runIndividualizer.idRequest]);runIndividualizer.initMap();if (runIndividualizer.categoryPaginationEl) {var rootEl = document.querySelector('#pull-deal-feed');rootEl.append(runIndividualizer.categoryPaginationEl);runIndividualizer.categoryPaginationEl = null;}var interval = setInterval(function() {var messages = document.querySelectorAll('#pull-deal-feed .cui-urgency-message');if (messages[0].innerHTML === '') {clearInterval(interval);messages.forEach(function(el) {el.innerHTML = el.getAttribute('data-message');});}}, 100);setTimeout(function() {clearInterval(interval);}, 3000);var el = document.querySelector('#db_category_css');if (el) {el.remove();}runIndividualizer.addAds('category');runIndividualizer.initScrollTo();var rootEl = document.querySelector('#pull-deal-feed');runIndividualizer.renderPurplePrices(runIndividualizer.idRequest, rootEl);","empty_response_handler":"var el = document.querySelector('#db_category_css');if (el) {el.remove();}runIndividualizer.startTimeObserver = null;","events":[{"type":["fetch"],"selector":{"mode":"css","selection":"html"},"input_handler":"var url = runIndividualizer.nativeEvent[0];if (url.indexOf('\/get-lazy-loaded-cards') > 0) {var parameters = runIndividualizer.parseFilterParameters(decodeURIComponent(url));if (runIndividualizer.isPossibleToUseFilter(parameters)) {if (parameters.page) {runIndividualizer.requestData.offset = (parseInt(parameters.page) - 1) * 40;}runIndividualizer.requestData.filter = runIndividualizer.getFilter(parameters);} else {runIndividualizer.lock = true;}} else {runIndividualizer.lock = true;}","timeout_handler":"if (!runIndividualizer.recommendations.hasOwnProperty(runIndividualizer.idRequest)) {runIndividualizer.startTimeObserver = null;}","observer":{"parent_selector":{"mode":"css","selection":"body"},"mutation_selector":{"mode":"css","selection":"#pull-deal-feed"}},"timeout":5000},{"type":["fetch"],"selector":{"mode":"css","selection":"body"},"input_handler":"var url = runIndividualizer.nativeEvent[0];if (url.indexOf('\/get-paginated-cards') > 0) {var parameters = runIndividualizer.parseFilterParameters(decodeURIComponent(url));if (runIndividualizer.isPossibleToUseFilter(parameters)) {if (parameters.page) {runIndividualizer.requestData.offset = ((parseInt(parameters.page) - 1) * 40) - runIndividualizer.removedDealsCount.category;}runIndividualizer.requestData.filter = runIndividualizer.getFilter(parameters);} else {runIndividualizer.lock = true;}} else {runIndividualizer.lock = true;}","timeout_handler":"if (!runIndividualizer.recommendations.hasOwnProperty(runIndividualizer.idRequest)) {runIndividualizer.startTimeObserver = null;}","observer":{"parent_selector":{"mode":"css","selection":"body"},"mutation_selector":{"mode":"css","selection":"#pull-deal-feed"}},"timeout":5000}],"item_attributes":{"_customer_item_id":{"property":"data-bhc","output_handler":"runIndividualizer.element.setAttribute('data-bhc', 'deal:' + runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":""},"required":!0},"channel":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseData === 'marketrate-hotel' || runIndividualizer.responseItem['is_travel_bookable_deal']) {runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"discount_percent_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = JSON.parse(runIndividualizer.responseItem['value_array'])[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && data[index] > 0 && !isSalePriceInEffect && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = data[index] + '% ' + runIndividualizer.translations.discountBadgeText;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-discount-badge"},"required":!0},"is_bookable":{"property":"data-style","output_handler":"if (runIndividualizer.responseData) {runIndividualizer.element.style.display = 'flex';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-book-online-cta__container"},"required":!0},"is_travel_bookable_deal":{"property":"data-is-travel-bookable-deal","output_handler":"runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"med_image":{"property":"src","output_handler":"runIndividualizer.responseData = runIndividualizer.responseData.replace('t300x182.jpg', 'c349x211.webp');","run_condition":"","internal_selector":{"mode":"css","selection":".cui-image"},"required":!0},"merchant_name":{"property":"innerHTML","output_handler":"var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') < 0 && !isCashBackDeal && !isGetawaysDeal) {var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {runIndividualizer.element.classList.remove('one-line-truncate');var title = runIndividualizer.getTitle(runIndividualizer.responseItem);if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}runIndividualizer.responseData = title;}}var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.translations.memberPricing + ' ' + runIndividualizer.responseData;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-title"},"required":!0},"price_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);runIndividualizer.responseData = runIndividualizer.getFormattedPrice(data[index], runIndividualizer.responseItem['currency']);var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {var el = runIndividualizer.element.parentElement;el.classList.remove('c-txt-price');el.classList.add('cui-price-message', 'cui-price-hidden');el.innerHTML = runIndividualizer.translations.priceHidden;} else {if (isCashBackDeal) {runIndividualizer.responseData = runIndividualizer.getCashBack(runIndividualizer.responseItem);} else {if (data.length > 1) {var wrapEl = runIndividualizer.element.parentElement;var el = wrapEl.querySelector('.cui-price-discount .cui-price-descriptor:first-child');if (isSalePriceInEffect) {wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');wrapEl.closest('figure').querySelector('.cui-promotions .cui-offer div:first-child').innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';} else {el.innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';}el.style.display = 'block';}if (data.length === 1 && isSalePriceInEffect) {var wrapEl = runIndividualizer.element.parentElement;wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');}}var isCouponDeal = runIndividualizer.isCouponDeal(runIndividualizer.responseItem);if (isCouponDeal) {runIndividualizer.element.parentElement.parentElement.style.display = 'none';}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount span"},"required":!0},"purchases_total_displayed":{"property":"innerHTML","output_handler":"var num = runIndividualizer.responseData;var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (num > 10 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(num \/ 10) * 10) + '+ ' + runIndividualizer.translations.bought;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1},"rating_count":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_value']) {runIndividualizer.responseData = runIndividualizer.responseData + ' ' + runIndividualizer.translations.ratings;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .rating-count"},"required":!1},"rating_value":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_count']) {var value = runIndividualizer.responseData;var wrapEl = runIndividualizer.element.closest('.cui-review-rating');wrapEl.style.display = 'flex';var stars = wrapEl.querySelectorAll('ul li span');stars.forEach(function(el, num) {if (num + 0.8 <= value) {el.classList.value = 'full-star';} else if (num + 0.3 <= value) {el.classList.value = 'half-star';} else {el.classList.value = 'empty-star';}});} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .numeric-count"},"required":!1},"redemption_locations_short":{"property":"data-location","output_handler":"var locations = JSON.parse(runIndividualizer.responseData);var filteredLocations = [];locations.forEach(function(location) {if (location.hasOwnProperty('lat') && location.hasOwnProperty('lng')) {filteredLocations.push(location);}});locations = filteredLocations;if (locations.length > 0) {var location = runIndividualizer.getNearestLocation(locations);var address = [];if (location['streetAddress1']) {address.push(location['streetAddress1']);}if (location['city']) {address.push(location['city']);}var el = runIndividualizer.element.querySelector('.cui-location-name');if (el) {el.innerHTML = address.join(', ');}var distance = location['distanceInKm'];var unit = runIndividualizer.translations.distanceUnit;if (unit === 'mi') {distance = distance \/ 1.609;}distance = Math.round(distance * 10) \/ 10;var el = runIndividualizer.element.querySelector('.cui-location-distance');if (el) {el.innerHTML = distance + ' ' + unit;}runIndividualizer.element.style.display = 'block';} else {runIndividualizer.element.style.display = 'none';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-location"},"required":!1},"sale_price":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isSalePriceInEffect && !isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(runIndividualizer.responseData, runIndividualizer.responseItem['currency']);var wrapEl = runIndividualizer.element.parentElement;wrapEl.querySelector('.cui-verbose-urgency-text').innerHTML = runIndividualizer.translations.limitedTime;wrapEl.style.display = 'flex';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-offer .cui-verbose-urgency-price"},"required":!1},"title_general":{"property":"innerHTML","output_handler":"var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') >= 0) {var title = runIndividualizer.responseData.trim();if (title === '') {var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseItem['title_array']);var title = data[index];}if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}var el = runIndividualizer.element.closest('figure').querySelector('.cui-udc-title');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {el.classList.remove('one-line-truncate');if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}}el.innerHTML = title;runIndividualizer.responseData = '';} else {var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (isCashBackDeal) {runIndividualizer.element.classList.add('c-txt-gray-dk');runIndividualizer.responseData = runIndividualizer.translations.freeToClaim;} else {var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (['product_card_merchant_name_up'].indexOf(abTestGroup) >= 0 || isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.getTitle(runIndividualizer.responseItem);}if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0 && !isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.responseItem['merchant_name'];}}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-subtitle"},"required":!0},"url":{"property":"href","output_handler":"","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"value_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = data[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(originalPrice, runIndividualizer.responseItem['currency']);runIndividualizer.element.style.display = 'block';var refEl = runIndividualizer.element.nextElementSibling;refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML('<span>&nbsp;<\/span>'), refEl)} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-original"},"required":!0},"views_24h":{"property":"innerHTML","output_handler":"var numViews = runIndividualizer.responseData;var numPurchases = runIndividualizer.responseItem['purchases_total_displayed'];var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if ((!numPurchases || numPurchases <= 10) && numViews >= 150 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(numViews \/ 10) * 10) + '+ ' + runIndividualizer.translations.viewedToday;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1}}},"category_getaways":{"type":"recommendation","running":!0,"run_condition":"!runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query && !runDataGatherer.loadUrl({'mode': 'specific','parameters': ['category']}).parameters.category && ['getaways_itier'].indexOf(document.querySelector('head').getAttribute('data-app')) >= 0 && LS_Mustache_Params && LS_Mustache_Params.gigConfig && localStorage.getItem('db_forced_ab_tests')","multiple":!0,"apply_only_last_request":!0,"root_selector":{"mode":"css","selection":"#flash-deals .card-ui-container"},"run_handler":"var css = runIndividualizer.createElementFromHTML(\"<style id='db_category_getaways_css'>#flash-deals {visibility: hidden;}<\/style>\");document.querySelector('head').append(css);setTimeout(function() {var el = document.querySelector('#db_category_getaways_css');if (el) {el.remove();}}, 3000);","input_handler":"runIndividualizer.requestData.returnedAttributes = ['title_array', 'sale_price_start_at', 'sale_price_end_at', 'gallery_title', 'currency', 'category', 'inventory_service_id', 'restricted_reason', 'restricted', 'show_discount', 'deal_option_id_array', 'category_guids_object', 'category_guids', 'eligible_for_groupon_incentives', 'pds_id', 'channel_id', 'inventory_product_id'];runIndividualizer.requestData.output = ['scriptAbTest', 'mainAbTest'];runIndividualizer.requestData.contextVariables = runIndividualizer.getContextVariables();var abTestGroup = runIndividualizer.getAbTestGroupFromTheirAbTester();if (abTestGroup) {runIndividualizer.requestData.abTests = abTestGroup;}runIndividualizer.requestData.filter = \"customer_taxonomy_hierarchy LIKE '%Getaways%'\";","received_response_handler":"if (!runIndividualizer.startTimeObserver) {runIndividualizer.startTimeObserver = new Date().getTime();}sessionStorage.setItem('db_abtests', JSON.stringify(runIndividualizer.abTests));runIndividualizer.getAndSavePurplePrices(runIndividualizer.idRequest);","before_render_handler":"var itemEl = \"<figure class='card-ui cui-c-udc price-badge-filled-background left-aligned-card is-getaways-booking has-additional-discount-percent' data-bhc=''><div class='cui-content'><a href=''><div class='cui-udc-image-container rounded-corners'><div class='cui-udc-image-overlay'><\/div><div class='cui-image-lazy-container cui-image-hover-zoom'><img class='cui-svg-placeholder' height='211' width='349'><img class='cui-image lazy-load lazy-loaded' data-ll-status='loaded' src='' style='position: absolute; top: 0;'><\/div><\/div><div class='cui-udc-details cui-udc-left-aligned-details'><div class='cui-single-section'><div class='cui-udc-title one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-location cui-truncate cui-has-distance' style='display: none;'><span class='cui-location-name'><\/span><span class='cui-location-separator'>\u2022<\/span><span class='cui-location-distance'><\/span><\/div><\/div><div class='cui-single-section'><div class='cui-review-rating' style='display: none;'><div aria-hidden='true' class='numeric-count'><\/div><ul class='rating rating-numeric'><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><\/ul><div class='rating-count'><\/div><\/div><\/div><div class='cui-bottom-body'><div class='cui-combined-section'><div class='cui-price' data-pingdom-id='deal-price'><div aria-hidden='true' class='cui-price-original c-txt-gray-dk' style='display: none;'><\/div><div aria-hidden='true' class='cui-price-discount c-txt-price'><div class='cui-price-descriptor' style='display: none;'><\/div><span><\/span><div class='cui-price-descriptor' style='display: none;'><\/div><\/div><\/div><div class='cui-promotions'><div class='cui-detail-badge cui-discount-badge' style='display: none;'><\/div><div class='cui-urgent cui-offer' style='display: none;'><div><\/div><div class='cui-verbose-urgency-price' aria-hidden='true'><\/div><div class='cui-verbose-urgency-text'><\/div><\/div><\/div><\/div><div class='cui-single-section'><div class='cui-udc-subtitle one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-urgency-message'><\/div><\/div><\/div><\/div><\/a><div class='cui-book-online-cta__container' style='display: none;'><a class='cui-book-online-cta' href=''>\" + runIndividualizer.translations.bookOnline + \"<\/a> <\/div><\/div><\/figure>\";var rootEl = document.querySelector('#flash-deals .card-ui-container');if (rootEl.hasAttribute('data-offset')) {var offset = parseInt(rootEl.getAttribute('data-offset')) + 1;rootEl.querySelectorAll('figure:nth-child(n + ' + offset + ')').forEach(function(el) {el.remove();});rootEl.appendChild(runIndividualizer.createElementFromHTML(itemEl));} else {runIndividualizer.categoryGetawaysHeroOriginalEl = rootEl.querySelector('figure');rootEl.innerHTML = itemEl;}if (runIndividualizer.startTimeObserver) {runDataGatherer.sendCustomEvent('category_getaways_observer_duration', 'inview', {'duration': (new Date().getTime() - runIndividualizer.startTimeObserver)});runIndividualizer.startTimeObserver = null;}","output_handler":"var rootEl = document.querySelector('#flash-deals .card-ui-container');if (!rootEl.hasAttribute('data-offset')) {var firstEl = rootEl.querySelector('figure');var heroOriginalEl = runIndividualizer.categoryGetawaysHeroOriginalEl;var heroEl = firstEl.cloneNode(true);var heroContentEl = heroEl.querySelector('.cui-content');var linkEl = runIndividualizer.createElementFromHTML(\"<a href='\" + firstEl.querySelector('a').getAttribute('href') + \"'  style='width: 100%;'><\/a>\");var viewDealEl = heroOriginalEl.querySelector('.cui-view-deal').cloneNode(true);heroContentEl.append(heroContentEl.querySelector('.cui-udc-image-container'));heroContentEl.append(heroContentEl.querySelector('.cui-udc-details'));heroContentEl.querySelector('a').remove();heroEl.append(linkEl);linkEl.append(heroContentEl);heroEl.classList.value = 'card-ui cui-c-udc cui-c-udc-featured left-aligned-card';heroEl.querySelector('.cui-book-online-cta__container').remove();heroEl.querySelector('.cui-udc-details').append(viewDealEl);rootEl.prepend(heroEl);heroOriginalEl.remove();firstEl.remove();}var interval = setInterval(function() {var messages = document.querySelectorAll('#flash-deals .cui-urgency-message');if (messages[0].innerHTML === '') {clearInterval(interval);messages.forEach(function(el) {el.innerHTML = el.getAttribute('data-message');});}}, 100);setTimeout(function() {clearInterval(interval);}, 3000);runIndividualizer.renderPurplePrices(runIndividualizer.idRequest, rootEl);var el = document.querySelector('#db_category_getaways_css');if (el) {el.remove();}runIndividualizer.categoryGetawaysXhrLock = true;","empty_response_handler":"var el = document.querySelector('#db_category_getaways_css');if (el) {el.remove();}runIndividualizer.startTimeObserver = null;","events":[{"type":["DOMContentLoaded"],"selector":{"mode":"css","selection":"#flash-deals .card-ui-container"},"input_handler":"","timeout_handler":"var el = document.querySelector('#db_category_getaways_css');if (el) {el.remove();}if (!runIndividualizer.recommendations.hasOwnProperty(runIndividualizer.idRequest)) {runIndividualizer.startTimeObserver = null;}","timeout":3000},{"run_condition":"runIndividualizer.categoryGetawaysXhrLock","type":["xhr"],"selector":{"mode":"css","selection":"body"},"input_handler":"var url = runIndividualizer.nativeEvent[1];if (url.indexOf('\/getaways\/pagination') === 0) {var offset = parseInt(url.split('offset=').pop().split('&')[0]);var rootEl = document.querySelector('#flash-deals .card-ui-container');runIndividualizer.requestData.offset = offset;rootEl.setAttribute('data-offset', offset);runIndividualizer.categoryGetawaysXhrLock = false;} else {runIndividualizer.lock = true;}","timeout_handler":"if (!runIndividualizer.recommendations.hasOwnProperty(runIndividualizer.idRequest)) {runIndividualizer.startTimeObserver = null;}","observer":{"parent_selector":{"mode":"css","selection":"#flash-deals .card-ui-container"}},"timeout":3000}],"item_attributes":{"_customer_item_id":{"property":"data-bhc","output_handler":"runIndividualizer.element.setAttribute('data-bhc', 'deal:' + runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":""},"required":!0},"channel":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseData === 'marketrate-hotel' || runIndividualizer.responseItem['is_travel_bookable_deal']) {runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"discount_percent_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = JSON.parse(runIndividualizer.responseItem['value_array'])[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && data[index] > 0 && !isSalePriceInEffect && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = data[index] + '% ' + runIndividualizer.translations.discountBadgeText;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-discount-badge"},"required":!0},"is_bookable":{"property":"data-style","output_handler":"if (runIndividualizer.responseData) {runIndividualizer.element.style.display = 'flex';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-book-online-cta__container"},"required":!0},"is_travel_bookable_deal":{"property":"data-is-travel-bookable-deal","output_handler":"runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"med_image":{"property":"src","output_handler":"runIndividualizer.responseData = runIndividualizer.responseData.replace('t300x182.jpg', 'c349x211.webp');","run_condition":"","internal_selector":{"mode":"css","selection":".cui-image"},"required":!0},"merchant_name":{"property":"innerHTML","output_handler":"var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') < 0 && !isCashBackDeal && !isGetawaysDeal) {var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {runIndividualizer.element.classList.remove('one-line-truncate');var title = runIndividualizer.getTitle(runIndividualizer.responseItem);if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}runIndividualizer.responseData = title;}}var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.translations.memberPricing + ' ' + runIndividualizer.responseData;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-title"},"required":!0},"price_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);runIndividualizer.responseData = runIndividualizer.getFormattedPrice(data[index], runIndividualizer.responseItem['currency']);var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {var el = runIndividualizer.element.parentElement;el.classList.remove('c-txt-price');el.classList.add('cui-price-message', 'cui-price-hidden');el.innerHTML = runIndividualizer.translations.priceHidden;} else {if (isCashBackDeal) {runIndividualizer.responseData = runIndividualizer.getCashBack(runIndividualizer.responseItem);} else {if (data.length > 1) {var wrapEl = runIndividualizer.element.parentElement;var el = wrapEl.querySelector('.cui-price-discount .cui-price-descriptor:first-child');if (isSalePriceInEffect) {wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');wrapEl.closest('figure').querySelector('.cui-promotions .cui-offer div:first-child').innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';} else {el.innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';}el.style.display = 'block';}if (data.length === 1 && isSalePriceInEffect) {var wrapEl = runIndividualizer.element.parentElement;wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');}}var isCouponDeal = runIndividualizer.isCouponDeal(runIndividualizer.responseItem);if (isCouponDeal) {runIndividualizer.element.parentElement.parentElement.style.display = 'none';}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount span"},"required":!0},"purchases_total_displayed":{"property":"innerHTML","output_handler":"var num = runIndividualizer.responseData;var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (num > 10 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(num \/ 10) * 10) + '+ ' + runIndividualizer.translations.bought;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1},"rating_count":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_value']) {runIndividualizer.responseData = runIndividualizer.responseData + ' ' + runIndividualizer.translations.ratings;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .rating-count"},"required":!1},"rating_value":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_count']) {var value = runIndividualizer.responseData;var wrapEl = runIndividualizer.element.closest('.cui-review-rating');wrapEl.style.display = 'flex';var stars = wrapEl.querySelectorAll('ul li span');stars.forEach(function(el, num) {if (num + 0.8 <= value) {el.classList.value = 'full-star';} else if (num + 0.3 <= value) {el.classList.value = 'half-star';} else {el.classList.value = 'empty-star';}});} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .numeric-count"},"required":!1},"redemption_locations_short":{"property":"data-location","output_handler":"var locations = JSON.parse(runIndividualizer.responseData);var filteredLocations = [];locations.forEach(function(location) {if (location.hasOwnProperty('lat') && location.hasOwnProperty('lng')) {filteredLocations.push(location);}});locations = filteredLocations;if (locations.length > 0) {var location = runIndividualizer.getNearestLocation(locations);var address = [];if (location['streetAddress1']) {address.push(location['streetAddress1']);}if (location['city']) {address.push(location['city']);}var el = runIndividualizer.element.querySelector('.cui-location-name');if (el) {el.innerHTML = address.join(', ');}var distance = location['distanceInKm'];var unit = runIndividualizer.translations.distanceUnit;if (unit === 'mi') {distance = distance \/ 1.609;}distance = Math.round(distance * 10) \/ 10;var el = runIndividualizer.element.querySelector('.cui-location-distance');if (el) {el.innerHTML = distance + ' ' + unit;}runIndividualizer.element.style.display = 'block';} else {runIndividualizer.element.style.display = 'none';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-location"},"required":!1},"sale_price":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isSalePriceInEffect && !isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(runIndividualizer.responseData, runIndividualizer.responseItem['currency']);var wrapEl = runIndividualizer.element.parentElement;wrapEl.querySelector('.cui-verbose-urgency-text').innerHTML = runIndividualizer.translations.limitedTime;wrapEl.style.display = 'flex';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-offer .cui-verbose-urgency-price"},"required":!1},"title_general":{"property":"innerHTML","output_handler":"var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') >= 0) {var title = runIndividualizer.responseData.trim();if (title === '') {var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseItem['title_array']);var title = data[index];}if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}var el = runIndividualizer.element.closest('figure').querySelector('.cui-udc-title');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {el.classList.remove('one-line-truncate');if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}}el.innerHTML = title;runIndividualizer.responseData = '';} else {var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (isCashBackDeal) {runIndividualizer.element.classList.add('c-txt-gray-dk');runIndividualizer.responseData = runIndividualizer.translations.freeToClaim;} else {var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (['product_card_merchant_name_up'].indexOf(abTestGroup) >= 0 || isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.getTitle(runIndividualizer.responseItem);}if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0 && !isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.responseItem['merchant_name'];}}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-subtitle"},"required":!0},"url":{"property":"href","output_handler":"","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"value_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = data[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(originalPrice, runIndividualizer.responseItem['currency']);runIndividualizer.element.style.display = 'block';var refEl = runIndividualizer.element.nextElementSibling;refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML('<span>&nbsp;<\/span>'), refEl)} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-original"},"required":!0},"views_24h":{"property":"innerHTML","output_handler":"var numViews = runIndividualizer.responseData;var numPurchases = runIndividualizer.responseItem['purchases_total_displayed'];var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if ((!numPurchases || numPurchases <= 10) && numViews >= 150 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(numViews \/ 10) * 10) + '+ ' + runIndividualizer.translations.viewedToday;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1}}},"category_mobile":{"type":"recommendation","running":!1,"run_condition":"!runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query && ['pull', 'goods'].indexOf(document.querySelector('head').getAttribute('data-app')) >= 0 && LS_Mustache_Params && LS_Mustache_Params.mobileConfig","multiple":!0,"apply_only_last_request":!0,"root_selector":{"mode":"css","selection":"#pull-mobile-cards"},"run_handler":"var css = runIndividualizer.createElementFromHTML(\"<style id='db_category_mobile_css'>#pull-mobile-cards {visibility: hidden;}<\/style>\");document.querySelector('head').append(css);setTimeout(function() {var el = document.querySelector('#db_category_mobile_css');if (el) {el.remove();}}, 3000);","input_handler":"runIndividualizer.requestData.returnedAttributes = ['title_array', 'sale_price_start_at', 'sale_price_end_at', 'gallery_title', 'currency', 'category', 'inventory_service_id', 'restricted_reason', 'restricted', 'show_discount', 'deal_option_id_array', 'category_guids_object', 'category_guids', 'eligible_for_groupon_incentives', 'pds_id', 'channel_id', 'inventory_product_id'];runIndividualizer.requestData.output = ['scriptAbTest', 'mainAbTest'];runIndividualizer.ads = [];runIndividualizer.requestData.contextVariables = runIndividualizer.getContextVariables();var abTestGroup = runIndividualizer.getAbTestGroupFromTheirAbTester();if (abTestGroup) {runIndividualizer.requestData.abTests = abTestGroup;}","received_response_handler":"if (!runIndividualizer.startTimeObserver) {runIndividualizer.startTimeObserver = new Date().getTime();}sessionStorage.setItem('db_abtests', JSON.stringify(runIndividualizer.abTests));runIndividualizer.getAndSavePurplePrices(runIndividualizer.idRequest);","before_render_handler":"if (runIndividualizer.ads.length === 0) {document.querySelectorAll('#pull-mobile-cards .ai-inventory-placement-container').forEach(function(item) {runIndividualizer.ads.push(item.cloneNode(true));});}runIndividualizer.cloneSponsoredDeals('category_mobile');var itemEl = \"<figure class='card-ui cui-c-udc price-badge-filled-background left-aligned-card is-getaways-booking has-additional-discount-percent' data-bhc=''><div class='cui-content'><a href=''><div class='cui-udc-image-container rounded-corners'><div class='cui-udc-image-overlay'><\/div><div class='cui-image-lazy-container cui-image-hover-zoom'><img class='cui-svg-placeholder' height='211' width='349'><img class='cui-image lazy-load lazy-loaded' data-ll-status='loaded' src='' style='position: absolute; top: 0;'><\/div><\/div><div class='cui-udc-details cui-udc-left-aligned-details'><div class='cui-single-section'><div class='cui-udc-title one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-location cui-truncate cui-has-distance' style='display: none;'><span class='cui-location-name'><\/span><span class='cui-location-separator'>\u2022<\/span><span class='cui-location-distance'><\/span><\/div><\/div><div class='cui-single-section'><div class='cui-review-rating' style='display: none;'><div aria-hidden='true' class='numeric-count'><\/div><ul class='rating rating-numeric'><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><\/ul><div class='rating-count'><\/div><\/div><\/div><div class='cui-bottom-body'><div class='cui-combined-section'><div class='cui-price' data-pingdom-id='deal-price'><div aria-hidden='true' class='cui-price-original c-txt-gray-dk' style='display: none;'><\/div><div aria-hidden='true' class='cui-price-discount c-txt-price'><div class='cui-price-descriptor' style='display: none;'><\/div><span><\/span><div class='cui-price-descriptor' style='display: none;'><\/div><\/div><\/div><div class='cui-promotions'><div class='cui-detail-badge cui-discount-badge' style='display: none;'><\/div><div class='cui-urgent cui-offer' style='display: none;'><div><\/div><div class='cui-verbose-urgency-price' aria-hidden='true'><\/div><div class='cui-verbose-urgency-text'><\/div><\/div><\/div><\/div><div class='cui-single-section'><div class='cui-udc-subtitle one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-urgency-message'><\/div><\/div><\/div><\/div><\/a><div class='cui-book-online-cta__container' style='display: none;'><a class='cui-book-online-cta' href=''>\" + runIndividualizer.translations.bookOnline + \"<\/a> <\/div><\/div><\/figure>\";var rootEl = document.querySelector(\"#pull-mobile-cards\");if (rootEl.hasAttribute('data-offset')) {var offset = parseInt(rootEl.getAttribute('data-offset')) + 1;rootEl.parentElement.querySelectorAll('#pull-mobile-cards > *:not(figure)').forEach(function(el) {el.remove();});rootEl.querySelectorAll('figure:nth-child(n + ' + offset + ')').forEach(function(el) {el.remove();});rootEl.appendChild(runIndividualizer.createElementFromHTML(itemEl));} else {rootEl.innerHTML = itemEl;}if (runIndividualizer.startTimeObserver) {runDataGatherer.sendCustomEvent('category_mobile_observer_duration', 'inview', {'duration': (new Date().getTime() - runIndividualizer.startTimeObserver)});runIndividualizer.startTimeObserver = null;}","output_handler":"runIndividualizer.applySponsoredDeals('category_mobile');var interval = setInterval(function() {var messages = document.querySelectorAll('#pull-mobile-cards .cui-urgency-message');if (messages[0].innerHTML === '') {clearInterval(interval);messages.forEach(function(el) {el.innerHTML = el.getAttribute('data-message');});}}, 100);setTimeout(function() {clearInterval(interval);}, 3000);var el = document.querySelector('#db_category_mobile_css');if (el) {el.remove();}runIndividualizer.addAds('category_mobile');var rootEl = document.querySelector('#pull-mobile-cards');runIndividualizer.renderPurplePrices(runIndividualizer.idRequest, rootEl);","empty_response_handler":"var el = document.querySelector('#db_category_mobile_css');if (el) {el.remove();}runIndividualizer.startTimeObserver = null;","events":[{"type":["fetch"],"selector":{"mode":"css","selection":""},"input_handler":"var url = runIndividualizer.nativeEvent[0];if (url.indexOf('\/get-paginated-cards') > 0) {var parameters = runIndividualizer.parseFilterParameters(decodeURIComponent(url));if (runIndividualizer.isPossibleToUseFilter(parameters)) {var rootEl = document.querySelector('#pull-mobile-cards');if (parameters.page && parameters.page !== '0') {runIndividualizer.requestData.offset = (parseInt(parameters.page) - 1) * 40;rootEl.setAttribute('data-offset', runIndividualizer.requestData.offset);} else {rootEl.setAttribute('data-offset', 0);}runIndividualizer.requestData.filter = runIndividualizer.getFilter(parameters);} else {runIndividualizer.lock = true;}} else {runIndividualizer.lock = true;}","timeout_handler":"var el = document.querySelector('#db_category_mobile_css');if (el) {el.remove();}if (!runIndividualizer.recommendations.hasOwnProperty(runIndividualizer.idRequest)) {runIndividualizer.startTimeObserver = null;}","observer":{"parent_selector":{"mode":"css","selection":"body"},"mutation_selector":{"mode":"css","selection":"#pull-mobile-cards"}},"timeout":4500}],"item_attributes":{"_customer_item_id":{"property":"data-bhc","output_handler":"runIndividualizer.element.setAttribute('data-bhc', 'deal:' + runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":""},"required":!0},"channel":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseData === 'marketrate-hotel' || runIndividualizer.responseItem['is_travel_bookable_deal']) {runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"discount_percent_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = JSON.parse(runIndividualizer.responseItem['value_array'])[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && data[index] > 0 && !isSalePriceInEffect && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = data[index] + '% ' + runIndividualizer.translations.discountBadgeText;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-discount-badge"},"required":!0},"is_bookable":{"property":"data-style","output_handler":"if (runIndividualizer.responseData) {runIndividualizer.element.style.display = 'flex';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-book-online-cta__container"},"required":!0},"is_travel_bookable_deal":{"property":"data-is-travel-bookable-deal","output_handler":"runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"med_image":{"property":"src","output_handler":"runIndividualizer.responseData = runIndividualizer.responseData.replace('t300x182.jpg', 'c349x211.webp');","run_condition":"","internal_selector":{"mode":"css","selection":".cui-image"},"required":!0},"merchant_name":{"property":"innerHTML","output_handler":"var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') < 0 && !isCashBackDeal && !isGetawaysDeal) {var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {runIndividualizer.element.classList.remove('one-line-truncate');var title = runIndividualizer.getTitle(runIndividualizer.responseItem);if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}runIndividualizer.responseData = title;}}var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.translations.memberPricing + ' ' + runIndividualizer.responseData;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-title"},"required":!0},"price_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);runIndividualizer.responseData = runIndividualizer.getFormattedPrice(data[index], runIndividualizer.responseItem['currency']);var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {var el = runIndividualizer.element.parentElement;el.classList.remove('c-txt-price');el.classList.add('cui-price-message', 'cui-price-hidden');el.innerHTML = runIndividualizer.translations.priceHidden;} else {if (isCashBackDeal) {runIndividualizer.responseData = runIndividualizer.getCashBack(runIndividualizer.responseItem);} else {if (data.length > 1) {var wrapEl = runIndividualizer.element.parentElement;var el = wrapEl.querySelector('.cui-price-discount .cui-price-descriptor:first-child');if (isSalePriceInEffect) {wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');wrapEl.closest('figure').querySelector('.cui-promotions .cui-offer div:first-child').innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';} else {el.innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';}el.style.display = 'block';}if (data.length === 1 && isSalePriceInEffect) {var wrapEl = runIndividualizer.element.parentElement;wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');}}var isCouponDeal = runIndividualizer.isCouponDeal(runIndividualizer.responseItem);if (isCouponDeal) {runIndividualizer.element.parentElement.parentElement.style.display = 'none';}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount span"},"required":!0},"purchases_total_displayed":{"property":"innerHTML","output_handler":"var num = runIndividualizer.responseData;var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (num > 10 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(num \/ 10) * 10) + '+ ' + runIndividualizer.translations.bought;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1},"rating_count":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_value']) {runIndividualizer.responseData = runIndividualizer.responseData + ' ' + runIndividualizer.translations.ratings;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .rating-count"},"required":!1},"rating_value":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_count']) {var value = runIndividualizer.responseData;var wrapEl = runIndividualizer.element.closest('.cui-review-rating');wrapEl.style.display = 'flex';var stars = wrapEl.querySelectorAll('ul li span');stars.forEach(function(el, num) {if (num + 0.8 <= value) {el.classList.value = 'full-star';} else if (num + 0.3 <= value) {el.classList.value = 'half-star';} else {el.classList.value = 'empty-star';}});} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .numeric-count"},"required":!1},"redemption_locations_short":{"property":"data-location","output_handler":"var locations = JSON.parse(runIndividualizer.responseData);var filteredLocations = [];locations.forEach(function(location) {if (location.hasOwnProperty('lat') && location.hasOwnProperty('lng')) {filteredLocations.push(location);}});locations = filteredLocations;if (locations.length > 0) {var location = runIndividualizer.getNearestLocation(locations);var address = [];if (location['streetAddress1']) {address.push(location['streetAddress1']);}if (location['city']) {address.push(location['city']);}var el = runIndividualizer.element.querySelector('.cui-location-name');if (el) {el.innerHTML = address.join(', ');}var distance = location['distanceInKm'];var unit = runIndividualizer.translations.distanceUnit;if (unit === 'mi') {distance = distance \/ 1.609;}distance = Math.round(distance * 10) \/ 10;var el = runIndividualizer.element.querySelector('.cui-location-distance');if (el) {el.innerHTML = distance + ' ' + unit;}runIndividualizer.element.style.display = 'block';} else {runIndividualizer.element.style.display = 'none';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-location"},"required":!1},"sale_price":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isSalePriceInEffect && !isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(runIndividualizer.responseData, runIndividualizer.responseItem['currency']);var wrapEl = runIndividualizer.element.parentElement;wrapEl.querySelector('.cui-verbose-urgency-text').innerHTML = runIndividualizer.translations.limitedTime;wrapEl.style.display = 'flex';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-offer .cui-verbose-urgency-price"},"required":!1},"title_general":{"property":"innerHTML","output_handler":"var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') >= 0) {var title = runIndividualizer.responseData.trim();if (title === '') {var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseItem['title_array']);var title = data[index];}if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}var el = runIndividualizer.element.closest('figure').querySelector('.cui-udc-title');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {el.classList.remove('one-line-truncate');if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}}el.innerHTML = title;runIndividualizer.responseData = '';} else {var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (isCashBackDeal) {runIndividualizer.element.classList.add('c-txt-gray-dk');runIndividualizer.responseData = runIndividualizer.translations.freeToClaim;} else {var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (['product_card_merchant_name_up'].indexOf(abTestGroup) >= 0 || isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.getTitle(runIndividualizer.responseItem);}if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0 && !isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.responseItem['merchant_name'];}}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-subtitle"},"required":!0},"url":{"property":"href","output_handler":"","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"value_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = data[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(originalPrice, runIndividualizer.responseItem['currency']);runIndividualizer.element.style.display = 'block';var refEl = runIndividualizer.element.nextElementSibling;refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML('<span>&nbsp;<\/span>'), refEl)} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-original"},"required":!0},"views_24h":{"property":"innerHTML","output_handler":"var numViews = runIndividualizer.responseData;var numPurchases = runIndividualizer.responseItem['purchases_total_displayed'];var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if ((!numPurchases || numPurchases <= 10) && numViews >= 150 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(numViews \/ 10) * 10) + '+ ' + runIndividualizer.translations.viewedToday;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1}}},"category_mobile_occasion":{"type":"recommendation","running":!0,"run_condition":"!runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query && ['occasions_itier'].indexOf(document.querySelector('head').getAttribute('data-app')) >= 0 && LS_Mustache_Params && LS_Mustache_Params.mobileConfig && location.href.split('&').length === 1","multiple":!0,"apply_only_last_request":!0,"root_selector":{"mode":"css","selection":"#result-list ul"},"run_handler":"var css = runIndividualizer.createElementFromHTML(\"<style id='db_category_mobile_occasion_css'>#result-list {visibility: hidden;}<\/style>\");document.querySelector('head').append(css);setTimeout(function() {var el = document.querySelector('#db_category_mobile_occasion_css');if (el) {el.remove();}}, 3000);","input_handler":"runIndividualizer.requestData.returnedAttributes = ['title_array', 'sale_price_start_at', 'sale_price_end_at', 'gallery_title', 'currency', 'category', 'inventory_service_id', 'restricted_reason', 'restricted', 'show_discount', 'deal_option_id_array', 'category_guids_object', 'category_guids', 'eligible_for_groupon_incentives', 'pds_id', 'channel_id', 'inventory_product_id'];runIndividualizer.requestData.output = ['scriptAbTest', 'mainAbTest'];runIndividualizer.requestData.contextVariables = runIndividualizer.getContextVariables();var abTestGroup = runIndividualizer.getAbTestGroupFromTheirAbTester();if (abTestGroup) {runIndividualizer.requestData.abTests = abTestGroup;}","received_response_handler":"if (!runIndividualizer.startTimeObserver) {runIndividualizer.startTimeObserver = new Date().getTime();}sessionStorage.setItem('db_abtests', JSON.stringify(runIndividualizer.abTests));runIndividualizer.getAndSavePurplePrices(runIndividualizer.idRequest);","before_render_handler":"var itemEl = \"<li><figure class='card-ui cui-c-udc price-badge-filled-background left-aligned-card is-getaways-booking has-additional-discount-percent' data-bhc=''><div class='cui-content'><a href=''><div class='cui-udc-image-container rounded-corners'><div class='cui-udc-image-overlay'><\/div><div class='cui-image-lazy-container cui-image-hover-zoom'><img class='cui-svg-placeholder' height='211' width='349'><img class='cui-image lazy-load lazy-loaded' data-ll-status='loaded' src='' style='position: absolute; top: 0;'><\/div><\/div><div class='cui-udc-details cui-udc-left-aligned-details'><div class='cui-single-section'><div class='cui-udc-title one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-location cui-truncate cui-has-distance' style='display: none;'><span class='cui-location-name'><\/span><span class='cui-location-separator'>\u2022<\/span><span class='cui-location-distance'><\/span><\/div><\/div><div class='cui-single-section'><div class='cui-review-rating' style='display: none;'><div aria-hidden='true' class='numeric-count'><\/div><ul class='rating rating-numeric'><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><\/ul><div class='rating-count'><\/div><\/div><\/div><div class='cui-bottom-body'><div class='cui-combined-section'><div class='cui-price' data-pingdom-id='deal-price'><div aria-hidden='true' class='cui-price-original c-txt-gray-dk' style='display: none;'><\/div><div aria-hidden='true' class='cui-price-discount c-txt-price'><div class='cui-price-descriptor' style='display: none;'><\/div><span><\/span><div class='cui-price-descriptor' style='display: none;'><\/div><\/div><\/div><div class='cui-promotions'><div class='cui-detail-badge cui-discount-badge' style='display: none;'><\/div><div class='cui-urgent cui-offer' style='display: none;'><div><\/div><div class='cui-verbose-urgency-price' aria-hidden='true'><\/div><div class='cui-verbose-urgency-text'><\/div><\/div><\/div><\/div><div class='cui-single-section'><div class='cui-udc-subtitle one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-urgency-message'><\/div><\/div><\/div><\/div><\/a><div class='cui-book-online-cta__container' style='display: none;'><a class='cui-book-online-cta' href=''>\" + runIndividualizer.translations.bookOnline + \"<\/a> <\/div><\/div><\/figure><\/li>\";var rootEl = document.querySelector(\"#result-list ul\");var paginationEl = document.querySelector('#load-more-deals');if (paginationEl) {paginationEl = paginationEl.closest('li');runIndividualizer.categoryMobileOccasionPaginationEl = paginationEl;paginationEl.parentElement.removeChild(paginationEl);}if (rootEl.hasAttribute('data-offset')) {var offset = parseInt(rootEl.getAttribute('data-offset')) + 1;rootEl.querySelectorAll('li:nth-child(n + ' + offset + ')').forEach(function(el) {el.remove();});rootEl.appendChild(runIndividualizer.createElementFromHTML(itemEl));} else {rootEl.innerHTML = itemEl;}if (runIndividualizer.startTimeObserver) {runDataGatherer.sendCustomEvent('category_mobile_occasion_observer_duration', 'inview', {'duration': (new Date().getTime() - runIndividualizer.startTimeObserver)});runIndividualizer.startTimeObserver = null;}","output_handler":"if (runIndividualizer.categoryMobileOccasionPaginationEl) {var rootEl = document.querySelector('#result-list ul');rootEl.append(runIndividualizer.categoryMobileOccasionPaginationEl);runIndividualizer.categoryMobileOccasionPaginationEl = null;}var interval = setInterval(function() {var messages = document.querySelectorAll('#result-list ul .cui-urgency-message');if (messages[0].innerHTML === '') {clearInterval(interval);messages.forEach(function(el) {el.innerHTML = el.getAttribute('data-message');});}}, 100);setTimeout(function() {clearInterval(interval);}, 3000);var el = document.querySelector('#db_category_mobile_occasion_css');if (el) {el.remove();};var rootEl = document.querySelector('#result-list ul');runIndividualizer.renderPurplePrices(runIndividualizer.idRequest, rootEl);","empty_response_handler":"var el = document.querySelector('#db_category_mobile_occasion_css');if (el) {el.remove();}runIndividualizer.startTimeObserver = null;","events":[{"type":["fetch"],"selector":{"mode":"css","selection":"html"},"input_handler":"var url = runIndividualizer.nativeEvent[0];if (url.indexOf('\/occasion\/deals-json') === 0 && url.indexOf('&context=') > 0) {var offset = parseInt(url.split('offset=').pop().split('&')[0]);if (offset > 5) {runIndividualizer.requestData.offset = offset;var rootEl = document.querySelector('#result-list ul');rootEl.setAttribute('data-offset', document.querySelectorAll('#result-list ul figure[data-bhc]').length);}var expression = url.split('filterQuery=').pop().split('&')[0];runIndividualizer.requestData.filter = runIndividualizer.getFilterForOccassion(expression);} else {runIndividualizer.lock = true;}","timeout_handler":"var el = document.querySelector('#db_category_mobile_occasion_css');if (el) {el.remove();}if (!runIndividualizer.recommendations.hasOwnProperty(runIndividualizer.idRequest)) {runIndividualizer.startTimeObserver = null;}","observer":{"parent_selector":{"mode":"css","selection":"body"},"mutation_selector":{"mode":"css","selection":"#result-list ul"}},"timeout":3000}],"item_attributes":{"_customer_item_id":{"property":"data-bhc","output_handler":"runIndividualizer.element.setAttribute('data-bhc', 'deal:' + runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":"figure"},"required":!0},"channel":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseData === 'marketrate-hotel' || runIndividualizer.responseItem['is_travel_bookable_deal']) {runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"discount_percent_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = JSON.parse(runIndividualizer.responseItem['value_array'])[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && data[index] > 0 && !isSalePriceInEffect && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = data[index] + '% ' + runIndividualizer.translations.discountBadgeText;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-discount-badge"},"required":!0},"is_bookable":{"property":"data-style","output_handler":"if (runIndividualizer.responseData) {runIndividualizer.element.style.display = 'flex';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-book-online-cta__container"},"required":!0},"is_travel_bookable_deal":{"property":"data-is-travel-bookable-deal","output_handler":"runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"med_image":{"property":"src","output_handler":"runIndividualizer.responseData = runIndividualizer.responseData.replace('t300x182.jpg', 'c349x211.webp');","run_condition":"","internal_selector":{"mode":"css","selection":".cui-image"},"required":!0},"merchant_name":{"property":"innerHTML","output_handler":"var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') < 0 && !isCashBackDeal && !isGetawaysDeal) {var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {runIndividualizer.element.classList.remove('one-line-truncate');var title = runIndividualizer.getTitle(runIndividualizer.responseItem);if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}runIndividualizer.responseData = title;}}var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.translations.memberPricing + ' ' + runIndividualizer.responseData;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-title"},"required":!0},"price_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);runIndividualizer.responseData = runIndividualizer.getFormattedPrice(data[index], runIndividualizer.responseItem['currency']);var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {var el = runIndividualizer.element.parentElement;el.classList.remove('c-txt-price');el.classList.add('cui-price-message', 'cui-price-hidden');el.innerHTML = runIndividualizer.translations.priceHidden;} else {if (isCashBackDeal) {runIndividualizer.responseData = runIndividualizer.getCashBack(runIndividualizer.responseItem);} else {if (data.length > 1) {var wrapEl = runIndividualizer.element.parentElement;var el = wrapEl.querySelector('.cui-price-discount .cui-price-descriptor:first-child');if (isSalePriceInEffect) {wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');wrapEl.closest('figure').querySelector('.cui-promotions .cui-offer div:first-child').innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';} else {el.innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';}el.style.display = 'block';}if (data.length === 1 && isSalePriceInEffect) {var wrapEl = runIndividualizer.element.parentElement;wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');}}var isCouponDeal = runIndividualizer.isCouponDeal(runIndividualizer.responseItem);if (isCouponDeal) {runIndividualizer.element.parentElement.parentElement.style.display = 'none';}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount span"},"required":!0},"purchases_total_displayed":{"property":"innerHTML","output_handler":"var num = runIndividualizer.responseData;var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (num > 10 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(num \/ 10) * 10) + '+ ' + runIndividualizer.translations.bought;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1},"rating_count":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_value']) {runIndividualizer.responseData = runIndividualizer.responseData + ' ' + runIndividualizer.translations.ratings;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .rating-count"},"required":!1},"rating_value":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_count']) {var value = runIndividualizer.responseData;var wrapEl = runIndividualizer.element.closest('.cui-review-rating');wrapEl.style.display = 'flex';var stars = wrapEl.querySelectorAll('ul li span');stars.forEach(function(el, num) {if (num + 0.8 <= value) {el.classList.value = 'full-star';} else if (num + 0.3 <= value) {el.classList.value = 'half-star';} else {el.classList.value = 'empty-star';}});} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .numeric-count"},"required":!1},"redemption_locations_short":{"property":"data-location","output_handler":"var locations = JSON.parse(runIndividualizer.responseData);var filteredLocations = [];locations.forEach(function(location) {if (location.hasOwnProperty('lat') && location.hasOwnProperty('lng')) {filteredLocations.push(location);}});locations = filteredLocations;if (locations.length > 0) {var location = runIndividualizer.getNearestLocation(locations);var address = [];if (location['streetAddress1']) {address.push(location['streetAddress1']);}if (location['city']) {address.push(location['city']);}var el = runIndividualizer.element.querySelector('.cui-location-name');if (el) {el.innerHTML = address.join(', ');}var distance = location['distanceInKm'];var unit = runIndividualizer.translations.distanceUnit;if (unit === 'mi') {distance = distance \/ 1.609;}distance = Math.round(distance * 10) \/ 10;var el = runIndividualizer.element.querySelector('.cui-location-distance');if (el) {el.innerHTML = distance + ' ' + unit;}runIndividualizer.element.style.display = 'block';} else {runIndividualizer.element.style.display = 'none';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-location"},"required":!1},"sale_price":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isSalePriceInEffect && !isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(runIndividualizer.responseData, runIndividualizer.responseItem['currency']);var wrapEl = runIndividualizer.element.parentElement;wrapEl.querySelector('.cui-verbose-urgency-text').innerHTML = runIndividualizer.translations.limitedTime;wrapEl.style.display = 'flex';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-offer .cui-verbose-urgency-price"},"required":!1},"title_general":{"property":"innerHTML","output_handler":"var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') >= 0) {var title = runIndividualizer.responseData.trim();if (title === '') {var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseItem['title_array']);var title = data[index];}if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}var el = runIndividualizer.element.closest('figure').querySelector('.cui-udc-title');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {el.classList.remove('one-line-truncate');if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}}el.innerHTML = title;runIndividualizer.responseData = '';} else {var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (isCashBackDeal) {runIndividualizer.element.classList.add('c-txt-gray-dk');runIndividualizer.responseData = runIndividualizer.translations.freeToClaim;} else {var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (['product_card_merchant_name_up'].indexOf(abTestGroup) >= 0 || isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.getTitle(runIndividualizer.responseItem);}if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0 && !isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.responseItem['merchant_name'];}}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-subtitle"},"required":!0},"url":{"property":"href","output_handler":"","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"value_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = data[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(originalPrice, runIndividualizer.responseItem['currency']);runIndividualizer.element.style.display = 'block';var refEl = runIndividualizer.element.nextElementSibling;refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML('<span>&nbsp;<\/span>'), refEl)} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-original"},"required":!0},"views_24h":{"property":"innerHTML","output_handler":"var numViews = runIndividualizer.responseData;var numPurchases = runIndividualizer.responseItem['purchases_total_displayed'];var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if ((!numPurchases || numPurchases <= 10) && numViews >= 150 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(numViews \/ 10) * 10) + '+ ' + runIndividualizer.translations.viewedToday;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1}}},"category_occasion":{"type":"recommendation","running":!0,"run_condition":"!runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query && ['occasions_itier'].indexOf(document.querySelector('head').getAttribute('data-app')) >= 0 && LS_Mustache_Params && LS_Mustache_Params.gigConfig","multiple":!0,"apply_only_last_request":!0,"root_selector":{"mode":"css","selection":"#result-list ul.card-ui-container:last-child"},"run_handler":"var css = runIndividualizer.createElementFromHTML(\"<style id='db_category_occasion_css'>#result-list {visibility: hidden;}<\/style>\");document.querySelector('head').append(css);setTimeout(function() {var el = document.querySelector('#db_category_occasion_css');if (el) {el.remove();}}, 3000);","input_handler":"runIndividualizer.requestData.returnedAttributes = ['title_array', 'sale_price_start_at', 'sale_price_end_at', 'gallery_title', 'currency', 'category', 'inventory_service_id', 'restricted_reason', 'restricted', 'show_discount', 'deal_option_id_array', 'category_guids_object', 'category_guids', 'eligible_for_groupon_incentives', 'pds_id', 'channel_id', 'inventory_product_id'];runIndividualizer.requestData.output = ['scriptAbTest', 'mainAbTest'];runIndividualizer.requestData.contextVariables = runIndividualizer.getContextVariables();var abTestGroup = runIndividualizer.getAbTestGroupFromTheirAbTester();if (abTestGroup) {runIndividualizer.requestData.abTests = abTestGroup;}","received_response_handler":"if (!runIndividualizer.startTimeObserver) {runIndividualizer.startTimeObserver = new Date().getTime();}sessionStorage.setItem('db_abtests', JSON.stringify(runIndividualizer.abTests));runIndividualizer.getAndSavePurplePrices(runIndividualizer.idRequest);","before_render_handler":"var itemEl = \"<li><figure class='card-ui cui-c-udc price-badge-filled-background left-aligned-card is-getaways-booking has-additional-discount-percent' data-bhc=''><div class='cui-content'><a href=''><div class='cui-udc-image-container rounded-corners'><div class='cui-udc-image-overlay'><\/div><div class='cui-image-lazy-container cui-image-hover-zoom'><img class='cui-svg-placeholder' height='211' width='349'><img class='cui-image lazy-load lazy-loaded' data-ll-status='loaded' src='' style='position: absolute; top: 0;'><\/div><\/div><div class='cui-udc-details cui-udc-left-aligned-details'><div class='cui-single-section'><div class='cui-udc-title one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-location cui-truncate cui-has-distance' style='display: none;'><span class='cui-location-name'><\/span><span class='cui-location-separator'>\u2022<\/span><span class='cui-location-distance'><\/span><\/div><\/div><div class='cui-single-section'><div class='cui-review-rating' style='display: none;'><div aria-hidden='true' class='numeric-count'><\/div><ul class='rating rating-numeric'><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><\/ul><div class='rating-count'><\/div><\/div><\/div><div class='cui-bottom-body'><div class='cui-combined-section'><div class='cui-price' data-pingdom-id='deal-price'><div aria-hidden='true' class='cui-price-original c-txt-gray-dk' style='display: none;'><\/div><div aria-hidden='true' class='cui-price-discount c-txt-price'><div class='cui-price-descriptor' style='display: none;'><\/div><span><\/span><div class='cui-price-descriptor' style='display: none;'><\/div><\/div><\/div><div class='cui-promotions'><div class='cui-detail-badge cui-discount-badge' style='display: none;'><\/div><div class='cui-urgent cui-offer' style='display: none;'><div><\/div><div class='cui-verbose-urgency-price' aria-hidden='true'><\/div><div class='cui-verbose-urgency-text'><\/div><\/div><\/div><\/div><div class='cui-single-section'><div class='cui-udc-subtitle one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-urgency-message'><\/div><\/div><\/div><\/div><\/a><div class='cui-book-online-cta__container' style='display: none;'><a class='cui-book-online-cta' href=''>\" + runIndividualizer.translations.bookOnline + \"<\/a> <\/div><\/div><\/figure><\/li>\";var paginationEl = document.querySelector('#load-more-deals');if (paginationEl) {paginationEl = paginationEl.closest('li');runIndividualizer.categoryOccasionPaginationEl = paginationEl;paginationEl.parentElement.removeChild(paginationEl);}var elements = document.querySelectorAll('#result-list ul.card-ui-container');if (elements.length > 1) {elements[0].remove();}var rootEl = document.querySelector('#result-list ul.card-ui-container:last-child');if (rootEl.hasAttribute('data-offset')) {var offset = parseInt(rootEl.getAttribute('data-offset')) + 1;rootEl.querySelectorAll('li:nth-child(n + ' + offset + ')').forEach(function(el) {el.remove();});rootEl.appendChild(runIndividualizer.createElementFromHTML(itemEl));} else {rootEl.innerHTML = itemEl;}if (runIndividualizer.startTimeObserver) {runDataGatherer.sendCustomEvent('category_occasion_observer_duration', 'inview', {'duration': (new Date().getTime() - runIndividualizer.startTimeObserver)});runIndividualizer.startTimeObserver = null;}","output_handler":"var rootEl = document.querySelector('#result-list ul.card-ui-container:last-child');var heroContainerEl = document.querySelector('#heroContainer');if (!rootEl.hasAttribute('data-offset') && heroContainerEl) {var firstEl = rootEl.querySelector('figure');var heroContainerEl = document.querySelector('#heroContainer');var heroOriginalEl = heroContainerEl.querySelector('figure');var heroEl = firstEl.cloneNode(true);var heroContentEl = heroEl.querySelector('.cui-content');var linkEl = runIndividualizer.createElementFromHTML(\"<a href='\" + firstEl.querySelector('a').getAttribute('href') + \"'  style='width: 100%;'><\/a>\");var viewDealEl = heroOriginalEl.querySelector('.cui-view-deal').cloneNode(true);heroContentEl.append(heroContentEl.querySelector('.cui-udc-image-container'));heroContentEl.append(heroContentEl.querySelector('.cui-udc-details'));heroContentEl.querySelector('a').remove();heroEl.append(linkEl);linkEl.append(heroContentEl);heroEl.classList.value = 'card-ui cui-c-udc cui-c-udc-featured left-aligned-card';heroEl.querySelector('.cui-book-online-cta__container').remove();heroEl.querySelector('.cui-udc-details').append(viewDealEl);heroContainerEl.append(heroEl);heroOriginalEl.remove();firstEl.parentElement.remove();}if (runIndividualizer.categoryOccasionPaginationEl) {rootEl.append(runIndividualizer.categoryOccasionPaginationEl);runIndividualizer.categoryOccasionPaginationEl = null;}var interval = setInterval(function() {var messages = document.querySelectorAll('#result-list .cui-urgency-message');if (messages[0].innerHTML === '') {clearInterval(interval);messages.forEach(function(el) {el.innerHTML = el.getAttribute('data-message');});}}, 100);setTimeout(function() {clearInterval(interval);}, 3000);var el = document.querySelector('#db_category_occasion_css');if (el) {el.remove();};runIndividualizer.renderPurplePrices(runIndividualizer.idRequest, rootEl);","empty_response_handler":"var el = document.querySelector('#db_category_occasion_css');if (el) {el.remove();}runIndividualizer.startTimeObserver = null;","events":[{"run_condition":"location.href.indexOf('offset=') < 0","type":["inview"],"selector":{"mode":"css","selection":"body"},"input_handler":"var data = JSON.parse(document.querySelector('#domConfig').innerHTML);var expression = data['occasion']['rapiFilter'];var filterFromUrl = runIndividualizer.getFilterForOccassionFromUrl();if (filterFromUrl) {filterFromUrl = runIndividualizer.getFilterForOccassion(filterFromUrl);filterFromUrl = filterFromUrl.replaceAll('customer_taxonomy_hierarchy ', 'customer_taxonomy_hierarchy_translations ');runIndividualizer.requestData.filter = '(' + runIndividualizer.getFilterForOccassion(expression) + ') AND ' + filterFromUrl;} else {runIndividualizer.requestData.filter = runIndividualizer.getFilterForOccassion(expression);}","timeout_handler":"var el = document.querySelector('#db_category_occasion_css');if (el) {el.remove();}if (!runIndividualizer.recommendations.hasOwnProperty(runIndividualizer.idRequest)) {runIndividualizer.startTimeObserver = null;}","timeout":3000},{"type":["fetch"],"selector":{"mode":"css","selection":"html"},"input_handler":"var url = runIndividualizer.nativeEvent[0];if (url.indexOf('\/occasion\/deals-json') === 0 && url.indexOf('&context=') > 0) {var offset = parseInt(url.split('offset=').pop().split('&')[0]);if (offset > 5) {var rootEl = document.querySelector('#result-list ul.card-ui-container:last-child');if (offset === 50 && location.href.indexOf('offset=') > 0) {runIndividualizer.requestData.count = 100;} else {runIndividualizer.requestData.offset = offset;rootEl.setAttribute('data-offset', document.querySelectorAll('#result-list ul figure[data-bhc]').length);}}var expression = url.split('filterQuery=').pop().split('&')[0];runIndividualizer.requestData.filter = runIndividualizer.getFilterForOccassion(expression);} else {runIndividualizer.lock = true;}","timeout_handler":"if (!runIndividualizer.recommendations.hasOwnProperty(runIndividualizer.idRequest)) {runIndividualizer.startTimeObserver = null;}","observer":{"parent_selector":{"mode":"css","selection":"body"},"mutation_selector":{"mode":"css","selection":"#result-list ul"}},"timeout":3000}],"item_attributes":{"_customer_item_id":{"property":"data-bhc","output_handler":"runIndividualizer.element.setAttribute('data-bhc', 'deal:' + runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":"figure"},"required":!0},"channel":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseData === 'marketrate-hotel' || runIndividualizer.responseItem['is_travel_bookable_deal']) {runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"discount_percent_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = JSON.parse(runIndividualizer.responseItem['value_array'])[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && data[index] > 0 && !isSalePriceInEffect && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = data[index] + '% ' + runIndividualizer.translations.discountBadgeText;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-discount-badge"},"required":!0},"is_bookable":{"property":"data-style","output_handler":"if (runIndividualizer.responseData) {runIndividualizer.element.style.display = 'flex';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-book-online-cta__container"},"required":!0},"is_travel_bookable_deal":{"property":"data-is-travel-bookable-deal","output_handler":"runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"med_image":{"property":"src","output_handler":"runIndividualizer.responseData = runIndividualizer.responseData.replace('t300x182.jpg', 'c349x211.webp');","run_condition":"","internal_selector":{"mode":"css","selection":".cui-image"},"required":!0},"merchant_name":{"property":"innerHTML","output_handler":"var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') < 0 && !isCashBackDeal && !isGetawaysDeal) {var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {runIndividualizer.element.classList.remove('one-line-truncate');var title = runIndividualizer.getTitle(runIndividualizer.responseItem);if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}runIndividualizer.responseData = title;}}var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.translations.memberPricing + ' ' + runIndividualizer.responseData;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-title"},"required":!0},"price_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);runIndividualizer.responseData = runIndividualizer.getFormattedPrice(data[index], runIndividualizer.responseItem['currency']);var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {var el = runIndividualizer.element.parentElement;el.classList.remove('c-txt-price');el.classList.add('cui-price-message', 'cui-price-hidden');el.innerHTML = runIndividualizer.translations.priceHidden;} else {if (isCashBackDeal) {runIndividualizer.responseData = runIndividualizer.getCashBack(runIndividualizer.responseItem);} else {if (data.length > 1) {var wrapEl = runIndividualizer.element.parentElement;var el = wrapEl.querySelector('.cui-price-discount .cui-price-descriptor:first-child');if (isSalePriceInEffect) {wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');wrapEl.closest('figure').querySelector('.cui-promotions .cui-offer div:first-child').innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';} else {el.innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';}el.style.display = 'block';}if (data.length === 1 && isSalePriceInEffect) {var wrapEl = runIndividualizer.element.parentElement;wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');}}var isCouponDeal = runIndividualizer.isCouponDeal(runIndividualizer.responseItem);if (isCouponDeal) {runIndividualizer.element.parentElement.parentElement.style.display = 'none';}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount span"},"required":!0},"purchases_total_displayed":{"property":"innerHTML","output_handler":"var num = runIndividualizer.responseData;var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (num > 10 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(num \/ 10) * 10) + '+ ' + runIndividualizer.translations.bought;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1},"rating_count":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_value']) {runIndividualizer.responseData = runIndividualizer.responseData + ' ' + runIndividualizer.translations.ratings;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .rating-count"},"required":!1},"rating_value":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_count']) {var value = runIndividualizer.responseData;var wrapEl = runIndividualizer.element.closest('.cui-review-rating');wrapEl.style.display = 'flex';var stars = wrapEl.querySelectorAll('ul li span');stars.forEach(function(el, num) {if (num + 0.8 <= value) {el.classList.value = 'full-star';} else if (num + 0.3 <= value) {el.classList.value = 'half-star';} else {el.classList.value = 'empty-star';}});} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .numeric-count"},"required":!1},"redemption_locations_short":{"property":"data-location","output_handler":"var locations = JSON.parse(runIndividualizer.responseData);var filteredLocations = [];locations.forEach(function(location) {if (location.hasOwnProperty('lat') && location.hasOwnProperty('lng')) {filteredLocations.push(location);}});locations = filteredLocations;if (locations.length > 0) {var location = runIndividualizer.getNearestLocation(locations);var address = [];if (location['streetAddress1']) {address.push(location['streetAddress1']);}if (location['city']) {address.push(location['city']);}var el = runIndividualizer.element.querySelector('.cui-location-name');if (el) {el.innerHTML = address.join(', ');}var distance = location['distanceInKm'];var unit = runIndividualizer.translations.distanceUnit;if (unit === 'mi') {distance = distance \/ 1.609;}distance = Math.round(distance * 10) \/ 10;var el = runIndividualizer.element.querySelector('.cui-location-distance');if (el) {el.innerHTML = distance + ' ' + unit;}runIndividualizer.element.style.display = 'block';} else {runIndividualizer.element.style.display = 'none';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-location"},"required":!1},"sale_price":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isSalePriceInEffect && !isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(runIndividualizer.responseData, runIndividualizer.responseItem['currency']);var wrapEl = runIndividualizer.element.parentElement;wrapEl.querySelector('.cui-verbose-urgency-text').innerHTML = runIndividualizer.translations.limitedTime;wrapEl.style.display = 'flex';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-offer .cui-verbose-urgency-price"},"required":!1},"title_general":{"property":"innerHTML","output_handler":"var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') >= 0) {var title = runIndividualizer.responseData.trim();if (title === '') {var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseItem['title_array']);var title = data[index];}if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}var el = runIndividualizer.element.closest('figure').querySelector('.cui-udc-title');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {el.classList.remove('one-line-truncate');if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}}el.innerHTML = title;runIndividualizer.responseData = '';} else {var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (isCashBackDeal) {runIndividualizer.element.classList.add('c-txt-gray-dk');runIndividualizer.responseData = runIndividualizer.translations.freeToClaim;} else {var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (['product_card_merchant_name_up'].indexOf(abTestGroup) >= 0 || isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.getTitle(runIndividualizer.responseItem);}if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0 && !isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.responseItem['merchant_name'];}}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-subtitle"},"required":!0},"url":{"property":"href","output_handler":"","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"value_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = data[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(originalPrice, runIndividualizer.responseItem['currency']);runIndividualizer.element.style.display = 'block';var refEl = runIndividualizer.element.nextElementSibling;refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML('<span>&nbsp;<\/span>'), refEl)} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-original"},"required":!0},"views_24h":{"property":"innerHTML","output_handler":"var numViews = runIndividualizer.responseData;var numPurchases = runIndividualizer.responseItem['purchases_total_displayed'];var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if ((!numPurchases || numPurchases <= 10) && numViews >= 150 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(numViews \/ 10) * 10) + '+ ' + runIndividualizer.translations.viewedToday;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1}}},"homepage_all":{"type":"recommendation","running":!0,"run_condition":"(location.pathname === '\/' || location.pathname.indexOf('home-like') >= 0) && LS_Mustache_Params && LS_Mustache_Params.gigConfig","multiple":!0,"apply_only_last_request":!0,"root_selector":{"mode":"css","selection":"#all-deals"},"run_handler":"var css = runIndividualizer.createElementFromHTML(\"<style id='db_homepage_all_css'>#all-deals {visibility: hidden;}<\/style>\");document.querySelector('head').append(css);","input_handler":"runIndividualizer.requestData.returnedAttributes = ['title_array', 'sale_price_start_at', 'sale_price_end_at', 'gallery_title', 'currency', 'category', 'inventory_service_id', 'restricted_reason', 'restricted', 'show_discount', 'deal_option_id_array', 'category_guids_object', 'category_guids', 'eligible_for_groupon_incentives', 'pds_id', 'channel_id', 'inventory_product_id'];runIndividualizer.requestData.output = ['scriptAbTest', 'mainAbTest'];runIndividualizer.requestData.contextVariables = runIndividualizer.getContextVariables();var abTestGroup = runIndividualizer.getAbTestGroupFromTheirAbTester();if (abTestGroup) {runIndividualizer.requestData.abTests = abTestGroup;}","received_response_handler":"sessionStorage.setItem('db_abtests', JSON.stringify(runIndividualizer.abTests));runIndividualizer.getAndSavePurplePrices(runIndividualizer.idRequest);","before_render_handler":"var itemEl = \"<figure class='card-ui cui-c-udc price-badge-filled-background left-aligned-card is-getaways-booking has-additional-discount-percent' data-bhc=''><div class='cui-content'><a href=''><div class='cui-udc-image-container rounded-corners'><div class='cui-udc-image-overlay'><\/div><div class='cui-image-lazy-container cui-image-hover-zoom'><img class='cui-svg-placeholder' height='211' width='349'><img class='cui-image lazy-load lazy-loaded' data-ll-status='loaded' src='' style='position: absolute; top: 0;'><\/div><\/div><div class='cui-udc-details cui-udc-left-aligned-details'><div class='cui-single-section'><div class='cui-udc-title one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-location cui-truncate cui-has-distance' style='display: none;'><span class='cui-location-name'><\/span><span class='cui-location-separator'>\u2022<\/span><span class='cui-location-distance'><\/span><\/div><\/div><div class='cui-single-section'><div class='cui-review-rating' style='display: none;'><div aria-hidden='true' class='numeric-count'><\/div><ul class='rating rating-numeric'><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><\/ul><div class='rating-count'><\/div><\/div><\/div><div class='cui-bottom-body'><div class='cui-combined-section'><div class='cui-price' data-pingdom-id='deal-price'><div aria-hidden='true' class='cui-price-original c-txt-gray-dk' style='display: none;'><\/div><div aria-hidden='true' class='cui-price-discount c-txt-price'><div class='cui-price-descriptor' style='display: none;'><\/div><span><\/span><div class='cui-price-descriptor' style='display: none;'><\/div><\/div><\/div><div class='cui-promotions'><div class='cui-detail-badge cui-discount-badge' style='display: none;'><\/div><div class='cui-urgent cui-offer' style='display: none;'><div><\/div><div class='cui-verbose-urgency-price' aria-hidden='true'><\/div><div class='cui-verbose-urgency-text'><\/div><\/div><\/div><\/div><div class='cui-single-section'><div class='cui-udc-subtitle one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-urgency-message'><\/div><\/div><\/div><\/div><\/a><div class='cui-book-online-cta__container' style='display: none;'><a class='cui-book-online-cta' href=''>\" + runIndividualizer.translations.bookOnline + \"<\/a> <\/div><\/div><\/figure>\";var rootEl = document.querySelector('#all-deals');runIndividualizer.homepageAllHeadingEl = rootEl.querySelector('.cui-c-brand-prop').cloneNode(true);rootEl.innerHTML = itemEl;","output_handler":"var rootEl = document.querySelector('#all-deals');rootEl.prepend(runIndividualizer.homepageAllHeadingEl);var interval = setInterval(function() {var messages = document.querySelectorAll('#all-deals .cui-urgency-message');if (messages[0].innerHTML === '') {clearInterval(interval);messages.forEach(function(el) {el.innerHTML = el.getAttribute('data-message');});}}, 100);setTimeout(function() {clearInterval(interval);}, 3000);var el = document.querySelector('#db_homepage_all_css');if (el) {el.remove();};runIndividualizer.renderPurplePrices(runIndividualizer.idRequest, rootEl);","empty_response_handler":"var el = document.querySelector('#db_homepage_all_css');if (el) {el.remove();}","events":[{"type":["DOMContentLoaded"],"selector":{"mode":"css","selection":"#all-deals"},"input_handler":"var page = runDataGatherer.loadUrl({'mode': 'specific','parameters': ['page']}).parameters.page;if (page) {runIndividualizer.requestData.offset = (parseInt(page) - 1) * 24;}","timeout_handler":"var el = document.querySelector('#db_homepage_all_css');if (el) {el.remove();}","timeout":7000},{"type":["fetch"],"selector":{"mode":"css","selection":""},"input_handler":"var url = runIndividualizer.nativeEvent[0];if (url.indexOf('\/homepage\/get-paginated-cards') > 0) {var page = parseInt(url.split('page=').pop().split('&')[0]);runIndividualizer.requestData.offset = (page - 1) * 24;} else {runIndividualizer.lock = true;}","timeout_handler":"","observer":{"parent_selector":{"mode":"css","selection":"body"},"mutation_selector":{"mode":"css","selection":"#all-deals"}},"timeout":10000}],"item_attributes":{"_customer_item_id":{"property":"data-bhc","output_handler":"runIndividualizer.element.setAttribute('data-bhc', 'deal:' + runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":""},"required":!0},"channel":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseData === 'marketrate-hotel' || runIndividualizer.responseItem['is_travel_bookable_deal']) {runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"discount_percent_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = JSON.parse(runIndividualizer.responseItem['value_array'])[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && data[index] > 0 && !isSalePriceInEffect && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = data[index] + '% ' + runIndividualizer.translations.discountBadgeText;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-discount-badge"},"required":!0},"is_bookable":{"property":"data-style","output_handler":"if (runIndividualizer.responseData) {runIndividualizer.element.style.display = 'flex';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-book-online-cta__container"},"required":!0},"is_travel_bookable_deal":{"property":"data-is-travel-bookable-deal","output_handler":"runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"med_image":{"property":"src","output_handler":"runIndividualizer.responseData = runIndividualizer.responseData.replace('t300x182.jpg', 'c349x211.webp');","run_condition":"","internal_selector":{"mode":"css","selection":".cui-image"},"required":!0},"merchant_name":{"property":"innerHTML","output_handler":"var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') < 0 && !isCashBackDeal && !isGetawaysDeal) {var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {runIndividualizer.element.classList.remove('one-line-truncate');var title = runIndividualizer.getTitle(runIndividualizer.responseItem);if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}runIndividualizer.responseData = title;}}var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.translations.memberPricing + ' ' + runIndividualizer.responseData;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-title"},"required":!0},"price_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);runIndividualizer.responseData = runIndividualizer.getFormattedPrice(data[index], runIndividualizer.responseItem['currency']);var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {var el = runIndividualizer.element.parentElement;el.classList.remove('c-txt-price');el.classList.add('cui-price-message', 'cui-price-hidden');el.innerHTML = runIndividualizer.translations.priceHidden;} else {if (isCashBackDeal) {runIndividualizer.responseData = runIndividualizer.getCashBack(runIndividualizer.responseItem);} else {if (data.length > 1) {var wrapEl = runIndividualizer.element.parentElement;var el = wrapEl.querySelector('.cui-price-discount .cui-price-descriptor:first-child');if (isSalePriceInEffect) {wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');wrapEl.closest('figure').querySelector('.cui-promotions .cui-offer div:first-child').innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';} else {el.innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';}el.style.display = 'block';}if (data.length === 1 && isSalePriceInEffect) {var wrapEl = runIndividualizer.element.parentElement;wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');}}var isCouponDeal = runIndividualizer.isCouponDeal(runIndividualizer.responseItem);if (isCouponDeal) {runIndividualizer.element.parentElement.parentElement.style.display = 'none';}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount span"},"required":!0},"purchases_total_displayed":{"property":"innerHTML","output_handler":"var num = runIndividualizer.responseData;var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (num > 10 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(num \/ 10) * 10) + '+ ' + runIndividualizer.translations.bought;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1},"rating_count":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_value']) {runIndividualizer.responseData = runIndividualizer.responseData + ' ' + runIndividualizer.translations.ratings;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .rating-count"},"required":!1},"rating_value":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_count']) {var value = runIndividualizer.responseData;var wrapEl = runIndividualizer.element.closest('.cui-review-rating');wrapEl.style.display = 'flex';var stars = wrapEl.querySelectorAll('ul li span');stars.forEach(function(el, num) {if (num + 0.8 <= value) {el.classList.value = 'full-star';} else if (num + 0.3 <= value) {el.classList.value = 'half-star';} else {el.classList.value = 'empty-star';}});} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .numeric-count"},"required":!1},"redemption_locations_short":{"property":"data-location","output_handler":"var locations = JSON.parse(runIndividualizer.responseData);var filteredLocations = [];locations.forEach(function(location) {if (location.hasOwnProperty('lat') && location.hasOwnProperty('lng')) {filteredLocations.push(location);}});locations = filteredLocations;if (locations.length > 0) {var location = runIndividualizer.getNearestLocation(locations);var address = [];if (location['streetAddress1']) {address.push(location['streetAddress1']);}if (location['city']) {address.push(location['city']);}var el = runIndividualizer.element.querySelector('.cui-location-name');if (el) {el.innerHTML = address.join(', ');}var distance = location['distanceInKm'];var unit = runIndividualizer.translations.distanceUnit;if (unit === 'mi') {distance = distance \/ 1.609;}distance = Math.round(distance * 10) \/ 10;var el = runIndividualizer.element.querySelector('.cui-location-distance');if (el) {el.innerHTML = distance + ' ' + unit;}runIndividualizer.element.style.display = 'block';} else {runIndividualizer.element.style.display = 'none';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-location"},"required":!1},"sale_price":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isSalePriceInEffect && !isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(runIndividualizer.responseData, runIndividualizer.responseItem['currency']);var wrapEl = runIndividualizer.element.parentElement;wrapEl.querySelector('.cui-verbose-urgency-text').innerHTML = runIndividualizer.translations.limitedTime;wrapEl.style.display = 'flex';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-offer .cui-verbose-urgency-price"},"required":!1},"title_general":{"property":"innerHTML","output_handler":"var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') >= 0) {var title = runIndividualizer.responseData.trim();if (title === '') {var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseItem['title_array']);var title = data[index];}if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}var el = runIndividualizer.element.closest('figure').querySelector('.cui-udc-title');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {el.classList.remove('one-line-truncate');if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}}el.innerHTML = title;runIndividualizer.responseData = '';} else {var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (isCashBackDeal) {runIndividualizer.element.classList.add('c-txt-gray-dk');runIndividualizer.responseData = runIndividualizer.translations.freeToClaim;} else {var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (['product_card_merchant_name_up'].indexOf(abTestGroup) >= 0 || isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.getTitle(runIndividualizer.responseItem);}if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0 && !isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.responseItem['merchant_name'];}}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-subtitle"},"required":!0},"url":{"property":"href","output_handler":"","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"value_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = data[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(originalPrice, runIndividualizer.responseItem['currency']);runIndividualizer.element.style.display = 'block';var refEl = runIndividualizer.element.nextElementSibling;refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML('<span>&nbsp;<\/span>'), refEl)} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-original"},"required":!0},"views_24h":{"property":"innerHTML","output_handler":"var numViews = runIndividualizer.responseData;var numPurchases = runIndividualizer.responseItem['purchases_total_displayed'];var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if ((!numPurchases || numPurchases <= 10) && numViews >= 150 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(numViews \/ 10) * 10) + '+ ' + runIndividualizer.translations.viewedToday;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1}}},"homepage_featured":{"type":"recommendation","running":!0,"run_condition":"(location.pathname === '\/' || location.pathname.indexOf('home-like') >= 0) && LS_Mustache_Params && LS_Mustache_Params.gigConfig","multiple":!0,"apply_only_last_request":!0,"root_selector":{"mode":"css","selection":"#small-featured"},"run_handler":"var css = runIndividualizer.createElementFromHTML(\"<style id='db_homepage_featured_css'>#small-featured {visibility: hidden;}<\/style>\");document.querySelector('head').append(css);","input_handler":"runIndividualizer.requestData.returnedAttributes = ['title_array', 'sale_price_start_at', 'sale_price_end_at', 'gallery_title', 'currency', 'category', 'inventory_service_id', 'restricted_reason', 'restricted', 'show_discount', 'deal_option_id_array', 'category_guids_object', 'category_guids', 'eligible_for_groupon_incentives', 'pds_id', 'channel_id', 'inventory_product_id'];runIndividualizer.requestData.output = ['scriptAbTest', 'mainAbTest'];runIndividualizer.requestData.contextVariables = runIndividualizer.getContextVariables();var abTestGroup = runIndividualizer.getAbTestGroupFromTheirAbTester();if (abTestGroup) {runIndividualizer.requestData.abTests = abTestGroup;}","received_response_handler":"sessionStorage.setItem('db_abtests', JSON.stringify(runIndividualizer.abTests));runIndividualizer.getAndSavePurplePrices(runIndividualizer.idRequest);","before_render_handler":"var itemEl = \"<figure class='card-ui cui-c-udc price-badge-filled-background left-aligned-card is-getaways-booking has-additional-discount-percent' data-bhc=''><div class='cui-content'><a href=''><div class='cui-udc-image-container rounded-corners'><div class='cui-udc-image-overlay'><\/div><div class='cui-image-lazy-container cui-image-hover-zoom'><img class='cui-svg-placeholder' height='211' width='349'><img class='cui-image lazy-load lazy-loaded' data-ll-status='loaded' src='' style='position: absolute; top: 0;'><\/div><\/div><div class='cui-udc-details cui-udc-left-aligned-details'><div class='cui-single-section'><div class='cui-udc-title one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-location cui-truncate cui-has-distance' style='display: none;'><span class='cui-location-name'><\/span><span class='cui-location-separator'>\u2022<\/span><span class='cui-location-distance'><\/span><\/div><\/div><div class='cui-single-section'><div class='cui-review-rating' style='display: none;'><div aria-hidden='true' class='numeric-count'><\/div><ul class='rating rating-numeric'><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><\/ul><div class='rating-count'><\/div><\/div><\/div><div class='cui-bottom-body'><div class='cui-combined-section'><div class='cui-price' data-pingdom-id='deal-price'><div aria-hidden='true' class='cui-price-original c-txt-gray-dk' style='display: none;'><\/div><div aria-hidden='true' class='cui-price-discount c-txt-price'><div class='cui-price-descriptor' style='display: none;'><\/div><span><\/span><div class='cui-price-descriptor' style='display: none;'><\/div><\/div><\/div><div class='cui-promotions'><div class='cui-detail-badge cui-discount-badge' style='display: none;'><\/div><div class='cui-urgent cui-offer' style='display: none;'><div><\/div><div class='cui-verbose-urgency-price' aria-hidden='true'><\/div><div class='cui-verbose-urgency-text'><\/div><\/div><\/div><\/div><div class='cui-single-section'><div class='cui-udc-subtitle one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-urgency-message'><\/div><\/div><\/div><\/div><\/a><div class='cui-book-online-cta__container' style='display: none;'><a class='cui-book-online-cta' href=''>\" + runIndividualizer.translations.bookOnline + \"<\/a> <\/div><\/div><\/figure>\";var rootEl = document.querySelector('#small-featured');rootEl.innerHTML = itemEl;","output_handler":"var interval = setInterval(function() {var messages = document.querySelectorAll('#small-featured .cui-urgency-message');if (messages[0].innerHTML === '') {clearInterval(interval);messages.forEach(function(el) {el.innerHTML = el.getAttribute('data-message');});}}, 100);setTimeout(function() {clearInterval(interval);}, 3000);var el = document.querySelector('#db_homepage_featured_css');if (el) {el.remove();};var rootEl = document.querySelector('#small-featured');runIndividualizer.renderPurplePrices(runIndividualizer.idRequest, rootEl);","empty_response_handler":"var el = document.querySelector('#db_homepage_featured_css');if (el) {el.remove();}","events":[{"type":["DOMContentLoaded"],"selector":{"mode":"css","selection":"#small-featured"},"input_handler":"","timeout_handler":"var el = document.querySelector('#db_homepage_featured_css');if (el) {el.remove();}","timeout":5000}],"item_attributes":{"_customer_item_id":{"property":"data-bhc","output_handler":"runIndividualizer.element.setAttribute('data-bhc', 'deal:' + runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":""},"required":!0},"channel":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseData === 'marketrate-hotel' || runIndividualizer.responseItem['is_travel_bookable_deal']) {runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"discount_percent_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = JSON.parse(runIndividualizer.responseItem['value_array'])[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && data[index] > 0 && !isSalePriceInEffect && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = data[index] + '% ' + runIndividualizer.translations.discountBadgeText;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-discount-badge"},"required":!0},"is_bookable":{"property":"data-style","output_handler":"if (runIndividualizer.responseData) {runIndividualizer.element.style.display = 'flex';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-book-online-cta__container"},"required":!0},"is_travel_bookable_deal":{"property":"data-is-travel-bookable-deal","output_handler":"runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"med_image":{"property":"src","output_handler":"runIndividualizer.responseData = runIndividualizer.responseData.replace('t300x182.jpg', 'c349x211.webp');","run_condition":"","internal_selector":{"mode":"css","selection":".cui-image"},"required":!0},"merchant_name":{"property":"innerHTML","output_handler":"var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') < 0 && !isCashBackDeal && !isGetawaysDeal) {var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {runIndividualizer.element.classList.remove('one-line-truncate');var title = runIndividualizer.getTitle(runIndividualizer.responseItem);if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}runIndividualizer.responseData = title;}}var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.translations.memberPricing + ' ' + runIndividualizer.responseData;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-title"},"required":!0},"price_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);runIndividualizer.responseData = runIndividualizer.getFormattedPrice(data[index], runIndividualizer.responseItem['currency']);var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {var el = runIndividualizer.element.parentElement;el.classList.remove('c-txt-price');el.classList.add('cui-price-message', 'cui-price-hidden');el.innerHTML = runIndividualizer.translations.priceHidden;} else {if (isCashBackDeal) {runIndividualizer.responseData = runIndividualizer.getCashBack(runIndividualizer.responseItem);} else {if (data.length > 1) {var wrapEl = runIndividualizer.element.parentElement;var el = wrapEl.querySelector('.cui-price-discount .cui-price-descriptor:first-child');if (isSalePriceInEffect) {wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');wrapEl.closest('figure').querySelector('.cui-promotions .cui-offer div:first-child').innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';} else {el.innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';}el.style.display = 'block';}if (data.length === 1 && isSalePriceInEffect) {var wrapEl = runIndividualizer.element.parentElement;wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');}}var isCouponDeal = runIndividualizer.isCouponDeal(runIndividualizer.responseItem);if (isCouponDeal) {runIndividualizer.element.parentElement.parentElement.style.display = 'none';}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount span"},"required":!0},"purchases_total_displayed":{"property":"innerHTML","output_handler":"var num = runIndividualizer.responseData;var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (num > 10 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(num \/ 10) * 10) + '+ ' + runIndividualizer.translations.bought;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1},"rating_count":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_value']) {runIndividualizer.responseData = runIndividualizer.responseData + ' ' + runIndividualizer.translations.ratings;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .rating-count"},"required":!1},"rating_value":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_count']) {var value = runIndividualizer.responseData;var wrapEl = runIndividualizer.element.closest('.cui-review-rating');wrapEl.style.display = 'flex';var stars = wrapEl.querySelectorAll('ul li span');stars.forEach(function(el, num) {if (num + 0.8 <= value) {el.classList.value = 'full-star';} else if (num + 0.3 <= value) {el.classList.value = 'half-star';} else {el.classList.value = 'empty-star';}});} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .numeric-count"},"required":!1},"redemption_locations_short":{"property":"data-location","output_handler":"var locations = JSON.parse(runIndividualizer.responseData);var filteredLocations = [];locations.forEach(function(location) {if (location.hasOwnProperty('lat') && location.hasOwnProperty('lng')) {filteredLocations.push(location);}});locations = filteredLocations;if (locations.length > 0) {var location = runIndividualizer.getNearestLocation(locations);var address = [];if (location['streetAddress1']) {address.push(location['streetAddress1']);}if (location['city']) {address.push(location['city']);}var el = runIndividualizer.element.querySelector('.cui-location-name');if (el) {el.innerHTML = address.join(', ');}var distance = location['distanceInKm'];var unit = runIndividualizer.translations.distanceUnit;if (unit === 'mi') {distance = distance \/ 1.609;}distance = Math.round(distance * 10) \/ 10;var el = runIndividualizer.element.querySelector('.cui-location-distance');if (el) {el.innerHTML = distance + ' ' + unit;}runIndividualizer.element.style.display = 'block';} else {runIndividualizer.element.style.display = 'none';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-location"},"required":!1},"sale_price":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isSalePriceInEffect && !isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(runIndividualizer.responseData, runIndividualizer.responseItem['currency']);var wrapEl = runIndividualizer.element.parentElement;wrapEl.querySelector('.cui-verbose-urgency-text').innerHTML = runIndividualizer.translations.limitedTime;wrapEl.style.display = 'flex';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-offer .cui-verbose-urgency-price"},"required":!1},"title_general":{"property":"innerHTML","output_handler":"var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') >= 0) {var title = runIndividualizer.responseData.trim();if (title === '') {var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseItem['title_array']);var title = data[index];}if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}var el = runIndividualizer.element.closest('figure').querySelector('.cui-udc-title');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {el.classList.remove('one-line-truncate');if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}}el.innerHTML = title;runIndividualizer.responseData = '';} else {var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (isCashBackDeal) {runIndividualizer.element.classList.add('c-txt-gray-dk');runIndividualizer.responseData = runIndividualizer.translations.freeToClaim;} else {var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (['product_card_merchant_name_up'].indexOf(abTestGroup) >= 0 || isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.getTitle(runIndividualizer.responseItem);}if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0 && !isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.responseItem['merchant_name'];}}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-subtitle"},"required":!0},"url":{"property":"href","output_handler":"","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"value_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = data[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(originalPrice, runIndividualizer.responseItem['currency']);runIndividualizer.element.style.display = 'block';var refEl = runIndividualizer.element.nextElementSibling;refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML('<span>&nbsp;<\/span>'), refEl)} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-original"},"required":!0},"views_24h":{"property":"innerHTML","output_handler":"var numViews = runIndividualizer.responseData;var numPurchases = runIndividualizer.responseItem['purchases_total_displayed'];var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if ((!numPurchases || numPurchases <= 10) && numViews >= 150 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(numViews \/ 10) * 10) + '+ ' + runIndividualizer.translations.viewedToday;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1}}},"homepage_mobile_category_1":{"type":"recommendation","running":!0,"run_condition":"location.pathname === '\/' && LS_Mustache_Params && LS_Mustache_Params.mobileConfig && location.host.slice(-4) !== '.com'","multiple":!0,"apply_only_last_request":!0,"root_selector":{"mode":"css","selection":"[data-bhc='compound:homepage_flexible_touch_category_carousel_1'] .carousel-content"},"run_handler":"var css = runIndividualizer.createElementFromHTML(\"<style id='db_homepage_mobile_category_1_css'>[data-bhc='compound:homepage_flexible_touch_category_carousel_1'] {visibility: hidden;}<\/style>\");document.querySelector('head').append(css);","input_handler":"runIndividualizer.requestData.returnedAttributes = ['title_array', 'sale_price_start_at', 'sale_price_end_at', 'gallery_title', 'currency', 'category', 'inventory_service_id', 'restricted_reason', 'restricted', 'show_discount', 'deal_option_id_array', 'category_guids_object', 'category_guids', 'eligible_for_groupon_incentives', 'pds_id', 'channel_id', 'inventory_product_id'];runIndividualizer.requestData.output = ['scriptAbTest', 'mainAbTest'];runIndividualizer.requestData.contextVariables = runIndividualizer.getContextVariables();runIndividualizer.requestData.items = runIndividualizer.homepageMobileItems;var abTestGroup = runIndividualizer.getAbTestGroupFromTheirAbTester();if (abTestGroup) {runIndividualizer.requestData.abTests = abTestGroup;}","received_response_handler":"sessionStorage.setItem('db_abtests', JSON.stringify(runIndividualizer.abTests));runIndividualizer.getAndSavePurplePrices(runIndividualizer.idRequest);","before_render_handler":"var itemEl = \"<figure class='card-ui cui-c-udc price-badge-filled-background left-aligned-card is-getaways-booking has-additional-discount-percent' data-bhc=''><div class='cui-content'><a href=''><div class='cui-udc-image-container rounded-corners'><div class='cui-udc-image-overlay'><\/div><div class='cui-image-lazy-container cui-image-hover-zoom'><img class='cui-svg-placeholder' height='211' width='349'><img class='cui-image lazy-load lazy-loaded' data-ll-status='loaded' src='' style='position: absolute; top: 0;'><\/div><\/div><div class='cui-udc-details cui-udc-left-aligned-details'><div class='cui-single-section'><div class='cui-udc-title one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-location cui-truncate cui-has-distance' style='display: none;'><span class='cui-location-name'><\/span><span class='cui-location-separator'>\u2022<\/span><span class='cui-location-distance'><\/span><\/div><\/div><div class='cui-single-section'><div class='cui-review-rating' style='display: none;'><div aria-hidden='true' class='numeric-count'><\/div><ul class='rating rating-numeric'><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><\/ul><div class='rating-count'><\/div><\/div><\/div><div class='cui-bottom-body'><div class='cui-combined-section'><div class='cui-price' data-pingdom-id='deal-price'><div aria-hidden='true' class='cui-price-original c-txt-gray-dk' style='display: none;'><\/div><div aria-hidden='true' class='cui-price-discount c-txt-price'><div class='cui-price-descriptor' style='display: none;'><\/div><span><\/span><div class='cui-price-descriptor' style='display: none;'><\/div><\/div><\/div><div class='cui-promotions'><div class='cui-detail-badge cui-discount-badge' style='display: none;'><\/div><div class='cui-urgent cui-offer' style='display: none;'><div><\/div><div class='cui-verbose-urgency-price' aria-hidden='true'><\/div><div class='cui-verbose-urgency-text'><\/div><\/div><\/div><\/div><div class='cui-single-section'><div class='cui-udc-subtitle one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-urgency-message'><\/div><\/div><\/div><\/div><\/a><div class='cui-book-online-cta__container' style='display: none;'><a class='cui-book-online-cta' href=''>\" + runIndividualizer.translations.bookOnline + \"<\/a> <\/div><\/div><\/figure>\";var rootEl = document.querySelector(\"[data-bhc='compound:homepage_flexible_touch_category_carousel_1'] .carousel-content\");rootEl.innerHTML = itemEl;","output_handler":"var interval = setInterval(function() {var messages = document.querySelectorAll(\"[data-bhc='compound:homepage_flexible_touch_category_carousel_1'] .carousel-content .cui-urgency-message\");if (messages[0].innerHTML === '') {clearInterval(interval);messages.forEach(function(el) {el.innerHTML = el.getAttribute('data-message');});}}, 100);setTimeout(function() {clearInterval(interval);}, 3000);var el = document.querySelector('#db_homepage_mobile_category_1_css');if (el) {el.remove();}runIndividualizer.recommendations[runIndividualizer.idRequest].forEach(function(item) {runIndividualizer.homepageMobileItems.push({\"itemId\": item.itemId});});var rootEl = document.querySelector(\"[data-bhc='compound:homepage_flexible_touch_category_carousel_1'] .carousel-content\");runIndividualizer.renderPurplePrices(runIndividualizer.idRequest, rootEl);","empty_response_handler":"var el = document.querySelector('#db_homepage_mobile_category_1_css');if (el) {el.remove();}","events":[{"type":["fetch"],"selector":{"mode":"css","selection":""},"input_handler":"var url = runIndividualizer.nativeEvent[0];if (url.indexOf('\/homepage\/get-paginated-cards') < 0 || url.indexOf('&index=4') < 0) {runIndividualizer.lock = true;}","timeout_handler":"var el = document.querySelector('#db_homepage_mobile_category_1_css');if (el) {el.remove();}","timeout":5000}],"item_attributes":{"_customer_item_id":{"property":"data-bhc","output_handler":"runIndividualizer.element.setAttribute('data-bhc', 'deal:' + runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":""},"required":!0},"channel":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseData === 'marketrate-hotel' || runIndividualizer.responseItem['is_travel_bookable_deal']) {runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"discount_percent_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = JSON.parse(runIndividualizer.responseItem['value_array'])[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && data[index] > 0 && !isSalePriceInEffect && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = data[index] + '% ' + runIndividualizer.translations.discountBadgeText;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-discount-badge"},"required":!0},"is_bookable":{"property":"data-style","output_handler":"if (runIndividualizer.responseData) {runIndividualizer.element.style.display = 'flex';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-book-online-cta__container"},"required":!0},"is_travel_bookable_deal":{"property":"data-is-travel-bookable-deal","output_handler":"runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"med_image":{"property":"src","output_handler":"runIndividualizer.responseData = runIndividualizer.responseData.replace('t300x182.jpg', 'c349x211.webp');","run_condition":"","internal_selector":{"mode":"css","selection":".cui-image"},"required":!0},"merchant_name":{"property":"innerHTML","output_handler":"var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') < 0 && !isCashBackDeal && !isGetawaysDeal) {var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {runIndividualizer.element.classList.remove('one-line-truncate');var title = runIndividualizer.getTitle(runIndividualizer.responseItem);if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}runIndividualizer.responseData = title;}}var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.translations.memberPricing + ' ' + runIndividualizer.responseData;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-title"},"required":!0},"price_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);runIndividualizer.responseData = runIndividualizer.getFormattedPrice(data[index], runIndividualizer.responseItem['currency']);var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {var el = runIndividualizer.element.parentElement;el.classList.remove('c-txt-price');el.classList.add('cui-price-message', 'cui-price-hidden');el.innerHTML = runIndividualizer.translations.priceHidden;} else {if (isCashBackDeal) {runIndividualizer.responseData = runIndividualizer.getCashBack(runIndividualizer.responseItem);} else {if (data.length > 1) {var wrapEl = runIndividualizer.element.parentElement;var el = wrapEl.querySelector('.cui-price-discount .cui-price-descriptor:first-child');if (isSalePriceInEffect) {wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');wrapEl.closest('figure').querySelector('.cui-promotions .cui-offer div:first-child').innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';} else {el.innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';}el.style.display = 'block';}if (data.length === 1 && isSalePriceInEffect) {var wrapEl = runIndividualizer.element.parentElement;wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');}}var isCouponDeal = runIndividualizer.isCouponDeal(runIndividualizer.responseItem);if (isCouponDeal) {runIndividualizer.element.parentElement.parentElement.style.display = 'none';}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount span"},"required":!0},"purchases_total_displayed":{"property":"innerHTML","output_handler":"var num = runIndividualizer.responseData;var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (num > 10 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(num \/ 10) * 10) + '+ ' + runIndividualizer.translations.bought;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1},"rating_count":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_value']) {runIndividualizer.responseData = runIndividualizer.responseData + ' ' + runIndividualizer.translations.ratings;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .rating-count"},"required":!1},"rating_value":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_count']) {var value = runIndividualizer.responseData;var wrapEl = runIndividualizer.element.closest('.cui-review-rating');wrapEl.style.display = 'flex';var stars = wrapEl.querySelectorAll('ul li span');stars.forEach(function(el, num) {if (num + 0.8 <= value) {el.classList.value = 'full-star';} else if (num + 0.3 <= value) {el.classList.value = 'half-star';} else {el.classList.value = 'empty-star';}});} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .numeric-count"},"required":!1},"redemption_locations_short":{"property":"data-location","output_handler":"var locations = JSON.parse(runIndividualizer.responseData);var filteredLocations = [];locations.forEach(function(location) {if (location.hasOwnProperty('lat') && location.hasOwnProperty('lng')) {filteredLocations.push(location);}});locations = filteredLocations;if (locations.length > 0) {var location = runIndividualizer.getNearestLocation(locations);var address = [];if (location['streetAddress1']) {address.push(location['streetAddress1']);}if (location['city']) {address.push(location['city']);}var el = runIndividualizer.element.querySelector('.cui-location-name');if (el) {el.innerHTML = address.join(', ');}var distance = location['distanceInKm'];var unit = runIndividualizer.translations.distanceUnit;if (unit === 'mi') {distance = distance \/ 1.609;}distance = Math.round(distance * 10) \/ 10;var el = runIndividualizer.element.querySelector('.cui-location-distance');if (el) {el.innerHTML = distance + ' ' + unit;}runIndividualizer.element.style.display = 'block';} else {runIndividualizer.element.style.display = 'none';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-location"},"required":!1},"sale_price":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isSalePriceInEffect && !isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(runIndividualizer.responseData, runIndividualizer.responseItem['currency']);var wrapEl = runIndividualizer.element.parentElement;wrapEl.querySelector('.cui-verbose-urgency-text').innerHTML = runIndividualizer.translations.limitedTime;wrapEl.style.display = 'flex';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-offer .cui-verbose-urgency-price"},"required":!1},"title_general":{"property":"innerHTML","output_handler":"var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') >= 0) {var title = runIndividualizer.responseData.trim();if (title === '') {var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseItem['title_array']);var title = data[index];}if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}var el = runIndividualizer.element.closest('figure').querySelector('.cui-udc-title');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {el.classList.remove('one-line-truncate');if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}}el.innerHTML = title;runIndividualizer.responseData = '';} else {var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (isCashBackDeal) {runIndividualizer.element.classList.add('c-txt-gray-dk');runIndividualizer.responseData = runIndividualizer.translations.freeToClaim;} else {var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (['product_card_merchant_name_up'].indexOf(abTestGroup) >= 0 || isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.getTitle(runIndividualizer.responseItem);}if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0 && !isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.responseItem['merchant_name'];}}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-subtitle"},"required":!0},"url":{"property":"href","output_handler":"","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"value_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = data[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(originalPrice, runIndividualizer.responseItem['currency']);runIndividualizer.element.style.display = 'block';var refEl = runIndividualizer.element.nextElementSibling;refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML('<span>&nbsp;<\/span>'), refEl)} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-original"},"required":!0},"views_24h":{"property":"innerHTML","output_handler":"var numViews = runIndividualizer.responseData;var numPurchases = runIndividualizer.responseItem['purchases_total_displayed'];var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if ((!numPurchases || numPurchases <= 10) && numViews >= 150 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(numViews \/ 10) * 10) + '+ ' + runIndividualizer.translations.viewedToday;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1}}},"homepage_mobile_category_2":{"type":"recommendation","running":!0,"run_condition":"location.pathname === '\/' && LS_Mustache_Params && LS_Mustache_Params.mobileConfig && location.host.slice(-4) !== '.com'","multiple":!0,"apply_only_last_request":!0,"root_selector":{"mode":"css","selection":"[data-bhc='compound:homepage_flexible_touch_category_carousel_2'] .carousel-content"},"run_handler":"var css = runIndividualizer.createElementFromHTML(\"<style id='db_homepage_mobile_category_2_css'>[data-bhc='compound:homepage_flexible_touch_category_carousel_2'] {visibility: hidden;}<\/style>\");document.querySelector('head').append(css);","input_handler":"runIndividualizer.requestData.returnedAttributes = ['title_array', 'sale_price_start_at', 'sale_price_end_at', 'gallery_title', 'currency', 'category', 'inventory_service_id', 'restricted_reason', 'restricted', 'show_discount', 'deal_option_id_array', 'category_guids_object', 'category_guids', 'eligible_for_groupon_incentives', 'pds_id', 'channel_id', 'inventory_product_id'];runIndividualizer.requestData.output = ['scriptAbTest', 'mainAbTest'];runIndividualizer.requestData.contextVariables = runIndividualizer.getContextVariables();runIndividualizer.requestData.items = runIndividualizer.homepageMobileItems;var abTestGroup = runIndividualizer.getAbTestGroupFromTheirAbTester();if (abTestGroup) {runIndividualizer.requestData.abTests = abTestGroup;}","received_response_handler":"sessionStorage.setItem('db_abtests', JSON.stringify(runIndividualizer.abTests));runIndividualizer.getAndSavePurplePrices(runIndividualizer.idRequest);","before_render_handler":"var itemEl = \"<figure class='card-ui cui-c-udc price-badge-filled-background left-aligned-card is-getaways-booking has-additional-discount-percent' data-bhc=''><div class='cui-content'><a href=''><div class='cui-udc-image-container rounded-corners'><div class='cui-udc-image-overlay'><\/div><div class='cui-image-lazy-container cui-image-hover-zoom'><img class='cui-svg-placeholder' height='211' width='349'><img class='cui-image lazy-load lazy-loaded' data-ll-status='loaded' src='' style='position: absolute; top: 0;'><\/div><\/div><div class='cui-udc-details cui-udc-left-aligned-details'><div class='cui-single-section'><div class='cui-udc-title one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-location cui-truncate cui-has-distance' style='display: none;'><span class='cui-location-name'><\/span><span class='cui-location-separator'>\u2022<\/span><span class='cui-location-distance'><\/span><\/div><\/div><div class='cui-single-section'><div class='cui-review-rating' style='display: none;'><div aria-hidden='true' class='numeric-count'><\/div><ul class='rating rating-numeric'><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><\/ul><div class='rating-count'><\/div><\/div><\/div><div class='cui-bottom-body'><div class='cui-combined-section'><div class='cui-price' data-pingdom-id='deal-price'><div aria-hidden='true' class='cui-price-original c-txt-gray-dk' style='display: none;'><\/div><div aria-hidden='true' class='cui-price-discount c-txt-price'><div class='cui-price-descriptor' style='display: none;'><\/div><span><\/span><div class='cui-price-descriptor' style='display: none;'><\/div><\/div><\/div><div class='cui-promotions'><div class='cui-detail-badge cui-discount-badge' style='display: none;'><\/div><div class='cui-urgent cui-offer' style='display: none;'><div><\/div><div class='cui-verbose-urgency-price' aria-hidden='true'><\/div><div class='cui-verbose-urgency-text'><\/div><\/div><\/div><\/div><div class='cui-single-section'><div class='cui-udc-subtitle one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-urgency-message'><\/div><\/div><\/div><\/div><\/a><div class='cui-book-online-cta__container' style='display: none;'><a class='cui-book-online-cta' href=''>\" + runIndividualizer.translations.bookOnline + \"<\/a> <\/div><\/div><\/figure>\";var rootEl = document.querySelector(\"[data-bhc='compound:homepage_flexible_touch_category_carousel_2'] .carousel-content\");rootEl.innerHTML = itemEl;","output_handler":"var interval = setInterval(function() {var messages = document.querySelectorAll(\"[data-bhc='compound:homepage_flexible_touch_category_carousel_2'] .carousel-content .cui-urgency-message\");if (messages[0].innerHTML === '') {clearInterval(interval);messages.forEach(function(el) {el.innerHTML = el.getAttribute('data-message');});}}, 100);setTimeout(function() {clearInterval(interval);}, 3000);var el = document.querySelector('#db_homepage_mobile_category_2_css');if (el) {el.remove();}runIndividualizer.recommendations[runIndividualizer.idRequest].forEach(function(item) {runIndividualizer.homepageMobileItems.push({\"itemId\": item.itemId});});var rootEl = document.querySelector(\"[data-bhc='compound:homepage_flexible_touch_category_carousel_2'] .carousel-content\");runIndividualizer.renderPurplePrices(runIndividualizer.idRequest, rootEl);","empty_response_handler":"var el = document.querySelector('#db_homepage_mobile_category_2_css');if (el) {el.remove();}","events":[{"type":["fetch"],"selector":{"mode":"css","selection":""},"input_handler":"var url = runIndividualizer.nativeEvent[0];if (url.indexOf('\/homepage\/get-paginated-cards') < 0 || url.indexOf('&index=4') < 0) {runIndividualizer.lock = true;}","timeout_handler":"var el = document.querySelector('#db_homepage_mobile_category_2_css');if (el) {el.remove();}","observer":{"parent_selector":{"mode":"css","selection":"body"},"mutation_selector":{"mode":"css","selection":"[data-bhc='compound:homepage_flexible_touch_category_carousel_2']"}},"timeout":5000}],"item_attributes":{"_customer_item_id":{"property":"data-bhc","output_handler":"runIndividualizer.element.setAttribute('data-bhc', 'deal:' + runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":""},"required":!0},"channel":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseData === 'marketrate-hotel' || runIndividualizer.responseItem['is_travel_bookable_deal']) {runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"discount_percent_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = JSON.parse(runIndividualizer.responseItem['value_array'])[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && data[index] > 0 && !isSalePriceInEffect && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = data[index] + '% ' + runIndividualizer.translations.discountBadgeText;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-discount-badge"},"required":!0},"is_bookable":{"property":"data-style","output_handler":"if (runIndividualizer.responseData) {runIndividualizer.element.style.display = 'flex';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-book-online-cta__container"},"required":!0},"is_travel_bookable_deal":{"property":"data-is-travel-bookable-deal","output_handler":"runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"med_image":{"property":"src","output_handler":"runIndividualizer.responseData = runIndividualizer.responseData.replace('t300x182.jpg', 'c349x211.webp');","run_condition":"","internal_selector":{"mode":"css","selection":".cui-image"},"required":!0},"merchant_name":{"property":"innerHTML","output_handler":"var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') < 0 && !isCashBackDeal && !isGetawaysDeal) {var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {runIndividualizer.element.classList.remove('one-line-truncate');var title = runIndividualizer.getTitle(runIndividualizer.responseItem);if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}runIndividualizer.responseData = title;}}var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.translations.memberPricing + ' ' + runIndividualizer.responseData;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-title"},"required":!0},"price_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);runIndividualizer.responseData = runIndividualizer.getFormattedPrice(data[index], runIndividualizer.responseItem['currency']);var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {var el = runIndividualizer.element.parentElement;el.classList.remove('c-txt-price');el.classList.add('cui-price-message', 'cui-price-hidden');el.innerHTML = runIndividualizer.translations.priceHidden;} else {if (isCashBackDeal) {runIndividualizer.responseData = runIndividualizer.getCashBack(runIndividualizer.responseItem);} else {if (data.length > 1) {var wrapEl = runIndividualizer.element.parentElement;var el = wrapEl.querySelector('.cui-price-discount .cui-price-descriptor:first-child');if (isSalePriceInEffect) {wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');wrapEl.closest('figure').querySelector('.cui-promotions .cui-offer div:first-child').innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';} else {el.innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';}el.style.display = 'block';}if (data.length === 1 && isSalePriceInEffect) {var wrapEl = runIndividualizer.element.parentElement;wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');}}var isCouponDeal = runIndividualizer.isCouponDeal(runIndividualizer.responseItem);if (isCouponDeal) {runIndividualizer.element.parentElement.parentElement.style.display = 'none';}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount span"},"required":!0},"purchases_total_displayed":{"property":"innerHTML","output_handler":"var num = runIndividualizer.responseData;var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (num > 10 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(num \/ 10) * 10) + '+ ' + runIndividualizer.translations.bought;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1},"rating_count":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_value']) {runIndividualizer.responseData = runIndividualizer.responseData + ' ' + runIndividualizer.translations.ratings;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .rating-count"},"required":!1},"rating_value":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_count']) {var value = runIndividualizer.responseData;var wrapEl = runIndividualizer.element.closest('.cui-review-rating');wrapEl.style.display = 'flex';var stars = wrapEl.querySelectorAll('ul li span');stars.forEach(function(el, num) {if (num + 0.8 <= value) {el.classList.value = 'full-star';} else if (num + 0.3 <= value) {el.classList.value = 'half-star';} else {el.classList.value = 'empty-star';}});} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .numeric-count"},"required":!1},"redemption_locations_short":{"property":"data-location","output_handler":"var locations = JSON.parse(runIndividualizer.responseData);var filteredLocations = [];locations.forEach(function(location) {if (location.hasOwnProperty('lat') && location.hasOwnProperty('lng')) {filteredLocations.push(location);}});locations = filteredLocations;if (locations.length > 0) {var location = runIndividualizer.getNearestLocation(locations);var address = [];if (location['streetAddress1']) {address.push(location['streetAddress1']);}if (location['city']) {address.push(location['city']);}var el = runIndividualizer.element.querySelector('.cui-location-name');if (el) {el.innerHTML = address.join(', ');}var distance = location['distanceInKm'];var unit = runIndividualizer.translations.distanceUnit;if (unit === 'mi') {distance = distance \/ 1.609;}distance = Math.round(distance * 10) \/ 10;var el = runIndividualizer.element.querySelector('.cui-location-distance');if (el) {el.innerHTML = distance + ' ' + unit;}runIndividualizer.element.style.display = 'block';} else {runIndividualizer.element.style.display = 'none';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-location"},"required":!1},"sale_price":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isSalePriceInEffect && !isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(runIndividualizer.responseData, runIndividualizer.responseItem['currency']);var wrapEl = runIndividualizer.element.parentElement;wrapEl.querySelector('.cui-verbose-urgency-text').innerHTML = runIndividualizer.translations.limitedTime;wrapEl.style.display = 'flex';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-offer .cui-verbose-urgency-price"},"required":!1},"title_general":{"property":"innerHTML","output_handler":"var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') >= 0) {var title = runIndividualizer.responseData.trim();if (title === '') {var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseItem['title_array']);var title = data[index];}if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}var el = runIndividualizer.element.closest('figure').querySelector('.cui-udc-title');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {el.classList.remove('one-line-truncate');if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}}el.innerHTML = title;runIndividualizer.responseData = '';} else {var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (isCashBackDeal) {runIndividualizer.element.classList.add('c-txt-gray-dk');runIndividualizer.responseData = runIndividualizer.translations.freeToClaim;} else {var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (['product_card_merchant_name_up'].indexOf(abTestGroup) >= 0 || isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.getTitle(runIndividualizer.responseItem);}if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0 && !isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.responseItem['merchant_name'];}}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-subtitle"},"required":!0},"url":{"property":"href","output_handler":"","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"value_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = data[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(originalPrice, runIndividualizer.responseItem['currency']);runIndividualizer.element.style.display = 'block';var refEl = runIndividualizer.element.nextElementSibling;refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML('<span>&nbsp;<\/span>'), refEl)} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-original"},"required":!0},"views_24h":{"property":"innerHTML","output_handler":"var numViews = runIndividualizer.responseData;var numPurchases = runIndividualizer.responseItem['purchases_total_displayed'];var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if ((!numPurchases || numPurchases <= 10) && numViews >= 150 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(numViews \/ 10) * 10) + '+ ' + runIndividualizer.translations.viewedToday;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1}}},"homepage_mobile_category_3":{"type":"recommendation","running":!0,"run_condition":"location.pathname === '\/' && LS_Mustache_Params && LS_Mustache_Params.mobileConfig && location.host.slice(-4) !== '.com'","multiple":!0,"apply_only_last_request":!0,"root_selector":{"mode":"css","selection":"[data-bhc='compound:homepage_flexible_touch_category_carousel_3'] .carousel-content"},"run_handler":"var css = runIndividualizer.createElementFromHTML(\"<style id='db_homepage_mobile_category_3_css'>[data-bhc='compound:homepage_flexible_touch_category_carousel_3'] {visibility: hidden;}<\/style>\");document.querySelector('head').append(css);","input_handler":"runIndividualizer.requestData.returnedAttributes = ['title_array', 'sale_price_start_at', 'sale_price_end_at', 'gallery_title', 'currency', 'category', 'inventory_service_id', 'restricted_reason', 'restricted', 'show_discount', 'deal_option_id_array', 'category_guids_object', 'category_guids', 'eligible_for_groupon_incentives', 'pds_id', 'channel_id', 'inventory_product_id'];runIndividualizer.requestData.output = ['scriptAbTest', 'mainAbTest'];runIndividualizer.requestData.contextVariables = runIndividualizer.getContextVariables();runIndividualizer.requestData.items = runIndividualizer.homepageMobileItems;var abTestGroup = runIndividualizer.getAbTestGroupFromTheirAbTester();if (abTestGroup) {runIndividualizer.requestData.abTests = abTestGroup;}","received_response_handler":"sessionStorage.setItem('db_abtests', JSON.stringify(runIndividualizer.abTests));runIndividualizer.getAndSavePurplePrices(runIndividualizer.idRequest);","before_render_handler":"var itemEl = \"<figure class='card-ui cui-c-udc price-badge-filled-background left-aligned-card is-getaways-booking has-additional-discount-percent' data-bhc=''><div class='cui-content'><a href=''><div class='cui-udc-image-container rounded-corners'><div class='cui-udc-image-overlay'><\/div><div class='cui-image-lazy-container cui-image-hover-zoom'><img class='cui-svg-placeholder' height='211' width='349'><img class='cui-image lazy-load lazy-loaded' data-ll-status='loaded' src='' style='position: absolute; top: 0;'><\/div><\/div><div class='cui-udc-details cui-udc-left-aligned-details'><div class='cui-single-section'><div class='cui-udc-title one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-location cui-truncate cui-has-distance' style='display: none;'><span class='cui-location-name'><\/span><span class='cui-location-separator'>\u2022<\/span><span class='cui-location-distance'><\/span><\/div><\/div><div class='cui-single-section'><div class='cui-review-rating' style='display: none;'><div aria-hidden='true' class='numeric-count'><\/div><ul class='rating rating-numeric'><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><\/ul><div class='rating-count'><\/div><\/div><\/div><div class='cui-bottom-body'><div class='cui-combined-section'><div class='cui-price' data-pingdom-id='deal-price'><div aria-hidden='true' class='cui-price-original c-txt-gray-dk' style='display: none;'><\/div><div aria-hidden='true' class='cui-price-discount c-txt-price'><div class='cui-price-descriptor' style='display: none;'><\/div><span><\/span><div class='cui-price-descriptor' style='display: none;'><\/div><\/div><\/div><div class='cui-promotions'><div class='cui-detail-badge cui-discount-badge' style='display: none;'><\/div><div class='cui-urgent cui-offer' style='display: none;'><div><\/div><div class='cui-verbose-urgency-price' aria-hidden='true'><\/div><div class='cui-verbose-urgency-text'><\/div><\/div><\/div><\/div><div class='cui-single-section'><div class='cui-udc-subtitle one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-urgency-message'><\/div><\/div><\/div><\/div><\/a><div class='cui-book-online-cta__container' style='display: none;'><a class='cui-book-online-cta' href=''>\" + runIndividualizer.translations.bookOnline + \"<\/a> <\/div><\/div><\/figure>\";var rootEl = document.querySelector(\"[data-bhc='compound:homepage_flexible_touch_category_carousel_3'] .carousel-content\");rootEl.innerHTML = itemEl;","output_handler":"var interval = setInterval(function() {var messages = document.querySelectorAll(\"[data-bhc='compound:homepage_flexible_touch_category_carousel_2'] .carousel-content .cui-urgency-message\");if (messages[0].innerHTML === '') {clearInterval(interval);messages.forEach(function(el) {el.innerHTML = el.getAttribute('data-message');});}}, 100);setTimeout(function() {clearInterval(interval);}, 3000);var el = document.querySelector('#db_homepage_mobile_category_3_css');if (el) {el.remove();}runIndividualizer.recommendations[runIndividualizer.idRequest].forEach(function(item) {runIndividualizer.homepageMobileItems.push({\"itemId\": item.itemId});});var rootEl = document.querySelector(\"[data-bhc='compound:homepage_flexible_touch_category_carousel_3'] .carousel-content\");runIndividualizer.renderPurplePrices(runIndividualizer.idRequest, rootEl);","empty_response_handler":"var el = document.querySelector('#db_homepage_mobile_category_3_css');if (el) {el.remove();}","events":[{"type":["fetch"],"selector":{"mode":"css","selection":""},"input_handler":"var url = runIndividualizer.nativeEvent[0];if (url.indexOf('\/homepage\/get-paginated-cards') < 0 || url.indexOf('&index=5') < 0) {runIndividualizer.lock = true;}","timeout_handler":"var el = document.querySelector('#db_homepage_mobile_category_3_css');if (el) {el.remove();}","timeout":5000}],"item_attributes":{"_customer_item_id":{"property":"data-bhc","output_handler":"runIndividualizer.element.setAttribute('data-bhc', 'deal:' + runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":""},"required":!0},"channel":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseData === 'marketrate-hotel' || runIndividualizer.responseItem['is_travel_bookable_deal']) {runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"discount_percent_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = JSON.parse(runIndividualizer.responseItem['value_array'])[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && data[index] > 0 && !isSalePriceInEffect && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = data[index] + '% ' + runIndividualizer.translations.discountBadgeText;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-discount-badge"},"required":!0},"is_bookable":{"property":"data-style","output_handler":"if (runIndividualizer.responseData) {runIndividualizer.element.style.display = 'flex';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-book-online-cta__container"},"required":!0},"is_travel_bookable_deal":{"property":"data-is-travel-bookable-deal","output_handler":"runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"med_image":{"property":"src","output_handler":"runIndividualizer.responseData = runIndividualizer.responseData.replace('t300x182.jpg', 'c349x211.webp');","run_condition":"","internal_selector":{"mode":"css","selection":".cui-image"},"required":!0},"merchant_name":{"property":"innerHTML","output_handler":"var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') < 0 && !isCashBackDeal && !isGetawaysDeal) {var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {runIndividualizer.element.classList.remove('one-line-truncate');var title = runIndividualizer.getTitle(runIndividualizer.responseItem);if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}runIndividualizer.responseData = title;}}var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.translations.memberPricing + ' ' + runIndividualizer.responseData;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-title"},"required":!0},"price_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);runIndividualizer.responseData = runIndividualizer.getFormattedPrice(data[index], runIndividualizer.responseItem['currency']);var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {var el = runIndividualizer.element.parentElement;el.classList.remove('c-txt-price');el.classList.add('cui-price-message', 'cui-price-hidden');el.innerHTML = runIndividualizer.translations.priceHidden;} else {if (isCashBackDeal) {runIndividualizer.responseData = runIndividualizer.getCashBack(runIndividualizer.responseItem);} else {if (data.length > 1) {var wrapEl = runIndividualizer.element.parentElement;var el = wrapEl.querySelector('.cui-price-discount .cui-price-descriptor:first-child');if (isSalePriceInEffect) {wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');wrapEl.closest('figure').querySelector('.cui-promotions .cui-offer div:first-child').innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';} else {el.innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';}el.style.display = 'block';}if (data.length === 1 && isSalePriceInEffect) {var wrapEl = runIndividualizer.element.parentElement;wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');}}var isCouponDeal = runIndividualizer.isCouponDeal(runIndividualizer.responseItem);if (isCouponDeal) {runIndividualizer.element.parentElement.parentElement.style.display = 'none';}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount span"},"required":!0},"purchases_total_displayed":{"property":"innerHTML","output_handler":"var num = runIndividualizer.responseData;var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (num > 10 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(num \/ 10) * 10) + '+ ' + runIndividualizer.translations.bought;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1},"rating_count":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_value']) {runIndividualizer.responseData = runIndividualizer.responseData + ' ' + runIndividualizer.translations.ratings;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .rating-count"},"required":!1},"rating_value":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_count']) {var value = runIndividualizer.responseData;var wrapEl = runIndividualizer.element.closest('.cui-review-rating');wrapEl.style.display = 'flex';var stars = wrapEl.querySelectorAll('ul li span');stars.forEach(function(el, num) {if (num + 0.8 <= value) {el.classList.value = 'full-star';} else if (num + 0.3 <= value) {el.classList.value = 'half-star';} else {el.classList.value = 'empty-star';}});} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .numeric-count"},"required":!1},"redemption_locations_short":{"property":"data-location","output_handler":"var locations = JSON.parse(runIndividualizer.responseData);var filteredLocations = [];locations.forEach(function(location) {if (location.hasOwnProperty('lat') && location.hasOwnProperty('lng')) {filteredLocations.push(location);}});locations = filteredLocations;if (locations.length > 0) {var location = runIndividualizer.getNearestLocation(locations);var address = [];if (location['streetAddress1']) {address.push(location['streetAddress1']);}if (location['city']) {address.push(location['city']);}var el = runIndividualizer.element.querySelector('.cui-location-name');if (el) {el.innerHTML = address.join(', ');}var distance = location['distanceInKm'];var unit = runIndividualizer.translations.distanceUnit;if (unit === 'mi') {distance = distance \/ 1.609;}distance = Math.round(distance * 10) \/ 10;var el = runIndividualizer.element.querySelector('.cui-location-distance');if (el) {el.innerHTML = distance + ' ' + unit;}runIndividualizer.element.style.display = 'block';} else {runIndividualizer.element.style.display = 'none';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-location"},"required":!1},"sale_price":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isSalePriceInEffect && !isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(runIndividualizer.responseData, runIndividualizer.responseItem['currency']);var wrapEl = runIndividualizer.element.parentElement;wrapEl.querySelector('.cui-verbose-urgency-text').innerHTML = runIndividualizer.translations.limitedTime;wrapEl.style.display = 'flex';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-offer .cui-verbose-urgency-price"},"required":!1},"title_general":{"property":"innerHTML","output_handler":"var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') >= 0) {var title = runIndividualizer.responseData.trim();if (title === '') {var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseItem['title_array']);var title = data[index];}if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}var el = runIndividualizer.element.closest('figure').querySelector('.cui-udc-title');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {el.classList.remove('one-line-truncate');if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}}el.innerHTML = title;runIndividualizer.responseData = '';} else {var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (isCashBackDeal) {runIndividualizer.element.classList.add('c-txt-gray-dk');runIndividualizer.responseData = runIndividualizer.translations.freeToClaim;} else {var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (['product_card_merchant_name_up'].indexOf(abTestGroup) >= 0 || isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.getTitle(runIndividualizer.responseItem);}if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0 && !isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.responseItem['merchant_name'];}}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-subtitle"},"required":!0},"url":{"property":"href","output_handler":"","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"value_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = data[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(originalPrice, runIndividualizer.responseItem['currency']);runIndividualizer.element.style.display = 'block';var refEl = runIndividualizer.element.nextElementSibling;refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML('<span>&nbsp;<\/span>'), refEl)} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-original"},"required":!0},"views_24h":{"property":"innerHTML","output_handler":"var numViews = runIndividualizer.responseData;var numPurchases = runIndividualizer.responseItem['purchases_total_displayed'];var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if ((!numPurchases || numPurchases <= 10) && numViews >= 150 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(numViews \/ 10) * 10) + '+ ' + runIndividualizer.translations.viewedToday;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1}}},"homepage_mobile_directly":{"type":"recommendation","running":!0,"run_condition":"location.pathname === '\/' && LS_Mustache_Params && LS_Mustache_Params.mobileConfig && location.host.slice(-4) !== '.com'","multiple":!0,"apply_only_last_request":!0,"root_selector":{"mode":"css","selection":"[data-bhc='compound:homepage_flexible_touch_customer_affinity_widget'] .carousel-content"},"run_handler":"var css = runIndividualizer.createElementFromHTML(\"<style id='db_homepage_mobile_directly_css'>[data-bhc='compound:homepage_flexible_touch_customer_affinity_widget'] {visibility: hidden;}<\/style>\");document.querySelector('head').append(css);","input_handler":"runIndividualizer.requestData.returnedAttributes = ['title_array', 'sale_price_start_at', 'sale_price_end_at', 'gallery_title', 'currency', 'category', 'inventory_service_id', 'restricted_reason', 'restricted', 'show_discount', 'deal_option_id_array', 'category_guids_object', 'category_guids', 'eligible_for_groupon_incentives', 'pds_id', 'channel_id', 'inventory_product_id'];runIndividualizer.requestData.output = ['scriptAbTest', 'mainAbTest'];runIndividualizer.requestData.contextVariables = runIndividualizer.getContextVariables();runIndividualizer.requestData.items = runIndividualizer.homepageMobileItems;var abTestGroup = runIndividualizer.getAbTestGroupFromTheirAbTester();if (abTestGroup) {runIndividualizer.requestData.abTests = abTestGroup;}","received_response_handler":"sessionStorage.setItem('db_abtests', JSON.stringify(runIndividualizer.abTests));runIndividualizer.getAndSavePurplePrices(runIndividualizer.idRequest);","before_render_handler":"var itemEl = \"<figure class='card-ui cui-c-udc price-badge-filled-background left-aligned-card is-getaways-booking has-additional-discount-percent' data-bhc=''><div class='cui-content'><a href=''><div class='cui-udc-image-container rounded-corners'><div class='cui-udc-image-overlay'><\/div><div class='cui-image-lazy-container cui-image-hover-zoom'><img class='cui-svg-placeholder' height='211' width='349'><img class='cui-image lazy-load lazy-loaded' data-ll-status='loaded' src='' style='position: absolute; top: 0;'><\/div><\/div><div class='cui-udc-details cui-udc-left-aligned-details'><div class='cui-single-section'><div class='cui-udc-title one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-location cui-truncate cui-has-distance' style='display: none;'><span class='cui-location-name'><\/span><span class='cui-location-separator'>\u2022<\/span><span class='cui-location-distance'><\/span><\/div><\/div><div class='cui-single-section'><div class='cui-review-rating' style='display: none;'><div aria-hidden='true' class='numeric-count'><\/div><ul class='rating rating-numeric'><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><\/ul><div class='rating-count'><\/div><\/div><\/div><div class='cui-bottom-body'><div class='cui-combined-section'><div class='cui-price' data-pingdom-id='deal-price'><div aria-hidden='true' class='cui-price-original c-txt-gray-dk' style='display: none;'><\/div><div aria-hidden='true' class='cui-price-discount c-txt-price'><div class='cui-price-descriptor' style='display: none;'><\/div><span><\/span><div class='cui-price-descriptor' style='display: none;'><\/div><\/div><\/div><div class='cui-promotions'><div class='cui-detail-badge cui-discount-badge' style='display: none;'><\/div><div class='cui-urgent cui-offer' style='display: none;'><div><\/div><div class='cui-verbose-urgency-price' aria-hidden='true'><\/div><div class='cui-verbose-urgency-text'><\/div><\/div><\/div><\/div><div class='cui-single-section'><div class='cui-udc-subtitle one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-urgency-message'><\/div><\/div><\/div><\/div><\/a><div class='cui-book-online-cta__container' style='display: none;'><a class='cui-book-online-cta' href=''>\" + runIndividualizer.translations.bookOnline + \"<\/a> <\/div><\/div><\/figure>\";var rootEl = document.querySelector(\"[data-bhc='compound:homepage_flexible_touch_customer_affinity_widget'] .carousel-content\");rootEl.innerHTML = itemEl;","output_handler":"var interval = setInterval(function() {var messages = document.querySelectorAll(\"[data-bhc='compound:homepage_flexible_touch_customer_affinity_widget'] .carousel-content .cui-urgency-message\");if (messages[0].innerHTML === '') {clearInterval(interval);messages.forEach(function(el) {el.innerHTML = el.getAttribute('data-message');});}}, 100);setTimeout(function() {clearInterval(interval);}, 3000);var el = document.querySelector('#db_homepage_mobile_directly_css');if (el) {el.remove();}runIndividualizer.recommendations[runIndividualizer.idRequest].forEach(function(item) {runIndividualizer.homepageMobileItems.push({\"itemId\": item.itemId});});var rootEl = document.querySelector(\"[data-bhc='compound:homepage_flexible_touch_customer_affinity_widget'] .carousel-content\");runIndividualizer.renderPurplePrices(runIndividualizer.idRequest, rootEl);","empty_response_handler":"var el = document.querySelector('#db_homepage_mobile_directly_css');if (el) {el.remove();}","events":[{"type":["DOMContentLoaded"],"selector":{"mode":"css","selection":""},"input_handler":"","timeout_handler":"var el = document.querySelector('#db_homepage_mobile_directly_css');if (el) {el.remove();}","timeout":5000}],"item_attributes":{"_customer_item_id":{"property":"data-bhc","output_handler":"runIndividualizer.element.setAttribute('data-bhc', 'deal:' + runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":""},"required":!0},"channel":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseData === 'marketrate-hotel' || runIndividualizer.responseItem['is_travel_bookable_deal']) {runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"discount_percent_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = JSON.parse(runIndividualizer.responseItem['value_array'])[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && data[index] > 0 && !isSalePriceInEffect && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = data[index] + '% ' + runIndividualizer.translations.discountBadgeText;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-discount-badge"},"required":!0},"is_bookable":{"property":"data-style","output_handler":"if (runIndividualizer.responseData) {runIndividualizer.element.style.display = 'flex';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-book-online-cta__container"},"required":!0},"is_travel_bookable_deal":{"property":"data-is-travel-bookable-deal","output_handler":"runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"med_image":{"property":"src","output_handler":"runIndividualizer.responseData = runIndividualizer.responseData.replace('t300x182.jpg', 'c349x211.webp');","run_condition":"","internal_selector":{"mode":"css","selection":".cui-image"},"required":!0},"merchant_name":{"property":"innerHTML","output_handler":"var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') < 0 && !isCashBackDeal && !isGetawaysDeal) {var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {runIndividualizer.element.classList.remove('one-line-truncate');var title = runIndividualizer.getTitle(runIndividualizer.responseItem);if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}runIndividualizer.responseData = title;}}var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.translations.memberPricing + ' ' + runIndividualizer.responseData;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-title"},"required":!0},"price_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);runIndividualizer.responseData = runIndividualizer.getFormattedPrice(data[index], runIndividualizer.responseItem['currency']);var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {var el = runIndividualizer.element.parentElement;el.classList.remove('c-txt-price');el.classList.add('cui-price-message', 'cui-price-hidden');el.innerHTML = runIndividualizer.translations.priceHidden;} else {if (isCashBackDeal) {runIndividualizer.responseData = runIndividualizer.getCashBack(runIndividualizer.responseItem);} else {if (data.length > 1) {var wrapEl = runIndividualizer.element.parentElement;var el = wrapEl.querySelector('.cui-price-discount .cui-price-descriptor:first-child');if (isSalePriceInEffect) {wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');wrapEl.closest('figure').querySelector('.cui-promotions .cui-offer div:first-child').innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';} else {el.innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';}el.style.display = 'block';}if (data.length === 1 && isSalePriceInEffect) {var wrapEl = runIndividualizer.element.parentElement;wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');}}var isCouponDeal = runIndividualizer.isCouponDeal(runIndividualizer.responseItem);if (isCouponDeal) {runIndividualizer.element.parentElement.parentElement.style.display = 'none';}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount span"},"required":!0},"purchases_total_displayed":{"property":"innerHTML","output_handler":"var num = runIndividualizer.responseData;var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (num > 10 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(num \/ 10) * 10) + '+ ' + runIndividualizer.translations.bought;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1},"rating_count":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_value']) {runIndividualizer.responseData = runIndividualizer.responseData + ' ' + runIndividualizer.translations.ratings;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .rating-count"},"required":!1},"rating_value":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_count']) {var value = runIndividualizer.responseData;var wrapEl = runIndividualizer.element.closest('.cui-review-rating');wrapEl.style.display = 'flex';var stars = wrapEl.querySelectorAll('ul li span');stars.forEach(function(el, num) {if (num + 0.8 <= value) {el.classList.value = 'full-star';} else if (num + 0.3 <= value) {el.classList.value = 'half-star';} else {el.classList.value = 'empty-star';}});} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .numeric-count"},"required":!1},"redemption_locations_short":{"property":"data-location","output_handler":"var locations = JSON.parse(runIndividualizer.responseData);var filteredLocations = [];locations.forEach(function(location) {if (location.hasOwnProperty('lat') && location.hasOwnProperty('lng')) {filteredLocations.push(location);}});locations = filteredLocations;if (locations.length > 0) {var location = runIndividualizer.getNearestLocation(locations);var address = [];if (location['streetAddress1']) {address.push(location['streetAddress1']);}if (location['city']) {address.push(location['city']);}var el = runIndividualizer.element.querySelector('.cui-location-name');if (el) {el.innerHTML = address.join(', ');}var distance = location['distanceInKm'];var unit = runIndividualizer.translations.distanceUnit;if (unit === 'mi') {distance = distance \/ 1.609;}distance = Math.round(distance * 10) \/ 10;var el = runIndividualizer.element.querySelector('.cui-location-distance');if (el) {el.innerHTML = distance + ' ' + unit;}runIndividualizer.element.style.display = 'block';} else {runIndividualizer.element.style.display = 'none';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-location"},"required":!1},"sale_price":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isSalePriceInEffect && !isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(runIndividualizer.responseData, runIndividualizer.responseItem['currency']);var wrapEl = runIndividualizer.element.parentElement;wrapEl.querySelector('.cui-verbose-urgency-text').innerHTML = runIndividualizer.translations.limitedTime;wrapEl.style.display = 'flex';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-offer .cui-verbose-urgency-price"},"required":!1},"title_general":{"property":"innerHTML","output_handler":"var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') >= 0) {var title = runIndividualizer.responseData.trim();if (title === '') {var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseItem['title_array']);var title = data[index];}if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}var el = runIndividualizer.element.closest('figure').querySelector('.cui-udc-title');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {el.classList.remove('one-line-truncate');if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}}el.innerHTML = title;runIndividualizer.responseData = '';} else {var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (isCashBackDeal) {runIndividualizer.element.classList.add('c-txt-gray-dk');runIndividualizer.responseData = runIndividualizer.translations.freeToClaim;} else {var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (['product_card_merchant_name_up'].indexOf(abTestGroup) >= 0 || isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.getTitle(runIndividualizer.responseItem);}if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0 && !isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.responseItem['merchant_name'];}}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-subtitle"},"required":!0},"url":{"property":"href","output_handler":"","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"value_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = data[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(originalPrice, runIndividualizer.responseItem['currency']);runIndividualizer.element.style.display = 'block';var refEl = runIndividualizer.element.nextElementSibling;refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML('<span>&nbsp;<\/span>'), refEl)} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-original"},"required":!0},"views_24h":{"property":"innerHTML","output_handler":"var numViews = runIndividualizer.responseData;var numPurchases = runIndividualizer.responseItem['purchases_total_displayed'];var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if ((!numPurchases || numPurchases <= 10) && numViews >= 150 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(numViews \/ 10) * 10) + '+ ' + runIndividualizer.translations.viewedToday;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1}}},"homepage_mobile_feed":{"type":"recommendation","running":!0,"run_condition":"location.pathname === '\/' && LS_Mustache_Params && LS_Mustache_Params.mobileConfig && location.host.slice(-4) === '.com'","multiple":!0,"apply_only_last_request":!0,"root_selector":{"mode":"css","selection":"#db_homepage_mobile_feed"},"run_handler":"var css = runIndividualizer.createElementFromHTML(\"<style id='db_homepage_mobile_feed_css'>#main-feed > figure[data-bhc*='deal:'] {visibility: hidden;}<\/style>\");document.querySelector('head').append(css);css = runIndividualizer.createElementFromHTML(\"<style id='db_homepage_mobile_feed_css_2'>#db_homepage_mobile_feed {display: none;}<\/style>\");document.querySelector('head').append(css);","input_handler":"runIndividualizer.requestData.returnedAttributes = ['title_array', 'sale_price_start_at', 'sale_price_end_at', 'gallery_title', 'currency', 'category', 'inventory_service_id', 'restricted_reason', 'restricted', 'show_discount', 'deal_option_id_array', 'category_guids_object', 'category_guids', 'eligible_for_groupon_incentives', 'pds_id', 'channel_id', 'inventory_product_id'];runIndividualizer.requestData.output = ['scriptAbTest', 'mainAbTest'];runIndividualizer.requestData.contextVariables = runIndividualizer.getContextVariables();runIndividualizer.requestData.items = runIndividualizer.homepageMobileItems;var abTestGroup = runIndividualizer.getAbTestGroupFromTheirAbTester();if (abTestGroup) {runIndividualizer.requestData.abTests = abTestGroup;}","received_response_handler":"sessionStorage.setItem('db_abtests', JSON.stringify(runIndividualizer.abTests));runIndividualizer.getAndSavePurplePrices(runIndividualizer.idRequest);","before_render_handler":"var positionEl = document.querySelector('#db_homepage_mobile_feed');if (!positionEl) {positionEl = runIndividualizer.createElementFromHTML(\"<div id='db_homepage_mobile_feed' data-offset-special='0'><\/div>\");document.querySelector('body').prepend(positionEl);}var itemEl = \"<figure data-db='true' class='card-ui cui-c-udc price-badge-filled-background left-aligned-card is-getaways-booking has-additional-discount-percent' data-bhc=''><div class='cui-content'><a href=''><div class='cui-udc-image-container rounded-corners'><div class='cui-udc-image-overlay'><\/div><div class='cui-image-lazy-container cui-image-hover-zoom'><img class='cui-svg-placeholder' height='211' width='349'><img class='cui-image lazy-load lazy-loaded' data-ll-status='loaded' src='' style='position: absolute; top: 0;'><\/div><\/div><div class='cui-udc-details cui-udc-left-aligned-details'><div class='cui-single-section'><div class='cui-udc-title one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-location cui-truncate cui-has-distance' style='display: none;'><span class='cui-location-name'><\/span><span class='cui-location-separator'>\u2022<\/span><span class='cui-location-distance'><\/span><\/div><\/div><div class='cui-single-section'><div class='cui-review-rating' style='display: none;'><div aria-hidden='true' class='numeric-count'><\/div><ul class='rating rating-numeric'><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><\/ul><div class='rating-count'><\/div><\/div><\/div><div class='cui-bottom-body'><div class='cui-combined-section'><div class='cui-price' data-pingdom-id='deal-price'><div aria-hidden='true' class='cui-price-original c-txt-gray-dk' style='display: none;'><\/div><div aria-hidden='true' class='cui-price-discount c-txt-price'><div class='cui-price-descriptor' style='display: none;'><\/div><span><\/span><div class='cui-price-descriptor' style='display: none;'><\/div><\/div><\/div><div class='cui-promotions'><div class='cui-detail-badge cui-discount-badge' style='display: none;'><\/div><div class='cui-urgent cui-offer' style='display: none;'><div><\/div><div class='cui-verbose-urgency-price' aria-hidden='true'><\/div><div class='cui-verbose-urgency-text'><\/div><\/div><\/div><\/div><div class='cui-single-section'><div class='cui-udc-subtitle one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-urgency-message'><\/div><\/div><\/div><\/div><\/a><div class='cui-book-online-cta__container' style='display: none;'><a class='cui-book-online-cta' href=''>\" + runIndividualizer.translations.bookOnline + \"<\/a> <\/div><\/div><\/figure>\";positionEl.innerHTML = itemEl;","output_handler":"var interval = setInterval(function() {var messages = document.querySelectorAll(\"#main-feed > figure[data-bhc*='deal:'] .cui-urgency-message\");if (messages[0].innerHTML === '') {clearInterval(interval);messages.forEach(function(el) {el.innerHTML = el.getAttribute('data-message');});}}, 100);setTimeout(function() {clearInterval(interval);}, 3000);var positionEl = document.querySelector('#db_homepage_mobile_feed');if (positionEl) {var offset = parseInt(positionEl.getAttribute('data-offset-special'));var newItems = positionEl.querySelectorAll('figure');var oldItems = document.querySelectorAll(\"#main-feed > figure[data-bhc*='deal:']\");var count = 0;oldItems.forEach(function(el, index) {if ((index + 1) > offset) {if (newItems[count]) {el.parentNode.replaceChild(newItems[count], el);count++;} else {el.remove();}}});positionEl.setAttribute('data-offset-special', offset + count);positionEl.innerHTML = '';}var el = document.querySelector('#db_homepage_mobile_feed_css');if (el) {el.remove();}if (!runIndividualizer.homepageMobileFeedAutoLoading) {runIndividualizer.homepageMobileFeedAutoLoading = true;var loadMoreButton = document.querySelector('.load-more-section-button');if (loadMoreButton) {var observer = new IntersectionObserver(function() {if (!runIndividualizer.homepageMobileFeedLock) {runIndividualizer.homepageMobileFeedLock = true;loadMoreButton.click();}});observer.observe(loadMoreButton);}}runIndividualizer.homepageMobileFeedLock = false;var rootEl = document.querySelector(\"#db_homepage_mobile_feed\");runIndividualizer.renderPurplePrices(runIndividualizer.idRequest, rootEl);","empty_response_handler":"var el = document.querySelector('#db_homepage_mobile_feed_css');if (el) {el.remove();}","events":[{"type":["DOMContentLoaded"],"selector":{"mode":"css","selection":"#main-feed > figure[data-bhc*='deal:']:nth-child(11)"},"input_handler":"runIndividualizer.requestData.count = 9;","timeout_handler":"var el = document.querySelector('#db_homepage_mobile_feed_css');if (el) {el.remove();}","timeout":5000},{"type":["fetch"],"selector":{"mode":"css","selection":""},"input_handler":"var url = runIndividualizer.nativeEvent[0];if (url.indexOf('\/homepage\/get-paginated-cards') < 0 || url.indexOf('&index=1') > 0) {runIndividualizer.lock = true;}var positionEl = document.querySelector('#db_homepage_mobile_feed');if (positionEl) {runIndividualizer.requestData.offset = parseInt(positionEl.getAttribute('data-offset-special'));}","timeout_handler":"var el = document.querySelector('#db_homepage_mobile_feed_css');if (el) {el.remove();}","observer":{"parent_selector":{"mode":"css","selection":"body"},"mutation_selector":{"mode":"css","selection":"#main-feed > figure[data-bhc*='deal:']:not([data-db])"}},"timeout":3000}],"item_attributes":{"_customer_item_id":{"property":"data-bhc","output_handler":"runIndividualizer.element.setAttribute('data-bhc', 'deal:' + runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":""},"required":!0},"channel":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseData === 'marketrate-hotel' || runIndividualizer.responseItem['is_travel_bookable_deal']) {runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"discount_percent_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = JSON.parse(runIndividualizer.responseItem['value_array'])[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && data[index] > 0 && !isSalePriceInEffect && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = data[index] + '% ' + runIndividualizer.translations.discountBadgeText;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-discount-badge"},"required":!0},"is_bookable":{"property":"data-style","output_handler":"if (runIndividualizer.responseData) {runIndividualizer.element.style.display = 'flex';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-book-online-cta__container"},"required":!0},"is_travel_bookable_deal":{"property":"data-is-travel-bookable-deal","output_handler":"runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"med_image":{"property":"src","output_handler":"runIndividualizer.responseData = runIndividualizer.responseData.replace('t300x182.jpg', 'c349x211.webp');","run_condition":"","internal_selector":{"mode":"css","selection":".cui-image"},"required":!0},"merchant_name":{"property":"innerHTML","output_handler":"var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') < 0 && !isCashBackDeal && !isGetawaysDeal) {var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {runIndividualizer.element.classList.remove('one-line-truncate');var title = runIndividualizer.getTitle(runIndividualizer.responseItem);if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}runIndividualizer.responseData = title;}}var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.translations.memberPricing + ' ' + runIndividualizer.responseData;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-title"},"required":!0},"price_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);runIndividualizer.responseData = runIndividualizer.getFormattedPrice(data[index], runIndividualizer.responseItem['currency']);var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {var el = runIndividualizer.element.parentElement;el.classList.remove('c-txt-price');el.classList.add('cui-price-message', 'cui-price-hidden');el.innerHTML = runIndividualizer.translations.priceHidden;} else {if (isCashBackDeal) {runIndividualizer.responseData = runIndividualizer.getCashBack(runIndividualizer.responseItem);} else {if (data.length > 1) {var wrapEl = runIndividualizer.element.parentElement;var el = wrapEl.querySelector('.cui-price-discount .cui-price-descriptor:first-child');if (isSalePriceInEffect) {wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');wrapEl.closest('figure').querySelector('.cui-promotions .cui-offer div:first-child').innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';} else {el.innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';}el.style.display = 'block';}if (data.length === 1 && isSalePriceInEffect) {var wrapEl = runIndividualizer.element.parentElement;wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');}}var isCouponDeal = runIndividualizer.isCouponDeal(runIndividualizer.responseItem);if (isCouponDeal) {runIndividualizer.element.parentElement.parentElement.style.display = 'none';}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount span"},"required":!0},"purchases_total_displayed":{"property":"innerHTML","output_handler":"var num = runIndividualizer.responseData;var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (num > 10 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(num \/ 10) * 10) + '+ ' + runIndividualizer.translations.bought;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1},"rating_count":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_value']) {runIndividualizer.responseData = runIndividualizer.responseData + ' ' + runIndividualizer.translations.ratings;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .rating-count"},"required":!1},"rating_value":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_count']) {var value = runIndividualizer.responseData;var wrapEl = runIndividualizer.element.closest('.cui-review-rating');wrapEl.style.display = 'flex';var stars = wrapEl.querySelectorAll('ul li span');stars.forEach(function(el, num) {if (num + 0.8 <= value) {el.classList.value = 'full-star';} else if (num + 0.3 <= value) {el.classList.value = 'half-star';} else {el.classList.value = 'empty-star';}});} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .numeric-count"},"required":!1},"redemption_locations_short":{"property":"data-location","output_handler":"var locations = JSON.parse(runIndividualizer.responseData);var filteredLocations = [];locations.forEach(function(location) {if (location.hasOwnProperty('lat') && location.hasOwnProperty('lng')) {filteredLocations.push(location);}});locations = filteredLocations;if (locations.length > 0) {var location = runIndividualizer.getNearestLocation(locations);var address = [];if (location['streetAddress1']) {address.push(location['streetAddress1']);}if (location['city']) {address.push(location['city']);}var el = runIndividualizer.element.querySelector('.cui-location-name');if (el) {el.innerHTML = address.join(', ');}var distance = location['distanceInKm'];var unit = runIndividualizer.translations.distanceUnit;if (unit === 'mi') {distance = distance \/ 1.609;}distance = Math.round(distance * 10) \/ 10;var el = runIndividualizer.element.querySelector('.cui-location-distance');if (el) {el.innerHTML = distance + ' ' + unit;}runIndividualizer.element.style.display = 'block';} else {runIndividualizer.element.style.display = 'none';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-location"},"required":!1},"sale_price":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isSalePriceInEffect && !isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(runIndividualizer.responseData, runIndividualizer.responseItem['currency']);var wrapEl = runIndividualizer.element.parentElement;wrapEl.querySelector('.cui-verbose-urgency-text').innerHTML = runIndividualizer.translations.limitedTime;wrapEl.style.display = 'flex';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-offer .cui-verbose-urgency-price"},"required":!1},"title_general":{"property":"innerHTML","output_handler":"var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') >= 0) {var title = runIndividualizer.responseData.trim();if (title === '') {var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseItem['title_array']);var title = data[index];}if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}var el = runIndividualizer.element.closest('figure').querySelector('.cui-udc-title');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {el.classList.remove('one-line-truncate');if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}}el.innerHTML = title;runIndividualizer.responseData = '';} else {var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (isCashBackDeal) {runIndividualizer.element.classList.add('c-txt-gray-dk');runIndividualizer.responseData = runIndividualizer.translations.freeToClaim;} else {var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (['product_card_merchant_name_up'].indexOf(abTestGroup) >= 0 || isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.getTitle(runIndividualizer.responseItem);}if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0 && !isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.responseItem['merchant_name'];}}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-subtitle"},"required":!0},"url":{"property":"href","output_handler":"","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"value_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = data[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(originalPrice, runIndividualizer.responseItem['currency']);runIndividualizer.element.style.display = 'block';var refEl = runIndividualizer.element.nextElementSibling;refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML('<span>&nbsp;<\/span>'), refEl)} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-original"},"required":!0},"views_24h":{"property":"innerHTML","output_handler":"var numViews = runIndividualizer.responseData;var numPurchases = runIndividualizer.responseItem['purchases_total_displayed'];var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if ((!numPurchases || numPurchases <= 10) && numViews >= 150 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(numViews \/ 10) * 10) + '+ ' + runIndividualizer.translations.viewedToday;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1}}},"homepage_mobile_inspired_by_history":{"type":"recommendation","running":!0,"run_condition":"location.pathname === '\/' && LS_Mustache_Params && LS_Mustache_Params.mobileConfig && location.host.slice(-4) === '.com'","multiple":!0,"apply_only_last_request":!0,"root_selector":{"mode":"css","selection":"[data-bhc='compound:homepage_touch_richrelevance_placement2'] .carousel-content"},"run_handler":"var css = runIndividualizer.createElementFromHTML(\"<style id='db_homepage_mobile_inspired_by_history_css'>[data-bhc='compound:homepage_touch_richrelevance_placement2'] {visibility: hidden;}<\/style>\");document.querySelector('head').append(css);","input_handler":"runIndividualizer.requestData.returnedAttributes = ['title_array', 'sale_price_start_at', 'sale_price_end_at', 'gallery_title', 'currency', 'category', 'inventory_service_id', 'restricted_reason', 'restricted', 'show_discount', 'deal_option_id_array', 'category_guids_object', 'category_guids', 'eligible_for_groupon_incentives', 'pds_id', 'channel_id', 'inventory_product_id'];runIndividualizer.requestData.output = ['scriptAbTest', 'mainAbTest'];runIndividualizer.requestData.contextVariables = runIndividualizer.getContextVariables();runIndividualizer.requestData.items = runIndividualizer.homepageMobileItems;var abTestGroup = runIndividualizer.getAbTestGroupFromTheirAbTester();if (abTestGroup) {runIndividualizer.requestData.abTests = abTestGroup;}","received_response_handler":"sessionStorage.setItem('db_abtests', JSON.stringify(runIndividualizer.abTests));runIndividualizer.getAndSavePurplePrices(runIndividualizer.idRequest);","before_render_handler":"var itemEl = \"<figure class='card-ui cui-c-udc price-badge-filled-background left-aligned-card is-getaways-booking has-additional-discount-percent' data-bhc=''><div class='cui-content'><a href=''><div class='cui-udc-image-container rounded-corners'><div class='cui-udc-image-overlay'><\/div><div class='cui-image-lazy-container cui-image-hover-zoom'><img class='cui-svg-placeholder' height='211' width='349'><img class='cui-image lazy-load lazy-loaded' data-ll-status='loaded' src='' style='position: absolute; top: 0;'><\/div><\/div><div class='cui-udc-details cui-udc-left-aligned-details'><div class='cui-single-section'><div class='cui-udc-title one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-location cui-truncate cui-has-distance' style='display: none;'><span class='cui-location-name'><\/span><span class='cui-location-separator'>\u2022<\/span><span class='cui-location-distance'><\/span><\/div><\/div><div class='cui-single-section'><div class='cui-review-rating' style='display: none;'><div aria-hidden='true' class='numeric-count'><\/div><ul class='rating rating-numeric'><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><\/ul><div class='rating-count'><\/div><\/div><\/div><div class='cui-bottom-body'><div class='cui-combined-section'><div class='cui-price' data-pingdom-id='deal-price'><div aria-hidden='true' class='cui-price-original c-txt-gray-dk' style='display: none;'><\/div><div aria-hidden='true' class='cui-price-discount c-txt-price'><div class='cui-price-descriptor' style='display: none;'><\/div><span><\/span><div class='cui-price-descriptor' style='display: none;'><\/div><\/div><\/div><div class='cui-promotions'><div class='cui-detail-badge cui-discount-badge' style='display: none;'><\/div><div class='cui-urgent cui-offer' style='display: none;'><div><\/div><div class='cui-verbose-urgency-price' aria-hidden='true'><\/div><div class='cui-verbose-urgency-text'><\/div><\/div><\/div><\/div><div class='cui-single-section'><div class='cui-udc-subtitle one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-urgency-message'><\/div><\/div><\/div><\/div><\/a><div class='cui-book-online-cta__container' style='display: none;'><a class='cui-book-online-cta' href=''>\" + runIndividualizer.translations.bookOnline + \"<\/a> <\/div><\/div><\/figure>\";var rootEl = document.querySelector(\"[data-bhc='compound:homepage_touch_richrelevance_placement2'] .carousel-content\");rootEl.innerHTML = itemEl;","output_handler":"var interval = setInterval(function() {var messages = document.querySelectorAll(\"[data-bhc='compound:homepage_touch_richrelevance_placement2'] .carousel-content .cui-urgency-message\");if (messages[0].innerHTML === '') {clearInterval(interval);messages.forEach(function(el) {el.innerHTML = el.getAttribute('data-message');});}}, 100);setTimeout(function() {clearInterval(interval);}, 3000);var el = document.querySelector('#db_homepage_mobile_inspired_by_history_css');if (el) {el.remove();}runIndividualizer.recommendations[runIndividualizer.idRequest].forEach(function(item) {runIndividualizer.homepageMobileItems.push({\"itemId\": item.itemId});});var rootEl = document.querySelector(\"[data-bhc='compound:homepage_touch_richrelevance_placement2'] .carousel-content\");runIndividualizer.renderPurplePrices(runIndividualizer.idRequest, rootEl);","empty_response_handler":"var el = document.querySelector('#db_homepage_mobile_inspired_by_history_css');if (el) {el.remove();}","events":[{"type":["DOMContentLoaded"],"selector":{"mode":"css","selection":""},"input_handler":"","timeout_handler":"var el = document.querySelector('#db_homepage_mobile_inspired_by_history_css');if (el) {el.remove();}","observer":{"parent_selector":{"mode":"css","selection":"body"},"mutation_selector":{"mode":"css","selection":"[data-bhc='compound:homepage_touch_richrelevance_placement2']"}},"timeout":7000}],"item_attributes":{"_customer_item_id":{"property":"data-bhc","output_handler":"runIndividualizer.element.setAttribute('data-bhc', 'deal:' + runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":""},"required":!0},"channel":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseData === 'marketrate-hotel' || runIndividualizer.responseItem['is_travel_bookable_deal']) {runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"discount_percent_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = JSON.parse(runIndividualizer.responseItem['value_array'])[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && data[index] > 0 && !isSalePriceInEffect && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = data[index] + '% ' + runIndividualizer.translations.discountBadgeText;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-discount-badge"},"required":!0},"is_bookable":{"property":"data-style","output_handler":"if (runIndividualizer.responseData) {runIndividualizer.element.style.display = 'flex';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-book-online-cta__container"},"required":!0},"is_travel_bookable_deal":{"property":"data-is-travel-bookable-deal","output_handler":"runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"med_image":{"property":"src","output_handler":"runIndividualizer.responseData = runIndividualizer.responseData.replace('t300x182.jpg', 'c349x211.webp');","run_condition":"","internal_selector":{"mode":"css","selection":".cui-image"},"required":!0},"merchant_name":{"property":"innerHTML","output_handler":"var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') < 0 && !isCashBackDeal && !isGetawaysDeal) {var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {runIndividualizer.element.classList.remove('one-line-truncate');var title = runIndividualizer.getTitle(runIndividualizer.responseItem);if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}runIndividualizer.responseData = title;}}var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.translations.memberPricing + ' ' + runIndividualizer.responseData;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-title"},"required":!0},"price_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);runIndividualizer.responseData = runIndividualizer.getFormattedPrice(data[index], runIndividualizer.responseItem['currency']);var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {var el = runIndividualizer.element.parentElement;el.classList.remove('c-txt-price');el.classList.add('cui-price-message', 'cui-price-hidden');el.innerHTML = runIndividualizer.translations.priceHidden;} else {if (isCashBackDeal) {runIndividualizer.responseData = runIndividualizer.getCashBack(runIndividualizer.responseItem);} else {if (data.length > 1) {var wrapEl = runIndividualizer.element.parentElement;var el = wrapEl.querySelector('.cui-price-discount .cui-price-descriptor:first-child');if (isSalePriceInEffect) {wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');wrapEl.closest('figure').querySelector('.cui-promotions .cui-offer div:first-child').innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';} else {el.innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';}el.style.display = 'block';}if (data.length === 1 && isSalePriceInEffect) {var wrapEl = runIndividualizer.element.parentElement;wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');}}var isCouponDeal = runIndividualizer.isCouponDeal(runIndividualizer.responseItem);if (isCouponDeal) {runIndividualizer.element.parentElement.parentElement.style.display = 'none';}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount span"},"required":!0},"purchases_total_displayed":{"property":"innerHTML","output_handler":"var num = runIndividualizer.responseData;var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (num > 10 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(num \/ 10) * 10) + '+ ' + runIndividualizer.translations.bought;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1},"rating_count":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_value']) {runIndividualizer.responseData = runIndividualizer.responseData + ' ' + runIndividualizer.translations.ratings;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .rating-count"},"required":!1},"rating_value":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_count']) {var value = runIndividualizer.responseData;var wrapEl = runIndividualizer.element.closest('.cui-review-rating');wrapEl.style.display = 'flex';var stars = wrapEl.querySelectorAll('ul li span');stars.forEach(function(el, num) {if (num + 0.8 <= value) {el.classList.value = 'full-star';} else if (num + 0.3 <= value) {el.classList.value = 'half-star';} else {el.classList.value = 'empty-star';}});} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .numeric-count"},"required":!1},"redemption_locations_short":{"property":"data-location","output_handler":"var locations = JSON.parse(runIndividualizer.responseData);var filteredLocations = [];locations.forEach(function(location) {if (location.hasOwnProperty('lat') && location.hasOwnProperty('lng')) {filteredLocations.push(location);}});locations = filteredLocations;if (locations.length > 0) {var location = runIndividualizer.getNearestLocation(locations);var address = [];if (location['streetAddress1']) {address.push(location['streetAddress1']);}if (location['city']) {address.push(location['city']);}var el = runIndividualizer.element.querySelector('.cui-location-name');if (el) {el.innerHTML = address.join(', ');}var distance = location['distanceInKm'];var unit = runIndividualizer.translations.distanceUnit;if (unit === 'mi') {distance = distance \/ 1.609;}distance = Math.round(distance * 10) \/ 10;var el = runIndividualizer.element.querySelector('.cui-location-distance');if (el) {el.innerHTML = distance + ' ' + unit;}runIndividualizer.element.style.display = 'block';} else {runIndividualizer.element.style.display = 'none';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-location"},"required":!1},"sale_price":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isSalePriceInEffect && !isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(runIndividualizer.responseData, runIndividualizer.responseItem['currency']);var wrapEl = runIndividualizer.element.parentElement;wrapEl.querySelector('.cui-verbose-urgency-text').innerHTML = runIndividualizer.translations.limitedTime;wrapEl.style.display = 'flex';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-offer .cui-verbose-urgency-price"},"required":!1},"title_general":{"property":"innerHTML","output_handler":"var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') >= 0) {var title = runIndividualizer.responseData.trim();if (title === '') {var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseItem['title_array']);var title = data[index];}if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}var el = runIndividualizer.element.closest('figure').querySelector('.cui-udc-title');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {el.classList.remove('one-line-truncate');if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}}el.innerHTML = title;runIndividualizer.responseData = '';} else {var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (isCashBackDeal) {runIndividualizer.element.classList.add('c-txt-gray-dk');runIndividualizer.responseData = runIndividualizer.translations.freeToClaim;} else {var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (['product_card_merchant_name_up'].indexOf(abTestGroup) >= 0 || isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.getTitle(runIndividualizer.responseItem);}if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0 && !isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.responseItem['merchant_name'];}}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-subtitle"},"required":!0},"url":{"property":"href","output_handler":"","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"value_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = data[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(originalPrice, runIndividualizer.responseItem['currency']);runIndividualizer.element.style.display = 'block';var refEl = runIndividualizer.element.nextElementSibling;refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML('<span>&nbsp;<\/span>'), refEl)} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-original"},"required":!0},"views_24h":{"property":"innerHTML","output_handler":"var numViews = runIndividualizer.responseData;var numPurchases = runIndividualizer.responseItem['purchases_total_displayed'];var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if ((!numPurchases || numPurchases <= 10) && numViews >= 150 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(numViews \/ 10) * 10) + '+ ' + runIndividualizer.translations.viewedToday;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1}}},"homepage_mobile_news":{"type":"recommendation","running":!0,"run_condition":"location.pathname === '\/' && LS_Mustache_Params && LS_Mustache_Params.mobileConfig && location.host.slice(-4) !== '.com'","multiple":!0,"apply_only_last_request":!0,"root_selector":{"mode":"css","selection":"[data-bhc='compound:homepage_flexible_touch_new_deals_widget'] .carousel-content"},"run_handler":"var css = runIndividualizer.createElementFromHTML(\"<style id='db_homepage_mobile_news_css'>[data-bhc='compound:homepage_flexible_touch_new_deals_widget'] {visibility: hidden;}<\/style>\");document.querySelector('head').append(css);","input_handler":"runIndividualizer.requestData.returnedAttributes = ['title_array', 'sale_price_start_at', 'sale_price_end_at', 'gallery_title', 'currency', 'category', 'inventory_service_id', 'restricted_reason', 'restricted', 'show_discount', 'deal_option_id_array', 'category_guids_object', 'category_guids', 'eligible_for_groupon_incentives', 'pds_id', 'channel_id', 'inventory_product_id'];runIndividualizer.requestData.output = ['scriptAbTest', 'mainAbTest'];runIndividualizer.requestData.contextVariables = runIndividualizer.getContextVariables();runIndividualizer.requestData.items = runIndividualizer.homepageMobileItems;var abTestGroup = runIndividualizer.getAbTestGroupFromTheirAbTester();if (abTestGroup) {runIndividualizer.requestData.abTests = abTestGroup;}","received_response_handler":"sessionStorage.setItem('db_abtests', JSON.stringify(runIndividualizer.abTests));runIndividualizer.getAndSavePurplePrices(runIndividualizer.idRequest);","before_render_handler":"var itemEl = \"<figure class='card-ui cui-c-udc price-badge-filled-background left-aligned-card is-getaways-booking has-additional-discount-percent' data-bhc=''><div class='cui-content'><a href=''><div class='cui-udc-image-container rounded-corners'><div class='cui-udc-image-overlay'><\/div><div class='cui-image-lazy-container cui-image-hover-zoom'><img class='cui-svg-placeholder' height='211' width='349'><img class='cui-image lazy-load lazy-loaded' data-ll-status='loaded' src='' style='position: absolute; top: 0;'><\/div><\/div><div class='cui-udc-details cui-udc-left-aligned-details'><div class='cui-single-section'><div class='cui-udc-title one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-location cui-truncate cui-has-distance' style='display: none;'><span class='cui-location-name'><\/span><span class='cui-location-separator'>\u2022<\/span><span class='cui-location-distance'><\/span><\/div><\/div><div class='cui-single-section'><div class='cui-review-rating' style='display: none;'><div aria-hidden='true' class='numeric-count'><\/div><ul class='rating rating-numeric'><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><\/ul><div class='rating-count'><\/div><\/div><\/div><div class='cui-bottom-body'><div class='cui-combined-section'><div class='cui-price' data-pingdom-id='deal-price'><div aria-hidden='true' class='cui-price-original c-txt-gray-dk' style='display: none;'><\/div><div aria-hidden='true' class='cui-price-discount c-txt-price'><div class='cui-price-descriptor' style='display: none;'><\/div><span><\/span><div class='cui-price-descriptor' style='display: none;'><\/div><\/div><\/div><div class='cui-promotions'><div class='cui-detail-badge cui-discount-badge' style='display: none;'><\/div><div class='cui-urgent cui-offer' style='display: none;'><div><\/div><div class='cui-verbose-urgency-price' aria-hidden='true'><\/div><div class='cui-verbose-urgency-text'><\/div><\/div><\/div><\/div><div class='cui-single-section'><div class='cui-udc-subtitle one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-urgency-message'><\/div><\/div><\/div><\/div><\/a><div class='cui-book-online-cta__container' style='display: none;'><a class='cui-book-online-cta' href=''>\" + runIndividualizer.translations.bookOnline + \"<\/a> <\/div><\/div><\/figure>\";var rootEl = document.querySelector(\"[data-bhc='compound:homepage_flexible_touch_new_deals_widget'] .carousel-content\");rootEl.innerHTML = itemEl;","output_handler":"var interval = setInterval(function() {var messages = document.querySelectorAll(\"[data-bhc='compound:homepage_flexible_touch_new_deals_widget'] .carousel-content .cui-urgency-message\");if (messages[0].innerHTML === '') {clearInterval(interval);messages.forEach(function(el) {el.innerHTML = el.getAttribute('data-message');});}}, 100);setTimeout(function() {clearInterval(interval);}, 3000);var el = document.querySelector('#db_homepage_mobile_news_css');if (el) {el.remove();}runIndividualizer.recommendations[runIndividualizer.idRequest].forEach(function(item) {runIndividualizer.homepageMobileItems.push({\"itemId\": item.itemId});});var rootEl = document.querySelector(\"[data-bhc='compound:homepage_flexible_touch_new_deals_widget'] .carousel-content\");runIndividualizer.renderPurplePrices(runIndividualizer.idRequest, rootEl);","empty_response_handler":"var el = document.querySelector('#db_homepage_mobile_news_css');if (el) {el.remove();}","events":[{"type":["fetch"],"selector":{"mode":"css","selection":""},"input_handler":"var url = runIndividualizer.nativeEvent[0];if (url.indexOf('\/homepage\/get-paginated-cards') < 0 || url.indexOf('&index=2') < 0) {runIndividualizer.lock = true;}","timeout_handler":"var el = document.querySelector('#db_homepage_mobile_news_css');if (el) {el.remove();}","observer":{"parent_selector":{"mode":"css","selection":"body"},"mutation_selector":{"mode":"css","selection":"[data-bhc='compound:homepage_flexible_touch_new_deals_widget']"}},"timeout":5000}],"item_attributes":{"_customer_item_id":{"property":"data-bhc","output_handler":"runIndividualizer.element.setAttribute('data-bhc', 'deal:' + runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":""},"required":!0},"channel":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseData === 'marketrate-hotel' || runIndividualizer.responseItem['is_travel_bookable_deal']) {runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"discount_percent_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = JSON.parse(runIndividualizer.responseItem['value_array'])[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && data[index] > 0 && !isSalePriceInEffect && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = data[index] + '% ' + runIndividualizer.translations.discountBadgeText;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-discount-badge"},"required":!0},"is_bookable":{"property":"data-style","output_handler":"if (runIndividualizer.responseData) {runIndividualizer.element.style.display = 'flex';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-book-online-cta__container"},"required":!0},"is_travel_bookable_deal":{"property":"data-is-travel-bookable-deal","output_handler":"runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"med_image":{"property":"src","output_handler":"runIndividualizer.responseData = runIndividualizer.responseData.replace('t300x182.jpg', 'c349x211.webp');","run_condition":"","internal_selector":{"mode":"css","selection":".cui-image"},"required":!0},"merchant_name":{"property":"innerHTML","output_handler":"var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') < 0 && !isCashBackDeal && !isGetawaysDeal) {var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {runIndividualizer.element.classList.remove('one-line-truncate');var title = runIndividualizer.getTitle(runIndividualizer.responseItem);if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}runIndividualizer.responseData = title;}}var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.translations.memberPricing + ' ' + runIndividualizer.responseData;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-title"},"required":!0},"price_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);runIndividualizer.responseData = runIndividualizer.getFormattedPrice(data[index], runIndividualizer.responseItem['currency']);var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {var el = runIndividualizer.element.parentElement;el.classList.remove('c-txt-price');el.classList.add('cui-price-message', 'cui-price-hidden');el.innerHTML = runIndividualizer.translations.priceHidden;} else {if (isCashBackDeal) {runIndividualizer.responseData = runIndividualizer.getCashBack(runIndividualizer.responseItem);} else {if (data.length > 1) {var wrapEl = runIndividualizer.element.parentElement;var el = wrapEl.querySelector('.cui-price-discount .cui-price-descriptor:first-child');if (isSalePriceInEffect) {wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');wrapEl.closest('figure').querySelector('.cui-promotions .cui-offer div:first-child').innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';} else {el.innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';}el.style.display = 'block';}if (data.length === 1 && isSalePriceInEffect) {var wrapEl = runIndividualizer.element.parentElement;wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');}}var isCouponDeal = runIndividualizer.isCouponDeal(runIndividualizer.responseItem);if (isCouponDeal) {runIndividualizer.element.parentElement.parentElement.style.display = 'none';}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount span"},"required":!0},"purchases_total_displayed":{"property":"innerHTML","output_handler":"var num = runIndividualizer.responseData;var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (num > 10 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(num \/ 10) * 10) + '+ ' + runIndividualizer.translations.bought;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1},"rating_count":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_value']) {runIndividualizer.responseData = runIndividualizer.responseData + ' ' + runIndividualizer.translations.ratings;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .rating-count"},"required":!1},"rating_value":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_count']) {var value = runIndividualizer.responseData;var wrapEl = runIndividualizer.element.closest('.cui-review-rating');wrapEl.style.display = 'flex';var stars = wrapEl.querySelectorAll('ul li span');stars.forEach(function(el, num) {if (num + 0.8 <= value) {el.classList.value = 'full-star';} else if (num + 0.3 <= value) {el.classList.value = 'half-star';} else {el.classList.value = 'empty-star';}});} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .numeric-count"},"required":!1},"redemption_locations_short":{"property":"data-location","output_handler":"var locations = JSON.parse(runIndividualizer.responseData);var filteredLocations = [];locations.forEach(function(location) {if (location.hasOwnProperty('lat') && location.hasOwnProperty('lng')) {filteredLocations.push(location);}});locations = filteredLocations;if (locations.length > 0) {var location = runIndividualizer.getNearestLocation(locations);var address = [];if (location['streetAddress1']) {address.push(location['streetAddress1']);}if (location['city']) {address.push(location['city']);}var el = runIndividualizer.element.querySelector('.cui-location-name');if (el) {el.innerHTML = address.join(', ');}var distance = location['distanceInKm'];var unit = runIndividualizer.translations.distanceUnit;if (unit === 'mi') {distance = distance \/ 1.609;}distance = Math.round(distance * 10) \/ 10;var el = runIndividualizer.element.querySelector('.cui-location-distance');if (el) {el.innerHTML = distance + ' ' + unit;}runIndividualizer.element.style.display = 'block';} else {runIndividualizer.element.style.display = 'none';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-location"},"required":!1},"sale_price":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isSalePriceInEffect && !isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(runIndividualizer.responseData, runIndividualizer.responseItem['currency']);var wrapEl = runIndividualizer.element.parentElement;wrapEl.querySelector('.cui-verbose-urgency-text').innerHTML = runIndividualizer.translations.limitedTime;wrapEl.style.display = 'flex';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-offer .cui-verbose-urgency-price"},"required":!1},"title_general":{"property":"innerHTML","output_handler":"var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') >= 0) {var title = runIndividualizer.responseData.trim();if (title === '') {var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseItem['title_array']);var title = data[index];}if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}var el = runIndividualizer.element.closest('figure').querySelector('.cui-udc-title');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {el.classList.remove('one-line-truncate');if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}}el.innerHTML = title;runIndividualizer.responseData = '';} else {var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (isCashBackDeal) {runIndividualizer.element.classList.add('c-txt-gray-dk');runIndividualizer.responseData = runIndividualizer.translations.freeToClaim;} else {var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (['product_card_merchant_name_up'].indexOf(abTestGroup) >= 0 || isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.getTitle(runIndividualizer.responseItem);}if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0 && !isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.responseItem['merchant_name'];}}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-subtitle"},"required":!0},"url":{"property":"href","output_handler":"","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"value_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = data[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(originalPrice, runIndividualizer.responseItem['currency']);runIndividualizer.element.style.display = 'block';var refEl = runIndividualizer.element.nextElementSibling;refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML('<span>&nbsp;<\/span>'), refEl)} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-original"},"required":!0},"views_24h":{"property":"innerHTML","output_handler":"var numViews = runIndividualizer.responseData;var numPurchases = runIndividualizer.responseItem['purchases_total_displayed'];var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if ((!numPurchases || numPurchases <= 10) && numViews >= 150 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(numViews \/ 10) * 10) + '+ ' + runIndividualizer.translations.viewedToday;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1}}},"homepage_popular":{"type":"recommendation","running":!0,"run_condition":"(location.pathname === '\/' || location.pathname.indexOf('home-like') >= 0) && LS_Mustache_Params && LS_Mustache_Params.gigConfig","multiple":!0,"apply_only_last_request":!0,"root_selector":{"mode":"css","selection":"#popular-on-groupon"},"run_handler":"var css = runIndividualizer.createElementFromHTML(\"<style id='db_homepage_popular_css'>#popular-on-groupon {visibility: hidden;}<\/style>\");document.querySelector('head').append(css);","input_handler":"runIndividualizer.requestData.returnedAttributes = ['title_array', 'sale_price_start_at', 'sale_price_end_at', 'gallery_title', 'currency', 'category', 'inventory_service_id', 'restricted_reason', 'restricted', 'show_discount', 'deal_option_id_array', 'category_guids_object', 'category_guids', 'eligible_for_groupon_incentives', 'pds_id', 'channel_id', 'inventory_product_id'];runIndividualizer.requestData.output = ['scriptAbTest', 'mainAbTest'];runIndividualizer.requestData.contextVariables = runIndividualizer.getContextVariables();var abTestGroup = runIndividualizer.getAbTestGroupFromTheirAbTester();if (abTestGroup) {runIndividualizer.requestData.abTests = abTestGroup;}","received_response_handler":"sessionStorage.setItem('db_abtests', JSON.stringify(runIndividualizer.abTests));runIndividualizer.getAndSavePurplePrices(runIndividualizer.idRequest);","before_render_handler":"runIndividualizer.cloneSponsoredDeals('homepage_popular');var itemEl = \"<figure class='card-ui cui-c-udc price-badge-filled-background left-aligned-card is-getaways-booking has-additional-discount-percent' data-bhc=''><div class='cui-content'><a href=''><div class='cui-udc-image-container rounded-corners'><div class='cui-udc-image-overlay'><\/div><div class='cui-image-lazy-container cui-image-hover-zoom'><img class='cui-svg-placeholder' height='211' width='349'><img class='cui-image lazy-load lazy-loaded' data-ll-status='loaded' src='' style='position: absolute; top: 0;'><\/div><\/div><div class='cui-udc-details cui-udc-left-aligned-details'><div class='cui-single-section'><div class='cui-udc-title one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-location cui-truncate cui-has-distance' style='display: none;'><span class='cui-location-name'><\/span><span class='cui-location-separator'>\u2022<\/span><span class='cui-location-distance'><\/span><\/div><\/div><div class='cui-single-section'><div class='cui-review-rating' style='display: none;'><div aria-hidden='true' class='numeric-count'><\/div><ul class='rating rating-numeric'><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><\/ul><div class='rating-count'><\/div><\/div><\/div><div class='cui-bottom-body'><div class='cui-combined-section'><div class='cui-price' data-pingdom-id='deal-price'><div aria-hidden='true' class='cui-price-original c-txt-gray-dk' style='display: none;'><\/div><div aria-hidden='true' class='cui-price-discount c-txt-price'><div class='cui-price-descriptor' style='display: none;'><\/div><span><\/span><div class='cui-price-descriptor' style='display: none;'><\/div><\/div><\/div><div class='cui-promotions'><div class='cui-detail-badge cui-discount-badge' style='display: none;'><\/div><div class='cui-urgent cui-offer' style='display: none;'><div><\/div><div class='cui-verbose-urgency-price' aria-hidden='true'><\/div><div class='cui-verbose-urgency-text'><\/div><\/div><\/div><\/div><div class='cui-single-section'><div class='cui-udc-subtitle one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-urgency-message'><\/div><\/div><\/div><\/div><\/a><div class='cui-book-online-cta__container' style='display: none;'><a class='cui-book-online-cta' href=''>\" + runIndividualizer.translations.bookOnline + \"<\/a> <\/div><\/div><\/figure>\";var rootEl = document.querySelector('#popular-on-groupon');runIndividualizer.homepagePopularHeadingEl = rootEl.querySelector('.cui-c-brand-prop').cloneNode(true);rootEl.innerHTML = itemEl;","output_handler":"runIndividualizer.applySponsoredDeals('homepage_popular');var rootEl = document.querySelector('#popular-on-groupon');rootEl.prepend(runIndividualizer.homepagePopularHeadingEl);var interval = setInterval(function() {var messages = document.querySelectorAll(\"#popular-on-groupon .cui-urgency-message\");if (messages[0].innerHTML === '') {clearInterval(interval);messages.forEach(function(el) {el.innerHTML = el.getAttribute('data-message');});}}, 100);setTimeout(function() {clearInterval(interval);}, 3000);var el = document.querySelector('#db_homepage_popular_css');if (el) {el.remove();}runIndividualizer.recommendations[runIndividualizer.idRequest].forEach(function(item) {runIndividualizer.homepageMobileItems.push({\"itemId\": item.itemId});});runIndividualizer.renderPurplePrices(runIndividualizer.idRequest, rootEl);","empty_response_handler":"var el = document.querySelector('#db_homepage_popular_css');if (el) {el.remove();}","events":[{"type":["DOMContentLoaded"],"selector":{"mode":"css","selection":"#popular-on-groupon"},"input_handler":"","timeout_handler":"var el = document.querySelector('#db_homepage_popular_css');if (el) {el.remove();}","timeout":7000}],"item_attributes":{"_customer_item_id":{"property":"data-bhc","output_handler":"runIndividualizer.element.setAttribute('data-bhc', 'deal:' + runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":""},"required":!0},"channel":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseData === 'marketrate-hotel' || runIndividualizer.responseItem['is_travel_bookable_deal']) {runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"discount_percent_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = JSON.parse(runIndividualizer.responseItem['value_array'])[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && data[index] > 0 && !isSalePriceInEffect && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = data[index] + '% ' + runIndividualizer.translations.discountBadgeText;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-discount-badge"},"required":!0},"is_bookable":{"property":"data-style","output_handler":"if (runIndividualizer.responseData) {runIndividualizer.element.style.display = 'flex';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-book-online-cta__container"},"required":!0},"is_travel_bookable_deal":{"property":"data-is-travel-bookable-deal","output_handler":"runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"med_image":{"property":"src","output_handler":"runIndividualizer.responseData = runIndividualizer.responseData.replace('t300x182.jpg', 'c349x211.webp');","run_condition":"","internal_selector":{"mode":"css","selection":".cui-image"},"required":!0},"merchant_name":{"property":"innerHTML","output_handler":"var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') < 0 && !isCashBackDeal && !isGetawaysDeal) {var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {runIndividualizer.element.classList.remove('one-line-truncate');var title = runIndividualizer.getTitle(runIndividualizer.responseItem);if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}runIndividualizer.responseData = title;}}var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.translations.memberPricing + ' ' + runIndividualizer.responseData;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-title"},"required":!0},"price_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);runIndividualizer.responseData = runIndividualizer.getFormattedPrice(data[index], runIndividualizer.responseItem['currency']);var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {var el = runIndividualizer.element.parentElement;el.classList.remove('c-txt-price');el.classList.add('cui-price-message', 'cui-price-hidden');el.innerHTML = runIndividualizer.translations.priceHidden;} else {if (isCashBackDeal) {runIndividualizer.responseData = runIndividualizer.getCashBack(runIndividualizer.responseItem);} else {if (data.length > 1) {var wrapEl = runIndividualizer.element.parentElement;var el = wrapEl.querySelector('.cui-price-discount .cui-price-descriptor:first-child');if (isSalePriceInEffect) {wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');wrapEl.closest('figure').querySelector('.cui-promotions .cui-offer div:first-child').innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';} else {el.innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';}el.style.display = 'block';}if (data.length === 1 && isSalePriceInEffect) {var wrapEl = runIndividualizer.element.parentElement;wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');}}var isCouponDeal = runIndividualizer.isCouponDeal(runIndividualizer.responseItem);if (isCouponDeal) {runIndividualizer.element.parentElement.parentElement.style.display = 'none';}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount span"},"required":!0},"purchases_total_displayed":{"property":"innerHTML","output_handler":"var num = runIndividualizer.responseData;var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (num > 10 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(num \/ 10) * 10) + '+ ' + runIndividualizer.translations.bought;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1},"rating_count":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_value']) {runIndividualizer.responseData = runIndividualizer.responseData + ' ' + runIndividualizer.translations.ratings;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .rating-count"},"required":!1},"rating_value":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_count']) {var value = runIndividualizer.responseData;var wrapEl = runIndividualizer.element.closest('.cui-review-rating');wrapEl.style.display = 'flex';var stars = wrapEl.querySelectorAll('ul li span');stars.forEach(function(el, num) {if (num + 0.8 <= value) {el.classList.value = 'full-star';} else if (num + 0.3 <= value) {el.classList.value = 'half-star';} else {el.classList.value = 'empty-star';}});} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .numeric-count"},"required":!1},"redemption_locations_short":{"property":"data-location","output_handler":"var locations = JSON.parse(runIndividualizer.responseData);var filteredLocations = [];locations.forEach(function(location) {if (location.hasOwnProperty('lat') && location.hasOwnProperty('lng')) {filteredLocations.push(location);}});locations = filteredLocations;if (locations.length > 0) {var location = runIndividualizer.getNearestLocation(locations);var address = [];if (location['streetAddress1']) {address.push(location['streetAddress1']);}if (location['city']) {address.push(location['city']);}var el = runIndividualizer.element.querySelector('.cui-location-name');if (el) {el.innerHTML = address.join(', ');}var distance = location['distanceInKm'];var unit = runIndividualizer.translations.distanceUnit;if (unit === 'mi') {distance = distance \/ 1.609;}distance = Math.round(distance * 10) \/ 10;var el = runIndividualizer.element.querySelector('.cui-location-distance');if (el) {el.innerHTML = distance + ' ' + unit;}runIndividualizer.element.style.display = 'block';} else {runIndividualizer.element.style.display = 'none';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-location"},"required":!1},"sale_price":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isSalePriceInEffect && !isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(runIndividualizer.responseData, runIndividualizer.responseItem['currency']);var wrapEl = runIndividualizer.element.parentElement;wrapEl.querySelector('.cui-verbose-urgency-text').innerHTML = runIndividualizer.translations.limitedTime;wrapEl.style.display = 'flex';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-offer .cui-verbose-urgency-price"},"required":!1},"title_general":{"property":"innerHTML","output_handler":"var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') >= 0) {var title = runIndividualizer.responseData.trim();if (title === '') {var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseItem['title_array']);var title = data[index];}if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}var el = runIndividualizer.element.closest('figure').querySelector('.cui-udc-title');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {el.classList.remove('one-line-truncate');if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}}el.innerHTML = title;runIndividualizer.responseData = '';} else {var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (isCashBackDeal) {runIndividualizer.element.classList.add('c-txt-gray-dk');runIndividualizer.responseData = runIndividualizer.translations.freeToClaim;} else {var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (['product_card_merchant_name_up'].indexOf(abTestGroup) >= 0 || isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.getTitle(runIndividualizer.responseItem);}if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0 && !isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.responseItem['merchant_name'];}}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-subtitle"},"required":!0},"url":{"property":"href","output_handler":"","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"value_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = data[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(originalPrice, runIndividualizer.responseItem['currency']);runIndividualizer.element.style.display = 'block';var refEl = runIndividualizer.element.nextElementSibling;refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML('<span>&nbsp;<\/span>'), refEl)} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-original"},"required":!0},"views_24h":{"property":"innerHTML","output_handler":"var numViews = runIndividualizer.responseData;var numPurchases = runIndividualizer.responseItem['purchases_total_displayed'];var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if ((!numPurchases || numPurchases <= 10) && numViews >= 150 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(numViews \/ 10) * 10) + '+ ' + runIndividualizer.translations.viewedToday;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1}}},"product_detail_1":{"type":"recommendation","running":!0,"run_condition":"location.pathname.indexOf('\/deals\/') === 0 && location.pathname.split('\/').length === 3 && LS_Mustache_Params && LS_Mustache_Params.gigConfig && payload","multiple":!0,"apply_only_last_request":!0,"root_selector":{"mode":"css","selection":"#db_product_detail_1"},"run_handler":"var css = runIndividualizer.createElementFromHTML(\"<style id='db_product_detail_1_css'>.cui-arrow-next, .cui-arrow-previous { background: white; }<\/style>\");document.querySelector('head').append(css);css = runIndividualizer.createElementFromHTML(\"<style id='db_product_detail_1_css_2'>[data-bhc='compound:crossChannel_dealpage_richrelevance_rr_recs1'] { display: none; }<\/style>\");document.querySelector('head').append(css);runIndividualizer.hideReviews();runIndividualizer.hideDealTitleAndMerchantTitle();","input_handler":"runIndividualizer.requestData.returnedAttributes = ['title_array', 'sale_price_start_at', 'sale_price_end_at', 'gallery_title', 'currency', 'category', 'inventory_service_id', 'restricted_reason', 'restricted', 'show_discount', 'deal_option_id_array', 'category_guids_object', 'category_guids', 'eligible_for_groupon_incentives', 'pds_id', 'channel_id', 'inventory_product_id'];runIndividualizer.requestData.output = ['scriptAbTest', 'mainAbTest'];runIndividualizer.requestData.contextVariables = runIndividualizer.getContextVariables();runIndividualizer.requestData.itemId = payload.dealUuid;var abTestGroup = runIndividualizer.getAbTestGroupFromTheirAbTester();if (abTestGroup) {runIndividualizer.requestData.abTests = abTestGroup;}","received_response_handler":"sessionStorage.setItem('db_abtests', JSON.stringify(runIndividualizer.abTests));runIndividualizer.getAndSavePurplePrices(runIndividualizer.idRequest);","before_render_handler":"var positionEl = \"<figure class='card-ui cui-c-compound cui-four-up cui-c-desktop-carousel' data-bhc='compound:crossChannel_dealpage_similar_deals' data-bh-viewport='respect'><figcaption class='cui-compound-header'><div class='compound-header-left-container'><h2 class='compound-title' style='font-weight:800;'>\" + runIndividualizer.translations['productDetailHeadline1'] + \"<\/h2><\/div><div class='cui-carousel-pagination'><span class='cui-pagination-numbers'><span class='current-page'><\/span>&nbsp;<span>\" + runIndividualizer.translations['of'] + \"<\/span>&nbsp;<span class='total-pages'><\/span><\/span> <button aria-label='Previous' class='cui-arrow-previous disabled' data-bhc='carousel:previous'><svg height='24px' viewbox='0 0 32 32' width='24px' xmlns='http:\/\/www.w3.org\/2000\/svg'><path d='M20.71 25.29a1 1 0 1 1-1.41 1.41l-10-10a1 1 0 0 1 0-1.41l10-10a1 1 0 1 1 1.41 1.41l-9.3 9.3 9.3 9.29z'><\/path><\/svg><\/button> <button aria-label='Next' class='cui-arrow-next' data-bhc='carousel:next'><svg height='24px' viewbox='0 0 32 32' width='24px' xmlns='http:\/\/www.w3.org\/2000\/svg'><path d='M11.29 25.29a1 1 0 1 0 1.41 1.41l10-10a1 1 0 0 0 0-1.41l-10-10a1 1 0 1 0-1.41 1.41l9.3 9.3-9.3 9.29z'><\/path><\/svg><\/button><\/div><\/figcaption><div class='cui-content-holder'><div class='cui-cards-wrapper carousel'><div id='db_product_detail_1' class='cui-content carousel-content has-scroll-listener'><\/div><\/div><\/div><\/figure>\";var itemEl = \"<figure class='card-ui cui-c-udc price-badge-filled-background left-aligned-card is-getaways-booking has-additional-discount-percent' data-bhc='' data-clickurl='' data-bh-viewport='respect' data-index=''><div class='cui-content'><a href=''><div class='cui-udc-image-container rounded-corners'><div class='cui-udc-image-overlay'><\/div><div class='cui-image-lazy-container cui-image-hover-zoom'><img class='cui-svg-placeholder' height='211' width='349'><img class='cui-image lazy-load lazy-loaded' data-ll-status='loaded' src=''><\/div><\/div><div class='cui-udc-details cui-udc-left-aligned-details'><div class='cui-single-section'><div class='cui-udc-title one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-location cui-truncate cui-has-distance' style='display: none;'><span class='cui-location-name'><\/span><span class='cui-location-separator'>\u2022<\/span><span class='cui-location-distance'><\/span><\/div><\/div><div class='cui-single-section'><div class='cui-review-rating' style='display: none;'><div aria-hidden='true' class='numeric-count'><\/div><ul class='rating rating-numeric'><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><\/ul><div class='rating-count'><\/div><\/div><\/div><div class='cui-bottom-body'><div class='cui-combined-section'><div class='cui-price' data-pingdom-id='deal-price'><div aria-hidden='true' class='cui-price-original c-txt-gray-dk' style='display: none;'><\/div><div aria-hidden='true' class='cui-price-discount c-txt-price'><div class='cui-price-descriptor' style='display: none;'><\/div><span><\/span><div class='cui-price-descriptor' style='display: none;'><\/div><\/div><\/div><div class='cui-promotions'><div class='cui-detail-badge cui-discount-badge' style='display: none;'><\/div><div class='cui-urgent cui-offer' style='display: none;'><div><\/div><div class='cui-verbose-urgency-price' aria-hidden='true'><\/div><div class='cui-verbose-urgency-text'><\/div><\/div><\/div><\/div><div class='cui-single-section'><div class='cui-udc-subtitle one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-urgency-message' data-bhc><\/div><\/div><\/div><\/div><\/a><div class='cui-book-online-cta__container' style='display: none;'><a class='cui-book-online-cta' href=''>\" + runIndividualizer.translations.bookOnline + \"<\/a> <\/div><\/div><\/figure>\";var refEl = document.querySelector('.main .crosslinks-container');if (refEl) {refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML(positionEl), refEl);} else {refEl = document.querySelector('.main .page-container');refEl.append(runIndividualizer.createElementFromHTML(positionEl));}var rootEl = document.querySelector('#db_product_detail_1');rootEl.innerHTML = itemEl;","output_handler":"var interval = setInterval(function() {var messages = document.querySelectorAll(\"#db_product_detail_1 .cui-urgency-message\");if (messages[0].innerHTML === '') {clearInterval(interval);messages.forEach(function(el) {el.innerHTML = el.getAttribute('data-message');});}}, 100);setTimeout(function() {clearInterval(interval);}, 3000);document.querySelectorAll('#db_product_detail_1 figure.card-ui').forEach(function(item, iterator) {item.setAttribute('data-index', iterator);});runIndividualizer.moveAndShowReviews();var rootEl = document.querySelector('#db_product_detail_1');runIndividualizer.initCarouselPaginatorNumbers(rootEl);runIndividualizer.moveAndShowDealTitleAndMerchantTitle();runIndividualizer.renderPurplePrices(runIndividualizer.idRequest, rootEl);","empty_response_handler":"var el = document.querySelector('#db_product_detail_1_css_2');if (el) {el.remove();}el = document.querySelector('#db_product_detail_css_reviews');if (el) {el.remove();}el = document.querySelector('#db_product_detail_css_title');if (el) {el.remove();}","events":[{"type":["DOMContentLoaded"],"selector":{"mode":"css","selection":".main .page-container"},"input_handler":"","timeout_handler":"if (!runIndividualizer.recommendations.hasOwnProperty(runIndividualizer.idRequest)) {var el = document.querySelector('#db_product_detail_1_css_2');if (el) {el.remove();}el = document.querySelector('#db_product_detail_css_reviews');if (el) {el.remove();}el = document.querySelector('#db_product_detail_css_title');if (el) {el.remove();}}","timeout":10000}],"item_attributes":{"_customer_item_id":{"property":"data-bhc","output_handler":"runIndividualizer.element.setAttribute('data-bhc', 'deal:' + runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":""},"required":!0},"channel":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseData === 'marketrate-hotel' || runIndividualizer.responseItem['is_travel_bookable_deal']) {runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"discount_percent_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = JSON.parse(runIndividualizer.responseItem['value_array'])[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && data[index] > 0 && !isSalePriceInEffect && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = data[index] + '% ' + runIndividualizer.translations.discountBadgeText;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-discount-badge"},"required":!0},"is_bookable":{"property":"data-style","output_handler":"if (runIndividualizer.responseData) {runIndividualizer.element.style.display = 'flex';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-book-online-cta__container"},"required":!0},"is_travel_bookable_deal":{"property":"data-is-travel-bookable-deal","output_handler":"runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"med_image":{"property":"src","output_handler":"runIndividualizer.responseData = runIndividualizer.responseData.replace('t300x182.jpg', 'c349x211.webp');","run_condition":"","internal_selector":{"mode":"css","selection":".cui-image"},"required":!0},"merchant_name":{"property":"innerHTML","output_handler":"var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') < 0 && !isCashBackDeal && !isGetawaysDeal) {var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {runIndividualizer.element.classList.remove('one-line-truncate');var title = runIndividualizer.getTitle(runIndividualizer.responseItem);if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}runIndividualizer.responseData = title;}}var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.translations.memberPricing + ' ' + runIndividualizer.responseData;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-title"},"required":!0},"price_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);runIndividualizer.responseData = runIndividualizer.getFormattedPrice(data[index], runIndividualizer.responseItem['currency']);var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {var el = runIndividualizer.element.parentElement;el.classList.remove('c-txt-price');el.classList.add('cui-price-message', 'cui-price-hidden');el.innerHTML = runIndividualizer.translations.priceHidden;} else {if (isCashBackDeal) {runIndividualizer.responseData = runIndividualizer.getCashBack(runIndividualizer.responseItem);} else {if (data.length > 1) {var wrapEl = runIndividualizer.element.parentElement;var el = wrapEl.querySelector('.cui-price-discount .cui-price-descriptor:first-child');if (isSalePriceInEffect) {wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');wrapEl.closest('figure').querySelector('.cui-promotions .cui-offer div:first-child').innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';} else {el.innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';}el.style.display = 'block';}if (data.length === 1 && isSalePriceInEffect) {var wrapEl = runIndividualizer.element.parentElement;wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');}}var isCouponDeal = runIndividualizer.isCouponDeal(runIndividualizer.responseItem);if (isCouponDeal) {runIndividualizer.element.parentElement.parentElement.style.display = 'none';}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount span"},"required":!0},"purchases_total_displayed":{"property":"innerHTML","output_handler":"var num = runIndividualizer.responseData;var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (num > 10 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(num \/ 10) * 10) + '+ ' + runIndividualizer.translations.bought;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1},"rating_count":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_value']) {runIndividualizer.responseData = runIndividualizer.responseData + ' ' + runIndividualizer.translations.ratings;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .rating-count"},"required":!1},"rating_value":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_count']) {var value = runIndividualizer.responseData;var wrapEl = runIndividualizer.element.closest('.cui-review-rating');wrapEl.style.display = 'flex';var stars = wrapEl.querySelectorAll('ul li span');stars.forEach(function(el, num) {if (num + 0.8 <= value) {el.classList.value = 'full-star';} else if (num + 0.3 <= value) {el.classList.value = 'half-star';} else {el.classList.value = 'empty-star';}});} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .numeric-count"},"required":!1},"redemption_locations_short":{"property":"data-location","output_handler":"var locations = JSON.parse(runIndividualizer.responseData);var filteredLocations = [];locations.forEach(function(location) {if (location.hasOwnProperty('lat') && location.hasOwnProperty('lng')) {filteredLocations.push(location);}});locations = filteredLocations;if (locations.length > 0) {var location = runIndividualizer.getNearestLocation(locations);var address = [];if (location['streetAddress1']) {address.push(location['streetAddress1']);}if (location['city']) {address.push(location['city']);}var el = runIndividualizer.element.querySelector('.cui-location-name');if (el) {el.innerHTML = address.join(', ');}var distance = location['distanceInKm'];var unit = runIndividualizer.translations.distanceUnit;if (unit === 'mi') {distance = distance \/ 1.609;}distance = Math.round(distance * 10) \/ 10;var el = runIndividualizer.element.querySelector('.cui-location-distance');if (el) {el.innerHTML = distance + ' ' + unit;}runIndividualizer.element.style.display = 'block';} else {runIndividualizer.element.style.display = 'none';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-location"},"required":!1},"sale_price":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isSalePriceInEffect && !isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(runIndividualizer.responseData, runIndividualizer.responseItem['currency']);var wrapEl = runIndividualizer.element.parentElement;wrapEl.querySelector('.cui-verbose-urgency-text').innerHTML = runIndividualizer.translations.limitedTime;wrapEl.style.display = 'flex';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-offer .cui-verbose-urgency-price"},"required":!1},"title_general":{"property":"innerHTML","output_handler":"var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') >= 0) {var title = runIndividualizer.responseData.trim();if (title === '') {var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseItem['title_array']);var title = data[index];}if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}var el = runIndividualizer.element.closest('figure').querySelector('.cui-udc-title');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {el.classList.remove('one-line-truncate');if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}}el.innerHTML = title;runIndividualizer.responseData = '';} else {var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (isCashBackDeal) {runIndividualizer.element.classList.add('c-txt-gray-dk');runIndividualizer.responseData = runIndividualizer.translations.freeToClaim;} else {var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (['product_card_merchant_name_up'].indexOf(abTestGroup) >= 0 || isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.getTitle(runIndividualizer.responseItem);}if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0 && !isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.responseItem['merchant_name'];}}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-subtitle"},"required":!0},"url":{"property":"href","output_handler":"runIndividualizer.element.closest('.card-ui').setAttribute('data-clickurl', runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"value_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = data[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(originalPrice, runIndividualizer.responseItem['currency']);runIndividualizer.element.style.display = 'block';var refEl = runIndividualizer.element.nextElementSibling;refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML('<span>&nbsp;<\/span>'), refEl)} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-original"},"required":!0},"views_24h":{"property":"innerHTML","output_handler":"var numViews = runIndividualizer.responseData;var numPurchases = runIndividualizer.responseItem['purchases_total_displayed'];var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if ((!numPurchases || numPurchases <= 10) && numViews >= 150 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(numViews \/ 10) * 10) + '+ ' + runIndividualizer.translations.viewedToday;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1}}},"product_detail_2":{"type":"recommendation","running":!0,"run_condition":"location.pathname.indexOf('\/deals\/') === 0 && location.pathname.split('\/').length === 3 && LS_Mustache_Params && LS_Mustache_Params.gigConfig && payload","multiple":!0,"apply_only_last_request":!0,"root_selector":{"mode":"css","selection":"#db_product_detail_2"},"run_handler":"var css = runIndividualizer.createElementFromHTML(\"<style id='db_product_detail_2_css'>.cui-arrow-next, .cui-arrow-previous { background: white; }<\/style>\");document.querySelector('head').append(css);css = runIndividualizer.createElementFromHTML(\"<style id='db_product_detail_2_css_2'>[data-bhc='compound:crossChannel_dealpage_richrelevance_rr_recs2'] { display: none; }<\/style>\");document.querySelector('head').append(css);runIndividualizer.hideReviews();runIndividualizer.hideDealTitleAndMerchantTitle();","input_handler":"runIndividualizer.requestData.returnedAttributes = ['title_array', 'sale_price_start_at', 'sale_price_end_at', 'gallery_title', 'currency', 'category', 'inventory_service_id', 'restricted_reason', 'restricted', 'show_discount', 'deal_option_id_array', 'category_guids_object', 'category_guids', 'eligible_for_groupon_incentives', 'pds_id', 'channel_id', 'inventory_product_id'];runIndividualizer.requestData.output = ['scriptAbTest', 'mainAbTest'];runIndividualizer.requestData.contextVariables = runIndividualizer.getContextVariables();runIndividualizer.requestData.itemId = payload.dealUuid;var abTestGroup = runIndividualizer.getAbTestGroupFromTheirAbTester();if (abTestGroup) {runIndividualizer.requestData.abTests = abTestGroup;}","received_response_handler":"sessionStorage.setItem('db_abtests', JSON.stringify(runIndividualizer.abTests));runIndividualizer.getAndSavePurplePrices(runIndividualizer.idRequest);","before_render_handler":"var positionEl = \"<figure class='card-ui cui-c-compound cui-four-up cui-c-desktop-carousel' data-bhc='compound:crossChannel_dealpage_recommended_deals' data-bh-viewport='respect'><figcaption class='cui-compound-header'><div class='compound-header-left-container'><h2 class='compound-title' style='font-weight:800;'>\" + runIndividualizer.translations['productDetailHeadline2'] + \"<\/h2><\/div><div class='cui-carousel-pagination'><span class='cui-pagination-numbers'><span class='current-page'><\/span>&nbsp;<span>\" + runIndividualizer.translations['of'] + \"<\/span>&nbsp;<span class='total-pages'><\/span><\/span> <button aria-label='Previous' class='cui-arrow-previous disabled' data-bhc='carousel:previous'><svg height='24px' viewbox='0 0 32 32' width='24px' xmlns='http:\/\/www.w3.org\/2000\/svg'><path d='M20.71 25.29a1 1 0 1 1-1.41 1.41l-10-10a1 1 0 0 1 0-1.41l10-10a1 1 0 1 1 1.41 1.41l-9.3 9.3 9.3 9.29z'><\/path><\/svg><\/button> <button aria-label='Next' class='cui-arrow-next' data-bhc='carousel:next'><svg height='24px' viewbox='0 0 32 32' width='24px' xmlns='http:\/\/www.w3.org\/2000\/svg'><path d='M11.29 25.29a1 1 0 1 0 1.41 1.41l10-10a1 1 0 0 0 0-1.41l-10-10a1 1 0 1 0-1.41 1.41l9.3 9.3-9.3 9.29z'><\/path><\/svg><\/button><\/div><\/figcaption><div class='cui-content-holder'><div class='cui-cards-wrapper carousel'><div id='db_product_detail_2' class='cui-content carousel-content has-scroll-listener'><\/div><\/div><\/div><\/figure>\";var itemEl = \"<figure class='card-ui cui-c-udc price-badge-filled-background left-aligned-card is-getaways-booking has-additional-discount-percent' data-bhc='' data-clickurl='' data-bh-viewport='respect' data-index=''><div class='cui-content'><a href=''><div class='cui-udc-image-container rounded-corners'><div class='cui-udc-image-overlay'><\/div><div class='cui-image-lazy-container cui-image-hover-zoom'><img class='cui-svg-placeholder' height='211' width='349'><img class='cui-image lazy-load lazy-loaded' data-ll-status='loaded' src=''><\/div><\/div><div class='cui-udc-details cui-udc-left-aligned-details'><div class='cui-single-section'><div class='cui-udc-title one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-location cui-truncate cui-has-distance' style='display: none;'><span class='cui-location-name'><\/span><span class='cui-location-separator'>\u2022<\/span><span class='cui-location-distance'><\/span><\/div><\/div><div class='cui-single-section'><div class='cui-review-rating' style='display: none;'><div aria-hidden='true' class='numeric-count'><\/div><ul class='rating rating-numeric'><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><\/ul><div class='rating-count'><\/div><\/div><\/div><div class='cui-bottom-body'><div class='cui-combined-section'><div class='cui-price' data-pingdom-id='deal-price'><div aria-hidden='true' class='cui-price-original c-txt-gray-dk' style='display: none;'><\/div><div aria-hidden='true' class='cui-price-discount c-txt-price'><div class='cui-price-descriptor' style='display: none;'><\/div><span><\/span><div class='cui-price-descriptor' style='display: none;'><\/div><\/div><\/div><div class='cui-promotions'><div class='cui-detail-badge cui-discount-badge' style='display: none;'><\/div><div class='cui-urgent cui-offer' style='display: none;'><div><\/div><div class='cui-verbose-urgency-price' aria-hidden='true'><\/div><div class='cui-verbose-urgency-text'><\/div><\/div><\/div><\/div><div class='cui-single-section'><div class='cui-udc-subtitle one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-urgency-message' data-bhc><\/div><\/div><\/div><\/div><\/a><div class='cui-book-online-cta__container' style='display: none;'><a class='cui-book-online-cta' href=''>\" + runIndividualizer.translations.bookOnline + \"<\/a> <\/div><\/div><\/figure>\";var refEl = document.querySelector('.main .crosslinks-container');if (refEl) {refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML(positionEl), refEl);} else {refEl = document.querySelector('.main .page-container');refEl.append(runIndividualizer.createElementFromHTML(positionEl));}var rootEl = document.querySelector('#db_product_detail_2');rootEl.innerHTML = itemEl;","output_handler":"var interval = setInterval(function() {var messages = document.querySelectorAll(\"#db_product_detail_2 .cui-urgency-message\");if (messages[0].innerHTML === '') {clearInterval(interval);messages.forEach(function(el) {el.innerHTML = el.getAttribute('data-message');});}}, 100);setTimeout(function() {clearInterval(interval);}, 3000);document.querySelectorAll('#db_product_detail_2 figure.card-ui').forEach(function(item, iterator) {item.setAttribute('data-index', iterator);});runIndividualizer.moveAndShowReviews();var rootEl = document.querySelector('#db_product_detail_2');runIndividualizer.initCarouselPaginatorNumbers(rootEl);runIndividualizer.moveAndShowDealTitleAndMerchantTitle();runIndividualizer.renderPurplePrices(runIndividualizer.idRequest, rootEl);","empty_response_handler":"var el = document.querySelector('#db_product_detail_2_css_2');if (el) {el.remove();}el = document.querySelector('#db_product_detail_css_reviews');if (el) {el.remove();}el = document.querySelector('#db_product_detail_css_title');if (el) {el.remove();}","events":[{"type":["DOMContentLoaded"],"selector":{"mode":"css","selection":".main .page-container"},"input_handler":"","timeout_handler":"if (!runIndividualizer.recommendations.hasOwnProperty(runIndividualizer.idRequest)) {var el = document.querySelector('#db_product_detail_2_css_2');if (el) {el.remove();}el = document.querySelector('#db_product_detail_css_reviews');if (el) {el.remove();}el = document.querySelector('#db_product_detail_css_title');if (el) {el.remove();}}","timeout":10000}],"item_attributes":{"_customer_item_id":{"property":"data-bhc","output_handler":"runIndividualizer.element.setAttribute('data-bhc', 'deal:' + runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":""},"required":!0},"channel":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseData === 'marketrate-hotel' || runIndividualizer.responseItem['is_travel_bookable_deal']) {runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"discount_percent_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = JSON.parse(runIndividualizer.responseItem['value_array'])[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && data[index] > 0 && !isSalePriceInEffect && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = data[index] + '% ' + runIndividualizer.translations.discountBadgeText;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-discount-badge"},"required":!0},"is_bookable":{"property":"data-style","output_handler":"if (runIndividualizer.responseData) {runIndividualizer.element.style.display = 'flex';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-book-online-cta__container"},"required":!0},"is_travel_bookable_deal":{"property":"data-is-travel-bookable-deal","output_handler":"runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"med_image":{"property":"src","output_handler":"runIndividualizer.responseData = runIndividualizer.responseData.replace('t300x182.jpg', 'c349x211.webp');","run_condition":"","internal_selector":{"mode":"css","selection":".cui-image"},"required":!0},"merchant_name":{"property":"innerHTML","output_handler":"var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') < 0 && !isCashBackDeal && !isGetawaysDeal) {var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {runIndividualizer.element.classList.remove('one-line-truncate');var title = runIndividualizer.getTitle(runIndividualizer.responseItem);if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}runIndividualizer.responseData = title;}}var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.translations.memberPricing + ' ' + runIndividualizer.responseData;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-title"},"required":!0},"price_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);runIndividualizer.responseData = runIndividualizer.getFormattedPrice(data[index], runIndividualizer.responseItem['currency']);var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {var el = runIndividualizer.element.parentElement;el.classList.remove('c-txt-price');el.classList.add('cui-price-message', 'cui-price-hidden');el.innerHTML = runIndividualizer.translations.priceHidden;} else {if (isCashBackDeal) {runIndividualizer.responseData = runIndividualizer.getCashBack(runIndividualizer.responseItem);} else {if (data.length > 1) {var wrapEl = runIndividualizer.element.parentElement;var el = wrapEl.querySelector('.cui-price-discount .cui-price-descriptor:first-child');if (isSalePriceInEffect) {wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');wrapEl.closest('figure').querySelector('.cui-promotions .cui-offer div:first-child').innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';} else {el.innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';}el.style.display = 'block';}if (data.length === 1 && isSalePriceInEffect) {var wrapEl = runIndividualizer.element.parentElement;wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');}}var isCouponDeal = runIndividualizer.isCouponDeal(runIndividualizer.responseItem);if (isCouponDeal) {runIndividualizer.element.parentElement.parentElement.style.display = 'none';}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount span"},"required":!0},"purchases_total_displayed":{"property":"innerHTML","output_handler":"var num = runIndividualizer.responseData;var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (num > 10 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(num \/ 10) * 10) + '+ ' + runIndividualizer.translations.bought;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1},"rating_count":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_value']) {runIndividualizer.responseData = runIndividualizer.responseData + ' ' + runIndividualizer.translations.ratings;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .rating-count"},"required":!1},"rating_value":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_count']) {var value = runIndividualizer.responseData;var wrapEl = runIndividualizer.element.closest('.cui-review-rating');wrapEl.style.display = 'flex';var stars = wrapEl.querySelectorAll('ul li span');stars.forEach(function(el, num) {if (num + 0.8 <= value) {el.classList.value = 'full-star';} else if (num + 0.3 <= value) {el.classList.value = 'half-star';} else {el.classList.value = 'empty-star';}});} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .numeric-count"},"required":!1},"redemption_locations_short":{"property":"data-location","output_handler":"var locations = JSON.parse(runIndividualizer.responseData);var filteredLocations = [];locations.forEach(function(location) {if (location.hasOwnProperty('lat') && location.hasOwnProperty('lng')) {filteredLocations.push(location);}});locations = filteredLocations;if (locations.length > 0) {var location = runIndividualizer.getNearestLocation(locations);var address = [];if (location['streetAddress1']) {address.push(location['streetAddress1']);}if (location['city']) {address.push(location['city']);}var el = runIndividualizer.element.querySelector('.cui-location-name');if (el) {el.innerHTML = address.join(', ');}var distance = location['distanceInKm'];var unit = runIndividualizer.translations.distanceUnit;if (unit === 'mi') {distance = distance \/ 1.609;}distance = Math.round(distance * 10) \/ 10;var el = runIndividualizer.element.querySelector('.cui-location-distance');if (el) {el.innerHTML = distance + ' ' + unit;}runIndividualizer.element.style.display = 'block';} else {runIndividualizer.element.style.display = 'none';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-location"},"required":!1},"sale_price":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isSalePriceInEffect && !isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(runIndividualizer.responseData, runIndividualizer.responseItem['currency']);var wrapEl = runIndividualizer.element.parentElement;wrapEl.querySelector('.cui-verbose-urgency-text').innerHTML = runIndividualizer.translations.limitedTime;wrapEl.style.display = 'flex';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-offer .cui-verbose-urgency-price"},"required":!1},"title_general":{"property":"innerHTML","output_handler":"var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') >= 0) {var title = runIndividualizer.responseData.trim();if (title === '') {var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseItem['title_array']);var title = data[index];}if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}var el = runIndividualizer.element.closest('figure').querySelector('.cui-udc-title');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {el.classList.remove('one-line-truncate');if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}}el.innerHTML = title;runIndividualizer.responseData = '';} else {var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (isCashBackDeal) {runIndividualizer.element.classList.add('c-txt-gray-dk');runIndividualizer.responseData = runIndividualizer.translations.freeToClaim;} else {var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (['product_card_merchant_name_up'].indexOf(abTestGroup) >= 0 || isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.getTitle(runIndividualizer.responseItem);}if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0 && !isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.responseItem['merchant_name'];}}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-subtitle"},"required":!0},"url":{"property":"href","output_handler":"runIndividualizer.element.closest('.card-ui').setAttribute('data-clickurl', runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"value_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = data[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(originalPrice, runIndividualizer.responseItem['currency']);runIndividualizer.element.style.display = 'block';var refEl = runIndividualizer.element.nextElementSibling;refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML('<span>&nbsp;<\/span>'), refEl)} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-original"},"required":!0},"views_24h":{"property":"innerHTML","output_handler":"var numViews = runIndividualizer.responseData;var numPurchases = runIndividualizer.responseItem['purchases_total_displayed'];var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if ((!numPurchases || numPurchases <= 10) && numViews >= 150 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(numViews \/ 10) * 10) + '+ ' + runIndividualizer.translations.viewedToday;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1}}},"product_detail_3":{"type":"recommendation","running":!0,"run_condition":"location.pathname.indexOf('\/deals\/') === 0 && location.pathname.split('\/').length === 3 && LS_Mustache_Params && LS_Mustache_Params.gigConfig && payload","multiple":!0,"apply_only_last_request":!0,"root_selector":{"mode":"css","selection":"#db_product_detail_3"},"run_handler":"var css = runIndividualizer.createElementFromHTML(\"<style id='db_product_detail_3_css'>.cui-arrow-next, .cui-arrow-previous { background: white; }<\/style>\");document.querySelector('head').append(css);","input_handler":"runIndividualizer.requestData.returnedAttributes = ['title_array', 'sale_price_start_at', 'sale_price_end_at', 'gallery_title', 'currency', 'category', 'inventory_service_id', 'restricted_reason', 'restricted', 'show_discount', 'deal_option_id_array', 'category_guids_object', 'category_guids', 'eligible_for_groupon_incentives', 'pds_id', 'channel_id', 'inventory_product_id'];runIndividualizer.requestData.output = ['scriptAbTest', 'mainAbTest'];runIndividualizer.requestData.contextVariables = runIndividualizer.getContextVariables();runIndividualizer.requestData.itemId = payload.dealUuid;var abTestGroup = runIndividualizer.getAbTestGroupFromTheirAbTester();if (abTestGroup) {runIndividualizer.requestData.abTests = abTestGroup;}","received_response_handler":"sessionStorage.setItem('db_abtests', JSON.stringify(runIndividualizer.abTests));runIndividualizer.getAndSavePurplePrices(runIndividualizer.idRequest);","before_render_handler":"var positionEl = \"<figure class='card-ui cui-c-compound cui-four-up cui-c-desktop-carousel' data-bhc='compound:crossChannel_dealpage_same_merchant_deals'  data-bh-viewport='respect'><figcaption class='cui-compound-header'><div class='compound-header-left-container'><h2 class='compound-title' style='font-weight:800;'>\" + runIndividualizer.translations['productDetailHeadline3'] + \"<\/h2><\/div><div class='cui-carousel-pagination'><span class='cui-pagination-numbers'><span class='current-page'><\/span>&nbsp;<span>\" + runIndividualizer.translations['of'] + \"<\/span>&nbsp;<span class='total-pages'><\/span><\/span> <button aria-label='Previous' class='cui-arrow-previous disabled' data-bhc='carousel:previous'><svg height='24px' viewbox='0 0 32 32' width='24px' xmlns='http:\/\/www.w3.org\/2000\/svg'><path d='M20.71 25.29a1 1 0 1 1-1.41 1.41l-10-10a1 1 0 0 1 0-1.41l10-10a1 1 0 1 1 1.41 1.41l-9.3 9.3 9.3 9.29z'><\/path><\/svg><\/button> <button aria-label='Next' class='cui-arrow-next' data-bhc='carousel:next'><svg height='24px' viewbox='0 0 32 32' width='24px' xmlns='http:\/\/www.w3.org\/2000\/svg'><path d='M11.29 25.29a1 1 0 1 0 1.41 1.41l10-10a1 1 0 0 0 0-1.41l-10-10a1 1 0 1 0-1.41 1.41l9.3 9.3-9.3 9.29z'><\/path><\/svg><\/button><\/div><\/figcaption><div class='cui-content-holder'><div class='cui-cards-wrapper carousel'><div id='db_product_detail_3' class='cui-content carousel-content has-scroll-listener'><\/div><\/div><\/div><\/figure>\";var itemEl = \"<figure class='card-ui cui-c-udc price-badge-filled-background left-aligned-card is-getaways-booking has-additional-discount-percent' data-bhc='' data-clickurl='' data-bh-viewport='respect' data-index=''><div class='cui-content'><a href=''><div class='cui-udc-image-container rounded-corners'><div class='cui-udc-image-overlay'><\/div><div class='cui-image-lazy-container cui-image-hover-zoom'><img class='cui-svg-placeholder' height='211' width='349'><img class='cui-image lazy-load lazy-loaded' data-ll-status='loaded' src=''><\/div><\/div><div class='cui-udc-details cui-udc-left-aligned-details'><div class='cui-single-section'><div class='cui-udc-title one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-location cui-truncate cui-has-distance' style='display: none;'><span class='cui-location-name'><\/span><span class='cui-location-separator'>\u2022<\/span><span class='cui-location-distance'><\/span><\/div><\/div><div class='cui-single-section'><div class='cui-review-rating' style='display: none;'><div aria-hidden='true' class='numeric-count'><\/div><ul class='rating rating-numeric'><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><\/ul><div class='rating-count'><\/div><\/div><\/div><div class='cui-bottom-body'><div class='cui-combined-section'><div class='cui-price' data-pingdom-id='deal-price'><div aria-hidden='true' class='cui-price-original c-txt-gray-dk' style='display: none;'><\/div><div aria-hidden='true' class='cui-price-discount c-txt-price'><div class='cui-price-descriptor' style='display: none;'><\/div><span><\/span><div class='cui-price-descriptor' style='display: none;'><\/div><\/div><\/div><div class='cui-promotions'><div class='cui-detail-badge cui-discount-badge' style='display: none;'><\/div><div class='cui-urgent cui-offer' style='display: none;'><div><\/div><div class='cui-verbose-urgency-price' aria-hidden='true'><\/div><div class='cui-verbose-urgency-text'><\/div><\/div><\/div><\/div><div class='cui-single-section'><div class='cui-udc-subtitle one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-urgency-message' data-bhc><\/div><\/div><\/div><\/div><\/a><div class='cui-book-online-cta__container' style='display: none;'><a class='cui-book-online-cta' href=''>\" + runIndividualizer.translations.bookOnline + \"<\/a> <\/div><\/div><\/figure>\";var refEl = document.querySelector('.main .crosslinks-container');if (refEl) {refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML(positionEl), refEl);} else {refEl = document.querySelector('.main .page-container');refEl.append(runIndividualizer.createElementFromHTML(positionEl));}var rootEl = document.querySelector('#db_product_detail_3');rootEl.innerHTML = itemEl;","output_handler":"var interval = setInterval(function() {var messages = document.querySelectorAll(\"#db_product_detail_3 .cui-urgency-message\");if (messages[0].innerHTML === '') {clearInterval(interval);messages.forEach(function(el) {el.innerHTML = el.getAttribute('data-message');});}}, 100);setTimeout(function() {clearInterval(interval);}, 3000);document.querySelectorAll('#db_product_detail_3 figure.card-ui').forEach(function(item, iterator) {item.setAttribute('data-index', iterator);});var rootEl = document.querySelector('#db_product_detail_3');runIndividualizer.initCarouselPaginatorNumbers(rootEl);runIndividualizer.renderPurplePrices(runIndividualizer.idRequest, rootEl);","empty_response_handler":"","events":[{"type":["DOMContentLoaded"],"selector":{"mode":"css","selection":".main .page-container"},"input_handler":"","timeout_handler":"","timeout":10000}],"item_attributes":{"_customer_item_id":{"property":"data-bhc","output_handler":"runIndividualizer.element.setAttribute('data-bhc', 'deal:' + runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":""},"required":!0},"channel":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseData === 'marketrate-hotel' || runIndividualizer.responseItem['is_travel_bookable_deal']) {runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"discount_percent_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = JSON.parse(runIndividualizer.responseItem['value_array'])[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && data[index] > 0 && !isSalePriceInEffect && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = data[index] + '% ' + runIndividualizer.translations.discountBadgeText;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-discount-badge"},"required":!0},"is_bookable":{"property":"data-style","output_handler":"if (runIndividualizer.responseData) {runIndividualizer.element.style.display = 'flex';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-book-online-cta__container"},"required":!0},"is_travel_bookable_deal":{"property":"data-is-travel-bookable-deal","output_handler":"runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"med_image":{"property":"src","output_handler":"runIndividualizer.responseData = runIndividualizer.responseData.replace('t300x182.jpg', 'c349x211.webp');","run_condition":"","internal_selector":{"mode":"css","selection":".cui-image"},"required":!0},"merchant_name":{"property":"innerHTML","output_handler":"var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') < 0 && !isCashBackDeal && !isGetawaysDeal) {var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {runIndividualizer.element.classList.remove('one-line-truncate');var title = runIndividualizer.getTitle(runIndividualizer.responseItem);if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}runIndividualizer.responseData = title;}}var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.translations.memberPricing + ' ' + runIndividualizer.responseData;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-title"},"required":!0},"price_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);runIndividualizer.responseData = runIndividualizer.getFormattedPrice(data[index], runIndividualizer.responseItem['currency']);var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {var el = runIndividualizer.element.parentElement;el.classList.remove('c-txt-price');el.classList.add('cui-price-message', 'cui-price-hidden');el.innerHTML = runIndividualizer.translations.priceHidden;} else {if (isCashBackDeal) {runIndividualizer.responseData = runIndividualizer.getCashBack(runIndividualizer.responseItem);} else {if (data.length > 1) {var wrapEl = runIndividualizer.element.parentElement;var el = wrapEl.querySelector('.cui-price-discount .cui-price-descriptor:first-child');if (isSalePriceInEffect) {wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');wrapEl.closest('figure').querySelector('.cui-promotions .cui-offer div:first-child').innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';} else {el.innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';}el.style.display = 'block';}if (data.length === 1 && isSalePriceInEffect) {var wrapEl = runIndividualizer.element.parentElement;wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');}}var isCouponDeal = runIndividualizer.isCouponDeal(runIndividualizer.responseItem);if (isCouponDeal) {runIndividualizer.element.parentElement.parentElement.style.display = 'none';}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount span"},"required":!0},"purchases_total_displayed":{"property":"innerHTML","output_handler":"var num = runIndividualizer.responseData;var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (num > 10 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(num \/ 10) * 10) + '+ ' + runIndividualizer.translations.bought;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1},"rating_count":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_value']) {runIndividualizer.responseData = runIndividualizer.responseData + ' ' + runIndividualizer.translations.ratings;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .rating-count"},"required":!1},"rating_value":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_count']) {var value = runIndividualizer.responseData;var wrapEl = runIndividualizer.element.closest('.cui-review-rating');wrapEl.style.display = 'flex';var stars = wrapEl.querySelectorAll('ul li span');stars.forEach(function(el, num) {if (num + 0.8 <= value) {el.classList.value = 'full-star';} else if (num + 0.3 <= value) {el.classList.value = 'half-star';} else {el.classList.value = 'empty-star';}});} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .numeric-count"},"required":!1},"redemption_locations_short":{"property":"data-location","output_handler":"var locations = JSON.parse(runIndividualizer.responseData);var filteredLocations = [];locations.forEach(function(location) {if (location.hasOwnProperty('lat') && location.hasOwnProperty('lng')) {filteredLocations.push(location);}});locations = filteredLocations;if (locations.length > 0) {var location = runIndividualizer.getNearestLocation(locations);var address = [];if (location['streetAddress1']) {address.push(location['streetAddress1']);}if (location['city']) {address.push(location['city']);}var el = runIndividualizer.element.querySelector('.cui-location-name');if (el) {el.innerHTML = address.join(', ');}var distance = location['distanceInKm'];var unit = runIndividualizer.translations.distanceUnit;if (unit === 'mi') {distance = distance \/ 1.609;}distance = Math.round(distance * 10) \/ 10;var el = runIndividualizer.element.querySelector('.cui-location-distance');if (el) {el.innerHTML = distance + ' ' + unit;}runIndividualizer.element.style.display = 'block';} else {runIndividualizer.element.style.display = 'none';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-location"},"required":!1},"sale_price":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isSalePriceInEffect && !isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(runIndividualizer.responseData, runIndividualizer.responseItem['currency']);var wrapEl = runIndividualizer.element.parentElement;wrapEl.querySelector('.cui-verbose-urgency-text').innerHTML = runIndividualizer.translations.limitedTime;wrapEl.style.display = 'flex';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-offer .cui-verbose-urgency-price"},"required":!1},"title_general":{"property":"innerHTML","output_handler":"var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') >= 0) {var title = runIndividualizer.responseData.trim();if (title === '') {var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseItem['title_array']);var title = data[index];}if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}var el = runIndividualizer.element.closest('figure').querySelector('.cui-udc-title');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {el.classList.remove('one-line-truncate');if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}}el.innerHTML = title;runIndividualizer.responseData = '';} else {var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (isCashBackDeal) {runIndividualizer.element.classList.add('c-txt-gray-dk');runIndividualizer.responseData = runIndividualizer.translations.freeToClaim;} else {var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (['product_card_merchant_name_up'].indexOf(abTestGroup) >= 0 || isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.getTitle(runIndividualizer.responseItem);}if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0 && !isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.responseItem['merchant_name'];}}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-subtitle"},"required":!0},"url":{"property":"href","output_handler":"runIndividualizer.element.closest('.card-ui').setAttribute('data-clickurl', runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"value_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = data[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(originalPrice, runIndividualizer.responseItem['currency']);runIndividualizer.element.style.display = 'block';var refEl = runIndividualizer.element.nextElementSibling;refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML('<span>&nbsp;<\/span>'), refEl)} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-original"},"required":!0},"views_24h":{"property":"innerHTML","output_handler":"var numViews = runIndividualizer.responseData;var numPurchases = runIndividualizer.responseItem['purchases_total_displayed'];var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if ((!numPurchases || numPurchases <= 10) && numViews >= 150 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(numViews \/ 10) * 10) + '+ ' + runIndividualizer.translations.viewedToday;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1}}},"product_detail_mobile_1":{"type":"recommendation","running":!0,"run_condition":"location.pathname.indexOf('\/deals\/') === 0 && location.pathname.split('\/').length === 3 && LS_Mustache_Params && LS_Mustache_Params.mobileConfig && payload","multiple":!0,"apply_only_last_request":!0,"root_selector":{"mode":"css","selection":"#db_product_detail_mobile_1"},"run_handler":"var css = runIndividualizer.createElementFromHTML(\"<style id='db_product_detail_mobile_1_css'>[data-bhc='compound:crossChannel_dealpage_richrelevance_rr_recs1'] { display: none; }<\/style>\");document.querySelector('head').append(css);runIndividualizer.hideReviews();","input_handler":"runIndividualizer.requestData.returnedAttributes = ['title_array', 'sale_price_start_at', 'sale_price_end_at', 'gallery_title', 'currency', 'category', 'inventory_service_id', 'restricted_reason', 'restricted', 'show_discount', 'deal_option_id_array', 'category_guids_object', 'category_guids', 'eligible_for_groupon_incentives', 'pds_id', 'channel_id', 'inventory_product_id'];runIndividualizer.requestData.output = ['scriptAbTest', 'mainAbTest'];runIndividualizer.requestData.contextVariables = runIndividualizer.getContextVariables();runIndividualizer.requestData.itemId = payload.dealUuid;var abTestGroup = runIndividualizer.getAbTestGroupFromTheirAbTester();if (abTestGroup) {runIndividualizer.requestData.abTests = abTestGroup;}","received_response_handler":"sessionStorage.setItem('db_abtests', JSON.stringify(runIndividualizer.abTests));runIndividualizer.getAndSavePurplePrices(runIndividualizer.idRequest);","before_render_handler":"var positionEl = \"<figure class='card-ui cui-c-compound' data-bhc='compound:crossChannel_dealpage_similar_deals' data-bh-viewport='respect' style='float:none;'><figcaption class='cui-compound-header'><div class='cui-flex-text-row'><h2 class='compound-title' style='font-weight:800;'>\" + runIndividualizer.translations['productDetailHeadline1'] + \"<\/h2><\/div><\/figcaption><div class='cui-content-holder'><div class='cui-cards-wrapper carousel'><div id='db_product_detail_mobile_1' class='cui-content carousel-content has-scroll-listener'><\/div><\/div><\/div><\/figure>\";var itemEl = \"<figure class='card-ui cui-c-udc price-badge-filled-background left-aligned-card is-getaways-booking has-additional-discount-percent' data-bhc='' data-clickurl='' data-bh-viewport='respect' data-index=''><div class='cui-content'><a href=''><div class='cui-udc-image-container rounded-corners'><div class='cui-udc-image-overlay'><\/div><div class='cui-image-lazy-container cui-image-hover-zoom'><img class='cui-svg-placeholder' height='211' width='349'><img class='cui-image lazy-load lazy-loaded' data-ll-status='loaded' src=''><\/div><\/div><div class='cui-udc-details cui-udc-left-aligned-details'><div class='cui-single-section'><div class='cui-udc-title one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-location cui-truncate cui-has-distance' style='display: none;'><span class='cui-location-name'><\/span><span class='cui-location-separator'>\u2022<\/span><span class='cui-location-distance'><\/span><\/div><\/div><div class='cui-single-section'><div class='cui-review-rating' style='display: none;'><div aria-hidden='true' class='numeric-count'><\/div><ul class='rating rating-numeric'><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><\/ul><div class='rating-count'><\/div><\/div><\/div><div class='cui-bottom-body'><div class='cui-combined-section'><div class='cui-price' data-pingdom-id='deal-price'><div aria-hidden='true' class='cui-price-original c-txt-gray-dk' style='display: none;'><\/div><div aria-hidden='true' class='cui-price-discount c-txt-price'><div class='cui-price-descriptor' style='display: none;'><\/div><span><\/span><div class='cui-price-descriptor' style='display: none;'><\/div><\/div><\/div><div class='cui-promotions'><div class='cui-detail-badge cui-discount-badge' style='display: none;'><\/div><div class='cui-urgent cui-offer' style='display: none;'><div><\/div><div class='cui-verbose-urgency-price' aria-hidden='true'><\/div><div class='cui-verbose-urgency-text'><\/div><\/div><\/div><\/div><div class='cui-single-section'><div class='cui-udc-subtitle one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-urgency-message' data-bhc><\/div><\/div><\/div><\/div><\/a><div class='cui-book-online-cta__container' style='display: none;'><a class='cui-book-online-cta' href=''>\" + runIndividualizer.translations.bookOnline + \"<\/a> <\/div><\/div><\/figure>\";var refEl = document.querySelector('#db_product_detail_mobile_2');if (refEl) {refEl = refEl.closest('.cui-c-compound');refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML(positionEl), refEl);} else {refEl = document.querySelector('#cards-bottom-placeholder');if (refEl) {refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML(positionEl), refEl.nextElementSibling);} else {refEl = document.querySelector('#deal-dfp-bottom-slot');refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML(positionEl), refEl);}}var rootEl = document.querySelector('#db_product_detail_mobile_1');rootEl.innerHTML = itemEl;","output_handler":"var interval = setInterval(function() {var messages = document.querySelectorAll(\"#db_product_detail_mobile_1 .cui-urgency-message\");if (messages[0].innerHTML === '') {clearInterval(interval);messages.forEach(function(el) {el.innerHTML = el.getAttribute('data-message');});}}, 100);setTimeout(function() {clearInterval(interval);}, 3000);document.querySelectorAll('#db_product_detail_mobile_1 figure.card-ui').forEach(function(item, iterator) {item.setAttribute('data-index', iterator);});runIndividualizer.moveAndShowReviews();var rootEl = document.querySelector(\"#db_product_detail_mobile_1\");runIndividualizer.renderPurplePrices(runIndividualizer.idRequest, rootEl);","empty_response_handler":"var el = document.querySelector('#db_product_detail_mobile_1_css');if (el) {el.remove();}el = document.querySelector('#db_product_detail_css_reviews');if (el) {el.remove();}","events":[{"type":["DOMContentLoaded"],"selector":{"mode":"css","selection":"#deal-dfp-bottom-slot"},"input_handler":"","timeout_handler":"if (!runIndividualizer.recommendations.hasOwnProperty(runIndividualizer.idRequest)) {var el = document.querySelector('#db_product_detail_mobile_1_css');if (el) {el.remove();}el = document.querySelector('#db_product_detail_css_reviews');if (el) {el.remove();}}","timeout":10000}],"item_attributes":{"_customer_item_id":{"property":"data-bhc","output_handler":"runIndividualizer.element.setAttribute('data-bhc', 'deal:' + runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":""},"required":!0},"channel":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseData === 'marketrate-hotel' || runIndividualizer.responseItem['is_travel_bookable_deal']) {runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"discount_percent_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = JSON.parse(runIndividualizer.responseItem['value_array'])[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && data[index] > 0 && !isSalePriceInEffect && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = data[index] + '% ' + runIndividualizer.translations.discountBadgeText;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-discount-badge"},"required":!0},"is_bookable":{"property":"data-style","output_handler":"if (runIndividualizer.responseData) {runIndividualizer.element.style.display = 'flex';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-book-online-cta__container"},"required":!0},"is_travel_bookable_deal":{"property":"data-is-travel-bookable-deal","output_handler":"runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"med_image":{"property":"src","output_handler":"runIndividualizer.responseData = runIndividualizer.responseData.replace('t300x182.jpg', 'c349x211.webp');","run_condition":"","internal_selector":{"mode":"css","selection":".cui-image"},"required":!0},"merchant_name":{"property":"innerHTML","output_handler":"var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') < 0 && !isCashBackDeal && !isGetawaysDeal) {var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {runIndividualizer.element.classList.remove('one-line-truncate');var title = runIndividualizer.getTitle(runIndividualizer.responseItem);if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}runIndividualizer.responseData = title;}}var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.translations.memberPricing + ' ' + runIndividualizer.responseData;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-title"},"required":!0},"price_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);runIndividualizer.responseData = runIndividualizer.getFormattedPrice(data[index], runIndividualizer.responseItem['currency']);var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {var el = runIndividualizer.element.parentElement;el.classList.remove('c-txt-price');el.classList.add('cui-price-message', 'cui-price-hidden');el.innerHTML = runIndividualizer.translations.priceHidden;} else {if (isCashBackDeal) {runIndividualizer.responseData = runIndividualizer.getCashBack(runIndividualizer.responseItem);} else {if (data.length > 1) {var wrapEl = runIndividualizer.element.parentElement;var el = wrapEl.querySelector('.cui-price-discount .cui-price-descriptor:first-child');if (isSalePriceInEffect) {wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');wrapEl.closest('figure').querySelector('.cui-promotions .cui-offer div:first-child').innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';} else {el.innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';}el.style.display = 'block';}if (data.length === 1 && isSalePriceInEffect) {var wrapEl = runIndividualizer.element.parentElement;wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');}}var isCouponDeal = runIndividualizer.isCouponDeal(runIndividualizer.responseItem);if (isCouponDeal) {runIndividualizer.element.parentElement.parentElement.style.display = 'none';}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount span"},"required":!0},"purchases_total_displayed":{"property":"innerHTML","output_handler":"var num = runIndividualizer.responseData;var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (num > 10 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(num \/ 10) * 10) + '+ ' + runIndividualizer.translations.bought;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1},"rating_count":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_value']) {runIndividualizer.responseData = runIndividualizer.responseData + ' ' + runIndividualizer.translations.ratings;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .rating-count"},"required":!1},"rating_value":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_count']) {var value = runIndividualizer.responseData;var wrapEl = runIndividualizer.element.closest('.cui-review-rating');wrapEl.style.display = 'flex';var stars = wrapEl.querySelectorAll('ul li span');stars.forEach(function(el, num) {if (num + 0.8 <= value) {el.classList.value = 'full-star';} else if (num + 0.3 <= value) {el.classList.value = 'half-star';} else {el.classList.value = 'empty-star';}});} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .numeric-count"},"required":!1},"redemption_locations_short":{"property":"data-location","output_handler":"var locations = JSON.parse(runIndividualizer.responseData);var filteredLocations = [];locations.forEach(function(location) {if (location.hasOwnProperty('lat') && location.hasOwnProperty('lng')) {filteredLocations.push(location);}});locations = filteredLocations;if (locations.length > 0) {var location = runIndividualizer.getNearestLocation(locations);var address = [];if (location['streetAddress1']) {address.push(location['streetAddress1']);}if (location['city']) {address.push(location['city']);}var el = runIndividualizer.element.querySelector('.cui-location-name');if (el) {el.innerHTML = address.join(', ');}var distance = location['distanceInKm'];var unit = runIndividualizer.translations.distanceUnit;if (unit === 'mi') {distance = distance \/ 1.609;}distance = Math.round(distance * 10) \/ 10;var el = runIndividualizer.element.querySelector('.cui-location-distance');if (el) {el.innerHTML = distance + ' ' + unit;}runIndividualizer.element.style.display = 'block';} else {runIndividualizer.element.style.display = 'none';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-location"},"required":!1},"sale_price":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isSalePriceInEffect && !isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(runIndividualizer.responseData, runIndividualizer.responseItem['currency']);var wrapEl = runIndividualizer.element.parentElement;wrapEl.querySelector('.cui-verbose-urgency-text').innerHTML = runIndividualizer.translations.limitedTime;wrapEl.style.display = 'flex';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-offer .cui-verbose-urgency-price"},"required":!1},"title_general":{"property":"innerHTML","output_handler":"var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') >= 0) {var title = runIndividualizer.responseData.trim();if (title === '') {var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseItem['title_array']);var title = data[index];}if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}var el = runIndividualizer.element.closest('figure').querySelector('.cui-udc-title');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {el.classList.remove('one-line-truncate');if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}}el.innerHTML = title;runIndividualizer.responseData = '';} else {var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (isCashBackDeal) {runIndividualizer.element.classList.add('c-txt-gray-dk');runIndividualizer.responseData = runIndividualizer.translations.freeToClaim;} else {var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (['product_card_merchant_name_up'].indexOf(abTestGroup) >= 0 || isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.getTitle(runIndividualizer.responseItem);}if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0 && !isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.responseItem['merchant_name'];}}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-subtitle"},"required":!0},"url":{"property":"href","output_handler":"runIndividualizer.element.closest('.card-ui').setAttribute('data-clickurl', runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"value_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = data[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(originalPrice, runIndividualizer.responseItem['currency']);runIndividualizer.element.style.display = 'block';var refEl = runIndividualizer.element.nextElementSibling;refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML('<span>&nbsp;<\/span>'), refEl)} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-original"},"required":!0},"views_24h":{"property":"innerHTML","output_handler":"var numViews = runIndividualizer.responseData;var numPurchases = runIndividualizer.responseItem['purchases_total_displayed'];var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if ((!numPurchases || numPurchases <= 10) && numViews >= 150 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(numViews \/ 10) * 10) + '+ ' + runIndividualizer.translations.viewedToday;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1}}},"product_detail_mobile_2":{"type":"recommendation","running":!0,"run_condition":"location.pathname.indexOf('\/deals\/') === 0 && location.pathname.split('\/').length === 3 && LS_Mustache_Params && LS_Mustache_Params.mobileConfig && payload","multiple":!0,"apply_only_last_request":!0,"root_selector":{"mode":"css","selection":"#db_product_detail_mobile_2"},"run_handler":"var css = runIndividualizer.createElementFromHTML(\"<style id='db_product_detail_mobile_2_css'>[data-bhc='compound:crossChannel_dealpage_richrelevance_rr_recs2'] { display: none; }<\/style>\");document.querySelector('head').append(css);runIndividualizer.hideReviews();","input_handler":"runIndividualizer.requestData.returnedAttributes = ['title_array', 'sale_price_start_at', 'sale_price_end_at', 'gallery_title', 'currency', 'category', 'inventory_service_id', 'restricted_reason', 'restricted', 'show_discount', 'deal_option_id_array', 'category_guids_object', 'category_guids', 'eligible_for_groupon_incentives', 'pds_id', 'channel_id', 'inventory_product_id'];runIndividualizer.requestData.output = ['scriptAbTest', 'mainAbTest'];runIndividualizer.requestData.contextVariables = runIndividualizer.getContextVariables();runIndividualizer.requestData.itemId = payload.dealUuid;var abTestGroup = runIndividualizer.getAbTestGroupFromTheirAbTester();if (abTestGroup) {runIndividualizer.requestData.abTests = abTestGroup;}","received_response_handler":"sessionStorage.setItem('db_abtests', JSON.stringify(runIndividualizer.abTests));runIndividualizer.getAndSavePurplePrices(runIndividualizer.idRequest);","before_render_handler":"var positionEl = \"<figure class='card-ui cui-c-compound' data-bhc='compound:crossChannel_dealpage_recommended_deals' data-bh-viewport='respect' style='float:none;'><figcaption class='cui-compound-header'><div class='cui-flex-text-row'><h2 class='compound-title' style='font-weight:800;'>\" + runIndividualizer.translations['productDetailHeadline2'] + \"<\/h2><\/div><\/figcaption><div class='cui-content-holder'><div class='cui-cards-wrapper carousel'><div id='db_product_detail_mobile_2' class='cui-content carousel-content has-scroll-listener'><\/div><\/div><\/div><\/figure>\";var itemEl = \"<figure class='card-ui cui-c-udc price-badge-filled-background left-aligned-card is-getaways-booking has-additional-discount-percent' data-bhc='' data-clickurl='' data-bh-viewport='respect' data-index=''><div class='cui-content'><a href=''><div class='cui-udc-image-container rounded-corners'><div class='cui-udc-image-overlay'><\/div><div class='cui-image-lazy-container cui-image-hover-zoom'><img class='cui-svg-placeholder' height='211' width='349'><img class='cui-image lazy-load lazy-loaded' data-ll-status='loaded' src=''><\/div><\/div><div class='cui-udc-details cui-udc-left-aligned-details'><div class='cui-single-section'><div class='cui-udc-title one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-location cui-truncate cui-has-distance' style='display: none;'><span class='cui-location-name'><\/span><span class='cui-location-separator'>\u2022<\/span><span class='cui-location-distance'><\/span><\/div><\/div><div class='cui-single-section'><div class='cui-review-rating' style='display: none;'><div aria-hidden='true' class='numeric-count'><\/div><ul class='rating rating-numeric'><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><\/ul><div class='rating-count'><\/div><\/div><\/div><div class='cui-bottom-body'><div class='cui-combined-section'><div class='cui-price' data-pingdom-id='deal-price'><div aria-hidden='true' class='cui-price-original c-txt-gray-dk' style='display: none;'><\/div><div aria-hidden='true' class='cui-price-discount c-txt-price'><div class='cui-price-descriptor' style='display: none;'><\/div><span><\/span><div class='cui-price-descriptor' style='display: none;'><\/div><\/div><\/div><div class='cui-promotions'><div class='cui-detail-badge cui-discount-badge' style='display: none;'><\/div><div class='cui-urgent cui-offer' style='display: none;'><div><\/div><div class='cui-verbose-urgency-price' aria-hidden='true'><\/div><div class='cui-verbose-urgency-text'><\/div><\/div><\/div><\/div><div class='cui-single-section'><div class='cui-udc-subtitle one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-urgency-message' data-bhc><\/div><\/div><\/div><\/div><\/a><div class='cui-book-online-cta__container' style='display: none;'><a class='cui-book-online-cta' href=''>\" + runIndividualizer.translations.bookOnline + \"<\/a> <\/div><\/div><\/figure>\";var refEl = document.querySelector('#db_product_detail_mobile_3');if (refEl) {refEl = refEl.closest('.cui-c-compound');refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML(positionEl), refEl);} else {refEl = document.querySelector('#cards-bottom-placeholder');if (refEl) {refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML(positionEl), refEl.nextElementSibling);} else {refEl = document.querySelector('#deal-dfp-bottom-slot');refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML(positionEl), refEl);}}var rootEl = document.querySelector('#db_product_detail_mobile_2');rootEl.innerHTML = itemEl;","output_handler":"var interval = setInterval(function() {var messages = document.querySelectorAll(\"#db_product_detail_mobile_2 .cui-urgency-message\");if (messages[0].innerHTML === '') {clearInterval(interval);messages.forEach(function(el) {el.innerHTML = el.getAttribute('data-message');});}}, 100);setTimeout(function() {clearInterval(interval);}, 3000);document.querySelectorAll('#db_product_detail_mobile_2 figure.card-ui').forEach(function(item, iterator) {item.setAttribute('data-index', iterator);});runIndividualizer.moveAndShowReviews();var rootEl = document.querySelector(\"#db_product_detail_mobile_2\");runIndividualizer.renderPurplePrices(runIndividualizer.idRequest, rootEl);","empty_response_handler":"var el = document.querySelector('#db_product_detail_mobile_2_css');if (el) {el.remove();}el = document.querySelector('#db_product_detail_css_reviews');if (el) {el.remove();}","events":[{"type":["DOMContentLoaded"],"selector":{"mode":"css","selection":"#deal-dfp-bottom-slot"},"input_handler":"","timeout_handler":"if (!runIndividualizer.recommendations.hasOwnProperty(runIndividualizer.idRequest)) {var el = document.querySelector('#db_product_detail_mobile_2_css');if (el) {el.remove();}el = document.querySelector('#db_product_detail_css_reviews');if (el) {el.remove();}}","timeout":10000}],"item_attributes":{"_customer_item_id":{"property":"data-bhc","output_handler":"runIndividualizer.element.setAttribute('data-bhc', 'deal:' + runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":""},"required":!0},"channel":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseData === 'marketrate-hotel' || runIndividualizer.responseItem['is_travel_bookable_deal']) {runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"discount_percent_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = JSON.parse(runIndividualizer.responseItem['value_array'])[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && data[index] > 0 && !isSalePriceInEffect && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = data[index] + '% ' + runIndividualizer.translations.discountBadgeText;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-discount-badge"},"required":!0},"is_bookable":{"property":"data-style","output_handler":"if (runIndividualizer.responseData) {runIndividualizer.element.style.display = 'flex';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-book-online-cta__container"},"required":!0},"is_travel_bookable_deal":{"property":"data-is-travel-bookable-deal","output_handler":"runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"med_image":{"property":"src","output_handler":"runIndividualizer.responseData = runIndividualizer.responseData.replace('t300x182.jpg', 'c349x211.webp');","run_condition":"","internal_selector":{"mode":"css","selection":".cui-image"},"required":!0},"merchant_name":{"property":"innerHTML","output_handler":"var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') < 0 && !isCashBackDeal && !isGetawaysDeal) {var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {runIndividualizer.element.classList.remove('one-line-truncate');var title = runIndividualizer.getTitle(runIndividualizer.responseItem);if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}runIndividualizer.responseData = title;}}var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.translations.memberPricing + ' ' + runIndividualizer.responseData;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-title"},"required":!0},"price_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);runIndividualizer.responseData = runIndividualizer.getFormattedPrice(data[index], runIndividualizer.responseItem['currency']);var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {var el = runIndividualizer.element.parentElement;el.classList.remove('c-txt-price');el.classList.add('cui-price-message', 'cui-price-hidden');el.innerHTML = runIndividualizer.translations.priceHidden;} else {if (isCashBackDeal) {runIndividualizer.responseData = runIndividualizer.getCashBack(runIndividualizer.responseItem);} else {if (data.length > 1) {var wrapEl = runIndividualizer.element.parentElement;var el = wrapEl.querySelector('.cui-price-discount .cui-price-descriptor:first-child');if (isSalePriceInEffect) {wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');wrapEl.closest('figure').querySelector('.cui-promotions .cui-offer div:first-child').innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';} else {el.innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';}el.style.display = 'block';}if (data.length === 1 && isSalePriceInEffect) {var wrapEl = runIndividualizer.element.parentElement;wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');}}var isCouponDeal = runIndividualizer.isCouponDeal(runIndividualizer.responseItem);if (isCouponDeal) {runIndividualizer.element.parentElement.parentElement.style.display = 'none';}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount span"},"required":!0},"purchases_total_displayed":{"property":"innerHTML","output_handler":"var num = runIndividualizer.responseData;var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (num > 10 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(num \/ 10) * 10) + '+ ' + runIndividualizer.translations.bought;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1},"rating_count":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_value']) {runIndividualizer.responseData = runIndividualizer.responseData + ' ' + runIndividualizer.translations.ratings;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .rating-count"},"required":!1},"rating_value":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_count']) {var value = runIndividualizer.responseData;var wrapEl = runIndividualizer.element.closest('.cui-review-rating');wrapEl.style.display = 'flex';var stars = wrapEl.querySelectorAll('ul li span');stars.forEach(function(el, num) {if (num + 0.8 <= value) {el.classList.value = 'full-star';} else if (num + 0.3 <= value) {el.classList.value = 'half-star';} else {el.classList.value = 'empty-star';}});} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .numeric-count"},"required":!1},"redemption_locations_short":{"property":"data-location","output_handler":"var locations = JSON.parse(runIndividualizer.responseData);var filteredLocations = [];locations.forEach(function(location) {if (location.hasOwnProperty('lat') && location.hasOwnProperty('lng')) {filteredLocations.push(location);}});locations = filteredLocations;if (locations.length > 0) {var location = runIndividualizer.getNearestLocation(locations);var address = [];if (location['streetAddress1']) {address.push(location['streetAddress1']);}if (location['city']) {address.push(location['city']);}var el = runIndividualizer.element.querySelector('.cui-location-name');if (el) {el.innerHTML = address.join(', ');}var distance = location['distanceInKm'];var unit = runIndividualizer.translations.distanceUnit;if (unit === 'mi') {distance = distance \/ 1.609;}distance = Math.round(distance * 10) \/ 10;var el = runIndividualizer.element.querySelector('.cui-location-distance');if (el) {el.innerHTML = distance + ' ' + unit;}runIndividualizer.element.style.display = 'block';} else {runIndividualizer.element.style.display = 'none';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-location"},"required":!1},"sale_price":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isSalePriceInEffect && !isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(runIndividualizer.responseData, runIndividualizer.responseItem['currency']);var wrapEl = runIndividualizer.element.parentElement;wrapEl.querySelector('.cui-verbose-urgency-text').innerHTML = runIndividualizer.translations.limitedTime;wrapEl.style.display = 'flex';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-offer .cui-verbose-urgency-price"},"required":!1},"title_general":{"property":"innerHTML","output_handler":"var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') >= 0) {var title = runIndividualizer.responseData.trim();if (title === '') {var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseItem['title_array']);var title = data[index];}if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}var el = runIndividualizer.element.closest('figure').querySelector('.cui-udc-title');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {el.classList.remove('one-line-truncate');if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}}el.innerHTML = title;runIndividualizer.responseData = '';} else {var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (isCashBackDeal) {runIndividualizer.element.classList.add('c-txt-gray-dk');runIndividualizer.responseData = runIndividualizer.translations.freeToClaim;} else {var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (['product_card_merchant_name_up'].indexOf(abTestGroup) >= 0 || isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.getTitle(runIndividualizer.responseItem);}if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0 && !isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.responseItem['merchant_name'];}}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-subtitle"},"required":!0},"url":{"property":"href","output_handler":"runIndividualizer.element.closest('.card-ui').setAttribute('data-clickurl', runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"value_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = data[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(originalPrice, runIndividualizer.responseItem['currency']);runIndividualizer.element.style.display = 'block';var refEl = runIndividualizer.element.nextElementSibling;refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML('<span>&nbsp;<\/span>'), refEl)} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-original"},"required":!0},"views_24h":{"property":"innerHTML","output_handler":"var numViews = runIndividualizer.responseData;var numPurchases = runIndividualizer.responseItem['purchases_total_displayed'];var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if ((!numPurchases || numPurchases <= 10) && numViews >= 150 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(numViews \/ 10) * 10) + '+ ' + runIndividualizer.translations.viewedToday;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1}}},"product_detail_mobile_3":{"type":"recommendation","running":!0,"run_condition":"location.pathname.indexOf('\/deals\/') === 0 && location.pathname.split('\/').length === 3 && LS_Mustache_Params && LS_Mustache_Params.mobileConfig && payload","multiple":!0,"apply_only_last_request":!0,"root_selector":{"mode":"css","selection":"#db_product_detail_mobile_3"},"run_handler":"","input_handler":"runIndividualizer.requestData.returnedAttributes = ['title_array', 'sale_price_start_at', 'sale_price_end_at', 'gallery_title', 'currency', 'category', 'inventory_service_id', 'restricted_reason', 'restricted', 'show_discount', 'deal_option_id_array', 'category_guids_object', 'category_guids', 'eligible_for_groupon_incentives', 'pds_id', 'channel_id', 'inventory_product_id'];runIndividualizer.requestData.output = ['scriptAbTest', 'mainAbTest'];runIndividualizer.requestData.contextVariables = runIndividualizer.getContextVariables();runIndividualizer.requestData.itemId = payload.dealUuid;var abTestGroup = runIndividualizer.getAbTestGroupFromTheirAbTester();if (abTestGroup) {runIndividualizer.requestData.abTests = abTestGroup;}","received_response_handler":"sessionStorage.setItem('db_abtests', JSON.stringify(runIndividualizer.abTests));runIndividualizer.getAndSavePurplePrices(runIndividualizer.idRequest);","before_render_handler":"var positionEl = \"<figure class='card-ui cui-c-compound' data-bhc='compound:crossChannel_dealpage_same_merchant_deals' data-bh-viewport='respect' style='float:none;'><figcaption class='cui-compound-header'><div class='cui-flex-text-row'><h2 class='compound-title' style='font-weight:800;'>\" + runIndividualizer.translations['productDetailHeadline3'] + \"<\/h2><\/div><\/figcaption><div class='cui-content-holder'><div class='cui-cards-wrapper carousel'><div id='db_product_detail_mobile_3' class='cui-content carousel-content has-scroll-listener'><\/div><\/div><\/div><\/figure>\";var itemEl = \"<figure class='card-ui cui-c-udc price-badge-filled-background left-aligned-card is-getaways-booking has-additional-discount-percent' data-bhc='' data-clickurl='' data-bh-viewport='respect' data-index=''><div class='cui-content'><a href=''><div class='cui-udc-image-container rounded-corners'><div class='cui-udc-image-overlay'><\/div><div class='cui-image-lazy-container cui-image-hover-zoom'><img class='cui-svg-placeholder' height='211' width='349'><img class='cui-image lazy-load lazy-loaded' data-ll-status='loaded' src=''><\/div><\/div><div class='cui-udc-details cui-udc-left-aligned-details'><div class='cui-single-section'><div class='cui-udc-title one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-location cui-truncate cui-has-distance' style='display: none;'><span class='cui-location-name'><\/span><span class='cui-location-separator'>\u2022<\/span><span class='cui-location-distance'><\/span><\/div><\/div><div class='cui-single-section'><div class='cui-review-rating' style='display: none;'><div aria-hidden='true' class='numeric-count'><\/div><ul class='rating rating-numeric'><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><\/ul><div class='rating-count'><\/div><\/div><\/div><div class='cui-bottom-body'><div class='cui-combined-section'><div class='cui-price' data-pingdom-id='deal-price'><div aria-hidden='true' class='cui-price-original c-txt-gray-dk' style='display: none;'><\/div><div aria-hidden='true' class='cui-price-discount c-txt-price'><div class='cui-price-descriptor' style='display: none;'><\/div><span><\/span><div class='cui-price-descriptor' style='display: none;'><\/div><\/div><\/div><div class='cui-promotions'><div class='cui-detail-badge cui-discount-badge' style='display: none;'><\/div><div class='cui-urgent cui-offer' style='display: none;'><div><\/div><div class='cui-verbose-urgency-price' aria-hidden='true'><\/div><div class='cui-verbose-urgency-text'><\/div><\/div><\/div><\/div><div class='cui-single-section'><div class='cui-udc-subtitle one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-urgency-message' data-bhc><\/div><\/div><\/div><\/div><\/a><div class='cui-book-online-cta__container' style='display: none;'><a class='cui-book-online-cta' href=''>\" + runIndividualizer.translations.bookOnline + \"<\/a> <\/div><\/div><\/figure>\";var refEl = document.querySelector('#db_product_detail_mobile_2');if (refEl) {refEl = refEl.closest('.cui-c-compound');refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML(positionEl), refEl.nextElementSibling);} else {refEl = document.querySelector('#cards-bottom-placeholder');if (refEl) {refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML(positionEl), refEl.nextElementSibling);} else {refEl = document.querySelector('#deal-dfp-bottom-slot');refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML(positionEl), refEl);}}var rootEl = document.querySelector('#db_product_detail_mobile_3');rootEl.innerHTML = itemEl;","output_handler":"var interval = setInterval(function() {var messages = document.querySelectorAll(\"#db_product_detail_mobile_3 .cui-urgency-message\");if (messages[0].innerHTML === '') {clearInterval(interval);messages.forEach(function(el) {el.innerHTML = el.getAttribute('data-message');});}}, 100);setTimeout(function() {clearInterval(interval);}, 3000);document.querySelectorAll('#db_product_detail_mobile_3 figure.card-ui').forEach(function(item, iterator) {item.setAttribute('data-index', iterator);});var rootEl = document.querySelector(\"#db_product_detail_mobile_3\");runIndividualizer.renderPurplePrices(runIndividualizer.idRequest, rootEl);","empty_response_handler":"","events":[{"type":["DOMContentLoaded"],"selector":{"mode":"css","selection":"#deal-dfp-bottom-slot"},"input_handler":"","timeout_handler":"","timeout":10000}],"item_attributes":{"_customer_item_id":{"property":"data-bhc","output_handler":"runIndividualizer.element.setAttribute('data-bhc', 'deal:' + runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":""},"required":!0},"channel":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseData === 'marketrate-hotel' || runIndividualizer.responseItem['is_travel_bookable_deal']) {runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"discount_percent_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = JSON.parse(runIndividualizer.responseItem['value_array'])[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && data[index] > 0 && !isSalePriceInEffect && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = data[index] + '% ' + runIndividualizer.translations.discountBadgeText;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-discount-badge"},"required":!0},"is_bookable":{"property":"data-style","output_handler":"if (runIndividualizer.responseData) {runIndividualizer.element.style.display = 'flex';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-book-online-cta__container"},"required":!0},"is_travel_bookable_deal":{"property":"data-is-travel-bookable-deal","output_handler":"runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"med_image":{"property":"src","output_handler":"runIndividualizer.responseData = runIndividualizer.responseData.replace('t300x182.jpg', 'c349x211.webp');","run_condition":"","internal_selector":{"mode":"css","selection":".cui-image"},"required":!0},"merchant_name":{"property":"innerHTML","output_handler":"var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') < 0 && !isCashBackDeal && !isGetawaysDeal) {var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {runIndividualizer.element.classList.remove('one-line-truncate');var title = runIndividualizer.getTitle(runIndividualizer.responseItem);if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}runIndividualizer.responseData = title;}}var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.translations.memberPricing + ' ' + runIndividualizer.responseData;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-title"},"required":!0},"price_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);runIndividualizer.responseData = runIndividualizer.getFormattedPrice(data[index], runIndividualizer.responseItem['currency']);var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {var el = runIndividualizer.element.parentElement;el.classList.remove('c-txt-price');el.classList.add('cui-price-message', 'cui-price-hidden');el.innerHTML = runIndividualizer.translations.priceHidden;} else {if (isCashBackDeal) {runIndividualizer.responseData = runIndividualizer.getCashBack(runIndividualizer.responseItem);} else {if (data.length > 1) {var wrapEl = runIndividualizer.element.parentElement;var el = wrapEl.querySelector('.cui-price-discount .cui-price-descriptor:first-child');if (isSalePriceInEffect) {wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');wrapEl.closest('figure').querySelector('.cui-promotions .cui-offer div:first-child').innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';} else {el.innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';}el.style.display = 'block';}if (data.length === 1 && isSalePriceInEffect) {var wrapEl = runIndividualizer.element.parentElement;wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');}}var isCouponDeal = runIndividualizer.isCouponDeal(runIndividualizer.responseItem);if (isCouponDeal) {runIndividualizer.element.parentElement.parentElement.style.display = 'none';}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount span"},"required":!0},"purchases_total_displayed":{"property":"innerHTML","output_handler":"var num = runIndividualizer.responseData;var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (num > 10 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(num \/ 10) * 10) + '+ ' + runIndividualizer.translations.bought;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1},"rating_count":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_value']) {runIndividualizer.responseData = runIndividualizer.responseData + ' ' + runIndividualizer.translations.ratings;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .rating-count"},"required":!1},"rating_value":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_count']) {var value = runIndividualizer.responseData;var wrapEl = runIndividualizer.element.closest('.cui-review-rating');wrapEl.style.display = 'flex';var stars = wrapEl.querySelectorAll('ul li span');stars.forEach(function(el, num) {if (num + 0.8 <= value) {el.classList.value = 'full-star';} else if (num + 0.3 <= value) {el.classList.value = 'half-star';} else {el.classList.value = 'empty-star';}});} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .numeric-count"},"required":!1},"redemption_locations_short":{"property":"data-location","output_handler":"var locations = JSON.parse(runIndividualizer.responseData);var filteredLocations = [];locations.forEach(function(location) {if (location.hasOwnProperty('lat') && location.hasOwnProperty('lng')) {filteredLocations.push(location);}});locations = filteredLocations;if (locations.length > 0) {var location = runIndividualizer.getNearestLocation(locations);var address = [];if (location['streetAddress1']) {address.push(location['streetAddress1']);}if (location['city']) {address.push(location['city']);}var el = runIndividualizer.element.querySelector('.cui-location-name');if (el) {el.innerHTML = address.join(', ');}var distance = location['distanceInKm'];var unit = runIndividualizer.translations.distanceUnit;if (unit === 'mi') {distance = distance \/ 1.609;}distance = Math.round(distance * 10) \/ 10;var el = runIndividualizer.element.querySelector('.cui-location-distance');if (el) {el.innerHTML = distance + ' ' + unit;}runIndividualizer.element.style.display = 'block';} else {runIndividualizer.element.style.display = 'none';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-location"},"required":!1},"sale_price":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isSalePriceInEffect && !isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(runIndividualizer.responseData, runIndividualizer.responseItem['currency']);var wrapEl = runIndividualizer.element.parentElement;wrapEl.querySelector('.cui-verbose-urgency-text').innerHTML = runIndividualizer.translations.limitedTime;wrapEl.style.display = 'flex';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-offer .cui-verbose-urgency-price"},"required":!1},"title_general":{"property":"innerHTML","output_handler":"var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') >= 0) {var title = runIndividualizer.responseData.trim();if (title === '') {var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseItem['title_array']);var title = data[index];}if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}var el = runIndividualizer.element.closest('figure').querySelector('.cui-udc-title');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {el.classList.remove('one-line-truncate');if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}}el.innerHTML = title;runIndividualizer.responseData = '';} else {var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (isCashBackDeal) {runIndividualizer.element.classList.add('c-txt-gray-dk');runIndividualizer.responseData = runIndividualizer.translations.freeToClaim;} else {var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (['product_card_merchant_name_up'].indexOf(abTestGroup) >= 0 || isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.getTitle(runIndividualizer.responseItem);}if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0 && !isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.responseItem['merchant_name'];}}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-subtitle"},"required":!0},"url":{"property":"href","output_handler":"runIndividualizer.element.closest('.card-ui').setAttribute('data-clickurl', runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"value_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = data[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(originalPrice, runIndividualizer.responseItem['currency']);runIndividualizer.element.style.display = 'block';var refEl = runIndividualizer.element.nextElementSibling;refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML('<span>&nbsp;<\/span>'), refEl)} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-original"},"required":!0},"views_24h":{"property":"innerHTML","output_handler":"var numViews = runIndividualizer.responseData;var numPurchases = runIndividualizer.responseItem['purchases_total_displayed'];var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if ((!numPurchases || numPurchases <= 10) && numViews >= 150 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(numViews \/ 10) * 10) + '+ ' + runIndividualizer.translations.viewedToday;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1}}},"search":{"type":"recommendation","running":!0,"run_condition":"runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query && LS_Mustache_Params && LS_Mustache_Params.gigConfig && runIndividualizer.isPossibleToUseFilter(runIndividualizer.parseFilterParameters(decodeURIComponent(location.href)))","multiple":!0,"apply_only_last_request":!0,"root_selector":{"mode":"css","selection":"#pull-deal-feed"},"run_handler":"var css = runIndividualizer.createElementFromHTML(\"<style id='db_search_css'>#pull-deal-feed {visibility: hidden;}<\/style>\");document.querySelector('head').append(css);setTimeout(function() {var el = document.querySelector('#db_search_css');if (el) {el.remove();}}, 4000);","input_handler":"runIndividualizer.requestData.returnedAttributes = ['title_array', 'sale_price_start_at', 'sale_price_end_at', 'gallery_title', 'currency', 'category', 'inventory_service_id', 'restricted_reason', 'restricted', 'show_discount', 'deal_option_id_array', 'category_guids_object', 'category_guids', 'eligible_for_groupon_incentives', 'pds_id', 'channel_id', 'inventory_product_id'];runIndividualizer.requestData.output = ['scriptAbTest', 'mainAbTest'];runIndividualizer.ads = [];runIndividualizer.bandCards = null;runIndividualizer.requestData.contextVariables = runIndividualizer.getContextVariables();runIndividualizer.requestData.searchQuery = runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query.replace(\/\\+\/g, ' ');var abTestGroup = runIndividualizer.getAbTestGroupFromTheirAbTester();if (abTestGroup) {runIndividualizer.requestData.abTests = abTestGroup;}","received_response_handler":"if (!runIndividualizer.startTimeObserver) {runIndividualizer.startTimeObserver = new Date().getTime();}sessionStorage.setItem('db_abtests', JSON.stringify(runIndividualizer.abTests));runIndividualizer.getAndSavePurplePrices(runIndividualizer.idRequest);","before_render_handler":"runIndividualizer.cloneSponsoredDeals('search');if (runIndividualizer.ads.length === 0) {document.querySelectorAll('#pull-deal-feed .ai-inventory-placement-container').forEach(function(item) {runIndividualizer.ads.push(item.cloneNode(true));});}if (!runIndividualizer.bandCards) {var bandCardsEl = document.querySelector('#pull-deal-feed .card-ui.cui-c-band .cui-has-pills');if (bandCardsEl) {runIndividualizer.bandCards = bandCardsEl.closest('.card-ui.cui-c-band').cloneNode(true);}}var itemEl = \"<figure class='card-ui cui-c-udc price-badge-filled-background left-aligned-card is-getaways-booking has-additional-discount-percent' data-bhc=''><div class='cui-content'><a href=''><div class='cui-udc-image-container rounded-corners'><div class='cui-udc-image-overlay'><\/div><div class='cui-image-lazy-container cui-image-hover-zoom'><img class='cui-svg-placeholder' height='211' width='349'><img class='cui-image lazy-load lazy-loaded' data-ll-status='loaded' src='' style='position: absolute; top: 0;'><\/div><\/div><div class='cui-udc-details cui-udc-left-aligned-details'><div class='cui-single-section'><div class='cui-udc-title one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-location cui-truncate cui-has-distance' style='display: none;'><span class='cui-location-name'><\/span><span class='cui-location-separator'>\u2022<\/span><span class='cui-location-distance'><\/span><\/div><\/div><div class='cui-single-section'><div class='cui-review-rating' style='display: none;'><div aria-hidden='true' class='numeric-count'><\/div><ul class='rating rating-numeric'><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><\/ul><div class='rating-count'><\/div><\/div><\/div><div class='cui-bottom-body'><div class='cui-combined-section'><div class='cui-price' data-pingdom-id='deal-price'><div aria-hidden='true' class='cui-price-original c-txt-gray-dk' style='display: none;'><\/div><div aria-hidden='true' class='cui-price-discount c-txt-price'><div class='cui-price-descriptor' style='display: none;'><\/div><span><\/span><div class='cui-price-descriptor' style='display: none;'><\/div><\/div><\/div><div class='cui-promotions'><div class='cui-detail-badge cui-discount-badge' style='display: none;'><\/div><div class='cui-urgent cui-offer' style='display: none;'><div><\/div><div class='cui-verbose-urgency-price' aria-hidden='true'><\/div><div class='cui-verbose-urgency-text'><\/div><\/div><\/div><\/div><div class='cui-single-section'><div class='cui-udc-subtitle one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-urgency-message'><\/div><\/div><\/div><\/div><\/a><div class='cui-book-online-cta__container' style='display: none;'><a class='cui-book-online-cta' href=''>\" + runIndividualizer.translations.bookOnline + \"<\/a> <\/div><\/div><\/figure>\";var paginationEl = document.querySelector('#pull-pagination');if (paginationEl) {runIndividualizer.searchPaginationEl = paginationEl;paginationEl.parentElement.removeChild(paginationEl);}var rootEl = document.querySelector('#pull-deal-feed');rootEl.innerHTML = itemEl;if (runIndividualizer.startTimeObserver) {runDataGatherer.sendCustomEvent('search_observer_duration', 'inview', {'duration': (new Date().getTime() - runIndividualizer.startTimeObserver)});runIndividualizer.startTimeObserver = null;}","output_handler":"runIndividualizer.applySponsoredDeals('search');if (runIndividualizer.searchPaginationEl) {var rootEl = document.querySelector('#pull-deal-feed');rootEl.append(runIndividualizer.searchPaginationEl);runIndividualizer.searchPaginationEl = null;}var totalResultsEl = document.querySelector('#pull-pagination .results span');if (totalResultsEl) {var totalResults = runIndividualizer.totalResults[runIndividualizer.idRequest];totalResultsEl.childNodes[1].nodeValue = totalResultsEl.childNodes[1].nodeValue.replace(\/\\d+\/g, totalResults);runIndividualizer.hidePaginator(totalResults, 40);}var interval = setInterval(function() {var messages = document.querySelectorAll(\"#pull-deal-feed .cui-urgency-message\");if (messages[0].innerHTML === '') {clearInterval(interval);messages.forEach(function(el) {el.innerHTML = el.getAttribute('data-message');});}}, 100);setTimeout(function() {clearInterval(interval);}, 3000);runIndividualizer.addAds('search');runIndividualizer.initScrollTo();runIndividualizer.addBandCards('search');var el = document.querySelector('#db_search_css');if (el) {el.remove();};var rootEl = document.querySelector(\"#pull-deal-feed\");runIndividualizer.renderPurplePrices(runIndividualizer.idRequest, rootEl);","empty_response_handler":"var el = document.querySelector('#db_search_css');if (el) {el.remove();}runIndividualizer.startTimeObserver = null;","events":[{"type":["fetch"],"selector":{"mode":"css","selection":"html"},"input_handler":"var url = runIndividualizer.nativeEvent[0];if (url.indexOf('\/get-lazy-loaded-cards') > 0) {var parameters = runIndividualizer.parseFilterParameters(decodeURIComponent(url));if (runIndividualizer.isPossibleToUseFilter(parameters)) {if (parameters.page) {runIndividualizer.requestData.offset = (parseInt(parameters.page) - 1) * 40;}runIndividualizer.requestData.filter = runIndividualizer.getFilter(parameters);} else {runIndividualizer.lock = true;}} else {runIndividualizer.lock = true;}","timeout_handler":"if (!runIndividualizer.recommendations.hasOwnProperty(runIndividualizer.idRequest)) {runIndividualizer.startTimeObserver = null;}","observer":{"parent_selector":{"mode":"css","selection":"body"},"mutation_selector":{"mode":"css","selection":"#pull-deal-feed"}},"timeout":7000},{"type":["fetch"],"selector":{"mode":"css","selection":"body"},"input_handler":"var url = runIndividualizer.nativeEvent[0];if (url.indexOf('\/get-paginated-cards') > 0) {var parameters = runIndividualizer.parseFilterParameters(decodeURIComponent(url));if (runIndividualizer.isPossibleToUseFilter(parameters)) {if (parameters.page) {runIndividualizer.requestData.offset = (parseInt(parameters.page) - 1) * 40;}runIndividualizer.requestData.filter = runIndividualizer.getFilter(parameters);} else {runIndividualizer.lock = true;}} else {runIndividualizer.lock = true;}","timeout_handler":"if (!runIndividualizer.recommendations.hasOwnProperty(runIndividualizer.idRequest)) {runIndividualizer.startTimeObserver = null;}","observer":{"parent_selector":{"mode":"css","selection":"body"},"mutation_selector":{"mode":"css","selection":"#pull-deal-feed"}},"timeout":5000}],"item_attributes":{"_customer_item_id":{"property":"data-bhc","output_handler":"runIndividualizer.element.setAttribute('data-bhc', 'deal:' + runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":""},"required":!0},"channel":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseData === 'marketrate-hotel' || runIndividualizer.responseItem['is_travel_bookable_deal']) {runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"discount_percent_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = JSON.parse(runIndividualizer.responseItem['value_array'])[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && data[index] > 0 && !isSalePriceInEffect && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = data[index] + '% ' + runIndividualizer.translations.discountBadgeText;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-discount-badge"},"required":!0},"is_bookable":{"property":"data-style","output_handler":"if (runIndividualizer.responseData) {runIndividualizer.element.style.display = 'flex';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-book-online-cta__container"},"required":!0},"is_travel_bookable_deal":{"property":"data-is-travel-bookable-deal","output_handler":"runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"med_image":{"property":"src","output_handler":"runIndividualizer.responseData = runIndividualizer.responseData.replace('t300x182.jpg', 'c349x211.webp');","run_condition":"","internal_selector":{"mode":"css","selection":".cui-image"},"required":!0},"merchant_name":{"property":"innerHTML","output_handler":"var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') < 0 && !isCashBackDeal && !isGetawaysDeal) {var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {runIndividualizer.element.classList.remove('one-line-truncate');var title = runIndividualizer.getTitle(runIndividualizer.responseItem);if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}runIndividualizer.responseData = title;}}var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.translations.memberPricing + ' ' + runIndividualizer.responseData;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-title"},"required":!0},"price_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);runIndividualizer.responseData = runIndividualizer.getFormattedPrice(data[index], runIndividualizer.responseItem['currency']);var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {var el = runIndividualizer.element.parentElement;el.classList.remove('c-txt-price');el.classList.add('cui-price-message', 'cui-price-hidden');el.innerHTML = runIndividualizer.translations.priceHidden;} else {if (isCashBackDeal) {runIndividualizer.responseData = runIndividualizer.getCashBack(runIndividualizer.responseItem);} else {if (data.length > 1) {var wrapEl = runIndividualizer.element.parentElement;var el = wrapEl.querySelector('.cui-price-discount .cui-price-descriptor:first-child');if (isSalePriceInEffect) {wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');wrapEl.closest('figure').querySelector('.cui-promotions .cui-offer div:first-child').innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';} else {el.innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';}el.style.display = 'block';}if (data.length === 1 && isSalePriceInEffect) {var wrapEl = runIndividualizer.element.parentElement;wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');}}var isCouponDeal = runIndividualizer.isCouponDeal(runIndividualizer.responseItem);if (isCouponDeal) {runIndividualizer.element.parentElement.parentElement.style.display = 'none';}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount span"},"required":!0},"purchases_total_displayed":{"property":"innerHTML","output_handler":"var num = runIndividualizer.responseData;var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (num > 10 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(num \/ 10) * 10) + '+ ' + runIndividualizer.translations.bought;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1},"rating_count":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_value']) {runIndividualizer.responseData = runIndividualizer.responseData + ' ' + runIndividualizer.translations.ratings;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .rating-count"},"required":!1},"rating_value":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_count']) {var value = runIndividualizer.responseData;var wrapEl = runIndividualizer.element.closest('.cui-review-rating');wrapEl.style.display = 'flex';var stars = wrapEl.querySelectorAll('ul li span');stars.forEach(function(el, num) {if (num + 0.8 <= value) {el.classList.value = 'full-star';} else if (num + 0.3 <= value) {el.classList.value = 'half-star';} else {el.classList.value = 'empty-star';}});} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .numeric-count"},"required":!1},"redemption_locations_short":{"property":"data-location","output_handler":"var locations = JSON.parse(runIndividualizer.responseData);var filteredLocations = [];locations.forEach(function(location) {if (location.hasOwnProperty('lat') && location.hasOwnProperty('lng')) {filteredLocations.push(location);}});locations = filteredLocations;if (locations.length > 0) {var location = runIndividualizer.getNearestLocation(locations);var address = [];if (location['streetAddress1']) {address.push(location['streetAddress1']);}if (location['city']) {address.push(location['city']);}var el = runIndividualizer.element.querySelector('.cui-location-name');if (el) {el.innerHTML = address.join(', ');}var distance = location['distanceInKm'];var unit = runIndividualizer.translations.distanceUnit;if (unit === 'mi') {distance = distance \/ 1.609;}distance = Math.round(distance * 10) \/ 10;var el = runIndividualizer.element.querySelector('.cui-location-distance');if (el) {el.innerHTML = distance + ' ' + unit;}runIndividualizer.element.style.display = 'block';} else {runIndividualizer.element.style.display = 'none';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-location"},"required":!1},"sale_price":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isSalePriceInEffect && !isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(runIndividualizer.responseData, runIndividualizer.responseItem['currency']);var wrapEl = runIndividualizer.element.parentElement;wrapEl.querySelector('.cui-verbose-urgency-text').innerHTML = runIndividualizer.translations.limitedTime;wrapEl.style.display = 'flex';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-offer .cui-verbose-urgency-price"},"required":!1},"title_general":{"property":"innerHTML","output_handler":"var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') >= 0) {var title = runIndividualizer.responseData.trim();if (title === '') {var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseItem['title_array']);var title = data[index];}if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}var el = runIndividualizer.element.closest('figure').querySelector('.cui-udc-title');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {el.classList.remove('one-line-truncate');if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}}el.innerHTML = title;runIndividualizer.responseData = '';} else {var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (isCashBackDeal) {runIndividualizer.element.classList.add('c-txt-gray-dk');runIndividualizer.responseData = runIndividualizer.translations.freeToClaim;} else {var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (['product_card_merchant_name_up'].indexOf(abTestGroup) >= 0 || isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.getTitle(runIndividualizer.responseItem);}if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0 && !isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.responseItem['merchant_name'];}}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-subtitle"},"required":!0},"url":{"property":"href","output_handler":"","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"value_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = data[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(originalPrice, runIndividualizer.responseItem['currency']);runIndividualizer.element.style.display = 'block';var refEl = runIndividualizer.element.nextElementSibling;refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML('<span>&nbsp;<\/span>'), refEl)} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-original"},"required":!0},"views_24h":{"property":"innerHTML","output_handler":"var numViews = runIndividualizer.responseData;var numPurchases = runIndividualizer.responseItem['purchases_total_displayed'];var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if ((!numPurchases || numPurchases <= 10) && numViews >= 150 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(numViews \/ 10) * 10) + '+ ' + runIndividualizer.translations.viewedToday;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1}}},"search_autocomplete":{"type":"recommendation","running":!0,"run_condition":"LS_Mustache_Params && LS_Mustache_Params.gigConfig","multiple":!0,"apply_only_last_request":!0,"root_selector":{"mode":"css","selection":"#db_search_autocomplete"},"run_handler":"var css = runIndividualizer.createElementFromHTML(\"<style id='db_search_autocomplete_css'>#ls-landing-search-form{position: relative;} #ls-search-form{position: relative;}<\/style>\");document.querySelector('head').append(css);","input_handler":"runIndividualizer.requestData.returnedAttributes = ['title_array', 'sale_price_start_at', 'sale_price_end_at', 'category', 'gallery_title', 'currency', 'category', 'inventory_service_id', 'restricted_reason', 'restricted', 'show_discount'];runIndividualizer.requestData.output = ['scriptAbTest', 'mainAbTest'];runIndividualizer.requestData.contextVariables = runIndividualizer.getContextVariables();var el = document.querySelector('#db_search_autocomplete');if (!el) {if (location.host.slice(-4) === '.com' && location.pathname === '\/') {var positionEl = \"<div class='css-1dbjc4n r-1bc1wpz r-kdyh1x r-pk4gcj r-1d2f490 r-t60dpp r-u8s1d r-nzzf0n r-l13dpy' id='db_search_autocomplete_wrap' style='display: none;'><div class='css-1dbjc4n r-1l7z4oj r-5njf8e'><div class='css-1dbjc4n' id='db_search_autocomplete'><\/div><\/div><\/div>\";if (document.documentElement.scrollTop > 132) {var refEl = document.querySelector('#ls-search-form');if (refEl) {refEl.prepend(runIndividualizer.createElementFromHTML(positionEl));var el = document.querySelector('#db_search_autocomplete_wrap');el.style.top = '47px';} else {runIndividualizer.lock = true;}} else {var refEl = document.querySelector('#ls-landing-search-form');if (refEl) {refEl.prepend(runIndividualizer.createElementFromHTML(positionEl));var el = document.querySelector('#db_search_autocomplete_wrap');el.style.top = '102px';el.style.width = '100%';} else {runIndividualizer.lock = true;}}} else {var refEl = document.querySelector('#ls-search-form .deal-search');if (refEl) {var positionEl = \"<div class='css-1dbjc4n r-1bc1wpz r-kdyh1x r-pk4gcj r-1d2f490 r-t60dpp r-u8s1d r-nzzf0n r-1j2mdbw r-l13dpy' id='db_search_autocomplete_wrap' style='display: none; box-shadow: rgb(0 0 0 \/ 20%) 0px 2px 8px 0px; top: 47px;'><div class='css-1dbjc4n r-1l7z4oj r-5njf8e'><div class='css-1dbjc4n' id='db_search_autocomplete'><\/div><\/div><\/div>\";refEl.append(runIndividualizer.createElementFromHTML(positionEl));} else {refEl = document.querySelector('#ls-search-form');if (refEl) {var positionEl = \"<div class='css-1dbjc4n r-1bc1wpz r-kdyh1x r-pk4gcj r-1d2f490 r-t60dpp r-u8s1d r-nzzf0n r-l13dpy' id='db_search_autocomplete_wrap' style='display: none; box-shadow: rgb(0 0 0 \/ 20%) 0px 2px 8px 0px; top: 47px;'><div class='css-1dbjc4n r-1l7z4oj r-5njf8e'><div class='css-1dbjc4n' id='db_search_autocomplete'><\/div><\/div><\/div>\";refEl.prepend(runIndividualizer.createElementFromHTML(positionEl));} else {runIndividualizer.lock = true;}}}}var abTestGroup = runIndividualizer.getAbTestGroupFromTheirAbTester();if (abTestGroup) {runIndividualizer.requestData.abTests = abTestGroup;}","received_response_handler":"sessionStorage.setItem('db_abtests', JSON.stringify(runIndividualizer.abTests));","before_render_handler":"var el = document.querySelector('#db_search_autocomplete');el.innerHTML = \"<div class='css-1dbjc4n r-1loqt21 r-o7ynqc r-1j63xyz'><div style='padding-top: 8px; padding-bottom: 8px;'><a href='' style='color: black; padding-left: 20px; display: flex; text-decoration: none;'><div><img src='' style='border-radius: 6px; width: 165px; max-width: unset;'><\/div><div style='padding-left: 6px;'><div class='cui-udc-title' style='font-weight: 700; text-overflow: ellipsis;display: -webkit-box;-webkit-line-clamp: 1;-webkit-box-orient: vertical;overflow: hidden; padding-right: 20px;'><\/div><div class='cui-udc-subtitle' style='text-overflow: ellipsis;display: -webkit-box;-webkit-line-clamp: 1;-webkit-box-orient: vertical;overflow: hidden; padding-right: 20px;'><\/div><div class='cui-single-section' style='text-overflow: ellipsis;display: -webkit-box;-webkit-line-clamp: 1;-webkit-box-orient: vertical;overflow: hidden; padding-right: 20px;'><div class='cui-location cui-has-distance' style='display: none;'><span class='cui-location-name'><\/span><span class='cui-location-separator'> \u2022 <\/span><span class='cui-location-distance'><\/span><\/div><\/div><div class='cui-single-section'><div class='cui-review-rating' style='display: none;'><div aria-hidden='true' class='numeric-count'><\/div><ul class='rating rating-numeric'><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><\/ul><div class='rating-count'><\/div><\/div><\/div><div class='card-ui cui-c-udc price-badge-filled-background' style='background: transparent; padding-left: 0; margin: 0;'><div class='cui-bottom-body'><div class='cui-combined-section'><div class='cui-price' data-pingdom-id='deal-price'><div aria-hidden='true' class='cui-price-original c-txt-gray-dk' style='display: none;'><\/div><div aria-hidden='true' class='cui-price-discount c-txt-price'><div class='cui-price-descriptor' style='display: none;'><\/div><span><\/span><div class='cui-price-descriptor' style='display: none;'><\/div><\/div><\/div><div class='cui-promotions'><div class='cui-detail-badge cui-discount-badge' style='display: none;'><\/div><div class='cui-urgent cui-offer' style='display: none;'><div><\/div><div aria-hidden='true' class='cui-verbose-urgency-price'><\/div><div class='cui-verbose-urgency-text'><\/div><\/div><\/div><\/div><div class='cui-single-section'><div class='cui-urgency-message'><\/div><\/div><\/div><\/div><\/div><\/a><\/div><\/div>\";","output_handler":"var el = document.querySelector('#db_search_autocomplete_css');if (!el) {var css = runIndividualizer.createElementFromHTML(\"<style id='db_search_autocomplete_css'>#ls-search-results {display: none;}#ls-landing-search-form{position: relative;}#ls-search-form{position: relative;}<\/style>\");document.querySelector('head').append(css);}el = document.querySelector('#db_search_autocomplete_wrap');el.style.display = 'block';el.querySelectorAll('#db_search_autocomplete > div').forEach(function(element) {element.addEventListener('mouseenter', function(event) {event.target.classList.add('r-1hnbk7c');});});el.querySelectorAll('#db_search_autocomplete > div').forEach(function(element) {element.addEventListener('mouseleave', function(event) {event.target.classList.remove('r-1hnbk7c');});});if (!runIndividualizer.searchAutocompleteInitialized) {runIndividualizer.searchAutocompleteInitialized = true;document.querySelector('body').addEventListener('click', function(event) {if (!event.target.closest('#db_search_autocomplete_wrap, #ls-search')) {var el = document.getElementById('db_search_autocomplete_wrap');if (el) {el.style.display = 'none';}}});var inputElArray = [];var inputEl = document.querySelector('#ls-search');if (inputEl) {inputElArray.push(inputEl);}if (location.host.slice(-4) === '.com' && location.pathname === '\/') {inputElArray.push(document.querySelector('#ls-search-landing'));}inputElArray.forEach(function(inputEl) {inputEl.addEventListener('keyup', function(event) {if (event.keyCode === 27) {var el = document.getElementById('db_search_autocomplete_wrap');if (el) {el.style.display = 'none';}}});inputEl.addEventListener('keydown', function(event) {var activeEl = document.querySelector('#db_search_autocomplete .r-1hnbk7c');var elements = [].slice.call(document.querySelectorAll('#db_search_autocomplete > div'));var count = elements.length;var index;if (event.keyCode === 40) {if (!activeEl) {elements[0].classList.add('r-1hnbk7c');} else {elements.some(function(element, number) {if (element.classList.contains('r-1hnbk7c')) {element.classList.remove('r-1hnbk7c');index = (number === (count - 1) ? 0 : (number + 1));elements[index].classList.add('r-1hnbk7c');return true;}});}}if (event.keyCode === 38) {if (!activeEl) {elements[elements.length - 1].classList.add('r-1hnbk7c');} else {elements.some(function(element, number) {if (element.classList.contains('r-1hnbk7c')) {element.classList.remove('r-1hnbk7c');index = (number === 0 ? (count - 1) : (number - 1));elements[index].classList.add('r-1hnbk7c');return true;}});}}if (event.keyCode === 13) {var activeEl = document.querySelector('#db_search_autocomplete .r-1hnbk7c a');if (activeEl) {activeEl.click();e.preventDefault();e.stopPropagation();return false;}}});});var formElArray = [];var formEl = document.querySelector('#ls-search-form');if (formEl) {formElArray.push(formEl);}if (location.host.slice(-4) === '.com' && location.pathname === '\/') {formElArray.push(document.querySelector('#ls-landing-search-form'));}formElArray.forEach(function(formEl) {formEl.addEventListener('submit', function(event) {var activeEl = document.querySelector('#db_search_autocomplete .r-1hnbk7c');var wrapEl = document.querySelector('#db_search_autocomplete_wrap');if (activeEl && wrapEl.style.display === 'block') {event.preventDefault();event.stopPropagation();return false;}});formEl.addEventListener('keydown', function(event) {var activeEl = document.querySelector('#db_search_autocomplete .r-1hnbk7c');var wrapEl = document.querySelector('#db_search_autocomplete_wrap');if (activeEl && wrapEl.style.display === 'block') {event.preventDefault();event.stopPropagation();return false;}});});if (location.host.slice(-4) === '.com' && location.pathname === '\/') {window.addEventListener('scroll', function() {if (document.documentElement.scrollTop > 132) {var el = document.querySelector('#ls-landing-search-form #db_search_autocomplete_wrap');if (el) {el.style.top = '47px';document.querySelector('#ls-search-form').prepend(el)}} else {var el = document.querySelector('#ls-search-form #db_search_autocomplete_wrap');if (el) {el.style.top = '102px';el.style.width = '100%';document.querySelector('#ls-landing-search-form').prepend(el)}}});}}","empty_response_handler":"var el = document.querySelector('#db_search_autocomplete_wrap');el.style.display = 'none';el = document.querySelector('#db_search_autocomplete_css');if (el) {el.remove();}","events":[{"type":["input","focus"],"selector":{"mode":"css","selection":"#ls-search, #ls-search-landing"},"input_handler":"runIndividualizer.requestData.searchQuery = runIndividualizer.element.value;","timeout_handler":"if (!runIndividualizer.recommendations.hasOwnProperty(runIndividualizer.idRequest)) {var el = document.querySelector('#db_search_autocomplete_wrap');el.style.display = 'none';el = document.querySelector('#db_search_autocomplete_css');if (el) {el.remove();}}","timeout":6000,"merge_time":300}],"item_attributes":{"_customer_item_id":{"property":"data-bhc","output_handler":"runIndividualizer.element.setAttribute('data-bhc', 'deal:' + runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"channel":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseData === 'marketrate-hotel' || runIndividualizer.responseItem['is_travel_bookable_deal']) {runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"discount_percent_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = JSON.parse(runIndividualizer.responseItem['value_array'])[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && data[index] > 0 && !isSalePriceInEffect && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = data[index] + '% ' + runIndividualizer.translations.discountBadgeText;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-discount-badge"},"required":!0},"is_travel_bookable_deal":{"property":"data-is-travel-bookable-deal","output_handler":"runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"med_image":{"property":"src","output_handler":"runIndividualizer.responseData = runIndividualizer.responseData.replace('t300x182.jpg', 'c349x211.webp');","run_condition":"","internal_selector":{"mode":"css","selection":"img"},"required":!0},"merchant_name":{"property":"innerHTML","output_handler":"var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') < 0 && !isCashBackDeal && !isGetawaysDeal) {var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {runIndividualizer.element.classList.remove('one-line-truncate');var title = runIndividualizer.getTitle(runIndividualizer.responseItem);if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}runIndividualizer.responseData = title;}}var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.translations.memberPricing + ' ' + runIndividualizer.responseData;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-title"},"required":!0},"price_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);runIndividualizer.responseData = runIndividualizer.getFormattedPrice(data[index], runIndividualizer.responseItem['currency']);var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {var el = runIndividualizer.element.parentElement;el.classList.remove('c-txt-price');el.classList.add('cui-price-message', 'cui-price-hidden');el.innerHTML = runIndividualizer.translations.priceHidden;} else {if (isCashBackDeal) {runIndividualizer.responseData = runIndividualizer.getCashBack(runIndividualizer.responseItem);} else {if (data.length > 1) {var wrapEl = runIndividualizer.element.parentElement;var el = wrapEl.querySelector('.cui-price-discount .cui-price-descriptor:first-child');if (isSalePriceInEffect) {wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');wrapEl.closest('a').querySelector('.cui-promotions .cui-offer div:first-child').innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';} else {el.innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';}el.style.display = 'block';}if (data.length === 1 && isSalePriceInEffect) {var wrapEl = runIndividualizer.element.parentElement;wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');}}var isCouponDeal = runIndividualizer.isCouponDeal(runIndividualizer.responseItem);if (isCouponDeal) {runIndividualizer.element.parentElement.parentElement.style.display = 'none';}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount span"},"required":!0},"rating_count":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_value']) {runIndividualizer.responseData = runIndividualizer.responseData + ' ' + runIndividualizer.translations.ratings;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .rating-count"},"required":!1},"rating_value":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_count']) {var value = runIndividualizer.responseData;var wrapEl = runIndividualizer.element.closest('.cui-review-rating');wrapEl.style.display = 'flex';var stars = wrapEl.querySelectorAll('ul li span');stars.forEach(function(el, num) {if (num + 0.8 <= value) {el.classList.value = 'full-star';} else if (num + 0.3 <= value) {el.classList.value = 'half-star';} else {el.classList.value = 'empty-star';}});} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .numeric-count"},"required":!1},"redemption_locations_short":{"property":"data-location","output_handler":"var locations = JSON.parse(runIndividualizer.responseData);var filteredLocations = [];locations.forEach(function(location) {if (location.hasOwnProperty('lat') && location.hasOwnProperty('lng')) {filteredLocations.push(location);}});locations = filteredLocations;if (locations.length > 0) {var location = runIndividualizer.getNearestLocation(locations);var address = [];if (location['streetAddress1']) {address.push(location['streetAddress1']);}if (location['city']) {address.push(location['city']);}var el = runIndividualizer.element.querySelector('.cui-location-name');if (el) {el.innerHTML = address.join(', ');}var distance = location['distanceInKm'];var unit = runIndividualizer.translations.distanceUnit;if (unit === 'mi') {distance = distance \/ 1.609;}distance = Math.round(distance * 10) \/ 10;var el = runIndividualizer.element.querySelector('.cui-location-distance');if (el) {el.innerHTML = distance + ' ' + unit;}runIndividualizer.element.style.display = 'block';} else {runIndividualizer.element.style.display = 'none';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-location"},"required":!1},"sale_price":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isSalePriceInEffect && !isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(runIndividualizer.responseData, runIndividualizer.responseItem['currency']);var wrapEl = runIndividualizer.element.parentElement;wrapEl.querySelector('.cui-verbose-urgency-text').innerHTML = runIndividualizer.translations.limitedTime;wrapEl.style.display = 'flex';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-offer .cui-verbose-urgency-price"},"required":!1},"title_general":{"property":"innerHTML","output_handler":"var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') >= 0) {var title = runIndividualizer.responseData.trim();if (title === '') {var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseItem['title_array']);var title = data[index];}if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}var el = runIndividualizer.element.closest('a').querySelector('.cui-udc-title');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {el.classList.remove('one-line-truncate');if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}}el.innerHTML = title;runIndividualizer.responseData = '';} else {var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (isCashBackDeal) {runIndividualizer.element.classList.add('c-txt-gray-dk');runIndividualizer.responseData = runIndividualizer.translations.freeToClaim;} else {var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (['product_card_merchant_name_up'].indexOf(abTestGroup) >= 0 || isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.getTitle(runIndividualizer.responseItem);}if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0 && !isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.responseItem['merchant_name'];}}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-subtitle"},"required":!0},"url":{"property":"href","output_handler":"","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"value_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = data[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(originalPrice, runIndividualizer.responseItem['currency']);runIndividualizer.element.style.display = 'block';var refEl = runIndividualizer.element.nextElementSibling;if (refEl.tagName === 'DIV') {refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML('<span>&nbsp;<\/span>'), refEl)}} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-original"},"required":!0}}},"search_autocomplete_mobile":{"type":"recommendation","running":!0,"run_condition":"LS_Mustache_Params && LS_Mustache_Params.mobileConfig","multiple":!0,"apply_only_last_request":!0,"root_selector":{"mode":"css","selection":"#db_search_autocomplete_mobile"},"run_handler":"var css = runIndividualizer.createElementFromHTML(\"<style id='db_search_autocomplete_mobile_css'><\/style>\");document.querySelector('head').append(css);","input_handler":"runIndividualizer.requestData.returnedAttributes = ['title_array', 'sale_price_start_at', 'sale_price_end_at', 'category', 'gallery_title', 'currency', 'category', 'inventory_service_id', 'restricted_reason', 'restricted', 'show_discount'];runIndividualizer.requestData.output = ['scriptAbTest', 'mainAbTest'];runIndividualizer.requestData.contextVariables = runIndividualizer.getContextVariables();var el = document.querySelector('#db_search_autocomplete_mobile');if (!el) {var refEl = document.querySelector('#ls-search-results');if (refEl) {var positionEl = \"<div id='db_search_autocomplete_mobile_wrap' style='display: none;'><div class='css-1dbjc4n' id='db_search_autocomplete_mobile'><\/div><\/div>\";refEl.append(runIndividualizer.createElementFromHTML(positionEl));}}var abTestGroup = runIndividualizer.getAbTestGroupFromTheirAbTester();if (abTestGroup) {runIndividualizer.requestData.abTests = abTestGroup;}","received_response_handler":"sessionStorage.setItem('db_abtests', JSON.stringify(runIndividualizer.abTests));","before_render_handler":"var el = document.querySelector('#db_search_autocomplete_mobile');el.innerHTML = \"<div class='css-1dbjc4n r-1loqt21 r-o7ynqc r-1j63xyz'><div style='padding-top: 8px; padding-bottom: 8px;'><a href='' style='color: black; padding-left: 20px; display: flex;'><div><img src='' style='border-radius: 6px; max-width: unset; width: 150px;'><\/div><div style='padding-left: 6px;'><div class='cui-udc-title' style='font-weight: 700; text-overflow: ellipsis;display: -webkit-box;-webkit-line-clamp: 1;-webkit-box-orient: vertical;overflow: hidden; padding-right: 20px;'><\/div><div class='cui-udc-subtitle' style='text-overflow: ellipsis;display: -webkit-box;-webkit-line-clamp: 1;-webkit-box-orient: vertical;overflow: hidden; padding-right: 20px;'><\/div><div class='cui-single-section' style='text-overflow: ellipsis;display: -webkit-box;-webkit-line-clamp: 1;-webkit-box-orient: vertical;overflow: hidden; padding-right: 20px;'><div class='cui-location cui-has-distance' style='display: none;'><span class='cui-location-name'><\/span><span class='cui-location-separator'> \u2022 <\/span><span class='cui-location-distance'><\/span><\/div><\/div><div class='cui-single-section'><div class='cui-review-rating' style='display: none;'><div aria-hidden='true' class='numeric-count'><\/div><ul class='rating rating-numeric'><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><\/ul><div class='rating-count'><\/div><\/div><\/div><div class='card-ui cui-c-udc price-badge-filled-background' style='background: transparent; padding-left: 0; margin: 0;'><div class='cui-bottom-body'><div class='cui-combined-section'><div class='cui-price' data-pingdom-id='deal-price'><div aria-hidden='true' class='cui-price-original c-txt-gray-dk' style='display: none;'><\/div><div aria-hidden='true' class='cui-price-discount c-txt-price'><div class='cui-price-descriptor' style='display: none;'><\/div><span><\/span><div class='cui-price-descriptor' style='display: none;'><\/div><\/div><\/div><div class='cui-promotions'><div class='cui-detail-badge cui-discount-badge' style='display: none;'><\/div><div class='cui-urgent cui-offer' style='display: none;'><div><\/div><div aria-hidden='true' class='cui-verbose-urgency-price'><\/div><div class='cui-verbose-urgency-text'><\/div><\/div><\/div><\/div><div class='cui-single-section'><div class='cui-urgency-message'><\/div><\/div><\/div><\/div><\/div><\/a><\/div><\/div>\";","output_handler":"var el = document.querySelector('#db_search_autocomplete_mobile_css');if (!el) {var css = runIndividualizer.createElementFromHTML(\"<style id='db_search_autocomplete_mobile_css'><\/style>\");document.querySelector('head').append(css);}el = document.querySelector('#db_search_autocomplete_mobile_wrap');el.style.display = 'block';if (!runIndividualizer.searchAutocompleteInitialized) {runIndividualizer.searchAutocompleteInitialized = true;document.querySelector('body').addEventListener('click', function(event) {if (!event.target.closest('#db_search_autocomplete_mobile_wrap, #ls-search')) {var el = document.getElementById('db_search_autocomplete_mobile_wrap');if (el) {el.style.display = 'none';}}});var formEl = document.querySelector('#ls-search-form');if (formEl) {formEl.addEventListener('submit', function(event) {var activeEl = document.querySelector('#db_search_autocomplete_mobile .r-1hnbk7c');var wrapEl = document.querySelector('#db_search_autocomplete_mobile_wrap');if (activeEl && wrapEl.style.display === 'block') {event.preventDefault();event.stopPropagation();return false;}});}}","empty_response_handler":"var el = document.querySelector('#db_search_autocomplete_mobile_wrap');el.style.display = 'none';el = document.querySelector('#db_search_autocomplete_mobile_css');if (el) {el.remove();}","events":[{"type":["input","focus"],"selector":{"mode":"css","selection":"#ls-deal-search-input"},"input_handler":"runIndividualizer.requestData.searchQuery = runIndividualizer.element.value;","timeout_handler":"if (!runIndividualizer.recommendations.hasOwnProperty(runIndividualizer.idRequest)) {var el = document.querySelector('#db_search_autocomplete_mobile_wrap');if (el) {el.style.display = 'none';}el = document.querySelector('#db_search_autocomplete_mobile_css');if (el) {el.remove();}}","timeout":6000,"merge_time":300}],"item_attributes":{"_customer_item_id":{"property":"data-bhc","output_handler":"runIndividualizer.element.setAttribute('data-bhc', 'deal:' + runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"channel":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseData === 'marketrate-hotel' || runIndividualizer.responseItem['is_travel_bookable_deal']) {runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"discount_percent_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = JSON.parse(runIndividualizer.responseItem['value_array'])[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && data[index] > 0 && !isSalePriceInEffect && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = data[index] + '% ' + runIndividualizer.translations.discountBadgeText;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-discount-badge"},"required":!0},"is_travel_bookable_deal":{"property":"data-is-travel-bookable-deal","output_handler":"runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"med_image":{"property":"src","output_handler":"runIndividualizer.responseData = runIndividualizer.responseData.replace('t300x182.jpg', 'c349x211.webp');","run_condition":"","internal_selector":{"mode":"css","selection":"img"},"required":!0},"merchant_name":{"property":"innerHTML","output_handler":"var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') < 0 && !isCashBackDeal && !isGetawaysDeal) {var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {runIndividualizer.element.classList.remove('one-line-truncate');var title = runIndividualizer.getTitle(runIndividualizer.responseItem);if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}runIndividualizer.responseData = title;}}var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.translations.memberPricing + ' ' + runIndividualizer.responseData;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-title"},"required":!0},"price_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);runIndividualizer.responseData = runIndividualizer.getFormattedPrice(data[index], runIndividualizer.responseItem['currency']);var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {var el = runIndividualizer.element.parentElement;el.classList.remove('c-txt-price');el.classList.add('cui-price-message', 'cui-price-hidden');el.innerHTML = runIndividualizer.translations.priceHidden;} else {if (isCashBackDeal) {runIndividualizer.responseData = runIndividualizer.getCashBack(runIndividualizer.responseItem);} else {if (data.length > 1) {var wrapEl = runIndividualizer.element.parentElement;var el = wrapEl.querySelector('.cui-price-discount .cui-price-descriptor:first-child');if (isSalePriceInEffect) {wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');wrapEl.closest('a').querySelector('.cui-promotions .cui-offer div:first-child').innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';} else {el.innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';}el.style.display = 'block';}if (data.length === 1 && isSalePriceInEffect) {var wrapEl = runIndividualizer.element.parentElement;wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');}}var isCouponDeal = runIndividualizer.isCouponDeal(runIndividualizer.responseItem);if (isCouponDeal) {runIndividualizer.element.parentElement.parentElement.style.display = 'none';}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount span"},"required":!0},"rating_count":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_value']) {runIndividualizer.responseData = runIndividualizer.responseData + ' ' + runIndividualizer.translations.ratings;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .rating-count"},"required":!1},"rating_value":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_count']) {var value = runIndividualizer.responseData;var wrapEl = runIndividualizer.element.closest('.cui-review-rating');wrapEl.style.display = 'flex';var stars = wrapEl.querySelectorAll('ul li span');stars.forEach(function(el, num) {if (num + 0.8 <= value) {el.classList.value = 'full-star';} else if (num + 0.3 <= value) {el.classList.value = 'half-star';} else {el.classList.value = 'empty-star';}});} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .numeric-count"},"required":!1},"redemption_locations_short":{"property":"data-location","output_handler":"var locations = JSON.parse(runIndividualizer.responseData);var filteredLocations = [];locations.forEach(function(location) {if (location.hasOwnProperty('lat') && location.hasOwnProperty('lng')) {filteredLocations.push(location);}});locations = filteredLocations;if (locations.length > 0) {var location = runIndividualizer.getNearestLocation(locations);var address = [];if (location['streetAddress1']) {address.push(location['streetAddress1']);}if (location['city']) {address.push(location['city']);}var el = runIndividualizer.element.querySelector('.cui-location-name');if (el) {el.innerHTML = address.join(', ');}var distance = location['distanceInKm'];var unit = runIndividualizer.translations.distanceUnit;if (unit === 'mi') {distance = distance \/ 1.609;}distance = Math.round(distance * 10) \/ 10;var el = runIndividualizer.element.querySelector('.cui-location-distance');if (el) {el.innerHTML = distance + ' ' + unit;}runIndividualizer.element.style.display = 'block';} else {runIndividualizer.element.style.display = 'none';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-location"},"required":!1},"sale_price":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isSalePriceInEffect && !isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(runIndividualizer.responseData, runIndividualizer.responseItem['currency']);var wrapEl = runIndividualizer.element.parentElement;wrapEl.querySelector('.cui-verbose-urgency-text').innerHTML = runIndividualizer.translations.limitedTime;wrapEl.style.display = 'flex';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-offer .cui-verbose-urgency-price"},"required":!1},"title_general":{"property":"innerHTML","output_handler":"var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') >= 0) {var title = runIndividualizer.responseData.trim();if (title === '') {var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseItem['title_array']);var title = data[index];}if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}var el = runIndividualizer.element.closest('a').querySelector('.cui-udc-title');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {el.classList.remove('one-line-truncate');if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}}el.innerHTML = title;runIndividualizer.responseData = '';} else {var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (isCashBackDeal) {runIndividualizer.element.classList.add('c-txt-gray-dk');runIndividualizer.responseData = runIndividualizer.translations.freeToClaim;} else {var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (['product_card_merchant_name_up'].indexOf(abTestGroup) >= 0 || isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.getTitle(runIndividualizer.responseItem);}if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0 && !isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.responseItem['merchant_name'];}}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-subtitle"},"required":!0},"url":{"property":"href","output_handler":"","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"value_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = data[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(originalPrice, runIndividualizer.responseItem['currency']);runIndividualizer.element.style.display = 'block';var refEl = runIndividualizer.element.nextElementSibling;if (refEl.tagName === 'DIV') {refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML('<span>&nbsp;<\/span>'), refEl)}} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-original"},"required":!0}}},"search_mobile":{"type":"recommendation","running":!0,"run_condition":"runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query && LS_Mustache_Params && LS_Mustache_Params.mobileConfig && runIndividualizer.isPossibleToUseFilter(runIndividualizer.parseFilterParameters(decodeURIComponent(location.href)))","multiple":!0,"apply_only_last_request":!0,"root_selector":{"mode":"css","selection":"#pull-mobile-cards"},"run_handler":"var css = runIndividualizer.createElementFromHTML(\"<style id='db_search_mobile_css'>#pull-mobile-cards, #pull-mobile-no-cards {visibility: hidden;}<\/style>\");document.querySelector('head').append(css);","input_handler":"runIndividualizer.requestData.returnedAttributes = ['title_array', 'sale_price_start_at', 'sale_price_end_at', 'gallery_title', 'currency', 'category', 'inventory_service_id', 'restricted_reason', 'restricted', 'show_discount', 'deal_option_id_array', 'category_guids_object', 'category_guids', 'eligible_for_groupon_incentives', 'pds_id', 'channel_id', 'inventory_product_id'];runIndividualizer.requestData.output = ['scriptAbTest', 'mainAbTest'];runIndividualizer.ads = [];runIndividualizer.bandCards = null;runIndividualizer.requestData.contextVariables = runIndividualizer.getContextVariables();runIndividualizer.requestData.searchQuery = runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query;var abTestGroup = runIndividualizer.getAbTestGroupFromTheirAbTester();if (abTestGroup) {runIndividualizer.requestData.abTests = abTestGroup;}","received_response_handler":"if (!runIndividualizer.startTimeObserver) {runIndividualizer.startTimeObserver = new Date().getTime();}sessionStorage.setItem('db_abtests', JSON.stringify(runIndividualizer.abTests));runIndividualizer.getAndSavePurplePrices(runIndividualizer.idRequest);","before_render_handler":"runIndividualizer.cloneSponsoredDeals('search_mobile');if (runIndividualizer.ads.length === 0) {document.querySelectorAll('#pull-mobile-cards .ai-inventory-placement-container').forEach(function(item) {runIndividualizer.ads.push(item.cloneNode(true));});}if (!runIndividualizer.bandCards) {var bandCardsEl = document.querySelector('#pull-mobile-cards .card-ui.cui-c-band .cui-has-pills');if (bandCardsEl) {runIndividualizer.bandCards = bandCardsEl.closest('.card-ui.cui-c-band').cloneNode(true);}}var itemEl = \"<figure class='card-ui cui-c-udc price-badge-filled-background left-aligned-card is-getaways-booking has-additional-discount-percent' data-bhc=''><div class='cui-content'><a href=''><div class='cui-udc-image-container rounded-corners'><div class='cui-udc-image-overlay'><\/div><div class='cui-image-lazy-container cui-image-hover-zoom'><img class='cui-svg-placeholder' height='211' width='349'><img class='cui-image lazy-load lazy-loaded' data-ll-status='loaded' src='' style='position: absolute; top: 0;'><\/div><\/div><div class='cui-udc-details cui-udc-left-aligned-details'><div class='cui-single-section'><div class='cui-udc-title one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-location cui-truncate cui-has-distance' style='display: none;'><span class='cui-location-name'><\/span><span class='cui-location-separator'>\u2022<\/span><span class='cui-location-distance'><\/span><\/div><\/div><div class='cui-single-section'><div class='cui-review-rating' style='display: none;'><div aria-hidden='true' class='numeric-count'><\/div><ul class='rating rating-numeric'><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><li aria-hidden='true'><span class=''><\/span><\/li><\/ul><div class='rating-count'><\/div><\/div><\/div><div class='cui-bottom-body'><div class='cui-combined-section'><div class='cui-price' data-pingdom-id='deal-price'><div aria-hidden='true' class='cui-price-original c-txt-gray-dk' style='display: none;'><\/div><div aria-hidden='true' class='cui-price-discount c-txt-price'><div class='cui-price-descriptor' style='display: none;'><\/div><span><\/span><div class='cui-price-descriptor' style='display: none;'><\/div><\/div><\/div><div class='cui-promotions'><div class='cui-detail-badge cui-discount-badge' style='display: none;'><\/div><div class='cui-urgent cui-offer' style='display: none;'><div><\/div><div class='cui-verbose-urgency-price' aria-hidden='true'><\/div><div class='cui-verbose-urgency-text'><\/div><\/div><\/div><\/div><div class='cui-single-section'><div class='cui-udc-subtitle one-line-truncate'><\/div><\/div><div class='cui-single-section'><div class='cui-urgency-message'><\/div><\/div><\/div><\/div><\/a><div class='cui-book-online-cta__container' style='display: none;'><a class='cui-book-online-cta' href=''>\" + runIndividualizer.translations.bookOnline + \"<\/a> <\/div><\/div><\/figure>\";var rootEl = document.querySelector(\"#pull-mobile-no-cards\");if (rootEl) {rootEl.setAttribute(\"id\", \"pull-mobile-cards\");var searchQuery = runDataGatherer.loadUrl({'mode': 'specific','parameters': ['query']}).parameters.query;var wrap = document.querySelector(\"#pull-page-content\");wrap.prepend(runIndividualizer.createElementFromHTML(\"<div class='browseHeader'><h1 class='page-header-title overflow-truncation'>\\\"\" + searchQuery + \"\\\"<\/h1><\/div>\"));} else {rootEl = document.querySelector(\"#pull-mobile-cards\");}if (rootEl.hasAttribute('data-offset')) {var offset = parseInt(rootEl.getAttribute('data-offset')) + 1;rootEl.parentElement.querySelectorAll('#pull-mobile-cards > *:not(figure)').forEach(function(el) {el.remove();});rootEl.querySelectorAll('figure:nth-child(n + ' + offset + ')').forEach(function(el) {el.remove();});rootEl.appendChild(runIndividualizer.createElementFromHTML(itemEl));} else {rootEl.innerHTML = itemEl;}if (runIndividualizer.startTimeObserver) {runDataGatherer.sendCustomEvent('category_observer_duration', 'inview', {'duration': (new Date().getTime() - runIndividualizer.startTimeObserver)});runIndividualizer.startTimeObserver = null;}","output_handler":"runIndividualizer.applySponsoredDeals('search_mobile');var el = document.querySelector('#db_search_mobile_css');if (el) {el.remove();}runIndividualizer.addAds('search_mobile');runIndividualizer.addBandCards('search_mobile');var rootEl = document.querySelector(\"#pull-mobile-cards\");runIndividualizer.renderPurplePrices(runIndividualizer.idRequest, rootEl);","empty_response_handler":"var el = document.querySelector('#db_search_mobile_css');if (el) {el.remove();}runIndividualizer.startTimeObserver = null;","events":[{"run_condition":"document.querySelector('#pull-mobile-no-cards')","type":["inview"],"selector":{"mode":"css","selection":"body"},"input_handler":"","timeout_handler":"var el = document.querySelector('#db_search_mobile_css');if (el) {el.remove();}if (!runIndividualizer.recommendations.hasOwnProperty(runIndividualizer.idRequest)) {runIndividualizer.startTimeObserver = null;}","timeout":7000},{"type":["fetch"],"selector":{"mode":"css","selection":""},"input_handler":"var url = runIndividualizer.nativeEvent[0];if (url.indexOf('\/get-paginated-cards') > 0) {var parameters = runIndividualizer.parseFilterParameters(decodeURIComponent(url));if (runIndividualizer.isPossibleToUseFilter(parameters)) {var rootEl = document.querySelector('#pull-mobile-cards');if (parameters.page && parameters.page !== '0') {runIndividualizer.requestData.offset = (parseInt(parameters.page) - 1) * 40;rootEl.setAttribute('data-offset', runIndividualizer.requestData.offset);} else {rootEl.setAttribute('data-offset', 0);}runIndividualizer.requestData.filter = runIndividualizer.getFilter(parameters);} else {runIndividualizer.lock = true;}} else {runIndividualizer.lock = true;}","timeout_handler":"var el = document.querySelector('#db_search_mobile_css');if (el) {el.remove();}if (!runIndividualizer.recommendations.hasOwnProperty(runIndividualizer.idRequest)) {runIndividualizer.startTimeObserver = null;}","observer":{"parent_selector":{"mode":"css","selection":"body"},"mutation_selector":{"mode":"css","selection":"#pull-mobile-cards"}},"timeout":3000}],"item_attributes":{"_customer_item_id":{"property":"data-bhc","output_handler":"runIndividualizer.element.setAttribute('data-bhc', 'deal:' + runIndividualizer.responseData);","run_condition":"","internal_selector":{"mode":"css","selection":""},"required":!0},"channel":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseData === 'marketrate-hotel' || runIndividualizer.responseItem['is_travel_bookable_deal']) {runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"discount_percent_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = JSON.parse(runIndividualizer.responseItem['value_array'])[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && data[index] > 0 && !isSalePriceInEffect && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = data[index] + '% ' + runIndividualizer.translations.discountBadgeText;runIndividualizer.element.style.display = 'block';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-discount-badge"},"required":!0},"is_bookable":{"property":"data-style","output_handler":"if (runIndividualizer.responseData) {runIndividualizer.element.style.display = 'flex';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-book-online-cta__container"},"required":!0},"is_travel_bookable_deal":{"property":"data-is-travel-bookable-deal","output_handler":"runIndividualizer.responseData = runIndividualizer.translations.perNightSymbol;runIndividualizer.element.style.display = 'block';","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount .cui-price-descriptor:last-child"},"required":!1},"med_image":{"property":"src","output_handler":"runIndividualizer.responseData = runIndividualizer.responseData.replace('t300x182.jpg', 'c349x211.webp');","run_condition":"","internal_selector":{"mode":"css","selection":".cui-image"},"required":!0},"merchant_name":{"property":"innerHTML","output_handler":"var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') < 0 && !isCashBackDeal && !isGetawaysDeal) {var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {runIndividualizer.element.classList.remove('one-line-truncate');var title = runIndividualizer.getTitle(runIndividualizer.responseItem);if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}runIndividualizer.responseData = title;}}var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.translations.memberPricing + ' ' + runIndividualizer.responseData;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-title"},"required":!0},"price_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);runIndividualizer.responseData = runIndividualizer.getFormattedPrice(data[index], runIndividualizer.responseItem['currency']);var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isMembersOnlyDeal) {var el = runIndividualizer.element.parentElement;el.classList.remove('c-txt-price');el.classList.add('cui-price-message', 'cui-price-hidden');el.innerHTML = runIndividualizer.translations.priceHidden;} else {if (isCashBackDeal) {runIndividualizer.responseData = runIndividualizer.getCashBack(runIndividualizer.responseItem);} else {if (data.length > 1) {var wrapEl = runIndividualizer.element.parentElement;var el = wrapEl.querySelector('.cui-price-discount .cui-price-descriptor:first-child');if (isSalePriceInEffect) {wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');wrapEl.closest('figure').querySelector('.cui-promotions .cui-offer div:first-child').innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';} else {el.innerHTML = runIndividualizer.translations.priceFrom + '&nbsp;';}el.style.display = 'block';}if (data.length === 1 && isSalePriceInEffect) {var wrapEl = runIndividualizer.element.parentElement;wrapEl.classList.remove('c-txt-price');wrapEl.classList.add('cui-verbose-urgency-pricing');}}var isCouponDeal = runIndividualizer.isCouponDeal(runIndividualizer.responseItem);if (isCouponDeal) {runIndividualizer.element.parentElement.parentElement.style.display = 'none';}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-discount span"},"required":!0},"purchases_total_displayed":{"property":"innerHTML","output_handler":"var num = runIndividualizer.responseData;var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (num > 10 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(num \/ 10) * 10) + '+ ' + runIndividualizer.translations.bought;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1},"rating_count":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_value']) {runIndividualizer.responseData = runIndividualizer.responseData + ' ' + runIndividualizer.translations.ratings;}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .rating-count"},"required":!1},"rating_value":{"property":"innerHTML","output_handler":"if (runIndividualizer.responseItem['rating_count']) {var value = runIndividualizer.responseData;var wrapEl = runIndividualizer.element.closest('.cui-review-rating');wrapEl.style.display = 'flex';var stars = wrapEl.querySelectorAll('ul li span');stars.forEach(function(el, num) {if (num + 0.8 <= value) {el.classList.value = 'full-star';} else if (num + 0.3 <= value) {el.classList.value = 'half-star';} else {el.classList.value = 'empty-star';}});} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-review-rating .numeric-count"},"required":!1},"redemption_locations_short":{"property":"data-location","output_handler":"var locations = JSON.parse(runIndividualizer.responseData);var filteredLocations = [];locations.forEach(function(location) {if (location.hasOwnProperty('lat') && location.hasOwnProperty('lng')) {filteredLocations.push(location);}});locations = filteredLocations;if (locations.length > 0) {var location = runIndividualizer.getNearestLocation(locations);var address = [];if (location['streetAddress1']) {address.push(location['streetAddress1']);}if (location['city']) {address.push(location['city']);}var el = runIndividualizer.element.querySelector('.cui-location-name');if (el) {el.innerHTML = address.join(', ');}var distance = location['distanceInKm'];var unit = runIndividualizer.translations.distanceUnit;if (unit === 'mi') {distance = distance \/ 1.609;}distance = Math.round(distance * 10) \/ 10;var el = runIndividualizer.element.querySelector('.cui-location-distance');if (el) {el.innerHTML = distance + ' ' + unit;}runIndividualizer.element.style.display = 'block';} else {runIndividualizer.element.style.display = 'none';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-location"},"required":!1},"sale_price":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isSalePriceInEffect = runIndividualizer.isSalePriceInEffect(runIndividualizer.responseItem);var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);if (isSalePriceInEffect && !isMembersOnlyDeal) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(runIndividualizer.responseData, runIndividualizer.responseItem['currency']);var wrapEl = runIndividualizer.element.parentElement;wrapEl.querySelector('.cui-verbose-urgency-text').innerHTML = runIndividualizer.translations.limitedTime;wrapEl.style.display = 'flex';} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-promotions .cui-offer .cui-verbose-urgency-price"},"required":!1},"title_general":{"property":"innerHTML","output_handler":"var abTestGroup = runIndividualizer.getAbTestGroup('product_card');if (runIndividualizer.responseItem['category'] && runIndividualizer.responseItem['category'].indexOf('{\\\"Goods\\\"') >= 0) {var title = runIndividualizer.responseData.trim();if (title === '') {var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseItem['title_array']);var title = data[index];}if (abTestGroup === 'product_card_gallery_title_up') {title = runIndividualizer.responseItem['gallery_title'] ? runIndividualizer.responseItem['gallery_title'] : title;}var el = runIndividualizer.element.closest('figure').querySelector('.cui-udc-title');if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0) {el.classList.remove('one-line-truncate');if (title.length > 55) {title = title.substring(0, 55).trim() + '...';}}el.innerHTML = title;runIndividualizer.responseData = '';} else {var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if (isCashBackDeal) {runIndividualizer.element.classList.add('c-txt-gray-dk');runIndividualizer.responseData = runIndividualizer.translations.freeToClaim;} else {var isGetawaysDeal = runIndividualizer.isGetawaysDeal(runIndividualizer.responseItem);if (['product_card_merchant_name_up'].indexOf(abTestGroup) >= 0 || isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.getTitle(runIndividualizer.responseItem);}if (['product_card_title_up', 'product_card_gallery_title_up'].indexOf(abTestGroup) >= 0 && !isGetawaysDeal) {runIndividualizer.responseData = runIndividualizer.responseItem['merchant_name'];}}}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-udc-subtitle"},"required":!0},"url":{"property":"href","output_handler":"","run_condition":"","internal_selector":{"mode":"css","selection":"a"},"required":!0},"value_array":{"property":"innerHTML","output_handler":"var index = runIndividualizer.getIndexOfVariant(runIndividualizer.responseItem);var data = JSON.parse(runIndividualizer.responseData);var originalPrice = data[index];var currentPrice = JSON.parse(runIndividualizer.responseItem['price_array'])[index];var isMembersOnlyDeal = runIndividualizer.isMembersOnlyDeal(runIndividualizer.responseItem);var isPossibleToShowDiscount = runIndividualizer.isPossibleToShowDiscount(runIndividualizer.responseItem);if (originalPrice > currentPrice && !isMembersOnlyDeal && isPossibleToShowDiscount) {runIndividualizer.responseData = runIndividualizer.getFormattedPrice(originalPrice, runIndividualizer.responseItem['currency']);runIndividualizer.element.style.display = 'block';var refEl = runIndividualizer.element.nextElementSibling;refEl.parentElement.insertBefore(runIndividualizer.createElementFromHTML('<span>&nbsp;<\/span>'), refEl)} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-price-original"},"required":!0},"views_24h":{"property":"innerHTML","output_handler":"var numViews = runIndividualizer.responseData;var numPurchases = runIndividualizer.responseItem['purchases_total_displayed'];var isCashBackDeal = runIndividualizer.isCashBackDeal(runIndividualizer.responseItem);if ((!numPurchases || numPurchases <= 10) && numViews >= 150 && !isCashBackDeal) {runIndividualizer.responseData = (Math.floor(numViews \/ 10) * 10) + '+ ' + runIndividualizer.translations.viewedToday;runIndividualizer.element.setAttribute('data-message', runIndividualizer.responseData);} else {runIndividualizer.responseData = '';}","run_condition":"","internal_selector":{"mode":"css","selection":".cui-urgency-message"},"required":!1}}}}};this.config=JSON.parse(JSON.stringify(i))};return this.config}catch(e){this.errorHandler(e,"getConfig")}},getUrl:function(){return"https://individualizer.databreakers.com/v1/individualizer"},getVersion:function(){return 1689611169},errorHandler:function(e,r,a){try{if(["info","warning","error"].indexOf(this.individualizerLogLevel)>=0){var t=runDataGatherer.prepareOuput(runDataGatherer.getConfig(),!0);t["dataPoints"][0]["attributes"]["message_type"]="error";t["dataPoints"][0]["attributes"]["error_name"]=e.name;t["dataPoints"][0]["attributes"]["error_message"]="area: "+r+", "+e.message;t["dataPoints"][0]["attributes"]["script_id"]=this.individualizerScriptId;t["dataPoints"][0]["attributes"]["script_version"]=this.getVersion();t["dataPoints"][0]["attributes"]["script_type"]="individualizer";if(a&&getPropertyNames(a).length!==0){t.dataPoints[0].attributes.original_request={"type":a.type,"method":a.method,"source_url":{"page":a.url}};if(a.hasOwnProperty("body")){t.dataPoints[0].attributes.original_request.body=JSON.stringify(a.body,null)}};var n=runDataGatherer.createCORSRequest("POST",runDataGatherer.getUrl());n.onerror=function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();n.onerror=null;return!1};if(n){n.send(JSON.stringify(t))}}}catch(i){}},warningHandler:function(e,r,a,t){try{if(["info","warning"].indexOf(this.individualizerLogLevel)>=0){var n=runDataGatherer.prepareOuput(runDataGatherer.getConfig(),!0);n["dataPoints"][0]["attributes"]["message_type"]="warning";n["dataPoints"][0]["attributes"]["warning_type"]=r;n["dataPoints"][0]["attributes"]["warning_message"]=e;n["dataPoints"][0]["attributes"]["script_id"]=this.individualizerScriptId;n["dataPoints"][0]["attributes"]["script_version"]=this.getVersion();n["dataPoints"][0]["attributes"]["script_type"]="individualizer";if(a){n["dataPoints"][0]["attributes"]["id_position"]=a};if(t){n["dataPoints"][0]["attributes"]["id_request"]=t};if(this.durations.hasOwnProperty(t)){n["dataPoints"][0]["attributes"]["request_duration_backend"]=this.durations[t]["requestDurationBackend"];n["dataPoints"][0]["attributes"]["request_duration_all"]=this.durations[t]["requestDurationAll"]};if(this.abTests){var l=JSON.stringify(this.abTests).indexOf("\"recommendation\"")>0?"recommendation":"original";n["dataPoints"][0]["attributes"]["event"]={};n["dataPoints"][0]["attributes"]["event"]["attributes"]={};n["dataPoints"][0]["attributes"]["event"]["attributes"]["ab_test_group"]=l};var s=runDataGatherer.createCORSRequest("POST",runDataGatherer.getUrl());s.onerror=function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();s.onerror=null;return!1};if(s){s.send(JSON.stringify(n))}}}catch(i){}},infoHandler:function(e,r,a,n,l){try{if(["info","warning","error"].indexOf(this.individualizerLogLevel)>=0){var t=runDataGatherer.prepareOuput(runDataGatherer.getConfig());t["dataPoints"][0]["attributes"]["message_type"]="info";t["dataPoints"][0]["attributes"]["info_type"]=r;t["dataPoints"][0]["attributes"]["info_message"]=e;t["dataPoints"][0]["attributes"]["request_duration_backend"]=a;t["dataPoints"][0]["attributes"]["request_duration_all"]=n;t["dataPoints"][0]["attributes"]["id_position"]=l;t["dataPoints"][0]["attributes"]["script_id"]=this.individualizerScriptId;t["dataPoints"][0]["attributes"]["script_version"]=this.getVersion();t["dataPoints"][0]["attributes"]["script_type"]="individualizer";var s=runDataGatherer.createCORSRequest("POST",runDataGatherer.getUrl());s.onerror=function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();s.onerror=null;return!1};if(s){s.send(JSON.stringify(t))}}}catch(i){var t={"dataPoints":[{"attributes":{"script_id":this.individualizerScriptId,"script_version":this.getVersion(),"config_version":runDataGatherer.getVersionOfConfig(),"script_type":"individualizer","source_url":{"page":location.href},"user_agent":navigator.userAgent,"message_type":"info","info_type":r,"info_message":e}}]};var s=runDataGatherer.createCORSRequest("POST",runDataGatherer.getUrl());s.onerror=function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();s.onerror=null;return!1};if(s){s.send(JSON.stringify(t))}}},initPolyfills:function(){try{if("document" in self){if(!("classList" in document.createElement("_"))||document.createElementNS&&!("classList" in document.createElementNS("http://www.w3.org/2000/svg","g"))){(function(e){"use strict";if(!("Element" in e))return;var l="classList",r="prototype",d=e.Element[r],n=Object,p=String[r].trim||function(){return this.replace(/^\s+|\s+$/g,"")},v=Array[r].indexOf||function(e){var i=0,r=this.length;for(;i<r;i++){if(i in this&&this[i]===e){return i}};return-1},u=function(e,i){this.name=e;this.code=DOMException[e];this.message=i},t=function(e,i){if(i===""){throw new u("SYNTAX_ERR","The token must not be empty.")};if(/\s/.test(i)){throw new u("INVALID_CHARACTER_ERR","The token must not contain space characters.")};return v.call(e,i)},o=function(e){var r=p.call(e.getAttribute("class")||""),a=r?r.split(/\s+/):[],i=0,t=a.length;for(;i<t;i++){this.push(a[i])};this._updateClassName=function(){e.setAttribute("class",this.toString())}},a=o[r]=[],c=function(){return new o(this)};u[r]=Error[r];a.item=function(e){return this[e]||null};a.contains=function(e){return~t(this,e+"")};a.add=function(){var i=arguments,r=0,n=i.length,e,a=!1;do{e=i[r]+"";if(!~t(this,e)){this.push(e);a=!0}}
while(++r<n);if(a){this._updateClassName()}};a.remove=function(){var r=arguments,a=0,s=r.length,i,n=!1,e;do{i=r[a]+"";e=t(this,i);while(~e){this.splice(e,1);n=!0;e=t(this,i)}}
while(++a<s);if(n){this._updateClassName()}};a.toggle=function(e,i){var r=this.contains(e),a=r?i!==!0&&"remove":i!==!1&&"add";if(a){this[a](e)};if(i===!0||i===!1){return i}
else{return!r}};a.replace=function(e,i){var r=t(e+"");if(~r){this.splice(r,1,i);this._updateClassName()}};a.toString=function(){return this.join(" ")};if(n.defineProperty){var s={get:c,enumerable:!0,configurable:!0};try{n.defineProperty(d,l,s)}catch(i){if(i.number===undefined||i.number===-0x7FF5EC54){s.enumerable=!1;n.defineProperty(d,l,s)}}}
else if(n[r].__defineGetter__){d.__defineGetter__(l,c)}}(self))}(function(){"use strict";var e=document.createElement("_");e.classList.add("c1","c2");if(!e.classList.contains("c2")){var i=function(e){var i=DOMTokenList.prototype[e];DOMTokenList.prototype[e]=function(e){var r,a=arguments.length;for(r=0;r<a;r++){e=arguments[r];i.call(this,e)}}};i("add");i("remove")};e.classList.toggle("c3",!1);if(e.classList.contains("c3")){var r=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(e,i){if(1 in arguments&&!this.contains(e)===!i){return i}
else{return r.call(this,e)}}};if(!("replace" in document.createElement("_").classList)){DOMTokenList.prototype.replace=function(e,i){var r=this.toString().split(" "),a=r.indexOf(e+"");if(~a){r=r.slice(a);this.remove.apply(this,r);this.add(i);this.add.apply(this,r.slice(1))}}};e=null}())}(function(e,i){"use strict";var a="amd",r="exports";if(typeof define==="function"&&define[a]){define(function(){return i(e)})}
else if(typeof module==="function"&&module[r]){module[r]=i(e)}
else{i(e)}}(this,function(){"use strict";var s,l,r,o,c,d=window.document,a,p,u,t,e=d.createElement("_"),i="DOMAttrModified";function m(e){delete e.target._datasetCache};function I(e){return e.replace(o,function(e,i){return i.toUpperCase()})};function v(){var e={};l=this.attributes;for(r=0,p=l.length;r<p;r+=1){s=l[r];u=s.name.match(c);if(u){e[I(u[1])]=s.value}};return e};function n(){if(a){e.removeEventListener(i,n,!1)}
else{e.detachEvent("on"+i,n)};t=!0};if(e.dataset!==undefined){return};o=/\-([a-z])/ig;c=/^data\-(.+)/;a=!!d.addEventListener;t=!1;if(a){e.addEventListener(i,n,!1)}
else{e.attachEvent("on"+i,n)};e.setAttribute("foo","bar");Object.defineProperty(window.Element.prototype,"dataset",{get:t?function(){if(!this._datasetCache){this._datasetCache=v.call(this)};return this._datasetCache}:v});if(t&&a){d.addEventListener(i,m,!1)}}));(function(e){e.forEach(function(e){if(e.hasOwnProperty("remove")){return};Object.defineProperty(e,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode.removeChild(this)}})})})([Element.prototype,CharacterData.prototype,DocumentType.prototype]);(function(e){e.forEach(function(e){if(e.hasOwnProperty("prepend")){return};Object.defineProperty(e,"prepend",{configurable:!0,enumerable:!0,writable:!0,value:function(){var i=Array.prototype.slice.call(arguments),e=document.createDocumentFragment();i.forEach(function(i){var r=i instanceof Node;e.appendChild(r?i:document.createTextNode(String(i)))});this.insertBefore(e,this.firstChild)}})})})([Element.prototype,Document.prototype,DocumentFragment.prototype])}catch(e){this.errorHandler(e,"initPolyfills")}},getElements:function(e,r,a){try{if(!r)return[a];if(e==="xpath"){return runDataGatherer.selectElements(r,a)}
else{return Array.prototype.slice.call(a.querySelectorAll(r))}}catch(i){this.errorHandler(i,"getElements")}},initListening:function(e){try{var s={};for(var l in e["positions"]){if(!e["positions"][l]["running"])continue;if(e["positions"][l]["run_condition"]){if(!eval(e["positions"][l]["run_condition"]))continue};for(var a in e["positions"][l]["events"]){for(var h in e["positions"][l]["events"][a]["type"]){var r=e["positions"][l]["events"][a]["type"][h];if(r!=="DOMContentLoaded"){var n=e["positions"][l],t=n["events"][a]["selector"],o=n["events"][a]["timeout"],c=n["events"][a]["timeout_handler"],p=n["events"][a].hasOwnProperty("input_handler")?n["events"][a]["input_handler"]:null,v=n["events"][a].hasOwnProperty("observer")?n["events"][a]["observer"]:null,m=n["events"][a].hasOwnProperty("run_condition")?n["events"][a]["run_condition"]:"",I=n["events"][a].hasOwnProperty("merge_time")?n["events"][a]["merge_time"]:0;if(!s.hasOwnProperty(r)){s[r]={}};if(!s[r].hasOwnProperty(t["mode"])){s[r][t["mode"]]={}};if(!s[r][t["mode"]].hasOwnProperty(t["selection"])){s[r][t["mode"]][t["selection"]]={}};if(!s[r][t["mode"]][t["selection"]].hasOwnProperty(l)){s[r][t["mode"]][t["selection"]][l]={"runCondition":m,"position":n,"timeout":o,"timeoutHandler":c,"eventHandler":p,"eventObserver":v,"mergeTime":I}}}}}};for(var r in s){for(var d in s[r]){for(var u in s[r][d]){var t={"mode":d,"selection":u};this.setListeningCallback(e,r,s[r][d][u],t)}}}}catch(i){this.errorHandler(i,"initListening")}},setListeningCallback:function(e,t,r,n){var a=this;try{if(t==="popstate"){var s=function(){try{var n=[],u={};var d={};var l={};var s=new Date().getTime();for(var t in r){if(!r[t]["position"]["running"])continue;if(r[t]["position"]["run_condition"].length){if(!eval(r[t]["position"]["run_condition"])){continue}};if(r[t]["runCondition"].length){if(!eval(r[t]["runCondition"])){continue}};a.lock=!1;a.requestData={};a.idRequest=t+"#"+s;try{eval(r[t]["eventHandler"]);eval(r[t]["position"]["input_handler"])}catch(i){a.startHibernation(i,"input_handler, position: "+t)};if(a.lock)continue;n.push(a.prepareRequest(t,a.requestData,r[t]["position"]["item_attributes"],e));u[t]=r[t]["timeout"];d[t]=r[t]["timeoutHandler"];l[t]=r[t]["eventObserver"]};if(!n.length)return;a.sendBatchRequest(n,e,u,d,l,null,s)}catch(i){a.errorHandler(i,"initListening popstate callback")}};window.addEventListener(t,s,!0)};if(t==="pushState"){var s=function(){try{var n=[],u={};var d={};var l={};var s=new Date().getTime();for(var t in r){if(!r[t]["position"]["running"])continue;if(r[t]["position"]["run_condition"].length){if(!eval(r[t]["position"]["run_condition"])){continue}};if(r[t]["runCondition"].length){if(!eval(r[t]["runCondition"])){continue}};a.lock=!1;a.requestData={};a.idRequest=t+"#"+s;try{eval(r[t]["eventHandler"]);eval(r[t]["position"]["input_handler"])}catch(i){a.startHibernation(i,"input_handler, position: "+t)};if(a.lock)continue;n.push(a.prepareRequest(t,a.requestData,r[t]["position"]["item_attributes"],e));u[t]=r[t]["timeout"];d[t]=r[t]["timeoutHandler"];l[t]=r[t]["eventObserver"]};if(!n.length)return;a.sendBatchRequest(n,e,u,d,l,null,s)}catch(i){a.errorHandler(i,"initListening pushState callback")}};if(this.pushStateCallbacks.length==0){var p=history.pushState;history.pushState=function(){p.apply(this,arguments);a.pushStateCallbacks.forEach(function(e){e()})}};this.pushStateCallbacks.push(s)};if(t==="replaceState"){var s=function(){try{var n=[],u={};var d={};var l={};var s=new Date().getTime();for(var t in r){if(!r[t]["position"]["running"])continue;if(r[t]["position"]["run_condition"].length){if(!eval(r[t]["position"]["run_condition"])){continue}};if(r[t]["runCondition"].length){if(!eval(r[t]["runCondition"])){continue}};a.lock=!1;a.requestData={};a.idRequest=t+"#"+s;if(a.lock)continue;n.push(a.prepareRequest(t,a.requestData,r[t]["position"]["item_attributes"],e));u[t]=r[t]["timeout"];d[t]=r[t]["timeoutHandler"];l[t]=r[t]["eventObserver"]};if(!n.length)return;a.sendBatchRequest(n,e,u,d,l,null,s)}catch(i){a.errorHandler(i,"initListening replaceState callback")}};if(this.replaceStateCallbacks.length==0){var c=history.replaceState;history.replaceState=function(){c.apply(this,arguments);a.replaceStateCallbacks.forEach(function(e){e()})}};this.replaceStateCallbacks.push(s)};if(t==="fetch"){var s=function(i){try{var s=[],o={};var u={};var d={};var l=new Date().getTime();for(var n in r){if(!r[n]["position"]["running"])continue;if(r[n]["position"]["run_condition"].length){if(!eval(r[n]["position"]["run_condition"])){continue}};if(r[n]["runCondition"].length){if(!eval(r[n]["runCondition"])){continue}};a.nativeEvent=i;a.lock=!1;a.requestData={};a.idRequest=n+"#"+l;try{eval(r[n]["eventHandler"])}catch(t){a.startHibernation(t,"input_handler, position: "+n)};if(a.lock)continue;try{eval(r[n]["position"]["input_handler"])}catch(t){a.startHibernation(t,"input_handler, position: "+n)};if(a.lock)continue;s.push(a.prepareRequest(n,a.requestData,r[n]["position"]["item_attributes"],e));o[n]=r[n]["timeout"];u[n]=r[n]["timeoutHandler"];d[n]=r[n]["eventObserver"]};if(!s.length)return;a.sendBatchRequest(s,e,o,u,d,null,l)}catch(t){a.errorHandler(t,"initListening fetch callback")}};if(this.fetchCallbacks.length===0){var o=window.fetch;window.fetch=function(){var e=arguments;a.fetchCallbacks.forEach(function(i){i(e)});return o.apply(this,arguments)}};this.fetchCallbacks.push(s)};if(t==="xhr"){var s=function(i){try{var s=[],o={};var u={};var d={};var l=new Date().getTime();for(var n in r){if(!r[n]["position"]["running"])continue;if(r[n]["position"]["run_condition"].length){if(!eval(r[n]["position"]["run_condition"])){continue}};if(r[n]["runCondition"].length){if(!eval(r[n]["runCondition"])){continue}};a.nativeEvent=i;a.lock=!1;a.requestData={};a.idRequest=n+"#"+l;try{eval(r[n]["eventHandler"])}catch(t){a.startHibernation(t,"input_handler, position: "+n)};if(a.lock)continue;try{eval(r[n]["position"]["input_handler"])}catch(t){a.startHibernation(t,"input_handler, position: "+n)};if(a.lock)continue;s.push(a.prepareRequest(n,a.requestData,r[n]["position"]["item_attributes"],e));o[n]=r[n]["timeout"];u[n]=r[n]["timeoutHandler"];d[n]=r[n]["eventObserver"]};if(!s.length)return;a.sendBatchRequest(s,e,o,u,d,null,l)}catch(t){a.errorHandler(t,"initListening xhr callback")}};if(this.xhrCallbacks.length===0){var u=window.XMLHttpRequest.prototype.open;window.XMLHttpRequest.prototype.open=function(){var e=[].slice.call(arguments);a.xhrRequestOpenArguments=e;return u.apply(this,e)};var d=window.XMLHttpRequest.prototype.send;window.XMLHttpRequest.prototype.send=function(){var e=a.xhrRequestOpenArguments.concat([].slice.call(arguments));e.push(this);a.xhrCallbacks.forEach(function(i){i(e)});d.apply(this,arguments)}};this.xhrCallbacks.push(s)};if(t==="inview"){var s=function(i){try{var s=[],o={};var u={};var d={};var l=new Date().getTime();a.element=i;for(var n in r){if(!r[n]["position"]["running"])continue;if(r[n]["position"]["run_condition"].length){if(!eval(r[n]["position"]["run_condition"])){continue}};if(r[n]["runCondition"].length){if(!eval(r[n]["runCondition"])){continue}};a.lock=!1;a.requestData={};a.idRequest=n+"#"+l;try{eval(r[n]["eventHandler"]);eval(r[n]["position"]["input_handler"])}catch(t){a.startHibernation(t,"input_handler, position: "+n)};if(a.lock)continue;s.push(a.prepareRequest(n,a.requestData,r[n]["position"]["item_attributes"],e));o[n]=r[n]["timeout"];u[n]=r[n]["timeoutHandler"];d[n]=r[n]["eventObserver"]};if(!s.length)return;a.sendBatchRequest(s,e,o,u,d,null,l)}catch(t){a.errorHandler(t,"initListening inview callback")}},l=function(){var e=[];if(n["mode"]==="xpath"){e=runDataGatherer.selectElements(n["selection"])}
else{e=Array.prototype.slice.call(document.querySelectorAll(n["selection"]))};return e};runDataGatherer.appear({appear:s,bounds:0,getElements:l})};if(["popstate","pushState","replaceState","fetch","xhr","inview"].indexOf(t)<0){var s=function(i){try{var d=[],m={};var v={};var p={};var o=new Date().getTime(),f=[],c=[],h;if(n["mode"]==="xpath"){c=runDataGatherer.selectElements(n["selection"])}
else{c=Array.prototype.slice.call(document.querySelectorAll(n["selection"]))};for(var I=0;I<c.length;I++){var l;if(i.hasOwnProperty("path")&&Array.isArray(i.path)&&i.path.length>2){l=i.path}
else{l=[];var u=i.target;while(u){l.push(u);u=u.parentElement};if(l.indexOf(window)===-1&&l.indexOf(document)===-1){l.push(document)};if(l.indexOf(window)===-1){l.push(window)}};h=l.indexOf(c[I]);if(h<0)continue;a.nativeEvent=i;a.element=l[h];for(var s in r){if(!r[s]["position"]["running"])continue;if(r[s]["position"]["run_condition"].length){if(!eval(r[s]["position"]["run_condition"])){continue}};if(r[s]["runCondition"].length){if(!eval(r[s]["runCondition"])){continue}};a.lock=!1;a.requestData={};a.idRequest=s+"#"+o;try{eval(r[s]["eventHandler"]);eval(r[s]["position"]["input_handler"])}catch(t){a.startHibernation(t,"input_handler, position: "+s)};if(a.lock)continue;d.push(a.prepareRequest(s,a.requestData,r[s]["position"]["item_attributes"],e));m[s]=r[s]["timeout"];v[s]=r[s]["timeoutHandler"];p[s]=r[s]["eventObserver"];f.push(r[s]["mergeTime"])};if(!d.length)return;var g=Math.max.apply(null,f);if(g===0){a.sendBatchRequest(d,e,m,v,p,null,o)}
else{if(a.lastRequest){a.lastRequest=function(){a.sendBatchRequest(d,e,m,v,p,null,o)}}
else{a.lastRequest=function(){a.sendBatchRequest(d,e,m,v,p,null,o)};setTimeout(function(){a.lastRequest();a.lastRequest=null},g)}};break}}catch(t){a.errorHandler(t,"initListening callback")}};document.addEventListener(t,s,!0)}}catch(i){this.errorHandler(i,"setListeningCallback")}},main:function(){try{var r=this.getConfig();this.individualizerScriptId=r["script_id"];this.individualizerLogLevel=r["log_level"];this.setLocalStorage(r);if(r["running"]&&runDataGatherer.resolveRunConditions(r["run_conditions"])&&!localStorage.getItem("db_disable")&&!localStorage.getItem("db_disable_temp")){var c=[],p={};var o={};var u={};var d={};var n=!1,s="noPosition",l=new Date().getTime();if(r.hasOwnProperty("variables")){eval(r["variables"])};if(r.hasOwnProperty("declarations")){eval(r["declarations"])};for(var t in r["positions"]){this.requestData={};var i=r["positions"][t];s=t;if(!i["running"])continue;if(i["run_condition"]&&!eval(i["run_condition"]))continue;if(i["run_handler"]){try{eval(i["run_handler"])}catch(e){this.startHibernation(e,"run_handler, position: "+t)}};loop1:for(var a in i["events"]){loop2:for(var v in i["events"][a]["type"]){if(i["events"][a]["type"][v]==="DOMContentLoaded"){if(i["events"][a].hasOwnProperty("run_condition")&&!eval(i["events"][a]["run_condition"]))continue;this.lock=!1;this.idRequest=t+"#"+l;try{eval(i["events"][a]["input_handler"]);eval(i["input_handler"])}catch(e){this.startHibernation(e,"input_handler, position: "+t)};if(this.lock)break loop1;c.push(this.prepareRequest(t,this.requestData,i["item_attributes"],r));p[t]=i["events"][a]["timeout"];o[t]=i["events"][a]["timeout_handler"];u[t]=i["events"][a].hasOwnProperty("observer")?i["events"][a]["observer"]:null;d[t]=i["events"][a]["selector"];n=!0;break loop1}}}};if(n)this.sendBatchRequest(c,r,p,o,u,d,l);this.initListening(r);this.initGarbageCollector()}}catch(e){this.errorHandler(e,"main, position: "+s)}},prepareRequest:function(e,r,n,s){try{var o=e.split("#"),u=o[o.length-1].split("@")[0],t={"requestId":e,"request":{"template":{"templateId":u},"returnedAttributes":[]}};if(s["positions"][e].hasOwnProperty("importance")){t["importance"]=s["positions"][e]["importance"]};if(localStorage.getItem("db_forced_ab_tests")){var c=JSON.parse(localStorage.getItem("db_forced_ab_tests"));t.request["abTests"]={"forcedAbTests":c}};if(getPropertyNames(r).length!==0){for(var a in r){if(a==="count"){t.request.template.count=r[a];continue};if(a==="filter"){t.request.template.filter=r[a];continue};if(a==="attributeStats"){t.request.template.attributeStats=r[a];continue};if(a==="booster"){t.request.template.booster=r[a];continue};if(a==="details"){t.request.template.details=r[a];continue};if(a==="output"){t.request.template.output=r[a];continue};if(a==="order"){t.request.template.order=r[a];continue};if(a==="orderBy"){t.request.template.orderBy=r[a];continue};t.request[a]=r[a]}};if(localStorage.getItem("db_forced_templates")){var d=JSON.parse(localStorage.getItem("db_forced_templates"));if(d.hasOwnProperty("all")){for(var a in d["all"]){t.request.template[a]=d["all"][a]}};if(d.hasOwnProperty(u)){for(var a in d[u]){t.request.template[a]=d[u][a]}}};for(var a in n){if(n[a]["run_condition"].length){if(eval(n[a]["run_condition"])){t["request"]["returnedAttributes"].push(a);if(n[a]["required"]){var l="";if(t.request.template.hasOwnProperty("filter")){l+=t.request.template.filter+" AND "};l+=a+" is not null";t.request.template.filter=l}}}
else{t["request"]["returnedAttributes"].push(a);if(n[a]["required"]){var l="";if(t.request.template.hasOwnProperty("filter")){l+=t.request.template.filter+" AND "};l+=a+" is not null";t.request.template.filter=l}}};return t}catch(i){this.errorHandler(i,"prepareRequest")}},sendBatchRequest:function(e,r,t,l,d,c,o){try{var a=this,b=function(e){try{if(e.readyState===e.DONE&&e.status===200){var s=JSON.parse(e.responseText),I=(new Date().getTime())-o;if(s&&typeof s==="object"){for(var n in s["responses"]){var p=s["responses"][n]["response"]["recommendations"],l=n+"#"+o;a.idRequest=l;a.responses[l]=s["responses"][n]["response"];var m=s["responses"][n]["response"]["abTests"];if(m){a.abTests=m};a.durations[l]={"requestDurationBackend":s["durationMs"],"requestDurationAll":I};if(p.length>0){if(!a.doRecommendationsContainRequiredAttributes(n,p)){var y={"name":"Invalid recommendations","message":"Recommendations do not contain required attributes."};a.startHibernation(y,"received_response_handler, position: "+n)};var v=s["responses"][n]["response"]["totalResults"];if(v){a.totalResults[l]=v};a.saveRecommendations(l,p);try{eval(r["positions"][n]["received_response_handler"])}catch(i){a.startHibernation(i,"received_response_handler, position: "+n)}}
else{try{eval(r["positions"][n]["received_response_handler"])}catch(i){a.startHibernation(i,"received_response_handler, position: "+n)};try{eval(r["positions"][n]["empty_response_handler"])}catch(i){a.startHibernation(i,"empty_response_handler, position: "+n)};var u="Not possible to apply the recommendations of "+n+", because no recommendations receieved.";a.warningHandler(u,"empty_response")};var h=t.hasOwnProperty(n)?t[n]:null,g=d.hasOwnProperty(n)?d[n]:null,f=c&&c.hasOwnProperty(n)?c[n]:null;if(!g){a.resolveIndividualization(l,o,h,!1,f)};if(r["log_level"]==="info"){a.infoHandler("","requestDuration",s["durationMs"],I,n)}}}
else{var u="Not possible to apply the recommendations, because no recommendations received.";a.warningHandler(u,"empty_response")}}
else{a.errorHandler("xhr.status: "+e.status,"sendBatchRequest callback")}}catch(i){a.errorHandler(i,"sendBatchRequest callback")}},s={};s["accountId"]=runDataGatherer.getAccountId();s["data"]=runDataGatherer.prepareOuput(runDataGatherer.getConfig());s["data"]["dataPoints"][0]["attributes"]["script_type"]="individualizer";s["data"]["dataPoints"][0]["attributes"]["script_version"]=this.getVersion();var I=s["data"].dataPoints[0]["attributes"]["user_identification"];if(I&&I.hasOwnProperty("id")){for(var u=0;u<e.length;u++){e[u]["request"]["userId"]=I["id"]}};var m=[],p=[];for(var u=0;u<e.length;u++){var n=e[u]["request"]["template"]["templateId"],h=r["positions"][n]["type"],g=n+"#"+o,f=l.hasOwnProperty(n)?l[n]:null,v=t.hasOwnProperty(n)?t[n]:null,y=d.hasOwnProperty(n)?d[n]:null;if(f&&v){(function(e,i,r){setTimeout(function(){try{if(a.isThereYoungerRequest(r))return;a.idRequest=r;try{eval(i)}catch(t){a.startHibernation(t,"timeout_handler, position: "+e)}}catch(t){a.errorHandler(t,"timeoutHandler, position: "+e)}},v)})(n,f,g)};if(y){(function(e,i,r,t,n){var o=function(n,s){if(e.hasOwnProperty("mutation_selector")){var c=e["mutation_selector"],l=a.getElements(c["mode"],c["selection"],document),d=!1;for(var o in l){for(var u in n){if(Array.prototype.slice.call(n[u]["addedNodes"]).indexOf(l[o])>=0){d=!0};if(n[u]["target"]==l[o]){d=!0}}};if(!d)return};if(a.observersAttempts[i]===0){setTimeout(function(){s.disconnect()},500)};a.observersAttempts[i]++;if(a.observersAttempts[i]>1){s.disconnect()};if(e.hasOwnProperty("handler"))eval(e["handler"]);a.resolveIndividualization(i,r,t,!0,null)},s=e["parent_selector"];a.observers[i]=new MutationObserver(o);a.observersAttempts[i]=0;var l=a.getElements(s["mode"],s["selection"],document);if(!l.length){var d=n+" (observerSelector, mode: "+s["mode"]+", selection: "+s["selection"]+")",u="Not possible to apply the observer to: "+d+", because element does not exist.";a.warningHandler(u,"element_missing");return};a.observers[i].observe(l[0],{childList:!0,subtree:!0})})(y,g,o,v,n)};if(h=="recommendation"){m.push(e[u])};if(h=="individualizer"){p.push(e[u])};if(!this.requests.hasOwnProperty(n)){this.requests[n]=[]};this.requests[n].push(o)};if(m.length>0){s["recommendation_request"]={};s["recommendation_request"]["requests"]=m;s["recommendation_request"]["uniqueRecommendations"]=!0;s["recommendation_request"]["importanceType"]="priority";if(p.length==0){s["synchronous"]=!1}};if(p.length>0){s["individualizer_request"]={};s["individualizer_request"]["requests"]=p};runDataGatherer.makeCorsRequest(s,this.getUrl(),"POST",b,!0)}catch(i){this.errorHandler(i,"sendBatchRequest")}},loadResponse:function(e){try{if(this.responses.hasOwnProperty(e)){return this.responses[e]};return!1}catch(i){this.errorHandler(i,"loadRecommendations")}},saveRecommendations:function(e,r){try{if(this.recommendations.hasOwnProperty(e)){var a="It was impossible to save the recommendations because the request id '"+e+"' was duplicated.";this.warningHandler(a,"duplicate_request_id")}
else{this.recommendations[e]=r}}catch(i){this.errorHandler(i,"saveRecommendations")}},loadRecommendations:function(e){try{if(this.recommendations.hasOwnProperty(e)){return this.recommendations[e]};return!1}catch(i){this.errorHandler(i,"loadRecommendations")}},applyRecommendations:function(e){try{var d=e.split("#")[0],P=this.getConfig(),t=P["positions"][d];this.responseData=this.loadRecommendations(e);this.idRequest=e;this.lock=!1;var I="before_render_handler - "+d;try{eval(t["before_render_handler"])}catch(i){this.startHibernation(i,"before_render_handler, position: "+d)};I="under before_render_handler - "+d;if(this.lock)return;var z=this.responseData,l=this,s=this.getElements(t["root_selector"]["mode"],t["root_selector"]["selection"],document);if(!s.length){var u=d+", mode: "+t["root_selector"]["mode"]+", selection: "+t["root_selector"]["selection"],o="Not possible to apply the recommendation to: "+u+", because element does not exist.";this.warningHandler(o,"element_missing");return};var v=s[0],k=v.children[0].cloneNode(!0);if(t["multiple"]){var g=v.dataset.offset?parseInt(v.dataset.offset):0,w=v.children;if(w.length<g){g=w.length-z.length};if(w[g]){k=w[g].cloneNode(!0)};for(var p=0;p<z.length;p++){p=parseInt(p);var c=z[p]["attributes"];this.responseItem=c;this.responseItem["itemId"]=z[p]["itemId"];var T=Object.keys(c),a=Object.keys(t["item_attributes"]),q={};for(var r=0;r<a.length;r++){if(t["item_attributes"][a[r]].hasOwnProperty("cloning_selector")){var b=JSON.parse(c[a[r]]);if(b.length>0){q[a[r]]=b}}};this.responseVariants=q;if(w.length<g+p+1)v.appendChild(k.cloneNode(!0));for(var r=0;r<a.length;r++){if(T.indexOf(a[r])<0)continue;I=a[r];if(a[r].indexOf("parameters::")>=0){var y=c["parameters"];for(var f in y){for(var D in y[f]){var h="parameters::"+f+"::"+D,n=t["item_attributes"][h]["internal_selector"],s=this.getElements(n["mode"],n["selection"],v.children[g+p]);this.responseData=y[f][D];if(!s.length){var u=d+" (internalSelector, mode: "+n["mode"]+", selection: "+n["selection"]+")",o="Not possible to apply the recommendation to: "+u+", because element does not exist.";this.warningHandler(o,"element_missing");continue};s.forEach(function(e){l.element=e;try{eval(t["item_attributes"][h]["output_handler"])}catch(i){l.startHibernation(i,"output_handler "+I+", position: "+d)};l.element[t["item_attributes"][h]["property"]]=l.responseData})}}}
else{if(t["item_attributes"][a[r]].hasOwnProperty("cloning_selector")){var E=t["item_attributes"][a[r]]["cloning_selector"],s=this.getElements(E["mode"],E["selection"],v.children[g+p]);if(!s.length){var u=d+" (cloningSelector, mode: "+E["mode"]+", selection: "+E["selection"]+")",o="Not possible to apply the recommendation to: "+u+", because element does not exist.";this.warningHandler(o,"element_missing");continue};var b=JSON.parse(c[a[r]]);if(b!=null&&b.constructor===Array){for(var m=0;m<b.length;m++){if(s.length<m+1){s[m]=s[0].cloneNode(!0);s[0].parentElement.appendChild(s[m])};var n=t["item_attributes"][a[r]]["internal_selector"],x=this.getElements(n["mode"],n["selection"],s[m]);this.responseData=b[m];this.responseVariantIndex=m;for(var S in this.responseVariants){this.responseVariant[S]=this.responseVariants[S][m]};if(!x.length){var u=d+" (internalSelector, mode: "+n["mode"]+", selection: "+n["selection"]+")",o="Not possible to apply the recommendation to: "+u+", because element does not exist.";this.warningHandler(o,"element_missing");continue};x.forEach(function(e){l.element=e;try{eval(t["item_attributes"][a[r]]["output_handler"])}catch(i){l.startHibernation(i,"output_handler "+I+", position: "+d)};l.element[t["item_attributes"][a[r]]["property"]]=l.responseData})}}}
else{var n=t["item_attributes"][a[r]]["internal_selector"],s=this.getElements(n["mode"],n["selection"],v.children[g+p]);this.responseData=c.hasOwnProperty(a[r])?c[a[r]]:null;if(!s.length){var u=d+" (internalSelector, mode: "+n["mode"]+", selection: "+n["selection"]+")",o="Not possible to apply the recommendation to: "+u+", because element does not exist.";this.warningHandler(o,"element_missing");continue};s.forEach(function(e){l.element=e;try{eval(t["item_attributes"][a[r]]["output_handler"])}catch(i){l.startHibernation(i,"output_handler "+I+", position: "+d)};l.element[t["item_attributes"][a[r]]["property"]]=l.responseData})}}}}}
else{var c=z[0]["attributes"],T=Object.keys(c),a=Object.keys(t["item_attributes"]);for(var r=0;r<a.length;r++){if(T.indexOf(a[r])<0)continue;I=a[r];if(a[r].indexOf("parameters::")>=0){var y=c["parameters"];for(var f in y){for(var D in y[f]){var h="parameters::"+f+"::"+D;I=h;var n=t["item_attributes"][h]["internal_selector"],s=this.getElements(n["mode"],n["selection"],v);this.responseData=y[f][D];if(!s.length){var u=d+" (internalSelector, mode: "+n["mode"]+", selection: "+n["selection"]+")",o="Not possible to apply the recommendation to: "+u+", because element does not exist.";this.warningHandler(o,"element_missing");continue};s.forEach(function(e){l.element=e;try{eval(t["item_attributes"][h]["output_handler"])}catch(i){l.startHibernation(i,"output_handler "+I+", position: "+d)};l.element[t["item_attributes"][h]["property"]]=l.responseData})}}}
else{var n=t["item_attributes"][a[r]]["internal_selector"],s=this.getElements(n["mode"],n["selection"],v);this.responseData=c.hasOwnProperty(a[r])?c[a[r]]:null;if(!s.length){var u=d+" (internalSelector, mode: "+n["mode"]+", selection: "+n["selection"]+")",o="Not possible to apply the recommendation to: "+u+", because element does not exist.";this.warningHandler(o,"element_missing");continue};s.forEach(function(e){l.element=e;try{eval(t["item_attributes"][a[r]]["output_handler"])}catch(i){l.startHibernation(i,"output_handler "+I+", position: "+d)};l.element[t["item_attributes"][a[r]]["property"]]=l.responseData})}}};this.responseData=z;try{eval(t["output_handler"])}catch(i){this.startHibernation(i,"output_handler, position: "+d)}}catch(i){this.errorHandler(i,"applyRecommendations output_handler, position: "+d)}},resolveIndividualization:function(e,r,a,t,n){try{var u=this,l=e.split("#")[0];if(this.isThereYoungerRequest(e))return;if(a&&((a-(new Date().getTime()-r))<=0)){var s="area: resolveIndividualization, Not possible to apply the recommendation to: "+l+", because of timeout.";this.warningHandler(s,"timeout",l,e);return};if(n){var c=this.getElements(n["mode"],n["selection"],document);if(!c.length){setTimeout(function(){u.resolveIndividualization(e,r,a,!1,n)},50);return}};var o=this.loadResponse(e),d=this.loadRecommendations(e);if(t&&!d&&!o){setTimeout(function(){u.resolveIndividualization(e,r,a,!0,n)},50);return};if(d){this.applyRecommendations(e)}
else{var s="area: callback, Not possible to apply the recommendation to: "+l+", because no recommendations receieved.";this.warningHandler(s,"empty_response")}}catch(i){this.errorHandler(i,"resolveIndividualization")}},isThereYoungerRequest:function(e){try{var r=e.split("#")[0],n=this.getConfig();if(!n["positions"][r]["apply_only_last_request"])return!1;var a=parseInt(e.split("#")[1]),t=Math.max.apply(null,this.requests[r]);return t!==a}catch(i){this.errorHandler(i,"isThereYoungerRequest")}},formatPrice:function(e,r,a,t,n){try{if(!a){a="."};if(!n){n=" "};var s=e.toFixed(2).split(".");if(r){s=Math.round(e).toFixed(2).split(".")};s=s[0].split("").reverse().reduce(function(e,i,r){return i==="-"?e:i+(r&&!(r%3)?n:"")+e},"")+(s[1]!=="00"?a+s[1]:t?a+"00":"");return s}catch(i){this.errorHandler(i,"formatPrice")}},initGarbageCollector:function(){try{var i=this;setInterval(function(){var s=new Date().getTime(),t={};for(var a in i.recommendations){var e=a.split("#")[0],r=parseInt(a.split("#")[1]);if(t.hasOwnProperty(e)){if(t[e]<r){t[e]=r}}
else{t[e]=r}};for(var a in i.recommendations){var e=a.split("#")[0],r=parseInt(a.split("#")[1]);if(t[e]==r){continue};if(r<(s-60000)){delete i.recommendations[e+"#"+r]}};for(var e in i.requests){var n=i.requests[e].length;while(n--){if(i.requests[e][n]<(s-60000)){i.requests[e].splice(n,1)}}}},60000)}catch(e){this.errorHandler(e,"initGarbageCollector")}},setLocalStorage:function(e){var r=localStorage.getItem("db_disable_temp");if(r&&(new Date().getTime()-parseInt(r))>e["hibernation"]["duration"]){localStorage.removeItem("db_disable_temp")};var i=runDataGatherer.loadUrl({"mode":"specific","parameters":["db_mode"]})["parameters"]["db_mode"];if(!i)return;if(i==="remove"){localStorage.removeItem("db_forced_ab_tests");localStorage.removeItem("db_disable")};if(i==="disable"){localStorage.setItem("db_disable","true")};if(i==="recommendation"){localStorage.setItem("db_forced_ab_tests","[{ \"abTestSelector\": { \"abTestType\": \"main\" }, \"groupSelector\": { \"abTestTags\": [ \"recommendation\" ] } }]")};if(i==="original"){localStorage.setItem("db_forced_ab_tests","[{ \"abTestSelector\": { \"abTestType\": \"main\" }, \"groupSelector\": { \"abTestTags\": [ \"original\" ] } }]")}},startHibernation:function(e,r){try{var a=this.getConfig();if(a["hibernation"]["running"]){localStorage.setItem("db_disable_temp",new Date().getTime().toString());this.errorHandler({"name":"hibernation","message":e.name+", "+e.message},r);location.reload()}
else{this.errorHandler(e,r)}}catch(i){this.errorHandler(i,"startHibernation")}},createElementFromHTML:function(e){try{var r=document.createElement("div");r.innerHTML=e.trim();return r.firstChild}catch(i){this.errorHandler(i,"createElementFromHTML")}},getAbTest:function(e,r){try{if(!r){r="frontend"};var s=this,a={"accountId":runDataGatherer.getAccountId(),"recommendation_request":{"requests":[{"requestId":r,"request":{"template":{"templateId":r,"output":["scriptAbTest","mainAbTest"]},"userId":runDataGatherer.loadUserId(runDataGatherer.getConfig()["user_identification"])}}],"uniqueRecommendations":!0,"importanceType":"priority"},"synchronous":!0};if(localStorage.getItem("db_forced_ab_tests")){var n=JSON.parse(localStorage.getItem("db_forced_ab_tests"));a["recommendation_request"]["requests"][0]["request"]["abTests"]={"forcedAbTests":n}};var t=function(i){if(i.readyState===i.DONE&&i.status===200){var a=JSON.parse(i.responseText);e(a["responses"][r]["response"]["abTests"])}
else{s.errorHandler({},"getAbTest, xhr.status: "+i.status+", xhr.readyState: "+i.readyState+", xhr.responseText: "+i.responseText)}};runDataGatherer.makeCorsRequest(a,this.getUrl(),"POST",t,!0)}catch(i){this.errorHandler(i,"getAbTest")}},doRecommendationsContainRequiredAttributes:function(e,r){try{var t=[],n=this.config.positions[e]["item_attributes"];for(var a in n){if(n[a]["required"]){t.push(a)}};r.forEach(function(e){if(!e.hasOwnProperty("attributes")){return!1};t.forEach(function(i){if(!e["attributes"].hasOwnProperty(i)){return!1}})});return!0}catch(i){this.errorHandler(i,"doRecommendationsContainRequiredAttributes")}}};runDataGatherer.initPolyfills();runDataGatherer.initInView();runIndividualizer.initPolyfills();runIndividualizer.main();runDataGatherer.main()}catch(e$){try{var output={"dataPoints":[{"attributes":{"source_url":{"page":location.href},"user_agent":navigator.userAgent,"message_type":"error","error_name":e$.name,"error_message":"area: "+area+", "+e$.message+", "+e$.result}}]};var xhr=new XMLHttpRequest();xhr.url="https://api.databreakers.com/v1/groupon_us/dataPoint";xhr.method="POST";if("withCredentials" in xhr){xhr.open(xhr.method,xhr.url);xhr.type="XMLHttpRequest"}
else if(typeof XDomainRequest!="undefined"){xhr=new XDomainRequest();xhr.open(xhr.method,xhr.url);xhr.type="XDomainRequest"};xhr.setRequestHeader("Content-Type","text/plain;charset=utf-8");xhr.onerror=function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();xhr.onerror=null;return!1};if(xhr){xhr.send(JSON.stringify(output))}}catch(e$){}};