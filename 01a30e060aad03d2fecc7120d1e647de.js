// Desarrollo Web - v0.1.22 ?v=14
var COMMENTS_API="//comentarios.emol.com/Comments/Api",COMMENTS_API_CACHE="//cache-comentarios.ecn.cl/Comments/Api",MAX_ANSWERS=1,PRIVATE_MODE=!1;function InitEncuesta(){"undefined"==typeof GlobalHost&&(GlobalHost="//static.emol.cl/emol50"),$(".encuesta-emol").each(function(){var t=$(this).attr("data-id");$(this);"ok"!=$(this).attr("data-status")&&($(this).html($("<div>").attr("class","poll-loading").html("Cargando..")),CratePoll(t))})}function CratePoll(n){var s=$('.encuesta-emol[data-id="'+n+'"]');""!=getCookie("SSTES")&&"undefined"!=getCookie("SSTES")?s.attr("data-status","ok"):s.attr("data-status","not-login"),$.get(COMMENTS_API_CACHE,{async:!1,action:"getPoll",pollId:n}).done(function(o){var t=jQuery.parseJSON(o);MAX_ANSWERS=t.maxAnswers,PRIVATE_MODE=t.privateMode;try{""!=t.css?($("head").append($('<link rel="stylesheet" type="text/css" />').attr("href",t.css)),$("LINK[href*='encuestas.css']").remove()):$("head").append($('<link rel="stylesheet" type="text/css" />').attr("href",GlobalHost+"/css/encuestas.css?v=5"))}catch(t){}s.attr("data-private",t.privateMode),s.attr("data-answers",t.maxAnswers),s.html(""),s.append($("<div>").attr("class","answer-title answer-"+n+"-title").html(t.title)),0==t.open&&s.append($("<div>").attr("class","poll-end-banner").append($("<span>").attr("class","poll-txt-end").html("Encuesta finalizada"),$("<span>").attr("class","poll-line-end")));var l=$("<table>").attr("style","width: 100%;").attr("class","answer-table answer-table-"+t.id);$.get(COMMENTS_API,{async:!1,action:"getPollResults",pollId:n}).done(function(t){var e=[],s=0;jQuery.parseJSON(t).forEach(function(t){e.push({id:t.pollAnswer.id,votes:t.votes}),s+=t.votes});var a=jQuery.parseJSON(o).answers;for(i=0;i<a.length;i++)for(j=0;j<a.length;j++)e[j].id==a[i].id&&(a[i].votes=e[j].votes);a.sort((t,e)=>t.votes>e.votes?1:e.votes>t.votes?-1:0),a.forEach(function(t){var e=0;0<s&&(e=100*t.votes/s);var a=Math.round(10*e)/10,e="";""==t.urlPhoto&&(e="img-not");e=$("<tr>").attr("class","tr-poll-"+t.id+" "+e);e.append($("<td>").attr("class","td-radio").append($("<input>").attr("id","answer-"+t.id).attr("class","answer-radio-"+n).attr("related-id",t.relatedPollId).attr("type","checkbox").attr("name","answer-"+n).attr("value",t.id),$("<label>").attr("for","answer-"+t.id).attr("class","answer-text").html("x"))),""!=t.urlPhoto?e.append($("<td>").attr("class","td-img").append($("<img>").attr("class","answer-img").attr("src",t.urlPhoto.replace("http:","https:")))):e.append($("<td>").attr("class","td-img-not")),e.append($("<td>").attr("class","td-text").append($("<label>").attr("for","answer-"+t.id).attr("class","answer-text").html(t.answer))),e.append($("<td>").attr("class","td-percent").append(a.toString().replace(".",",")+"%")),l.append(e)})}),s.append(l),s.append($("<div>").attr("id","poll-view-text-"+n).attr("class","poll-view-text-end")),""!=getCookie("SSTES")&&"undefined"!=getCookie("SSTES")?$("#poll-view-text-"+n).append($("<div>").attr("class","button-save-poll button-save-poll-"+n).attr("onclick","GetAnswer("+n+")").html(" Votar ")):$("#poll-view-text-"+n).append($("<div>").attr("id","poll-view-"+n).attr("class","poll-view").append($("<div>").attr("class","poll-text-init-cession").html("Debes iniciar sesi&oacute;n para participar."),$("<div>").attr("class","cont_bt_mer_pram btn_pram_login").attr("style","display:block;").append($("<a>").attr("href","javascript:void(0);").attr("onclick",'$("#loginEmol").modal("show");CambiarTab("divLogin");').append($("<span>").attr("class","cont_icon_mer_emol_s").append($("<img>").attr("src","//static.emol.cl/emol50/img/emol_sesion.png")),$("<span>").attr("class","cont_txt_bt_emol_se").append("Iniciar sesi&oacute;n")))));var e=new Array,a=getCookie("emol_polls");null!=a&&(e=(a=unescape(a)).split(",")),t.open&&!e.includes(n.toString())||($(".button-save-poll-"+n).addClass("poll-button-disabled").html("Ya votaste"),$(".button-save-poll-"+n).removeAttr("onclick"),"true"!=$('.encuesta-emol[data-id="'+n+'"]').attr("data-private")?GetResult(n):(s.addClass("poll-end"),$("#poll-view-text-"+n).append($("<div>").attr("class","poll-text-date-end").append("Los Resultados ser&aacute;n publicados"))),0==t.open&&$(".button-save-poll-"+n).remove())})}function GetAnswer(o){if(""!=getCookie("SSTES")&&"undefined"!=getCookie("SSTES")&&null!=getCookie("SSTES")){var t,e,a=0;$(".answer-radio-"+o+":checkbox:checked").each(function(){a+=1}),a.toString()==$('.encuesta-emol[data-id="'+o+'"]').attr("data-answers")?($(".button-save-poll-"+o).addClass("poll-button-disabled").html("Ya votaste"),$(".answer-radio-"+o+":checkbox:checked").each(function(a){var s=$(this).val();$.get(COMMENTS_API,{action:"answerPoll",answerId:s,emolToken:getCookie("SSTES")}).done(function(t){var e=!0;try{Temas.includes("Festival de Viña del Mar")&&(e=!1)}catch(t){}e&&modalShareVote(o,s);t=jQuery.parseJSON(t);t.status,"ok"==t.status&&$(".encuesta-emol").each(function(){$(this).attr("data-id")==o&&$("#status-result-poll-"+o).html("Gracias Por Votar.")}),"already voted or invalid poll"==t.error&&$(".encuesta-emol").each(function(){$(this).attr("data-id")}),a===parseInt($('.encuesta-emol[data-id="'+o+'"]').attr("data-answers"))-1&&("false"==$('.encuesta-emol[data-id="'+o+'"]').attr("data-private")?($(".button-save-poll-"+o).removeAttr("onclick"),console.log("GetResult If"),GetResult(o)):(console.log("GetResult Else"),$(".button-save-poll-"+o).removeAttr("onclick"),$("#poll-view-text-"+o).append($("<div>").attr("class","poll-text-date-end").append("Los Resultados ser&aacute;n publicados."))));t=$("#answer-"+s).attr("related-id");$.isNumeric(t)&&($('.encuesta-emol[data-id="'+o+'"]').after($("<blockquote>").attr("class","encuesta-emol").attr("data-id",t)),CratePoll(t))})}),t=new Array,null!=(e=getCookie("emol_polls"))&&(t=(e=unescape(e)).split(",")),t.includes(o.toString())||t.push(o),setCookie("emol_polls",t,"360")):"1"==$('.encuesta-emol[data-id="'+o+'"]').attr("data-answers")?alert("Debes seleccionar "+$('.encuesta-emol[data-id="'+o+'"]').attr("data-answers")+" opción."):alert("Debes seleccionar "+$('.encuesta-emol[data-id="'+o+'"]').attr("data-answers")+" opciones.")}else{$('.encuesta-emol[data-id="'+o+'"]').attr("data-status","not-login"),console.log("Init Secion error"),$("#poll-view-text-"+o).append($("<div>").attr("id","poll-view-"+o).attr("class","poll-view").append($("<div>").attr("class","poll-text-init-cession").html("Debes iniciar sesi&oacute;n para participar."),$("<div>").attr("class","cont_bt_mer_pram btn_pram_login").attr("style","display:block;").append($("<a>").attr("href","https://pram.elmercurio.com/Login.aspx?ApplicationName=EMOL&SSOTargetUrl="+cmtData.page).append($("<span>").attr("class","cont_icon_mer_emol_s").append($("<img>").attr("src","http://staticemol.gen.emol.cl/img/emol_sesion.png")),$("<span>").attr("class","cont_txt_bt_emol_se").append("Iniciar sesi&oacute;n")))));try{setTimeout(FB.XFBML.parse(),2e3)}catch(t){}$(".button-save-poll-"+o).remove()}}function modalShareVote(t,e){0==$("#trivia_emol_popUp").length&&$("body").append('<div class="emol_modal"><div class="modal fade in" id="trivia_emol_popUp" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="false" style="display: block;"><div class="modal-dialog modal-dialog-centered" role="document"><div class="modal-content"><div class="modal-header"><span><img src="https://static.emol.cl/emol50/img/logo_txt_esocial.png"></span><span class="close" data-dismiss="modal"><i class="fa fa-times"></i></span></div><div class="modal-body"><div class="content_encuesta"><div class="back_top_encuesta"> <img src="https://static.emol.cl/emol50/img/icono_encuesta.png"><span>¡Gracias por tu voto!</span></div><div class="cont_txt_modal_encuesta"> <span class="tit_modal_encuesta"><div class="answer-title">'+$(".answer-"+t+"-title").html()+'</div><span class="icon_squares"> <span class="square_enc"> <i class="fa fa-check"></i> </span> </span> <span class="txt">Voté por:</span></span><i class="fa fa-check-square check_encuesta"></i>'+$(".tr-poll-"+e+" .td-text .answer-text").html()+'<span class="tit_opina_modal">Opina y comparte tu votación</span></div><textarea id="text_area_vex_poll" contenteditable="true" class="text_area_vex" name="text_area_vex" rows="4" cols="50"></textarea><div class="dest_compartir"><div class="btn_compartir_modal" onclick="shareVote('+t+","+e+')" id="btn_compartir_modal"><a href="#">COMPARTIR</a></div></div></div></div><div class="modal-footer"></div></div></div></div></div>'),$("#text_area_vex_poll").val(""),$("#trivia_emol_popUp").modal("show")}function shareVote(t,e){CommentsApi.expressComment("#EncuestarEmol["+t+","+e+"]"+text_area_vex_poll.value),pollReplay(t,e),$("#trivia_emol_popUp").modal("hide")}function pollReplay(t,e){var a="#EncuestarEmol["+t+","+e+","+IDNoticia+"]"+text_area_vex_poll.value,t="POST";/(MSIE 8)|(MSIE 9)/i.test(navigator.userAgent)&&(t="GET");e=JSON.parse(unescape(getCookie("c_user_p"))).nick.removeAccents().split(" ").join("-");console.log(a),$.ajax({url:urlComments,method:t,dataType:"json",data:{action:"newComment",text:a,url:"https://comentarista.emol.com/"+getCookie("c_user_i")+"/"+e+".html",accessToken:cmtData.accessToken,authType:cmtData.authType,isAdmin:cmtData.isAdmin?"Y":"N",acceptedConditions:cmtData.aprtym?"Y":"N"}}).done(function(t){console.log("Encuesta compartida")}).fail(function(t){console.log("Encuesta compartida")})}function GetResult(e){$.get(COMMENTS_API,{async:!1,action:"getPollResults",pollId:e}).done(function(t){var t=jQuery.parseJSON(t),a=0;t.forEach(function(t){a+=t.votes}),$("#poll-view-text-"+e).append($("<div>").attr("id","result-poll-value-"+e).attr("class","result-poll-value").html("Votos totales: "+miles(a))),$(".answer-table-"+e).addClass("answer-finished"),t.forEach(function(t){var e=0;0<a&&(e=100*t.votes/a),$(".td-radio-"+t.pollAnswer.id).remove(),$(".td-radio-"+t.pollAnswer.id).remove(),$(".tr-poll-"+t.pollAnswer.id+" .td-radio").remove(),$(".tr-poll-"+t.pollAnswer.id+" .td-text").remove(),$(".tr-poll-"+t.pollAnswer.id+" .td-percent").remove();e=Math.round(10*e)/10;$(".tr-poll-"+t.pollAnswer.id).append($("<table>").attr("style","width: 100%;").append($("<tr>").append($("<td>").attr("class","answer-text-result").append(t.pollAnswer.answer).append($("<span>").append("<b>Votos:</b> <i>"+miles(t.votes)+"</i>"))),$("<tr>").append($("<td>").attr("class","answer-text-result").append('<div class="grafico"><strong class="barra" style="width: '+e+'%;"></strong><div class="porcentaje">'+e.toString().replace(".",",")+"%</div></div>"))))})})}function miles(t){return t=(t=t.toString().split("").reverse().join("").replace(/(?=\d*\.?)(\d{3})/g,"$1.")).split("").reverse().join("").replace(/^[\.]/,"")}$(document).ready(function(){document.cookie=encodeURIComponent("emol_polls")+"=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;","function"==typeof InitEncuesta&&InitEncuesta()});